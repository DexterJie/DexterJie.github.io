<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/0.jpg">
  <link rel="mask-icon" href="/images/0.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dexterjie.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="第一届OpenHarmony CTF专题赛 Crypto题解">
<meta property="og:type" content="article">
<meta property="og:title" content="第一届OpenHarmonyCTF">
<meta property="og:url" content="https://dexterjie.github.io/2025/06/09/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmonyCTF/index.html">
<meta property="og:site_name" content="DexterJie&#39;Blog">
<meta property="og:description" content="第一届OpenHarmony CTF专题赛 Crypto题解">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-06-09T13:18:18.000Z">
<meta property="article:modified_time" content="2025-06-09T13:19:00.079Z">
<meta property="article:author" content="DexterJie">
<meta property="article:tag" content="Wp">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dexterjie.github.io/2025/06/09/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmonyCTF/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dexterjie.github.io/2025/06/09/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmonyCTF/","path":"2025/06/09/赛题复现/第一届OpenHarmonyCTF/","title":"第一届OpenHarmonyCTF"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>第一届OpenHarmonyCTF | DexterJie'Blog</title>
  







<link rel="dns-prefetch" href="waline-five-mocha.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DexterJie'Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Never Mind the Scandal and Liber!!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1456890009&auto=1&height=66"></iframe>
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Weak-random"><span class="nav-number">1.</span> <span class="nav-text">Weak_random</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ea5y-RSA"><span class="nav-number">2.</span> <span class="nav-text">Ea5y_RSA</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Small-Message-For-SM4-Encryption"><span class="nav-number">3.</span> <span class="nav-text">Small Message For (SM4) Encryption</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Simple-LLL"><span class="nav-number">4.</span> <span class="nav-text">Simple LLL</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="DexterJie"
      src="/images/0.jpg">
  <p class="site-author-name" itemprop="name">DexterJie</p>
  <div class="site-description" itemprop="description">一枚只会Crypto的菜鸡</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">79</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dexterjie.github.io/2025/06/09/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmonyCTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/0.jpg">
      <meta itemprop="name" content="DexterJie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DexterJie'Blog">
      <meta itemprop="description" content="一枚只会Crypto的菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="第一届OpenHarmonyCTF | DexterJie'Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          第一届OpenHarmonyCTF
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-06-09 21:18:18 / 修改时间：21:19:00" itemprop="dateCreated datePublished" datetime="2025-06-09T21:18:18+08:00">2025-06-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Wp/" itemprop="url" rel="index"><span itemprop="name">Wp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2025/06/09/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmonyCTF/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2025/06/09/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmonyCTF/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>第一届OpenHarmony CTF专题赛 Crypto题解</p>
<span id="more"></span>

<p>赛题不是很难， 但是套了层鸿蒙，还挺有意思的。</p>
<h1 id="Weak-random"><a href="#Weak-random" class="headerlink" title="Weak_random"></a>Weak_random</h1><p>seed的范围很小，可以直接爆，iv不影响CBC第一块密文之后的解密结果，所以不用管iv</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&quot;a4d1a3d4a4c5eee0834449f1ed4539b3b29157825d0dbfa51e84525bb00ed5b5f462e994a2c742baa5fb90977507983c&quot;</span></span><br><span class="line">check = <span class="string">&quot;063043351f9576f5ffeaa565da8edf70dad688fd8b406742fa166de432d1ae27&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> entropy_part1 <span class="keyword">in</span> trange(<span class="number">10000</span>):</span><br><span class="line">    <span class="keyword">for</span> entropy_part2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        final_seed = entropy_part1 + (entropy_part2 &lt;&lt; <span class="number">8</span>) </span><br><span class="line">        random.seed(final_seed)</span><br><span class="line">        key = random.getrandbits(<span class="number">128</span>)</span><br><span class="line">        iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">        keybyte = long_to_bytes(key)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(keybyte) == <span class="number">16</span>:</span><br><span class="line">            aes = AES.new(keybyte,AES.MODE_CBC,iv)</span><br><span class="line">            flag = aes.decrypt(<span class="built_in">bytes</span>.fromhex(enc))[-<span class="number">32</span>:]</span><br><span class="line">            <span class="keyword">if</span> hashlib.sha256(flag).hexdigest() == check:</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">                <span class="comment"># flag&#123;0428f4ff1a4e3d2e2326552f9db48fa9&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="Ea5y-RSA"><a href="#Ea5y-RSA" class="headerlink" title="Ea5y_RSA"></a>Ea5y_RSA</h1><p>两个关键文件是，<code>entry/src/main/ets/util</code>路径下的RsaUtil.ets和<code>entry/src/main/ets/page</code>下的Index.ets</p>
<blockquote>
<p>RsaUtil.ets</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">import &#123; cryptoFramework &#125; from &#x27;@kit.CryptoArchitectureKit&#x27;;</span><br><span class="line">import &#123; buffer &#125; from &#x27;@kit.ArkTS&#x27;;</span><br><span class="line"></span><br><span class="line">class RsaUtil&#123;</span><br><span class="line">  private keyPair: cryptoFramework.KeyPair | null = null;</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">    let keyGenerator = cryptoFramework.createAsyKeyGenerator(&#x27;RSA1024&#x27;);</span><br><span class="line">    this.keyPair = keyGenerator.generateKeyPairSync();</span><br><span class="line">  &#125;</span><br><span class="line">  encrypt(data: string): cryptoFramework.DataBlob&#123;</span><br><span class="line">    let plainText: cryptoFramework.DataBlob = &#123; data: new Uint8Array(buffer.from(data, &#x27;utf-8&#x27;).buffer) &#125;;</span><br><span class="line"></span><br><span class="line">    if(this.keyPair != null)&#123;</span><br><span class="line">      return this.rsaEncryptBySegment(this.keyPair.pubKey, plainText);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      console.error(&#x27;Key is null&#x27;);</span><br><span class="line">      return plainText;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  rsaEncryptBySegment(pubKey: cryptoFramework.PubKey, plainText: cryptoFramework.DataBlob) &#123;</span><br><span class="line">    let cipher = cryptoFramework.createCipher(&#x27;RSA1024|PKCS1&#x27;);</span><br><span class="line">    cipher.initSync(cryptoFramework.CryptoMode.ENCRYPT_MODE, pubKey, null);</span><br><span class="line">    let plainTextSplitLen = 64;</span><br><span class="line">    let cipherText = new Uint8Array();</span><br><span class="line">    for (let i = 0; i &lt; plainText.data.length; i += plainTextSplitLen ) &#123;</span><br><span class="line">      let updateMessage = plainText.data.subarray(i, i + plainTextSplitLen );</span><br><span class="line">      let updateMessageBlob: cryptoFramework.DataBlob = &#123; data: updateMessage &#125;;</span><br><span class="line">      let updateOutput = cipher.doFinalSync(updateMessageBlob);</span><br><span class="line">      let mergeText = new Uint8Array(cipherText.length + updateOutput.data.length);</span><br><span class="line">      mergeText.set(cipherText);</span><br><span class="line">      mergeText.set(updateOutput.data, cipherText.length);</span><br><span class="line">      cipherText = mergeText;</span><br><span class="line">    &#125;</span><br><span class="line">    let cipherBlob: cryptoFramework.DataBlob = &#123; data: cipherText &#125;;</span><br><span class="line">    return cipherBlob;</span><br><span class="line">  &#125;</span><br><span class="line">  getGift(): number[]&#123;</span><br><span class="line">    let gift: number[] = [0];</span><br><span class="line">    if(this.keyPair != null)&#123;</span><br><span class="line">      let pri = this.keyPair.priKey.getEncoded().data;</span><br><span class="line"></span><br><span class="line">      for(let i: number = 7; i &lt; 285; i++)&#123;</span><br><span class="line">        gift.push(pri[i]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return gift;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default new RsaUtil();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Index.ets</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">check()&#123;</span><br><span class="line">  let encryptText = RsaUtil.encrypt(this.flag);</span><br><span class="line">  let base64 = new util.Base64Helper();</span><br><span class="line">  let c = base64.encodeToStringSync(encryptText.data);</span><br><span class="line"></span><br><span class="line">  if(c === &#x27;2z/TenC2n+eLR6WbO8mQcJsdKMasdA2/K6xDQj2ABqZvMz1PHTdUvnw7YcFv9fM7BYqf7WCbVFYzJINUeseI7f+72PEw6XuTyDW4s6nE6bZr51XrX383raumpOxUwryCudjsFEsDRmq16sgf0Rk2KJCVLyaXhDstMux+VumSaEY=&#x27;)&#123;</span><br><span class="line">    promptAction.showToast(&#123;</span><br><span class="line">      message: &quot;Wow, you find the true flag&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    promptAction.showToast(&#123;</span><br><span class="line">      message: &quot;oh, Sorry. But In my Log, this is a gift for you&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">    let gift = RsaUtil.getGift();</span><br><span class="line">    console.log(&#x27;my gift:&#x27;, gift);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从RsaUtil.ets中的<code>rsaEncryptBySegment</code>函数可以知道，hint是RSA私钥文件的第7-284字节，恢复一下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hint = [<span class="number">48</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">42</span>,<span class="number">134</span>,<span class="number">72</span>,<span class="number">134</span>,<span class="number">247</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">130</span>,<span class="number">2</span>,<span class="number">97</span>,<span class="number">48</span>,<span class="number">130</span>,<span class="number">2</span>,<span class="number">93</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">129</span>,<span class="number">129</span>,<span class="number">0</span>,<span class="number">219</span>,<span class="number">91</span>,<span class="number">76</span>,<span class="number">137</span>,<span class="number">49</span>,<span class="number">174</span>,<span class="number">41</span>,<span class="number">189</span>,<span class="number">193</span>,<span class="number">240</span>,<span class="number">64</span>,<span class="number">187</span>,<span class="number">23</span>,<span class="number">143</span>,<span class="number">171</span>,<span class="number">74</span>,<span class="number">107</span>,<span class="number">120</span>,<span class="number">166</span>,<span class="number">142</span>,<span class="number">186</span>,<span class="number">244</span>,<span class="number">90</span>,<span class="number">56</span>,<span class="number">6</span>,<span class="number">54</span>,<span class="number">147</span>,<span class="number">63</span>,<span class="number">158</span>,<span class="number">119</span>,<span class="number">222</span>,<span class="number">110</span>,<span class="number">46</span>,<span class="number">245</span>,<span class="number">223</span>,<span class="number">167</span>,<span class="number">190</span>,<span class="number">173</span>,<span class="number">76</span>,<span class="number">7</span>,<span class="number">36</span>,<span class="number">210</span>,<span class="number">188</span>,<span class="number">249</span>,<span class="number">83</span>,<span class="number">151</span>,<span class="number">200</span>,<span class="number">24</span>,<span class="number">88</span>,<span class="number">11</span>,<span class="number">247</span>,<span class="number">108</span>,<span class="number">112</span>,<span class="number">208</span>,<span class="number">109</span>,<span class="number">173</span>,<span class="number">32</span>,<span class="number">143</span>,<span class="number">133</span>,<span class="number">158</span>,<span class="number">62</span>,<span class="number">83</span>,<span class="number">232</span>,<span class="number">150</span>,<span class="number">60</span>,<span class="number">120</span>,<span class="number">232</span>,<span class="number">201</span>,<span class="number">90</span>,<span class="number">239</span>,<span class="number">207</span>,<span class="number">77</span>,<span class="number">200</span>,<span class="number">36</span>,<span class="number">2</span>,<span class="number">107</span>,<span class="number">62</span>,<span class="number">204</span>,<span class="number">214</span>,<span class="number">35</span>,<span class="number">28</span>,<span class="number">190</span>,<span class="number">48</span>,<span class="number">150</span>,<span class="number">242</span>,<span class="number">52</span>,<span class="number">247</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">255</span>,<span class="number">164</span>,<span class="number">13</span>,<span class="number">122</span>,<span class="number">170</span>,<span class="number">42</span>,<span class="number">223</span>,<span class="number">66</span>,<span class="number">36</span>,<span class="number">114</span>,<span class="number">134</span>,<span class="number">183</span>,<span class="number">30</span>,<span class="number">99</span>,<span class="number">21</span>,<span class="number">31</span>,<span class="number">224</span>,<span class="number">194</span>,<span class="number">169</span>,<span class="number">223</span>,<span class="number">86</span>,<span class="number">12</span>,<span class="number">216</span>,<span class="number">139</span>,<span class="number">0</span>,<span class="number">255</span>,<span class="number">220</span>,<span class="number">115</span>,<span class="number">223</span>,<span class="number">83</span>,<span class="number">90</span>,<span class="number">71</span>,<span class="number">25</span>,<span class="number">221</span>,<span class="number">180</span>,<span class="number">160</span>,<span class="number">8</span>,<span class="number">212</span>,<span class="number">41</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">129</span>,<span class="number">128</span>,<span class="number">82</span>,<span class="number">97</span>,<span class="number">158</span>,<span class="number">131</span>,<span class="number">227</span>,<span class="number">241</span>,<span class="number">153</span>,<span class="number">225</span>,<span class="number">151</span>,<span class="number">69</span>,<span class="number">136</span>,<span class="number">185</span>,<span class="number">251</span>,<span class="number">38</span>,<span class="number">76</span>,<span class="number">217</span>,<span class="number">93</span>,<span class="number">53</span>,<span class="number">105</span>,<span class="number">176</span>,<span class="number">47</span>,<span class="number">12</span>,<span class="number">120</span>,<span class="number">25</span>,<span class="number">148</span>,<span class="number">83</span>,<span class="number">200</span>,<span class="number">199</span>,<span class="number">90</span>,<span class="number">215</span>,<span class="number">127</span>,<span class="number">228</span>,<span class="number">247</span>,<span class="number">164</span>,<span class="number">5</span>,<span class="number">196</span>,<span class="number">52</span>,<span class="number">251</span>,<span class="number">86</span>,<span class="number">147</span>,<span class="number">84</span>,<span class="number">68</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">202</span>,<span class="number">83</span>,<span class="number">53</span>,<span class="number">165</span>,<span class="number">214</span>,<span class="number">227</span>,<span class="number">95</span>,<span class="number">160</span>,<span class="number">13</span>,<span class="number">90</span>,<span class="number">105</span>,<span class="number">230</span>,<span class="number">92</span>,<span class="number">85</span>,<span class="number">42</span>,<span class="number">132</span>,<span class="number">124</span>,<span class="number">185</span>,<span class="number">252</span>,<span class="number">158</span>,<span class="number">69</span>,<span class="number">85</span>,<span class="number">122</span>,<span class="number">160</span>,<span class="number">246</span>,<span class="number">99</span>,<span class="number">167</span>,<span class="number">168</span>,<span class="number">183</span>,<span class="number">89</span>,<span class="number">173</span>,<span class="number">57</span>,<span class="number">73</span>,<span class="number">126</span>,<span class="number">186</span>,<span class="number">253</span>,<span class="number">22</span>,<span class="number">111</span>,<span class="number">92</span>,<span class="number">152</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">95</span>,<span class="number">175</span>,<span class="number">46</span>,<span class="number">189</span>,<span class="number">186</span>,<span class="number">93</span>,<span class="number">207</span>,<span class="number">30</span>,<span class="number">207</span>,<span class="number">8</span>,<span class="number">231</span>,<span class="number">173</span>,<span class="number">143</span>,<span class="number">91</span>,<span class="number">128</span>,<span class="number">18</span>,<span class="number">58</span>,<span class="number">6</span>,<span class="number">25</span>,<span class="number">209</span>,<span class="number">64</span>,<span class="number">207</span>,<span class="number">123</span>,<span class="number">224</span>,<span class="number">255</span>,<span class="number">177</span>]</span><br><span class="line">plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hint:</span><br><span class="line">    plaintext += <span class="built_in">hex</span>(i)[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(plaintext)</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">300d06092a864886f70d0101010500048202613082025d02010002818100db5b4c8931ae29bdc1f040bb178fab4a6b78a68ebaf45a380636933f9e77de6e2ef5dfa7bead4c0724d2bcf95397c818580bf76c70d06dad208f859e3e53e8963c78e8c95aefcf4dc824026b3eccd6231cbe3096f234f7040bffa40d7aaa2adf42247286b71e63151fe0c2a9df560cd88b00ffdc73df535a4719ddb4a008d429020301000102818052619e83e3f199e1974588b9fb264cd95d3569b02f0c78199453c8c75ad77fe4f7a405c434fb56935444050eca5335a5d6e35fa00d5a69e65c552a847cb9fc9e45557aa0f663a7a8b759ad39497ebafd166f5c980e055faf2ebdba5dcf1ecf08e7ad8f5b80123a0619d140cf7be0ffb1</span><br></pre></td></tr></table></figure>

<p>按pem文件格式稍微区分一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">300d06092a864886f70d0101010500048202613082025d</span><br><span class="line">020100</span><br><span class="line">	02818100</span><br><span class="line">db5b4c8931ae29bdc1f040bb178fab4a6b78a68ebaf45a380636933f9e77de6e2ef5dfa7bead4c0724d2bcf95397c818580bf76c70d06dad208f859e3e53e8963c78e8c95aefcf4dc824026b3eccd6231cbe3096f234f7040bffa40d7aaa2adf42247286b71e63151fe0c2a9df560cd88b00ffdc73df535a4719ddb4a008d429</span><br><span class="line">	0203</span><br><span class="line">		010001</span><br><span class="line">	028180	52619e83e3f199e1974588b9fb264cd95d3569b02f0c78199453c8c75ad77fe4f7a405c434fb56935444050eca5335a5d6e35fa00d5a69e65c552a847cb9fc9e45557aa0f663a7a8b759ad39497ebafd166f5c980e055faf2ebdba5dcf1ecf08e7ad8f5b80123a0619d140cf7be0ffb1</span><br></pre></td></tr></table></figure>

<p>从中提取出<code>n</code>，<code>e</code>，以及<code>d</code>的高位（895bit），那大概率是低位128未知。</p>
<p>我的思路是用<br>$$<br>k’ &#x3D; \frac{e\times d_h}{n} + 1<br>$$<br>来近似正确的<code>k</code>，实际上这就是正确的<code>k</code></p>
<p>然后令<br>$$<br>S &#x3D; N + 1 - \frac{(e\times d_h)}{k}<br>$$</p>
<p>$$<br>D &#x3D; \sqrt{S^2 - 4n}<br>$$</p>
<p>然后计算<br>$$<br>p_h &#x3D; \frac{S + D}{2}<br>$$<br>得到的$p_h$和正确的$p$差了低128bit左右，一元copper得解</p>
<p>思路来源：<a target="_blank" rel="noopener" href="https://cic.iacr.org/p/1/3/29/pdf">Small Public Exponent Brings More: Improved Partial Key Exposure Attacks against RSA</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">0xdb5b4c8931ae29bdc1f040bb178fab4a6b78a68ebaf45a380636933f9e77de6e2ef5dfa7bead4c0724d2bcf95397c818580bf76c70d06dad208f859e3e53e8963c78e8c95aefcf4dc824026b3eccd6231cbe3096f234f7040bffa40d7aaa2adf42247286b71e63151fe0c2a9df560cd88b00ffdc73df535a4719ddb4a008d429</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">dh = <span class="number">0x52619e83e3f199e1974588b9fb264cd95d3569b02f0c78199453c8c75ad77fe4f7a405c434fb56935444050eca5335a5d6e35fa00d5a69e65c552a847cb9fc9e45557aa0f663a7a8b759ad39497ebafd166f5c980e055faf2ebdba5dcf1ecf08e7ad8f5b80123a0619d140cf7be0ffb1</span></span><br><span class="line">c = <span class="string">&quot;2z/TenC2n+eLR6WbO8mQcJsdKMasdA2/K6xDQj2ABqZvMz1PHTdUvnw7YcFv9fM7BYqf7WCbVFYzJINUeseI7f+72PEw6XuTyDW4s6nE6bZr51XrX383raumpOxUwryCudjsFEsDRmq16sgf0Rk2KJCVLyaXhDstMux+VumSaEY=&quot;</span></span><br><span class="line">c = bytes_to_long(base64.b64decode(c))</span><br><span class="line">unknown = <span class="number">128</span></span><br><span class="line">dh = dh &lt;&lt; unknown</span><br><span class="line">k = e * dh // n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 求p的高位</span></span><br><span class="line">S = n + <span class="number">1</span> - ((e*dh - <span class="number">1</span>) // k)</span><br><span class="line">D = gmpy2.iroot(<span class="built_in">abs</span>(S**<span class="number">2</span> - <span class="number">4</span>*n),<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">tmp = <span class="built_in">int</span>((S + D) // <span class="number">2</span>)</span><br><span class="line">ph = tmp &gt;&gt; <span class="number">140</span> &lt;&lt; <span class="number">140</span></span><br><span class="line"><span class="comment"># 恢复p</span></span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = ph + x</span><br><span class="line">res = f.small_roots(X=<span class="number">2</span>^<span class="number">140</span>,beta=<span class="number">0.49</span>)</span><br><span class="line">p = <span class="built_in">int</span>(ph + res[<span class="number">0</span>])</span><br><span class="line">q = n // p</span><br><span class="line">d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># flag&#123;O1d_WIN3_In_4_New_B0ttlE_HAhAh4HAHA&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="Small-Message-For-SM4-Encryption"><a href="#Small-Message-For-SM4-Encryption" class="headerlink" title="Small Message For (SM4) Encryption"></a>Small Message For (SM4) Encryption</h1><p>猜测<code>secret_message</code>很短，直接爆破</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm4</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line">leak = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;ee278c4e526ff15b8d308b6b18f83221&quot;</span>)</span><br><span class="line">ciphertext = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;d9ea43b0d208aa168e4a275a69df3bc86051e756f9ca7959b68c6b23c9e1b69c19e08b75938375a6be830d1844d8a6e368faf1ddffecea69b5abe00ac0d6e10d6696be33d40e83a272072fbe131f98c82587011f61f2d58a020c8c54cf9b651abd740a3d55d36daa9c88cfc10a520ce4211fba4365ce98b82355b17c64dd2de4800fc68df36cfa8a3fd05baac6970dcd&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">ciphertext, key, iv</span>):</span><br><span class="line">    cipher = sm4.CryptSM4(sm4.SM4_DECRYPT)</span><br><span class="line">    cipher.set_key(key, sm4.SM4_DECRYPT)</span><br><span class="line">    <span class="keyword">return</span> cipher.crypt_cbc(iv, ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b))</span><br><span class="line"></span><br><span class="line">printable = <span class="string">b&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">17</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;正在尝试长度为:<span class="subst">&#123;length&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(printable, repeat=length):</span><br><span class="line">        secret_message = <span class="built_in">bytes</span>(i)</span><br><span class="line">        key = secret_message</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(key) &lt; <span class="number">16</span>:</span><br><span class="line">            key += secret_message</span><br><span class="line">        iv = xor(key, leak)</span><br><span class="line">        plaintext = decrypt(ciphertext, key, iv)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> plaintext:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;key = <span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(plaintext)</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key = b&#x27;sMsMsMsMsMsMsMsM&#x27;</span><br><span class="line">b&quot;My FLAG? If you want it, I&#x27;ll let you have it... search for it! I left all of it at that place: flag&#123;tHe_m3s5ag3_1s_2_sMa11!11!&#125;&quot;</span><br></pre></td></tr></table></figure>

<h1 id="Simple-LLL"><a href="#Simple-LLL" class="headerlink" title="Simple LLL"></a>Simple LLL</h1><p>定位到关键函数<code>runMixer</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object #~@<span class="number">0</span>&gt;#runMixer(Object functionObject, Object newTarget, Index <span class="built_in">this</span>) &#123;</span><br><span class="line">        obj = <span class="built_in">this</span>.flag;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">this</span>.flag.length &lt; <span class="number">6</span> ? <span class="number">1</span> : <span class="number">0</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.output = <span class="string">&quot;Flag too short!&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (istrue((<span class="string">&quot;flag&#123;&quot;</span> != obj.substring(<span class="number">0</span>, <span class="number">5</span>) ? <span class="number">1</span> : <span class="number">0</span>)) != <span class="literal">null</span> || isfalse((<span class="string">&quot;&#125;&quot;</span> != obj[obj.length - <span class="number">1</span>] ? <span class="number">1</span> : <span class="number">0</span>)) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.output = <span class="string">&quot;Invalid flag, must starts with `flag&#123;` and ends with `&#125;`&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        substring = obj.substring(<span class="number">5</span>, obj.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> ((<span class="number">0</span> != (substring.length % <span class="number">3</span>) ? <span class="number">1</span> : <span class="number">0</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.output = <span class="string">&quot;Invalid key length (must be multiple of 3)&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">        getPrime = <span class="built_in">this</span>.getPrime(<span class="number">215</span>);</span><br><span class="line">        getPrime2 = <span class="built_in">this</span>.getPrime(<span class="number">128</span>);</span><br><span class="line">        getPrime3 = <span class="built_in">this</span>.getPrime(<span class="number">170</span>);</span><br><span class="line">        r36 = [Object];</span><br><span class="line">        obj2 = getiterator(<span class="string">&quot;Lattice-based cryptography is the generic term for constructions of cryptographic primitives that involve lattices, either in the construction itself or in the security proof.&quot;</span>.substring(<span class="number">0</span>, <span class="number">50</span>));</span><br><span class="line">        obj3 = obj2.next;</span><br><span class="line">        i2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            callthisN = obj3();</span><br><span class="line">            throw.ifnotobject(callthisN);</span><br><span class="line">            <span class="keyword">if</span> (istrue(callthisN.done) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            r362 = callthisN.value;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                bytesToLong = <span class="built_in">this</span>.bytesToLong(substring[i] + substring[i + <span class="number">1</span>] + substring[i + <span class="number">2</span>]);</span><br><span class="line">                i += <span class="number">3</span>;</span><br><span class="line">                r362 = (i &gt;= substring.length ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (r362 != <span class="number">0</span>) &#123;</span><br><span class="line">                    i = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                r36.push((<span class="built_in">this</span>.getRandomBits(<span class="number">190</span>) * getPrime) + ((<span class="built_in">this</span>.modPow(getPrime2, bytesToLong, getPrime3) * BigInt(r362.charCodeAt(<span class="number">0</span>))) % getPrime3));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ExceptionI0 unused) &#123;</span><br><span class="line">                z = r362;</span><br><span class="line">                <span class="keyword">if</span> (istrue(i2) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    i2 = <span class="number">1</span>;</span><br><span class="line">                    obj4 = <span class="literal">null</span>;</span><br><span class="line">                    r363 = hole;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        obj5 = obj2.return;</span><br><span class="line">                        obj3 = obj5;</span><br><span class="line">                        r363 = (<span class="number">0</span> == obj5 ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (ExceptionI0 unused2) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (r363 == <span class="number">0</span>) &#123;</span><br><span class="line">                        obj4 = obj3();</span><br><span class="line">                        <span class="keyword">throw</span>(z);</span><br><span class="line">                        throw.ifnotobject(obj4);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span>(z);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.output = <span class="string">&quot;P: &quot;</span> + getPrime3 + <span class="string">&quot;, G: &quot;</span> + getPrime2 + <span class="string">&quot;\nEncrypted: [&quot;</span> + r36.join(<span class="string">&quot;, &quot;</span>) + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">        console.error(<span class="string">&quot;P: &quot;</span> + getPrime3 + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        console.error(<span class="string">&quot;G: &quot;</span> + getPrime2 + <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>先把flag按3字节拆分，然后生成3个素数，加密逻辑是<code>encrypted_i = k_i * getPrime + (getPrime2 ^ flag_i,getPrime3) * ord(s_i) % P</code>，s是上面那串很长的字符串</p>
<p>把后面模P部分看作<code>y_i</code>，就是ACD。拿正交格打出后面DLP部分，然后解DLP</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">P = <span class="number">1254116318848000721162616841861668357042678028242871</span></span><br><span class="line">G = <span class="number">209950396597656524832933655724759236601</span></span><br><span class="line">Encrypted = [<span class="number">49075650530646745101583770544994878354350706600794137221493223425586773770444878005832637252613273185571525401857599466024</span>, <span class="number">32462058523831346965301451867146918419501780168654009007894837156535508614721716192457580504544083283156909800751366422095</span>, <span class="number">30972208810535296088928411886973751419617618309332429902969141779778292135413139940847060084830481982818980039701908647188</span>, <span class="number">36223574592391465479610118714694121780652259811896545667946982891979827110400079684720554665327962837948029887902911934412</span>, <span class="number">51083493449145987338071924797694856705969670516974983529541234868336268181840557466743268534891548519807169187995970255210</span>, <span class="number">46886310857573570123362938810630869611862461311551079654729345179011458677502368863164644598223367343833695547090533503341</span>, <span class="number">41708987706001718769608385110174384681410129197881430477256694463144195570856661595611916434585980611056756461291298472053</span>, <span class="number">30432351497415348382971171275378355359918508620694918719611498083801325935877535604696864046477138836882529337593346354232</span>, <span class="number">37560091205301885324103234765518311779406333692270015257703458177088739786303881151059582186911290629475272554877805151653</span>, <span class="number">31738173296730605298164313891136444126736390111525241834683826120523560694916544054475801123227319258203564087555114509638</span>, <span class="number">50467796950716988044567626656972211530828588399176491422572772105434068772625329068013940121046216843532049180580147283042</span>, <span class="number">32336092218697303538039888038013301651734768870962551231671340266349215882532885410190230501882822408733225249079178061292</span>, <span class="number">49233450637503908199331577713636388807738552874189785067376543229399582025835470237637909525452461674632729257338416707780</span>, <span class="number">28924861393443192065262429103620760999268015168472730662823316530606489620828661715860808895274847890501584963069001731650</span>, <span class="number">29876871203434245756788637186918045878619730844744607066691873635805407116210513937482891978090244921700528166986169373004</span>, <span class="number">51045530530049998485303784443472394679340537711157110553830035081831280045359882051584398935926529291755099240406457873783</span>, <span class="number">34236922717566363192133863703148263941004712495034897774573119383475003417834951108666287711404001939048464437002433679407</span>, <span class="number">45872505907809637020370422271978939675346851543054028587891901912384052395705538771247266287193763510286880060531292639959</span>, <span class="number">45848898109057344134202435270619102891933756903137918210539806927748378219250477795575772238242834622990352860755134741466</span>, <span class="number">30690831192388284613442756217051361418365633435900191091970709571717316387519397173976205018862717979518148324020005010923</span>, <span class="number">31449987807594348386701815071912866455543777241540033790783566519826585105648502178453059357873663927865204928554663236077</span>, <span class="number">44164522031334631634742032676966915810386287680887515409727547743275857694255961288064333775997899156198169728004798627301</span>, <span class="number">45435754201870632997035120062097881840301496409175334584690761854547511860361137446247046697532853292820408620710624307382</span>, <span class="number">44339690473566894343952978154628696880034014523559143611036136185280642456704915048553091007234249154226918623377375894691</span>, <span class="number">45467002847831254808014906287799768055175059091786525970897932893891805445410961529449204154370320748667361921821962109675</span>, <span class="number">36672712060609316132155228755904497745191559722524497137141776547016866438152541916275707247661474924785433334031743867273</span>, <span class="number">33318272036111737761729665211639916834294015786168547961487773974212416192990634928540026070104913562774692957549715549488</span>, <span class="number">26488446249432698184964155673759155536134402144071339774049243916957631410861616681071512410907603593351545902355432029458</span>, <span class="number">40341075900310292662475114169415116089541198150649315469712291419180113007460321212589560058895403777206252321908544442309</span>, <span class="number">26829451620598286750871854925026378833727062253205541621457386970491913105057509287213115121008833266049546890167479802632</span>, <span class="number">45513592341672142381403583527547085383860968838283026398569419392666884390543295759414462710314345917114880365977486134681</span>, <span class="number">30989656373000940717564315962045358441783763445149927644939982470127544608520133355349744790032263796611938858721618488033</span>, <span class="number">44334471499924741874147933306576276027827636768071583554224521981965987566098166455226169818663501835712110724415781328492</span>, <span class="number">31837426402896485653611477218311016784291450679331542452646112026594865452425670444622297055248688317693429007530695867601</span>, <span class="number">45542312691317689697293085601643785865987056411657443496979205966506140025833642545782321283634423578256217775226695304197</span>, <span class="number">30485271545188004895221095186333612748347363012347281545184750365885020656281644717572961657232707805466675963034006872784</span>, <span class="number">28909547798415865495384409998912720428801877178846539449144055022985800057587307639611234111333806969344999647025832449329</span>, <span class="number">36474516684693555253555620995281452623013317806760643054084307027361066299499728227911984729226225415113048230141419462563</span>, <span class="number">39314372710645902875277660511577509635271209111954999042581312773469634841357053636979220063564692737995811930064432927127</span>, <span class="number">44035251040377727725066806537218009403249809071419110041762050287261847325282865785027211482623438334346368614213368626255</span>, <span class="number">42188806896882930759219928360233240470234630013801107325372593842833925956327138084141056173119195258281285726246685847703</span>, <span class="number">49468951309617822848188776411074794337979193322455086362250368127634170021279451014724294108762327145601715669487069984722</span>, <span class="number">27848903821180797829554971104131819473313526358565662810201287260276042904982964015770224545162808975296175663605065805771</span>, <span class="number">31042392763667641699655908674042641249895844697990237386851044670925381792328355872131399527030058491850262643670126569454</span>, <span class="number">48573860100704044325616555512704392764962824964488286580053670612772243734308406893308936032754072647800515547910407250580</span>, <span class="number">42148920504930890050104940689383752399382140669899852679711608113701470501220517756835304057620414238155337848626148565134</span>, <span class="number">30537478091813698779272725543057552156908006401377428551485334818175823492053620624881741713726950644848546932655347996830</span>, <span class="number">41867226276134021326180924978032826959738927139822089673876558682452698080178587784785451606248821128839542546759193575454</span>, <span class="number">44448580251300888167824584862932031104845007996804107175030122343359380672927551324642723494840716530579291045310013545511</span>, <span class="number">26835868289472666680392568389484683867336038760181238473634160506663243002110413982694314116878396340095716172647058698157</span>]</span><br><span class="line">msg = <span class="string">&quot;Lattice-based cryptography is the generic term for constructions of cryptographic primitives that involve lattices, either in the construction itself or in the security proof.&quot;</span></span><br><span class="line">s = msg[:<span class="number">50</span>]</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(Encrypted)</span><br><span class="line">L = Matrix(ZZ,n,n+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    L[i,<span class="number">0</span>] = Encrypted[i]</span><br><span class="line">    L[i,i+<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">L[:,<span class="number">0</span>] *= getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">u_matrix = Matrix(ZZ,L.LLL()[:-<span class="number">2</span>,<span class="number">1</span>:])</span><br><span class="line">u_right_kernel = u_matrix.right_kernel().matrix()</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> u_right_kernel.LLL():</span><br><span class="line">    res = line.<span class="built_in">list</span>()</span><br><span class="line">    Y = [<span class="built_in">abs</span>(res[i]) * inverse(<span class="built_in">ord</span>(s[i]),P) % P <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> itertools.product(<span class="string">&#x27;0123456789abcdef&#x27;</span>,repeat=<span class="number">3</span>):</span><br><span class="line">            m = <span class="string">&#x27;&#x27;</span>.join(i).encode()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">pow</span>(G,bytes_to_long(m),P) == Y[_]:</span><br><span class="line">                flag += m</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f8abee3f93898fdbe1168d414e4f0e3614bfdd629b0f1f8abee3f93898fdbe1168d414e4f0e3614bfdd629b0f1f8abee3f93898fdbe1168d414e4f0e3614bfdd629b0f1f8abee3f93898fd</span><br></pre></td></tr></table></figure>

<p>有重复部分</p>
<p><code>flag&#123;f8abee3f93898fdbe1168d414e4f0e3614bfdd629b0f1&#125;</code></p>

    </div>

    
    
    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------已经到底啦！<i class="fa fa-paw"></i>-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>DexterJie
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dexterjie.github.io/2025/06/09/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmonyCTF/" title="第一届OpenHarmonyCTF">https://dexterjie.github.io/2025/06/09/赛题复现/第一届OpenHarmonyCTF/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Wp/" rel="tag"># Wp</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/12/05/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024%E5%BC%BA%E7%BD%91%E6%9D%AF%E7%BA%BF%E4%B8%8B%E8%B5%9B/" rel="prev" title="2024强网杯线下赛">
                  <i class="fa fa-chevron-left"></i> 2024强网杯线下赛
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DexterJie</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">299k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">18:08</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->


    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
<div class="busuanzi-count">
  <script async src="/js/busuanzi.pure.mini.js"></script>
  
  <span class="site-uv" title="总访客量">
    访客量<span id="busuanzi_value_site_uv"></span>
  </span>

  <span class="site-pv" title="总访问量">
    经过<span id="busuanzi_value_site_pv"></span>次回眸与你相遇
  </span>
</div>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"waline-five-mocha.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"locale":null,"placeholder":"请文明评论呀","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2025/06/09/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmonyCTF/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right"},"mobile":{"show":true}});</script></body>

</html>
