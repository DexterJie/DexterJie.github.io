<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/0.jpg">
  <link rel="mask-icon" href="/images/0.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dexterjie.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="记录2024网鼎杯和强网杯Crypto部分题解">
<meta property="og:type" content="article">
<meta property="og:title" content="2024网鼎杯and强网杯">
<meta property="og:url" content="https://dexterjie.github.io/2024/10/31/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%BD%91%E9%BC%8E%E6%9D%AF%20and%20%E5%BC%BA%E7%BD%91%E6%9D%AF/index.html">
<meta property="og:site_name" content="DexterJie&#39;Blog">
<meta property="og:description" content="记录2024网鼎杯和强网杯Crypto部分题解">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dexterjie.github.io/images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/10-29-1.png">
<meta property="og:image" content="https://dexterjie.github.io/images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-2-1.png">
<meta property="og:image" content="https://dexterjie.github.io/images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-3-1.png">
<meta property="og:image" content="https://dexterjie.github.io/images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-3-2.png">
<meta property="og:image" content="https://dexterjie.github.io/images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-3-4.png">
<meta property="og:image" content="https://dexterjie.github.io/images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-3-3.png">
<meta property="article:published_time" content="2024-10-31T11:21:58.000Z">
<meta property="article:modified_time" content="2024-11-03T11:00:49.083Z">
<meta property="article:author" content="DexterJie">
<meta property="article:tag" content="Wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dexterjie.github.io/images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/10-29-1.png">


<link rel="canonical" href="https://dexterjie.github.io/2024/10/31/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%BD%91%E9%BC%8E%E6%9D%AF%20and%20%E5%BC%BA%E7%BD%91%E6%9D%AF/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dexterjie.github.io/2024/10/31/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%BD%91%E9%BC%8E%E6%9D%AF%20and%20%E5%BC%BA%E7%BD%91%E6%9D%AF/","path":"2024/10/31/赛题复现/网鼎杯 and 强网杯/","title":"2024网鼎杯and强网杯"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>2024网鼎杯and强网杯 | DexterJie'Blog</title>
  







<link rel="dns-prefetch" href="waline-five-mocha.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DexterJie'Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Never Mind the Scandal and Liber!!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1456890009&auto=1&height=66"></iframe>
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9D%92%E9%BE%99%E7%BB%84"><span class="nav-number">1.</span> <span class="nav-text">青龙组</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto01"><span class="nav-number">1.1.</span> <span class="nav-text">Crypto01</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto02"><span class="nav-number">1.2.</span> <span class="nav-text">Crypto02</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%99%BD%E8%99%8E%E7%BB%84"><span class="nav-number">2.</span> <span class="nav-text">白虎组</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto01-1"><span class="nav-number">2.1.</span> <span class="nav-text">Crypto01</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto02-1"><span class="nav-number">2.2.</span> <span class="nav-text">Crypto02</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%B1%E9%9B%80%E7%BB%84"><span class="nav-number">3.</span> <span class="nav-text">朱雀组</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto01%E2%80%94%E2%80%94unsolved"><span class="nav-number">3.1.</span> <span class="nav-text">Crypto01——unsolved</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto02-2"><span class="nav-number">3.2.</span> <span class="nav-text">Crypto02</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto03"><span class="nav-number">3.3.</span> <span class="nav-text">Crypto03</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#part1"><span class="nav-number">3.3.1.</span> <span class="nav-text">part1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part2"><span class="nav-number">3.3.2.</span> <span class="nav-text">part2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part3"><span class="nav-number">3.3.3.</span> <span class="nav-text">part3</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF"><span class="nav-number">4.</span> <span class="nav-text">强网杯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#easyRSA"><span class="nav-number">4.1.</span> <span class="nav-text">easyRSA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apbq"><span class="nav-number">4.2.</span> <span class="nav-text">apbq</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#stage1"><span class="nav-number">4.2.1.</span> <span class="nav-text">stage1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stage2"><span class="nav-number">4.2.2.</span> <span class="nav-text">stage2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stage3%E2%80%94%E2%80%94unsolved"><span class="nav-number">4.2.3.</span> <span class="nav-text">stage3——unsolved</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-steps"><span class="nav-number">4.3.</span> <span class="nav-text">21_steps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#traditional-game"><span class="nav-number">4.4.</span> <span class="nav-text">traditional_game</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#step1"><span class="nav-number">4.4.1.</span> <span class="nav-text">step1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#step2"><span class="nav-number">4.4.2.</span> <span class="nav-text">step2</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="DexterJie"
      src="/images/0.jpg">
  <p class="site-author-name" itemprop="name">DexterJie</p>
  <div class="site-description" itemprop="description">一枚只会Crypto的菜鸡</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dexterjie.github.io/2024/10/31/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%BD%91%E9%BC%8E%E6%9D%AF%20and%20%E5%BC%BA%E7%BD%91%E6%9D%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/0.jpg">
      <meta itemprop="name" content="DexterJie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DexterJie'Blog">
      <meta itemprop="description" content="一枚只会Crypto的菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="2024网鼎杯and强网杯 | DexterJie'Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2024网鼎杯and强网杯
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-31 19:21:58" itemprop="dateCreated datePublished" datetime="2024-10-31T19:21:58+08:00">2024-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-03 19:00:49" itemprop="dateModified" datetime="2024-11-03T19:00:49+08:00">2024-11-03</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2024/10/31/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%BD%91%E9%BC%8E%E6%9D%AF%20and%20%E5%BC%BA%E7%BD%91%E6%9D%AF/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2024/10/31/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%BD%91%E9%BC%8E%E6%9D%AF%20and%20%E5%BC%BA%E7%BD%91%E6%9D%AF/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>31 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>记录2024网鼎杯和强网杯Crypto部分题解</p>
<span id="more"></span>

<h1 id="青龙组"><a href="#青龙组" class="headerlink" title="青龙组"></a>青龙组</h1><h2 id="Crypto01"><a href="#Crypto01" class="headerlink" title="Crypto01"></a>Crypto01</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">d = getPrime(<span class="number">299</span>)</span><br><span class="line">e = inverse(d,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">hint1 = p &gt;&gt; (<span class="number">512</span>-<span class="number">70</span>)</span><br><span class="line">hint2 = q &gt;&gt; (<span class="number">512</span>-<span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;hint1 = <span class="subst">&#123;hint1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;hint2 = <span class="subst">&#123;hint2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">n = <span class="number">73787944575265560659337066998651559854008554735456318333076159883563615536562553619509791556832630227860528135540580555475313775587694656733939337337162684083504013096398383073623252469953554083296109377792508578226035938969407231689553680824348024184291021105154956244179599769690508760502010020180061720019</span></span><br><span class="line">e = <span class="number">29567393844922147731100606267534953994449203725806042726345753844983783164567752859600595704301680439820601788437000356006329166887506988972343037285018001864800437750191409728833296698465447150521119258782212680439802048101817052671603259114861564484544609221844909301043673563931709693327971992359139371227</span></span><br><span class="line">c = <span class="number">45450360465574139870481845301350579669043708378076876540990465420189044791001300484095663295849190297258585508686905534568744689506644183459090297899984297370341547866178062353877908003401151052692574668213473397829536065790283637478791675039086877921443504800597649778898977086137114431286134700385182325815</span></span><br><span class="line">hint1 = <span class="number">954676601865566077628</span></span><br><span class="line">hint2 = <span class="number">599256795156046227992</span></span><br></pre></td></tr></table></figure>

<p>和2023领航杯复赛的bd一模一样，之前有记录过，可以看我的这篇博客<a href="https://dexterjie.github.io/2023/09/12/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023%E9%A2%86%E8%88%AA%E6%9D%AF/?highlight=%E9%A2%86%E8%88%AA%E6%9D%AF#bd">2023江苏省领航杯 | DexterJie’Blog</a></p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">time.clock = time.time</span><br><span class="line"> </span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># 如果晶格达到该尺寸，则停止移除</span></span><br><span class="line"><span class="comment"># 显示有用矢量的统计数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示带有 0 和 X 的矩阵</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>: </span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="comment">#print (a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试删除无用的向量</span></span><br><span class="line"><span class="comment"># 从当前 = n-1（最后一个向量）开始</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># 我们从当前 = n-1（最后一个向量）开始</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 开始从后面检查</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment">#  如果它没有用</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">             <span class="comment"># 让我们检查它是否影响其他向量</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># 如果另一个向量受到影响：</span></span><br><span class="line">                <span class="comment"># 我们增加计数</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># 等级：0</span></span><br><span class="line">            <span class="comment"># 如果没有其他载体最终受到影响</span></span><br><span class="line">            <span class="comment"># 我们删除它</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#print (&quot;* removing unhelpful vector&quot;, ii)</span></span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line">           <span class="comment"># 等级：1</span></span><br><span class="line">            <span class="comment">#如果只有一个受到影响，我们会检查</span></span><br><span class="line">            <span class="comment"># 如果它正在影响别的向量</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># 如果它影响哪怕一个向量</span></span><br><span class="line">                    <span class="comment"># 我们放弃这个</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># 如果没有其他向量受到影响，则将其删除，并且</span></span><br><span class="line">                <span class="comment"># 这个有用的向量不够有用</span></span><br><span class="line">                <span class="comment">#与我们无用的相比</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="comment">#print (&quot;* removing unhelpful vectors&quot;, ii, &quot;and&quot;, affected_vector_index)</span></span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1，-1 如果 &quot;strict=true&quot;，并且行列式不受约束</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> 在以下情况下找到解决方案：</span></span><br><span class="line"><span class="string">* d &lt; N^delta</span></span><br><span class="line"><span class="string">* |x|&lt; e^delta</span></span><br><span class="line"><span class="string">* |y|&lt; e^0.5</span></span><br><span class="line"><span class="string">每当 delta &lt; 1 - sqrt（2）/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)   <span class="comment">#多项式环</span></span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u)        <span class="comment">#  u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"> </span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># x-移位</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 单项式 x 移位列表</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials(): <span class="comment">#对于多项式中的单项式。单项式（）：</span></span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:  <span class="comment"># 如果单项不在单项中</span></span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># y-移位</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 单项式 y 移位列表</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 构造格 B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#约化格的原型</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment">#  #自动删除</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 重置维度</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 检查向量是否有帮助</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 检查行列式是否正确界定</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#BB = BB.BKZ(block_size=25)</span></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 替换向量 i 和 j -&gt;多项式 1 和 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;在格中寻找线性无关向量&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># 对于i and j, 构造两个多项式</span></span><br><span class="line"> </span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># 结果</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line">    <span class="comment"># 随机生成数据</span></span><br><span class="line">    <span class="comment">##########################################</span></span><br><span class="line">    <span class="comment">#start_time =time.perf_counter</span></span><br><span class="line">    start =time.clock()</span><br><span class="line">    size=<span class="number">512</span></span><br><span class="line">    length_N = <span class="number">2</span>*size;</span><br><span class="line">    ss=<span class="number">0</span></span><br><span class="line">    s=<span class="number">70</span></span><br><span class="line">    M=<span class="number">1</span>   <span class="comment"># the number of experiments</span></span><br><span class="line">    delta = <span class="number">299</span>/<span class="number">1024</span></span><br><span class="line">    <span class="comment"># p =  random_prime(2^512,2^511)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(M):</span><br><span class="line"><span class="comment">#         p =  random_prime(2^size,None,2^(size-1))</span></span><br><span class="line"><span class="comment">#         q =  random_prime(2^size,None,2^(size-1))</span></span><br><span class="line"><span class="comment">#         if(p&lt;q):</span></span><br><span class="line"><span class="comment">#             temp=p</span></span><br><span class="line"><span class="comment">#             p=q</span></span><br><span class="line"><span class="comment">#             q=temp</span></span><br><span class="line">        N = <span class="number">73787944575265560659337066998651559854008554735456318333076159883563615536562553619509791556832630227860528135540580555475313775587694656733939337337162684083504013096398383073623252469953554083296109377792508578226035938969407231689553680824348024184291021105154956244179599769690508760502010020180061720019</span></span><br><span class="line">        e = <span class="number">29567393844922147731100606267534953994449203725806042726345753844983783164567752859600595704301680439820601788437000356006329166887506988972343037285018001864800437750191409728833296698465447150521119258782212680439802048101817052671603259114861564484544609221844909301043673563931709693327971992359139371227</span></span><br><span class="line">        c = <span class="number">45450360465574139870481845301350579669043708378076876540990465420189044791001300484095663295849190297258585508686905534568744689506644183459090297899984297370341547866178062353877908003401151052692574668213473397829536065790283637478791675039086877921443504800597649778898977086137114431286134700385182325815</span></span><br><span class="line">        hint1 = <span class="number">954676601865566077628</span>  <span class="comment"># p高位</span></span><br><span class="line">        hint2 = <span class="number">599256795156046227992</span>  <span class="comment"># q高位</span></span><br><span class="line"><span class="comment">#         print (&quot;p真实高&quot;,s,&quot;比特：&quot;, int(p/2^(512-s)))</span></span><br><span class="line"><span class="comment">#         print (&quot;q真实高&quot;,s,&quot;比特：&quot;, int(q/2^(512-s)))</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#         N = p*q;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 解密指数d的指数( 最大0.292)</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        m = <span class="number">7</span>   <span class="comment"># 格大小（越大越好/越慢）</span></span><br><span class="line">        t = <span class="built_in">round</span>(((<span class="number">1</span>-<span class="number">2</span>*delta) * m))  <span class="comment"># 来自 Herrmann 和 May 的优化</span></span><br><span class="line">        X = floor(N^delta)  <span class="comment"># </span></span><br><span class="line">        Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>)/<span class="number">2</span>^s)    <span class="comment"># 如果 p、 q 大小相同，则正确</span></span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(hint1),<span class="built_in">int</span>(hint1)+<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\n\n\n l=&#x27;</span>,l)</span><br><span class="line">            pM=l;</span><br><span class="line">            p0=pM*<span class="number">2</span>^(size-s)+<span class="number">2</span>^(size-s)-<span class="number">1</span>;</span><br><span class="line">            q0=N/p0;</span><br><span class="line">            qM=<span class="built_in">int</span>(q0/<span class="number">2</span>^(size-s))</span><br><span class="line">            A = N + <span class="number">1</span>-pM*<span class="number">2</span>^(size-s)-qM*<span class="number">2</span>^(size-s);</span><br><span class="line">        <span class="comment">#A = N+1</span></span><br><span class="line">            P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol = <span class="number">1</span> + x * (A + y)  <span class="comment">#构建的方程</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment"># Checking bounds</span></span><br><span class="line">            <span class="comment">#if debug:</span></span><br><span class="line">                <span class="comment">#print (&quot;=== 核对数据 ===&quot;)</span></span><br><span class="line">                <span class="comment">#print (&quot;* delta:&quot;, delta)</span></span><br><span class="line">                <span class="comment">#print (&quot;* delta &lt; 0.292&quot;, delta &lt; 0.292)</span></span><br><span class="line">                <span class="comment">#print (&quot;* size of e:&quot;, ceil(log(e)/log(2)))  # e的bit数</span></span><br><span class="line">                <span class="comment"># print (&quot;* size of N:&quot;, len(bin(N)))          # N的bit数</span></span><br><span class="line">                <span class="comment">#print (&quot;* size of N:&quot;, ceil(log(N)/log(2)))  # N的bit数</span></span><br><span class="line">                <span class="comment">#print (&quot;* m:&quot;, m, &quot;, t:&quot;, t)</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment"># boneh_durfee</span></span><br><span class="line">            <span class="keyword">if</span> debug:</span><br><span class="line">                <span class="comment">##print (&quot;=== running algorithm ===&quot;)</span></span><br><span class="line">                start_time = time.time()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#print (&quot;=== solution found ===&quot;)</span></span><br><span class="line">                <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"> </span><br><span class="line">                d_sol = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">                ss=ss+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;p的高比特为：&quot;</span>,l)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;q的高比特为：&quot;</span>,qM)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;d=&quot;</span>,d_sol) </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time))</span><br><span class="line">            <span class="comment">#break</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ss=&quot;</span>,ss)</span><br><span class="line">                            <span class="comment">#end=time.process_time</span></span><br><span class="line">        end=time.clock()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Running time: %s Seconds&#x27;</span>%(end-start))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example()  </span><br></pre></td></tr></table></figure>

<p>这个脚本是基于人家实验的，有点乱</p>
<p><img src="/../../images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/10-29-1.png"></p>
<p>跑出d之后解RSA</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d = <span class="number">687038469975940863290260221773243585573217566356221334458982642899243861704377289553340363</span></span><br><span class="line">n = <span class="number">73787944575265560659337066998651559854008554735456318333076159883563615536562553619509791556832630227860528135540580555475313775587694656733939337337162684083504013096398383073623252469953554083296109377792508578226035938969407231689553680824348024184291021105154956244179599769690508760502010020180061720019</span></span><br><span class="line">c = <span class="number">45450360465574139870481845301350579669043708378076876540990465420189044791001300484095663295849190297258585508686905534568744689506644183459090297899984297370341547866178062353877908003401151052692574668213473397829536065790283637478791675039086877921443504800597649778898977086137114431286134700385182325815</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># wdflag&#123;39769372-2155-4c99-9ec2-6683c4451ed6&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Crypto02"><a href="#Crypto02" class="headerlink" title="Crypto02"></a>Crypto02</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> FLAG <span class="keyword">import</span> flag</span><br><span class="line"><span class="comment">#flag = &#x27;wdflag&#123;123&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">victory_encrypt</span>(<span class="params">plaintext, key</span>):</span><br><span class="line">    key = key.upper()</span><br><span class="line">    key_length = <span class="built_in">len</span>(key)</span><br><span class="line">    plaintext = plaintext.upper()</span><br><span class="line">    ciphertext = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(plaintext):</span><br><span class="line">        <span class="keyword">if</span> char.isalpha():</span><br><span class="line">            shift = <span class="built_in">ord</span>(key[i % key_length]) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">            encrypted_char = <span class="built_in">chr</span>((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) + shift) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>))</span><br><span class="line">            ciphertext += encrypted_char</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ciphertext += char</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line">victory_key = <span class="string">&quot;WANGDINGCUP&quot;</span></span><br><span class="line">victory_encrypted_flag = victory_encrypt(flag, victory_key)</span><br><span class="line"></span><br><span class="line">p = <span class="number">0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f</span></span><br><span class="line">a = <span class="number">0</span></span><br><span class="line">b = <span class="number">7</span></span><br><span class="line">xG = <span class="number">0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798</span></span><br><span class="line">yG = <span class="number">0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8</span></span><br><span class="line">G = (xG, yG)</span><br><span class="line">n = <span class="number">0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141</span></span><br><span class="line">h = <span class="number">1</span></span><br><span class="line">zero = (<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">dA = nextprime(random.randint(<span class="number">0</span>, n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dA &gt; n:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;warning!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addition</span>(<span class="params">t1, t2</span>):</span><br><span class="line">    <span class="keyword">if</span> t1 == zero:</span><br><span class="line">        <span class="keyword">return</span> t2</span><br><span class="line">    <span class="keyword">if</span> t2 == zero:</span><br><span class="line">        <span class="keyword">return</span> t2</span><br><span class="line">    (m1, n1) = t1</span><br><span class="line">    (m2, n2) = t2</span><br><span class="line">    <span class="keyword">if</span> m1 == m2:</span><br><span class="line">        <span class="keyword">if</span> n1 == <span class="number">0</span> <span class="keyword">or</span> n1 != n2:</span><br><span class="line">            <span class="keyword">return</span> zero</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k = (<span class="number">3</span> * m1 * m1 + a) % p * gmpy2.invert(<span class="number">2</span> * n1 , p) % p</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k = (n2 - n1 + p) % p * gmpy2.invert((m2 - m1 + p) % p, p) % p</span><br><span class="line">    m3 = (k * k % p - m1 - m2 + p * <span class="number">2</span>) % p</span><br><span class="line">    n3 = (k * (m1 - m3) % p - n1 + p) % p</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">int</span>(m3),<span class="built_in">int</span>(n3))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiplication</span>(<span class="params">x, k</span>):</span><br><span class="line">    ans = zero</span><br><span class="line">    t = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(t &lt;= k):</span><br><span class="line">        <span class="keyword">if</span> (k &amp;t )&gt;<span class="number">0</span>:</span><br><span class="line">            ans = addition(ans, x)</span><br><span class="line">        x = addition(x, x)</span><br><span class="line">        t &lt;&lt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getrs</span>(<span class="params">z, k</span>):</span><br><span class="line">    (xp, yp) = P</span><br><span class="line">    r = xp</span><br><span class="line">    s = (z + r * dA % n) % n * gmpy2.invert(k, n) % n</span><br><span class="line">    <span class="keyword">return</span> r,s</span><br><span class="line"></span><br><span class="line">z1 = random.randint(<span class="number">0</span>, p)</span><br><span class="line">z2 = random.randint(<span class="number">0</span>, p)</span><br><span class="line">k = random.randint(<span class="number">0</span>, n)</span><br><span class="line">P = multiplication(G, k)</span><br><span class="line">hA = multiplication(G, dA)</span><br><span class="line">r1, s1 = getrs(z1, k)</span><br><span class="line">r2, s2 = getrs(z2, k)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;r1 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(r1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;r2 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(r2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;s1 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(s1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;s2 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(s2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;z1 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(z1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;z2 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(z2))</span><br><span class="line"></span><br><span class="line">key = sha256(long_to_bytes(dA)).digest()</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC)</span><br><span class="line">iv = cipher.iv</span><br><span class="line">encrypted_flag = cipher.encrypt(pad(victory_encrypted_flag.encode(), AES.block_size))</span><br><span class="line">encrypted_flag_hex = binascii.hexlify(iv + encrypted_flag).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Encrypted flag (AES in CBC mode, hex):&quot;</span>, encrypted_flag_hex)</span><br><span class="line"></span><br><span class="line"><span class="comment"># output</span></span><br><span class="line"><span class="comment"># r1 = 80932673752923845218731053671144903633094494351596082125742241568755353762809</span></span><br><span class="line"><span class="comment"># r2 = 80932673752923845218731053671144903633094494351596082125742241568755353762809</span></span><br><span class="line"><span class="comment"># s1 = 11239004842544045364097722042148768449026688243093666008376082303522447245154</span></span><br><span class="line"><span class="comment"># s2 = 97301123368608673469588981075767011435222146576812290449372049839046298462487</span></span><br><span class="line"><span class="comment"># z1 = 84483328065344511722319723339101492661376118616972408250436525496870397932079</span></span><br><span class="line"><span class="comment"># z2 = 114907157406602520059145833917511615616817014350278499032611638874752053304591</span></span><br><span class="line"><span class="comment"># (&#x27;Encrypted flag (AES in CBC mode, hex):&#x27;, u&#x27;d8851c55edec1114a6d7a4d6d5efbba4611a39216ec146d2e675194dd0d5f768bee1b09799a133ffda1d283c4f6db475834cbe52c38c88736c94795c137490be&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>首先是ECDSA签名k的复用，原理如下<br>$$<br>s_1 \equiv k^{-1}(z_1 + r_1d_A) \mod n<br>$$</p>
<p>$$<br>s_2 \equiv k^{-1}(z_2 + r_2d_A) \mod n<br>$$</p>
<p>这里$r_1 &#x3D; r_2$，所以两式相减有<br>$$<br>s_1 - s_2 \equiv k^{-1}(z_1-z_2) \mod n<br>$$<br>所以<br>$$<br>k \equiv (z_1-z_2)\times (s_1-s_2)^{-1} \mod n<br>$$<br>有了k之后根据$s\equiv k^{-1}(z + rd_A)\mod n$就可以恢复$d_A$</p>
<p>然后解CBC得到victory_encrypted_flag</p>
<p>再根据加密逻辑写一个解密代码即可，最后把大写符号改为小写符号</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">victory_decrypt</span>(<span class="params">ciphertext, key</span>):</span><br><span class="line">    key = key.upper()</span><br><span class="line">    key_length = <span class="built_in">len</span>(key)</span><br><span class="line">    m = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i,char <span class="keyword">in</span> <span class="built_in">enumerate</span>(ciphertext):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= char &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>) <span class="keyword">or</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= char &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>):</span><br><span class="line">            shift = <span class="built_in">ord</span>(key[i % key_length]) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">            tmp = <span class="built_in">chr</span>((char - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) - shift) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>))</span><br><span class="line">            m += tmp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m += <span class="built_in">chr</span>(char)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">p = <span class="number">0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f</span></span><br><span class="line">a = <span class="number">0</span></span><br><span class="line">b = <span class="number">7</span></span><br><span class="line">xG = <span class="number">0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798</span></span><br><span class="line">yG = <span class="number">0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8</span></span><br><span class="line">G = (xG, yG)</span><br><span class="line">n = <span class="number">0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141</span></span><br><span class="line">r1 = <span class="number">80932673752923845218731053671144903633094494351596082125742241568755353762809</span></span><br><span class="line">r2 = <span class="number">80932673752923845218731053671144903633094494351596082125742241568755353762809</span></span><br><span class="line">s1 = <span class="number">11239004842544045364097722042148768449026688243093666008376082303522447245154</span></span><br><span class="line">s2 = <span class="number">97301123368608673469588981075767011435222146576812290449372049839046298462487</span></span><br><span class="line">z1 = <span class="number">84483328065344511722319723339101492661376118616972408250436525496870397932079</span></span><br><span class="line">z2 = <span class="number">114907157406602520059145833917511615616817014350278499032611638874752053304591</span></span><br><span class="line">victory_key = <span class="string">&quot;WANGDINGCUP&quot;</span></span><br><span class="line"></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;d8851c55edec1114a6d7a4d6d5efbba4611a39216ec146d2e675194dd0d5f768bee1b09799a133ffda1d283c4f6db475834cbe52c38c88736c94795c137490be&quot;</span>)</span><br><span class="line"></span><br><span class="line">k = gmpy2.invert((s1-s2),n)*(z1-z2) % n</span><br><span class="line">r_ = gmpy2.invert(r1,n)</span><br><span class="line"></span><br><span class="line">d = ((k * s1) - z1)*r_ % n</span><br><span class="line"></span><br><span class="line">key = sha256(long_to_bytes(d)).digest()</span><br><span class="line">iv = c[:<span class="number">16</span>]</span><br><span class="line">encrypted_flag = c[<span class="number">16</span>:]</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC,iv)</span><br><span class="line">decrypted_flag = cipher.decrypt(encrypted_flag)</span><br><span class="line"><span class="built_in">print</span>(decrypted_flag)</span><br><span class="line">flag = victory_decrypt(unpad(decrypted_flag,<span class="number">16</span>),victory_key)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># WDFLAG&#123;27F8DECFDB040ABB2D0DDBA70AD0484D&#125;</span></span><br><span class="line"><span class="built_in">print</span>(flag.lower())</span><br><span class="line"><span class="comment"># wdflag&#123;27f8decfdb040abb2d0ddba70ad0484d&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="白虎组"><a href="#白虎组" class="headerlink" title="白虎组"></a>白虎组</h1><h2 id="Crypto01-1"><a href="#Crypto01-1" class="headerlink" title="Crypto01"></a>Crypto01</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">block_size = <span class="number">64</span></span><br><span class="line">rounds = <span class="number">14</span></span><br><span class="line"></span><br><span class="line">P_permutation = Permutations(<span class="built_in">list</span>(<span class="built_in">range</span>(block_size))).random_element()</span><br><span class="line">inverse_P_permutation = [P_permutation.index(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(block_size)]</span><br><span class="line"></span><br><span class="line">MASK = <span class="number">0b1110001001111001000110010000100010101111101100101110100001001001</span></span><br><span class="line">IV = <span class="number">7</span></span><br><span class="line"></span><br><span class="line">b2i = <span class="keyword">lambda</span> x: Integer(<span class="built_in">sum</span>([x[i] * <span class="number">2</span>**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">x</span>):</span><br><span class="line">    padlen = block_size - <span class="built_in">len</span>(x) % block_size</span><br><span class="line">    <span class="keyword">return</span> x + <span class="built_in">bytes</span>([padlen] * padlen)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = [bit_x[P_permutation[i]] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(block_size)]</span><br><span class="line">    <span class="keyword">return</span> b2i(bit_x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P_inv</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = [bit_x[inverse_P_permutation[i]] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(block_size)]</span><br><span class="line">    <span class="keyword">return</span> b2i(bit_x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">x</span>):</span><br><span class="line">    x1 = x</span><br><span class="line">    x2 = x &lt;&lt; IV &amp; MASK</span><br><span class="line">    x3 = x &lt;&lt; IV &amp; ((<span class="number">1</span> &lt;&lt; block_size) - <span class="number">1</span>) | MASK</span><br><span class="line">    <span class="keyword">return</span> x1 ^ x2 ^ x3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">message_block, key</span>):</span><br><span class="line">    ret = message_block</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds):</span><br><span class="line">        ret = P_inv(S(P(ret)) ^ key)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">message = pad(flag)</span><br><span class="line">message = [Integer(bytes_to_long(message[i:i+<span class="number">8</span>])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(message), <span class="number">8</span>)]</span><br><span class="line"></span><br><span class="line">key = <span class="built_in">int</span>(md5(flag).hexdigest(), <span class="number">16</span>) &amp; ((<span class="number">1</span> &lt;&lt; block_size) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ciphertext = [encrypt(m, key) <span class="keyword">for</span> m <span class="keyword">in</span> message]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ciphertext)</span><br><span class="line"><span class="built_in">print</span>(P_permutation)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[]</span></span><br><span class="line"><span class="string">[]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>这题主要是encrypt中14轮<code>ret = P_inv(S(P(ret)) ^ key)</code>的迭代，逐一分析<code>P(x),S(x),P_inv(x)</code></p>
<p>可以知道<code>P(x)</code>和<code>P_inv(x)</code>就是单纯的置换。可以把置换用矩阵的形式表达<br>$$<br>P(x) &#x3D;<br>\begin{pmatrix}<br>P_{1,1} &amp; … &amp; P_{1,64}\<br>\vdots &amp; \ddots &amp; \vdots \<br>P_{64,1} &amp; … &amp; P_{64,64}<br>\end{pmatrix}<br>\times<br>\begin{pmatrix}<br>x_1 &amp; … &amp; x_{64}<br>\end{pmatrix}<br>$$</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">P_matrix = matrix(GF(<span class="number">2</span>),<span class="number">64</span>,<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> i, perm_index <span class="keyword">in</span> <span class="built_in">enumerate</span>(P_permutation):</span><br><span class="line">    P_matrix[i,perm_index] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = P_matrix * vector(GF(<span class="number">2</span>),bit_x)</span><br><span class="line">    <span class="keyword">return</span> b2i(vector(ZZ,bit_x).<span class="built_in">list</span>())</span><br></pre></td></tr></table></figure>

<p>这样就用矩阵的形式等效替代了原来的<code>P(x)</code></p>
<p>同理<code>P_inv</code>就很简单了，用$P^{-1}$乘上$x$向量就好了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">P_inv</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = P_matrix^(-<span class="number">1</span>) * vector(GF(<span class="number">2</span>),bit_x)</span><br><span class="line">    <span class="keyword">return</span> b2i(vector(ZZ,bit_x).<span class="built_in">list</span>())</span><br></pre></td></tr></table></figure>

<p>接下来分析<code>S(x)</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">x</span>):</span><br><span class="line">    x1 = x</span><br><span class="line">    x2 = x &lt;&lt; IV &amp; MASK</span><br><span class="line">    x3 = x &lt;&lt; IV &amp; ((<span class="number">1</span> &lt;&lt; block_size) - <span class="number">1</span>) | MASK</span><br><span class="line">    <span class="keyword">return</span> x1 ^ x2 ^ x3</span><br></pre></td></tr></table></figure>

<p>这里的x3其实等效于<code>x3 = x &lt;&lt; IV &amp; ((1 &lt;&lt; block_size) - 1)</code></p>
<p>此时<code>S(x)</code>中只有<code>&amp;</code>和<code>^</code>两个运算。我们可以用GF(2)下的矩阵乘法表示<code>&amp;</code>，用GF(2)下的加法表示<code>^</code>，那么就有<br>$$<br>S(x) &#x3D;\begin{pmatrix}<br>A_{1,1} &amp; … &amp; A_{1,64}\<br>\vdots &amp; \ddots &amp; \vdots \<br>A_{64,1} &amp; … &amp; A_{64,64}<br>\end{pmatrix}<br>\times<br>\begin{pmatrix}<br>x_1 &amp; … &amp; x_{64}<br>\end{pmatrix}<br>+<br>\begin{pmatrix}<br>b_1 &amp; … &amp; b_{64}<br>\end{pmatrix}<br>$$</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">A = matrix(GF(<span class="number">2</span>),<span class="number">64</span>,<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    A[i,i] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    j = i - IV</span><br><span class="line">    <span class="keyword">if</span> j &gt;= <span class="number">0</span>:</span><br><span class="line">        A[i,j] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">b = vector(GF(<span class="number">2</span>),<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    <span class="keyword">if</span> (MASK &gt;&gt; i) &amp; <span class="number">1</span>:</span><br><span class="line">        b[i] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = vector(GF(<span class="number">2</span>),bit_x)</span><br><span class="line">    res = A * bit_x + b</span><br><span class="line">    <span class="keyword">return</span> b2i(vector(ZZ,res))</span><br></pre></td></tr></table></figure>

<p>目前为止我们已经用矩阵的形式表示了三个函数</p>
<p>再看加密函数</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">message_block, key</span>):</span><br><span class="line">    ret = message_block</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds):</span><br><span class="line">        ret = P_inv(S(P(ret)) ^ key)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>

<p><code>^key</code>可以看作再加上一个k向量,k是key的二进制形式</p>
<p>一轮加密：<br>$$<br>ret &#x3D; P^{-1}(A(Px) + b + k)<br>$$<br>展开有<br>$$<br>ret &#x3D; P^{-1}APx + P^{-1}b + P^{-1}k<br>$$<br>记$T &#x3D; P^{-1}AP$,$U &#x3D; P^{-1}b$。那么14轮加密后<br>$$<br>ret &#x3D; T^{14}x + (T^{13}+T^{12} +…+I)U + (T^{13}+T^{12} +…+I)P^{-1}k<br>$$<br>注意到加密的时候是把flag的每八位进行分组之后再加密。那我们可以利用flag头<code>wdflag&#123;</code>，再爆破一位，即可获得第一组明文(此外,密文的最后两个值是一样的，可以说明后面两组明文是填充，也可以爆破填充内容来获得另外的明密文对，都可以解得k)。那么对于上面的式子，我们只有k是未知的，可以解矩阵方程得到k<br>$$<br>k &#x3D; (T^{13}+T^{12} +…+I)^{-1}P[ret - T^{14}x -(T^{13}+T^{12} +…+I)U]<br>$$<br>求得k之后再解密即可</p>
<blockquote>
<p>利用flag头</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">cipher = </span><br><span class="line">P_permutation = </span><br><span class="line">block_size = <span class="number">64</span></span><br><span class="line">rounds = <span class="number">14</span></span><br><span class="line"></span><br><span class="line">inverse_P_permutation = [P_permutation.index(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(block_size)]</span><br><span class="line"></span><br><span class="line">MASK = <span class="number">0b1110001001111001000110010000100010101111101100101110100001001001</span></span><br><span class="line">IV = <span class="number">7</span></span><br><span class="line"></span><br><span class="line">b2i = <span class="keyword">lambda</span> x: Integer(<span class="built_in">sum</span>([x[i] * <span class="number">2</span>**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]))</span><br><span class="line"></span><br><span class="line">P_matrix = matrix(GF(<span class="number">2</span>),<span class="number">64</span>,<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> i, perm_index <span class="keyword">in</span> <span class="built_in">enumerate</span>(P_permutation):</span><br><span class="line">    P_matrix[i,perm_index] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = P_matrix * vector(GF(<span class="number">2</span>),bit_x)</span><br><span class="line">    <span class="keyword">return</span> b2i(vector(ZZ,bit_x).<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P_inv</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = P_matrix^(-<span class="number">1</span>) * vector(GF(<span class="number">2</span>),bit_x)</span><br><span class="line">    <span class="keyword">return</span> b2i(vector(ZZ,bit_x).<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line">A = matrix(GF(<span class="number">2</span>),<span class="number">64</span>,<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    A[i,i] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    j = i - IV</span><br><span class="line">    <span class="keyword">if</span> j &gt;= <span class="number">0</span>:</span><br><span class="line">        A[i,j] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">b = vector(GF(<span class="number">2</span>),<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    <span class="keyword">if</span> (MASK &gt;&gt; i) &amp; <span class="number">1</span>:</span><br><span class="line">        b[i] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = vector(GF(<span class="number">2</span>),bit_x)</span><br><span class="line">    res = A * bit_x + b</span><br><span class="line">    <span class="keyword">return</span> b2i(vector(ZZ,res))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">T = P_matrix^(-<span class="number">1</span>)*A*P_matrix</span><br><span class="line">U = P_matrix^(-<span class="number">1</span>)*b</span><br><span class="line">tmp = <span class="built_in">sum</span>(T^i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds))</span><br><span class="line"></span><br><span class="line">keys=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;0123456789abcdef&quot;</span>:</span><br><span class="line">    c = cipher[<span class="number">0</span>].bits()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(c) != <span class="number">64</span>:</span><br><span class="line">        c += [<span class="number">0</span>]</span><br><span class="line">    c = vector(GF(<span class="number">2</span>),c)</span><br><span class="line">    m = <span class="string">b&quot;wdflag&#123;&quot;</span> + i.encode()</span><br><span class="line">    x = Integer(bytes_to_long(m)).bits()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(x) != <span class="number">64</span>:</span><br><span class="line">        x += [<span class="number">0</span>]</span><br><span class="line">    x = vector(GF(<span class="number">2</span>),x)</span><br><span class="line">    c -= T^rounds * x</span><br><span class="line">    c -= tmp*U</span><br><span class="line">    <span class="keyword">try</span>:    </span><br><span class="line">        P_invk = tmp.solve_right(c)</span><br><span class="line">        k = P_matrix*P_invk</span><br><span class="line">        key = <span class="built_in">sum</span>([<span class="built_in">int</span>(k[j])*<span class="number">2</span>^j <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(k))])</span><br><span class="line">        keys.append(key)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">c,key</span>):</span><br><span class="line">    ret = c.bits()</span><br><span class="line">    k = key.bits()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(ret) != <span class="number">64</span>:</span><br><span class="line">        ret += [<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(k) != <span class="number">64</span>:</span><br><span class="line">        k += [<span class="number">0</span>]</span><br><span class="line">    ret = vector(GF(<span class="number">2</span>),ret)</span><br><span class="line">    k = vector(GF(<span class="number">2</span>),k)</span><br><span class="line">    ret -= tmp * P_matrix^(-<span class="number">1</span>) * k</span><br><span class="line">    ret -= (tmp * U)</span><br><span class="line">    x = (T^<span class="number">14</span>)^(-<span class="number">1</span>) * ret</span><br><span class="line">    m = long_to_bytes(b2i(vector(ZZ,x)))</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">    m = [decrypt(c,key) <span class="keyword">for</span> c <span class="keyword">in</span> cipher]</span><br><span class="line">    flag = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">        flag += i</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>爆破填充内容</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">cipher = []</span><br><span class="line">P_permutation = []</span><br><span class="line">block_size = <span class="number">64</span></span><br><span class="line">rounds = <span class="number">14</span></span><br><span class="line"></span><br><span class="line">inverse_P_permutation = [P_permutation.index(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(block_size)]</span><br><span class="line"></span><br><span class="line">MASK = <span class="number">0b1110001001111001000110010000100010101111101100101110100001001001</span></span><br><span class="line">IV = <span class="number">7</span></span><br><span class="line"></span><br><span class="line">b2i = <span class="keyword">lambda</span> x: Integer(<span class="built_in">sum</span>([x[i] * <span class="number">2</span>**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]))</span><br><span class="line"></span><br><span class="line">P_matrix = matrix(GF(<span class="number">2</span>),<span class="number">64</span>,<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> i, perm_index <span class="keyword">in</span> <span class="built_in">enumerate</span>(P_permutation):</span><br><span class="line">    P_matrix[i,perm_index] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = P_matrix * vector(GF(<span class="number">2</span>),bit_x)</span><br><span class="line">    <span class="keyword">return</span> b2i(vector(ZZ,bit_x).<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P_inv</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = P_matrix^(-<span class="number">1</span>) * vector(GF(<span class="number">2</span>),bit_x)</span><br><span class="line">    <span class="keyword">return</span> b2i(vector(ZZ,bit_x).<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line">A = matrix(GF(<span class="number">2</span>),<span class="number">64</span>,<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    A[i,i] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    j = i - IV</span><br><span class="line">    <span class="keyword">if</span> j &gt;= <span class="number">0</span>:</span><br><span class="line">        A[i,j] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">b = vector(GF(<span class="number">2</span>),<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    <span class="keyword">if</span> (MASK &gt;&gt; i) &amp; <span class="number">1</span>:</span><br><span class="line">        b[i] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">x</span>):</span><br><span class="line">    bit_x = x.bits()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bit_x) &lt; block_size:</span><br><span class="line">        bit_x.extend([<span class="number">0</span>] * (block_size - <span class="built_in">len</span>(bit_x)))</span><br><span class="line">    bit_x = vector(GF(<span class="number">2</span>),bit_x)</span><br><span class="line">    res = A * bit_x + b</span><br><span class="line">    <span class="keyword">return</span> b2i(vector(ZZ,res))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">T = P_matrix^(-<span class="number">1</span>)*A*P_matrix</span><br><span class="line">U = P_matrix^(-<span class="number">1</span>)*b</span><br><span class="line">tmp = <span class="built_in">sum</span>(T^i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds))</span><br><span class="line"></span><br><span class="line">keys=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">32</span>):</span><br><span class="line">    c = cipher[-<span class="number">1</span>].bits()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(c) != <span class="number">64</span>:</span><br><span class="line">        c += [<span class="number">0</span>]</span><br><span class="line">    c = vector(GF(<span class="number">2</span>),c)</span><br><span class="line">    m = <span class="built_in">bytes</span>([i]) * <span class="number">8</span></span><br><span class="line">    x = Integer(bytes_to_long(m)).bits()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(x) != <span class="number">64</span>:</span><br><span class="line">        x += [<span class="number">0</span>]</span><br><span class="line">    x = vector(GF(<span class="number">2</span>),x)</span><br><span class="line">    c -= T^rounds * x</span><br><span class="line">    c -= tmp*U</span><br><span class="line">    <span class="keyword">try</span>:    </span><br><span class="line">        P_invk = tmp.solve_right(c)</span><br><span class="line">        k = P_matrix*P_invk</span><br><span class="line">        key = <span class="built_in">sum</span>([<span class="built_in">int</span>(k[j])*<span class="number">2</span>^j <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(k))])</span><br><span class="line">        keys.append(key)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">c,key</span>):</span><br><span class="line">    ret = c.bits()</span><br><span class="line">    k = key.bits()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(ret) != <span class="number">64</span>:</span><br><span class="line">        ret += [<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(k) != <span class="number">64</span>:</span><br><span class="line">        k += [<span class="number">0</span>]</span><br><span class="line">    ret = vector(GF(<span class="number">2</span>),ret)</span><br><span class="line">    k = vector(GF(<span class="number">2</span>),k)</span><br><span class="line">    ret -= tmp * P_matrix^(-<span class="number">1</span>) * k</span><br><span class="line">    ret -= (tmp * U)</span><br><span class="line">    x = (T^<span class="number">14</span>)^(-<span class="number">1</span>) * ret</span><br><span class="line">    m = long_to_bytes(b2i(vector(ZZ,x)))</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">    m = [decrypt(c,key) <span class="keyword">for</span> c <span class="keyword">in</span> cipher]</span><br><span class="line">    flag = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">        flag += i</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h2 id="Crypto02-1"><a href="#Crypto02-1" class="headerlink" title="Crypto02"></a>Crypto02</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, isPrime, GCD, inverse</span><br><span class="line"></span><br><span class="line">nbits = <span class="number">2048</span></span><br><span class="line">gbits = <span class="number">1000</span></span><br><span class="line">g = getPrime(<span class="built_in">int</span>(gbits))</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    a = getPrime(<span class="built_in">int</span>(nbits*<span class="number">0.5</span>)-gbits)</span><br><span class="line">    p = <span class="number">2</span>*g*a + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(p):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    b = getPrime(<span class="built_in">int</span>(nbits*<span class="number">0.5</span>)-gbits)</span><br><span class="line">    q = <span class="number">2</span>*g*b + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> p!=q <span class="keyword">and</span> isPrime(q):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">N = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2int</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(s.encode(<span class="string">&#x27;latin-1&#x27;</span>).<span class="built_in">hex</span>(),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int2str</span>(<span class="params">i</span>):</span><br><span class="line">    tmp=<span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(tmp)%<span class="number">2</span>==<span class="number">1</span>:</span><br><span class="line">        tmp=<span class="string">&#x27;0&#x27;</span>+tmp</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(tmp).decode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;pubkey.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="built_in">str</span>(e)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="built_in">str</span>(N)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    plain = str2int(f.read())</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(plain,e,N)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;cipher.txt&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(int2str(c).encode(<span class="string">&#x27;latin-1&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>根据p,q的生成方式(Pollard’s ρ algorithm)，可以找到博客[密码学学习笔记 之 浅析Pollard’s rho algorithm及其应用 | Van1sh的小屋](<a target="_blank" rel="noopener" href="https://jayxv.github.io/2019/11/11/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E6%B5%85%E6%9E%90Pollard's">https://jayxv.github.io/2019/11/11/密码学学习笔记之浅析Pollard&#39;s</a> rho algorithm及其应用&#x2F;)</p>
<p>基本上算是原题，拿博客的板子打就好了</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a, b = b, a%b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mapx</span>(<span class="params">x</span>):</span><br><span class="line">    x=(<span class="built_in">pow</span>(x,n-<span class="number">1</span>,n)+<span class="number">3</span>)%n    <span class="comment">#pow(x,n-1,n)是为了减小数值，加速运算，</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pollard_rho</span>(<span class="params">x1,x2</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x1=mapx(x1)</span><br><span class="line">        x2=mapx(mapx(x2))</span><br><span class="line">        p=gcd(x1-x2,n)</span><br><span class="line">        <span class="keyword">if</span> (p == n):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;fail&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">elif</span> (p!=<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;p: &quot;</span>+<span class="built_in">str</span>(p))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;q: &quot;</span>+<span class="built_in">str</span>(n // p))</span><br><span class="line">            <span class="keyword">return</span> p,n // p</span><br><span class="line"></span><br><span class="line">n = <span class="number">49025724928152491719950645039355675823887062840095001672970308684156817293484070166684235178364916522473822184239221170514602692903302575847326054102901449806271709230774063675539139201327878971370342483682454617270705142999317092151456200639975738970405158598235961567646064089356496022247689989925574384915789399433283855087561428970245448888799812611301566886173165074558800757040196846800189738355799057422298556992606146766063202605288257843684190291545600282197788724944382475099313284546776350595539129553760118549158103804149179701853798084612143809757187033897573787135477889183344944579834942896249251191453</span></span><br><span class="line">p,q = pollard_rho(<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">open</span>(<span class="string">&quot;cipher.txt&quot;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">c = <span class="built_in">int</span>(c.<span class="built_in">hex</span>(),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">d = inverse(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode())</span><br></pre></td></tr></table></figure>

<h1 id="朱雀组"><a href="#朱雀组" class="headerlink" title="朱雀组"></a>朱雀组</h1><h2 id="Crypto01——unsolved"><a href="#Crypto01——unsolved" class="headerlink" title="Crypto01——unsolved"></a>Crypto01——unsolved</h2><blockquote>
<p>easy_MNTRU.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.stats.distributions.discrete_gaussian_integer <span class="keyword">import</span> DiscreteGaussianDistributionIntegerSampler</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">std_limit = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_accurate_Discrete_Gaussian</span>(<span class="params">sigma, limit=std_limit</span>):</span><br><span class="line">    factor = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        Df = DiscreteGaussianDistributionIntegerSampler(sigma * factor)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(RR(std([Df() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">15</span>)])) - sigma) / sigma &lt; limit:</span><br><span class="line">            <span class="keyword">return</span> Df</span><br><span class="line">        factor += <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ZZ_to_Fq</span>(<span class="params">_vector, _q, _n</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(i % _q) <span class="keyword">if</span> <span class="built_in">abs</span>(_q - <span class="built_in">int</span>(i % _q)) &gt; <span class="built_in">int</span>(i % _q) <span class="keyword">else</span> (<span class="built_in">int</span>(i % _q) - _q) <span class="keyword">for</span> i <span class="keyword">in</span> _vector] + [<span class="number">0</span>] * (</span><br><span class="line">            _n - <span class="built_in">len</span>(_vector))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">My_generator</span>(<span class="params">Sampler, _n, limit=std_limit</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        tmp = [Sampler() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(_n)]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(RR(std(tmp)) - Sampler.sigma) &lt; limit:</span><br><span class="line">            <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        F = Matrix([[PRz(My_generator(Df, d)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)])</span><br><span class="line">        G = Matrix([[PRz(My_generator(Df, d)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(k)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            H = F.change_ring(PRqm).inverse() * G.change_ring(PRqm)</span><br><span class="line">            H = Matrix([[PRz(Hij.lift()) <span class="keyword">for</span> Hij <span class="keyword">in</span> Hi] <span class="keyword">for</span> Hi <span class="keyword">in</span> H.transpose()]).transpose()</span><br><span class="line">            <span class="keyword">return</span> F, G, H</span><br><span class="line">        <span class="keyword">except</span> ArithmeticError:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d = <span class="number">64</span></span><br><span class="line">q = <span class="number">12289</span></span><br><span class="line">p = <span class="number">17</span></span><br><span class="line">n = <span class="number">2</span></span><br><span class="line">k = <span class="number">1</span></span><br><span class="line">sigma_f, sigma_s, sigma_e = <span class="number">0.4</span>, <span class="number">0.6</span>, <span class="number">0.6</span></span><br><span class="line"></span><br><span class="line">PRq = PolynomialRing(Zmod(q), <span class="string">&#x27;xq&#x27;</span>)</span><br><span class="line">PRp = PolynomialRing(Zmod(p), <span class="string">&#x27;xp&#x27;</span>)</span><br><span class="line">PRz = PolynomialRing(ZZ, <span class="string">&#x27;xz&#x27;</span>)</span><br><span class="line">mod_polynomial = PRz.cyclotomic_polynomial(d * <span class="number">2</span>)</span><br><span class="line">PRqm = PRq.quotient(mod_polynomial)</span><br><span class="line">PRpm = PRp.quotient(mod_polynomial)</span><br><span class="line">Df = get_accurate_Discrete_Gaussian(sigma_f)</span><br><span class="line">Ds = get_accurate_Discrete_Gaussian(sigma_s)</span><br><span class="line">De = get_accurate_Discrete_Gaussian(sigma_e)</span><br><span class="line">m = []</span><br><span class="line">base = <span class="built_in">int</span>.from_bytes(flag, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> base &gt; <span class="number">0</span>:</span><br><span class="line">    m.append(<span class="built_in">int</span>(base % p))</span><br><span class="line">    base = base // p</span><br><span class="line">m = PRz(m)</span><br><span class="line"></span><br><span class="line">s = vector([PRz(My_generator(Ds, d)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)])</span><br><span class="line">e = PRz(My_generator(Ds, d))</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;data.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>).write(<span class="string">&#x27;H = &#x27;</span> + <span class="built_in">str</span>([<span class="built_in">list</span>(vi) <span class="keyword">for</span> vi <span class="keyword">in</span> H]) + <span class="string">&#x27;\n&#x27;</span> + <span class="string">&#x27;c = &#x27;</span> + <span class="built_in">str</span>(c) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">H = [[10164*xz^63 + 9000*xz^62 + 8286*xz^61 + 5227*xz^60 + 6181*xz^59 + 5761*xz^58 + 7446*xz^57 + 10719*xz^56 + 12069*xz^55 + 934*xz^54 + 7301*xz^53 + 10310*xz^52 + 3397*xz^51 + 474*xz^50 + 4342*xz^49 + 11687*xz^48 + 3326*xz^47 + 10295*xz^46 + 4112*xz^45 + 12233*xz^44 + 9436*xz^43 + 2831*xz^42 + 6611*xz^41 + 7190*xz^40 + 4559*xz^39 + 5945*xz^38 + 9605*xz^37 + 8836*xz^36 + 7632*xz^35 + 11091*xz^34 + 11966*xz^33 + 6096*xz^32 + 4209*xz^31 + 8470*xz^30 + 3059*xz^29 + 1260*xz^28 + 131*xz^27 + 6057*xz^26 + 4237*xz^25 + 6208*xz^24 + 3906*xz^23 + 9797*xz^22 + 11804*xz^21 + 8216*xz^20 + 4697*xz^19 + 9711*xz^18 + 10839*xz^17 + 2198*xz^16 + 9361*xz^15 + 10790*xz^14 + 2727*xz^13 + 7269*xz^12 + 10677*xz^11 + 12195*xz^10 + 11451*xz^9 + 752*xz^8 + 1282*xz^7 + 2990*xz^6 + 4491*xz^5 + 5352*xz^4 + 3448*xz^3 + 7551*xz^2 + 4702*xz + 427], [2097*xz^63 + 5773*xz^62 + 9022*xz^61 + 8544*xz^60 + 10555*xz^59 + 12163*xz^58 + 514*xz^57 + 5992*xz^56 + 2822*xz^55 + 7486*xz^54 + 9950*xz^53 + 6333*xz^52 + 8917*xz^51 + 4097*xz^50 + 11713*xz^49 + 7495*xz^48 + 1989*xz^47 + 10468*xz^46 + 3808*xz^45 + 5333*xz^44 + 1184*xz^43 + 6871*xz^42 + 4944*xz^41 + 630*xz^40 + 4644*xz^39 + 5582*xz^38 + 2200*xz^37 + 2970*xz^36 + 11908*xz^35 + 1946*xz^34 + 9833*xz^33 + 4771*xz^32 + 652*xz^31 + 3287*xz^30 + 2660*xz^29 + 5133*xz^28 + 6935*xz^27 + 2833*xz^26 + 10788*xz^25 + 12068*xz^24 + 362*xz^23 + 7765*xz^22 + 11454*xz^21 + 6499*xz^20 + 8140*xz^19 + 9100*xz^18 + 1642*xz^17 + 3282*xz^16 + 2028*xz^15 + 3867*xz^14 + 6458*xz^13 + 7408*xz^12 + 2944*xz^11 + 12257*xz^10 + 9911*xz^9 + 6711*xz^8 + 11102*xz^7 + 5603*xz^6 + 2554*xz^5 + 298*xz^4 + 9782*xz^3 + 1928*xz^2 + 2535*xz + 3668]]</span></span><br><span class="line"><span class="string">c = 6085*xz^63 + 9658*xz^62 + 8682*xz^61 + 2660*xz^60 + 9268*xz^59 + 8059*xz^58 + 6842*xz^57 + 7810*xz^56 + 9166*xz^55 + 10543*xz^54 + 5037*xz^53 + 624*xz^52 + 8735*xz^51 + 7393*xz^50 + 1587*xz^49 + 11955*xz^48 + 9867*xz^47 + 8488*xz^46 + 6883*xz^45 + 8323*xz^44 + 4607*xz^43 + 195*xz^42 + 1357*xz^41 + 4753*xz^40 + 2225*xz^39 + 6728*xz^38 + 9472*xz^37 + 5292*xz^36 + 1132*xz^35 + 8998*xz^34 + 7379*xz^33 + 3055*xz^32 + 4360*xz^31 + 5320*xz^30 + 10615*xz^29 + 7225*xz^28 + 9062*xz^27 + 2879*xz^26 + 2527*xz^25 + 7636*xz^24 + 6341*xz^23 + 456*xz^22 + 1517*xz^21 + 10366*xz^20 + 5444*xz^19 + 2507*xz^18 + 8567*xz^17 + 12055*xz^16 + 6353*xz^15 + 8241*xz^14 + 7436*xz^13 + 11704*xz^12 + 5722*xz^11 + 3808*xz^10 + 11866*xz^9 + 4663*xz^8 + 11430*xz^7 + 7288*xz^6 + 9504*xz^5 + 10292*xz^4 + 1089*xz^3 + 6380*xz^2 + 6417*xz + 1991</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Crypto02-2"><a href="#Crypto02-2" class="headerlink" title="Crypto02"></a>Crypto02</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">各位朱雀组参赛选手请注意，平台新增“CRYPTO02”赛题提示：</span><br><span class="line">提示信息如下：请根据提示信息进一步完成解题。</span><br><span class="line"></span><br><span class="line">（<span class="number">1</span>）RSA模数 n：</span><br><span class="line"></span><br><span class="line"><span class="number">0x00b8cb1cca99b6ac41876c18845732a5cbfc875df346ee9002ce608508b5fcf6b60a5ac7722a2d64ef74e1443a338e70a73e63a303f3ac9adf198595699f6e9f30c009d219c7d98c4ec84203610834029c79567efc08f66b4bc3f564bfb571546a06b7e48fb35bb9ccea9a2cd44349f829242078dfa64d525927bfd55d099c024f</span></span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）素数 p 的高位：</span><br><span class="line"></span><br><span class="line"><span class="number">0xe700568ff506bd5892af92592125e06cbe9bd45dfeafe931a333c13463023d4f0000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"></span><br><span class="line">（<span class="number">3</span>）加密指数 e：</span><br><span class="line"></span><br><span class="line"><span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">（<span class="number">4</span>）加密消息文件：flag.enc，你需要读取并解密此文件。</span><br><span class="line"></span><br><span class="line">你的任务是通过给定的信息恢复素数 p，计算私钥 d，并解密加密消息以获得 flag。@全体成员 </span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag.enc</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p7盡債3噮?%H仧?C垂粂跈[羀鮟zi盐誗迉??U&lt;§鄡7-筙</span><br><span class="line">党</span><br><span class="line">猑徽狶€W?5醭*輑8&#x27; ?噉H传丏朠	颬/?w?鎬袆4技E\爙d?萘緍僞tx&gt;?</span><br></pre></td></tr></table></figure>

<p>给出p的高256位，爆8位coppersmith</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">0x00b8cb1cca99b6ac41876c18845732a5cbfc875df346ee9002ce608508b5fcf6b60a5ac7722a2d64ef74e1443a338e70a73e63a303f3ac9adf198595699f6e9f30c009d219c7d98c4ec84203610834029c79567efc08f66b4bc3f564bfb571546a06b7e48fb35bb9ccea9a2cd44349f829242078dfa64d525927bfd55d099c024f</span></span><br><span class="line">p_high = <span class="number">0xe700568ff506bd5892af92592125e06cbe9bd45dfeafe931a333c13463023d4f</span></span><br><span class="line">pbits = <span class="number">512</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c = bytes_to_long(<span class="built_in">open</span>(<span class="string">&#x27;flag.enc&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">2</span>**<span class="number">8</span>):</span><br><span class="line">     p4 = p_high&lt;&lt;<span class="number">8</span>			<span class="comment">#这里需要先爆破8位，使得知道264位以后再恢复p</span></span><br><span class="line">     p4 = p4 + i</span><br><span class="line">     kbits = pbits - p4.nbits()</span><br><span class="line">     p4 = p4 &lt;&lt; kbits</span><br><span class="line">     R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">     f = x + p4</span><br><span class="line">     x = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>, epsilon=<span class="number">0.01</span>)</span><br><span class="line">     <span class="keyword">if</span> x:</span><br><span class="line">         p = p4 + <span class="built_in">int</span>(x[<span class="number">0</span>])</span><br><span class="line">         q = n // p</span><br><span class="line">         d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">         m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">         <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line">         <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="Crypto03"><a href="#Crypto03" class="headerlink" title="Crypto03"></a>Crypto03</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> is_prime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> Secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">2999</span></span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p1 = getPrime(<span class="number">1024</span>)</span><br><span class="line">q1 = nextprime(<span class="number">2024</span> * p1)</span><br><span class="line">n1 = p1 * q1</span><br><span class="line">f.write(<span class="string">&quot;n1 = &#123;0&#125;\n&quot;</span>.<span class="built_in">format</span>(n1))</span><br><span class="line"></span><br><span class="line">p2 = getPrime(<span class="number">1024</span>)</span><br><span class="line">q2 = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> q2 &lt; p2:</span><br><span class="line">    q2 = getPrime(<span class="number">1024</span>)</span><br><span class="line">n2 = p2 * q2</span><br><span class="line">n22 = p2 * p2 + q2 * q2</span><br><span class="line">f.write(<span class="string">&quot;n2 = &#123;0&#125;\n&quot;</span>.<span class="built_in">format</span>(n2))</span><br><span class="line">f.write(<span class="string">&quot;n22 = &#123;0&#125;\n&quot;</span>.<span class="built_in">format</span>(n22))</span><br><span class="line"></span><br><span class="line">r = random.getrandbits(<span class="number">1024</span>)</span><br><span class="line">p3 = r</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> is_prime(p3):</span><br><span class="line">    p3 += random.getrandbits(<span class="number">400</span>)</span><br><span class="line">q3 = r</span><br><span class="line"><span class="keyword">while</span> q3 &lt; p3:</span><br><span class="line">    q3 += random.getrandbits(<span class="number">500</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> is_prime(p3):</span><br><span class="line">    q3 += random.getrandbits(<span class="number">500</span>)</span><br><span class="line">n3 = p3 * q3</span><br><span class="line">f.write(<span class="string">&quot;n3 = &#123;0&#125;\n&quot;</span>.<span class="built_in">format</span>(n3))</span><br><span class="line"></span><br><span class="line">m1 = p1 * m * m + p2 * m + p3</span><br><span class="line">m2 = q1 * m * m + q2 * m + q3</span><br><span class="line">c1 = <span class="built_in">pow</span>(m1, e, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2, e, n)</span><br><span class="line"></span><br><span class="line">f.write(<span class="string">&quot;n = &#123;0&#125;\n&quot;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">f.write(<span class="string">&quot;c1 = &#123;0&#125;\n&quot;</span>.<span class="built_in">format</span>(c1))</span><br><span class="line">f.write(<span class="string">&quot;c2 = &#123;0&#125;\n&quot;</span>.<span class="built_in">format</span>(c2))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n1 = </span></span><br><span class="line"><span class="string">n2 = </span></span><br><span class="line"><span class="string">n22 = </span></span><br><span class="line"><span class="string">n3 = </span></span><br><span class="line"><span class="string">n = </span></span><br><span class="line"><span class="string">c1 = </span></span><br><span class="line"><span class="string">c2 = </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="part1"><a href="#part1" class="headerlink" title="part1"></a>part1</h3><p>第一部分<br>$$<br>n_1 &#x3D; p\times (2024p + x)<br>$$<br>把<code>n1 // 2024</code>开根号，爆破一点即可分解n1</p>
<h3 id="part2"><a href="#part2" class="headerlink" title="part2"></a>part2</h3><p>第二部分，利用下面两个式子分解n2<br>$$<br>n_2 &#x3D; p\times q<br>$$</p>
<p>$$<br>n_{22} &#x3D; p^2 + q^2<br>$$</p>
<p>那么有<br>$$<br>p+q &#x3D; \sqrt{n_{22}+ 2n_2}<br>$$</p>
<p>$$<br>p-q &#x3D; \sqrt{n_{22}- 2n_2}<br>$$</p>
<h3 id="part3"><a href="#part3" class="headerlink" title="part3"></a>part3</h3><p>经过测试</p>
<p>记<code>t = gmpy2.iroot(n3,2)[0]</code>，会发现要么<code>p3 + q3 = 2 * t</code>，要么<code>p3 + q3 = 2*t + 1</code></p>
<p>那么我们就有了<code>p3 + q3</code>，这很容易就能分解出p3,q3了。</p>
<p>但实际的使用利用的等式是<code>p3 * q3 == n3</code>，<code>p3 + q3 == 2*t + 2</code>有点奇怪</p>
<p>三个n都分解了之后用相关消息攻击，e为2999，比较大，用H-GCD</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HGCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * b.degree() &lt;= a.degree() <span class="keyword">or</span> a.degree() == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    m = a.degree() // <span class="number">2</span></span><br><span class="line">    a_top, a_bot = a.quo_rem(x^m)</span><br><span class="line">    b_top, b_bot = b.quo_rem(x^m)</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a_top, b_top)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    q, e = c.quo_rem(d)</span><br><span class="line">    d_top, d_bot = d.quo_rem(x^(m // <span class="number">2</span>))</span><br><span class="line">    e_top, e_bot = e.quo_rem(x^(m // <span class="number">2</span>))</span><br><span class="line">    S00, S01, S10, S11 = HGCD(d_top, e_top)</span><br><span class="line">    RET00 = S01 * R00 + (S00 - q * S01) * R10</span><br><span class="line">    RET01 = S01 * R01 + (S00 - q * S01) * R11</span><br><span class="line">    RET10 = S11 * R00 + (S10 - q * S11) * R10</span><br><span class="line">    RET11 = S11 * R01 + (S10 - q * S11) * R11</span><br><span class="line">    <span class="keyword">return</span> RET00, RET01, RET10, RET11</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="built_in">print</span>(a.degree(), b.degree())</span><br><span class="line">    q, r = a.quo_rem(b)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a, b)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> c.monic()</span><br><span class="line">    q, r = c.quo_rem(d)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    <span class="keyword">return</span> GCD(d, r)</span><br><span class="line"></span><br><span class="line">sys.setrecursionlimit(<span class="number">500000</span>)</span><br><span class="line"></span><br><span class="line">n1 = </span><br><span class="line">n2 = </span><br><span class="line">n22 = </span><br><span class="line">n3 = </span><br><span class="line">n = </span><br><span class="line">c1 = </span><br><span class="line">c2 = </span><br><span class="line">e = <span class="number">2999</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># factor n1</span></span><br><span class="line">t1 = gmpy2.iroot(n1 // <span class="number">2024</span>,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">100000</span>,<span class="number">100000</span>):</span><br><span class="line">    p1 = t1 + i</span><br><span class="line">    <span class="keyword">if</span> n1 % p1 == <span class="number">0</span>:</span><br><span class="line">        q1 = n1 // p1</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> p1 &gt; q1:</span><br><span class="line">    p1,q1 = q1,p1</span><br><span class="line"></span><br><span class="line"><span class="comment"># factor n2</span></span><br><span class="line">p_add_q = gmpy2.iroot(n22 + <span class="number">2</span>*n2,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">p_sub_q = gmpy2.iroot(n22 - <span class="number">2</span>*n2,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">p2 = (p_add_q + p_sub_q) // <span class="number">2</span></span><br><span class="line">q2 = n2 // p2</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p2 &gt; q2:</span><br><span class="line">    p2,q2 = q2,p2</span><br><span class="line">    </span><br><span class="line"><span class="comment"># factor n3</span></span><br><span class="line">t3 = <span class="number">2</span>*gmpy2.iroot(n3,<span class="number">2</span>)[<span class="number">0</span>] + <span class="number">2</span></span><br><span class="line">p_add_q = t3</span><br><span class="line">p_sub_q = gmpy2.iroot((p_add_q)**<span class="number">2</span> - <span class="number">4</span>*n3,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">p3 = (p_add_q + p_sub_q) // <span class="number">2</span></span><br><span class="line">q3 = (p_add_q - p_sub_q) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p3 &gt; q3:</span><br><span class="line">    p3,q3 = q3,p3</span><br><span class="line"></span><br><span class="line">p1,q1 = <span class="built_in">int</span>(p1),<span class="built_in">int</span>(q1)</span><br><span class="line">p2,q2 = <span class="built_in">int</span>(p2),<span class="built_in">int</span>(q2)</span><br><span class="line">p3,q3 = <span class="built_in">int</span>(p3),<span class="built_in">int</span>(q3)</span><br><span class="line"></span><br><span class="line"><span class="comment">###### Franklin-Reiter</span></span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (p1 * x * x + p2 * x + p3)^e - c1</span><br><span class="line">g = (q1 * x * x + q2 * x + q3)^e - c2</span><br><span class="line"></span><br><span class="line">res = GCD(f,g)</span><br><span class="line"></span><br><span class="line">m = -res.monic().coefficients()[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h1 id="强网杯"><a href="#强网杯" class="headerlink" title="强网杯"></a>强网杯</h1><h2 id="easyRSA"><a href="#easyRSA" class="headerlink" title="easyRSA"></a>easyRSA</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">import</span> random, gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAEncryptor</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">		self.g = self.a = self.b = <span class="number">0</span></span><br><span class="line">		self.e = <span class="number">65537</span></span><br><span class="line">		self.factorGen()</span><br><span class="line">		self.product()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">factorGen</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			self.g = getPrime(<span class="number">500</span>)</span><br><span class="line">			<span class="keyword">while</span> <span class="keyword">not</span> gmpy2.is_prime(<span class="number">2</span>*self.g*self.a+<span class="number">1</span>):</span><br><span class="line">				self.a = random.randint(<span class="number">2</span>**<span class="number">523</span>, <span class="number">2</span>**<span class="number">524</span>)</span><br><span class="line">			<span class="keyword">while</span> <span class="keyword">not</span> gmpy2.is_prime(<span class="number">2</span>*self.g*self.b+<span class="number">1</span>):</span><br><span class="line">				self.b = random.randint(<span class="number">2</span>**<span class="number">523</span>, <span class="number">2</span>**<span class="number">524</span>)</span><br><span class="line">			self.h = <span class="number">2</span>*self.g*self.a*self.b+self.a+self.b</span><br><span class="line">			<span class="keyword">if</span> gmpy2.is_prime(self.h):</span><br><span class="line">				self.N = <span class="number">2</span>*self.h*self.g+<span class="number">1</span></span><br><span class="line">				<span class="built_in">print</span>(<span class="built_in">len</span>(<span class="built_in">bin</span>(self.N)))</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, msg</span>):</span><br><span class="line">		<span class="keyword">return</span> gmpy2.powmod(msg, self.e, self.N)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">product</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">			self.flag = f.read()</span><br><span class="line">		self.enc = self.encrypt(self.flag)</span><br><span class="line">		self.show()</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&#x27;enc=<span class="subst">&#123;self.enc&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&quot;N=<span class="subst">&#123;self.N&#125;</span>&quot;</span>)</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&quot;e=<span class="subst">&#123;self.e&#125;</span>&quot;</span>)</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&quot;g=<span class="subst">&#123;self.g&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RSAEncryptor()</span><br></pre></td></tr></table></figure>

<p>根据p,q的产生方式</p>
<p>定位到Common Prime RSA。<a target="_blank" rel="noopener" href="https://hasegawaazusa.github.io/common-prime-rsa.html?highlight=common+prime">Common Prime RSA 笔记 | 独奏の小屋</a>找到该题符合的条件：g &lt; a + b，即1.3.3中的攻击脚本</p>
<p><img src="/../../images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-2-1.png"></p>
<p>先获取数据，N是2048bit，g是500bit。更改参数，把nbits改成2048,gamma改为0.244</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.groups.generic <span class="keyword">import</span> bsgs</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N=<span class="number">20435271199198608366445070163055743926530547854315033141279645965767638473864664330754962276436466649275050979103893712139245544544872935554374114399052839215948338405516499474115214273699914266370050930769132408706474824505336493869342787492685168436693712862639462238101469809198476436457638629311139852354706756281766432512479057195404236230484898324707597749019917227269367587815080448139295679716499335061655279345030131435571625512494222844856455878041228974934679176701090200039100574296646644271325056802850586021423090540681108392177561696676096831318357211402247645340390966411768743795331989322314544746799</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">g=<span class="number">1782714261471199600627912602675948124521242155026857581417496643395108146067670647314507299724027644449584417991370237640807949819393846820875335817261</span></span><br><span class="line">enc=<span class="number">20350664281726403319264794434818308682046627973818456992245939179105629755654804516474027208643477028915373806837243260505684415739400790158679693158292815111799557125205151404100645653607777497253093260710715998875446908652240009553176151050618425031785922700834263127349910566138042780128833737173370642149352579347648172805592085834236458809040063106208561153446872735282875495007579182595935084451653408565873131518763369654422924777264084722832367604444283493236654780236432466093893715601405666605776325094892405077833019846528616538992220553807641215435015982473851848348382653049398621386187791517991659737573</span></span><br><span class="line">nbits = <span class="number">2048</span></span><br><span class="line">gamma = <span class="number">0.244</span></span><br><span class="line">cbits = ceil(nbits * (<span class="number">0.5</span> - <span class="number">2</span> * gamma))</span><br><span class="line"></span><br><span class="line">M = (N - <span class="number">1</span>) // (<span class="number">2</span> * g)</span><br><span class="line">u = M // (<span class="number">2</span> * g)</span><br><span class="line">v = M - <span class="number">2</span> * g * u</span><br><span class="line">GF = Zmod(N)</span><br><span class="line">x = GF.random_element()</span><br><span class="line">y = x ^ (<span class="number">2</span> * g)</span><br><span class="line"><span class="comment"># c的范围大概与N^(0.5-2*gamma)很接近</span></span><br><span class="line">c = bsgs(y, y ^ u, ((<span class="number">2</span>**(cbits-<span class="number">1</span>)), (<span class="number">2</span>**(cbits+<span class="number">1</span>))))</span><br><span class="line">ab = u - c</span><br><span class="line">apb = v + <span class="number">2</span> * g * c</span><br><span class="line">P.&lt;x&gt; = ZZ[]</span><br><span class="line">f = x ^ <span class="number">2</span> - apb * x + ab</span><br><span class="line">a = f.roots()</span><br><span class="line"><span class="keyword">if</span> a:</span><br><span class="line">    a, b = a[<span class="number">0</span>][<span class="number">0</span>], a[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">    p = <span class="number">2</span> * g * a + <span class="number">1</span></span><br><span class="line">    q = <span class="number">2</span> * g * b + <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> p * q == N</span><br><span class="line"></span><br><span class="line">d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(enc,d,N)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># flag&#123;927ab370-fd1e-422d-8658-60b16447c86e&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="apbq"><a href="#apbq" class="headerlink" title="apbq"></a>apbq</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSA</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, privatekey, publickey</span>):</span><br><span class="line">        self.p, self.q, self.d = privatekey</span><br><span class="line">        self.n, self.e = publickey</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, plaintext</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(plaintext, <span class="built_in">bytes</span>):</span><br><span class="line">            plaintext = bytes_to_long(plaintext)</span><br><span class="line">        ciphertext = <span class="built_in">pow</span>(plaintext, self.e, self.n)</span><br><span class="line">        <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, ciphertext</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(ciphertext, <span class="built_in">bytes</span>):</span><br><span class="line">            ciphertext = bytes_to_long(ciphertext)</span><br><span class="line">        plaintext = <span class="built_in">pow</span>(ciphertext, self.d, self.n)</span><br><span class="line">        <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_keypair</span>(<span class="params">nbits, e = <span class="number">65537</span></span>):</span><br><span class="line">    p = getPrime(nbits//<span class="number">2</span>)</span><br><span class="line">    q = getPrime(nbits//<span class="number">2</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    d = inverse(e, n - p - q + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> (p, q, d), (n, e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pt = <span class="string">&#x27;./output.txt&#x27;</span></span><br><span class="line">    fout = <span class="built_in">open</span>(pt, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    sys.stdout = fout</span><br><span class="line"></span><br><span class="line">    block_size = ceil(<span class="built_in">len</span>(flag)/<span class="number">3</span>)</span><br><span class="line">    flag = [flag[i:i+block_size] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), block_size)]</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;[+] Welcome to my apbq game&#x27;</span>)</span><br><span class="line">    <span class="comment"># stage 1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ stage 1: p + q&#x27;</span>)</span><br><span class="line">    prikey1, pubkey1 = get_keypair(<span class="number">1024</span>)</span><br><span class="line">    RSA1 = RSA(prikey1, pubkey1)</span><br><span class="line">    enc1 = RSA1.encrypt(flag[<span class="number">0</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ hints = <span class="subst">&#123;prikey1[<span class="number">0</span>] + prikey1[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ public key = <span class="subst">&#123;pubkey1&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ enc1 = <span class="subst">&#123;enc1&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;----------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># stage 2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ stage 2: ai*p + bi*q&#x27;</span>)</span><br><span class="line">    prikey2, pubkey2 = get_keypair(<span class="number">1024</span>)</span><br><span class="line">    RSA2 = RSA(prikey2, pubkey2)</span><br><span class="line">    enc2 = RSA2.encrypt(flag[<span class="number">1</span>])</span><br><span class="line">    kbits = <span class="number">180</span></span><br><span class="line">    a = [getRandomNBitInteger(kbits) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">    b = [getRandomNBitInteger(kbits) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">    c = [a[i]*prikey2[<span class="number">0</span>] + b[i]*prikey2[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ hints = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ public key = <span class="subst">&#123;pubkey2&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ enc2 = <span class="subst">&#123;enc2&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;----------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># stage 3</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ stage 3: a*p + q, p + bq&#x27;</span>)</span><br><span class="line">    prikey3, pubkey3 = get_keypair(<span class="number">1024</span>)</span><br><span class="line">    RSA3 = RSA(prikey3, pubkey3)</span><br><span class="line">    enc3 = RSA2.encrypt(flag[<span class="number">2</span>])</span><br><span class="line">    kbits = <span class="number">512</span></span><br><span class="line">    a = getRandomNBitInteger(kbits)</span><br><span class="line">    b = getRandomNBitInteger(kbits)</span><br><span class="line">    c1 = a*prikey3[<span class="number">0</span>] + prikey3[<span class="number">1</span>]</span><br><span class="line">    c2 = prikey3[<span class="number">0</span>] + b*prikey3[<span class="number">1</span>] </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ hints = <span class="subst">&#123;c1, c2&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ public key = <span class="subst">&#123;pubkey3&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ enc3 = <span class="subst">&#123;enc3&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>output.txt</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[+] Welcome to my apbq game</span><br><span class="line">┃ stage 1: p + q</span><br><span class="line">┃ hints = 18978581186415161964839647137704633944599150543420658500585655372831779670338724440572792208984183863860898382564328183868786589851370156024615630835636170</span><br><span class="line">┃ public key = (89839084450618055007900277736741312641844770591346432583302975236097465068572445589385798822593889266430563039645335037061240101688433078717811590377686465973797658355984717210228739793741484666628342039127345855467748247485016133560729063901396973783754780048949709195334690395217112330585431653872523325589, 65537)</span><br><span class="line">┃ enc1 = 23664702267463524872340419776983638860234156620934868573173546937679196743146691156369928738109129704387312263842088573122121751421709842579634121187349747424486233111885687289480494785285701709040663052248336541918235910988178207506008430080621354232140617853327942136965075461701008744432418773880574136247</span><br><span class="line">----------------------</span><br><span class="line">┃ stage 2: ai*p + bi*q</span><br><span class="line">┃ hints = []</span><br><span class="line">┃ public key = (73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819, 65537)</span><br><span class="line">┃ enc2 = 30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span><br><span class="line">----------------------</span><br><span class="line">┃ stage 3: a*p + q, p + bq</span><br><span class="line">┃ hints = (68510878638370415044742935889020774276546916983689799210290582093686515377232591362560941306242501220803210859757512468762736941602749345887425082831572206675493389611203432014126644550502117937044804472954180498370676609819898980996282130652627551615825721459553747074503843556784456297882411861526590080037, 117882651978564762717266768251008799169262849451887398128580060795377656792158234083843539818050019451797822782621312362313232759168181582387488893534974006037142066091872636582259199644094998729866484138566711846974126209431468102938252566414322631620261045488855395390985797791782549179665864885691057222752)</span><br><span class="line">┃ public key = (94789409892878223843496496113047481402435455468813255092840207010463661854593919772268992045955100688692872116996741724352837555794276141314552518390800907711192442516993891316013640874154318671978150702691578926912235318405120588096104222702992868492960182477857526176600665556671704106974346372234964363581, 65537)</span><br><span class="line">┃ enc3 = 17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755</span><br></pre></td></tr></table></figure>



<h3 id="stage1"><a href="#stage1" class="headerlink" title="stage1"></a>stage1</h3><p>给出$h &#x3D; p+q$，联立$n &#x3D; p\times q$就能分解了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">hints = <span class="number">18978581186415161964839647137704633944599150543420658500585655372831779670338724440572792208984183863860898382564328183868786589851370156024615630835636170</span></span><br><span class="line">n1,e1 = (<span class="number">89839084450618055007900277736741312641844770591346432583302975236097465068572445589385798822593889266430563039645335037061240101688433078717811590377686465973797658355984717210228739793741484666628342039127345855467748247485016133560729063901396973783754780048949709195334690395217112330585431653872523325589</span>, <span class="number">65537</span>)</span><br><span class="line">enc1 = <span class="number">23664702267463524872340419776983638860234156620934868573173546937679196743146691156369928738109129704387312263842088573122121751421709842579634121187349747424486233111885687289480494785285701709040663052248336541918235910988178207506008430080621354232140617853327942136965075461701008744432418773880574136247</span></span><br><span class="line"></span><br><span class="line">p_add_q = hints</span><br><span class="line">p_sub_q = gmpy2.iroot(p_add_q^<span class="number">2</span> - <span class="number">4</span>*n1,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">p1 = (p_add_q + p_sub_q) // <span class="number">2</span></span><br><span class="line">q1 = (p_add_q - p_sub_q) // <span class="number">2</span></span><br><span class="line">d1 = inverse(e1,(p1-<span class="number">1</span>)*(q1-<span class="number">1</span>))</span><br><span class="line">m1 = <span class="built_in">pow</span>(enc1,d1,n1)</span><br><span class="line">flag1 = long_to_bytes(m1)</span><br><span class="line"><span class="built_in">print</span>(flag1)</span><br><span class="line"><span class="comment"># flag&#123;yOu_can_</span></span><br></pre></td></tr></table></figure>

<h3 id="stage2"><a href="#stage2" class="headerlink" title="stage2"></a>stage2</h3><p>第二部分类似于DownUnderCTF2023的ap+bq-ii。今年华为杯也有这题。找到这个exp：<a target="_blank" rel="noopener" href="https://github.com/josephsurin/my-ctf-challenges/blob/main/downunderctf-2023/apbq-rsa-ii/solve/solv.sage">my-ctf-challenges&#x2F;downunderctf-2023&#x2F;apbq-rsa-ii&#x2F;solve&#x2F;solv.sage at main · josephsurin&#x2F;my-ctf-challenges</a></p>
<p>拿原有的exp打了一下发现没打出来，试过爆破一些高位，但无果，后面索性多用些数据，没想到4个数据就分解了。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># n, c, hints</span></span><br><span class="line">hints = []</span><br><span class="line">n, e = (<span class="number">73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819</span>, <span class="number">65537</span>)</span><br><span class="line">enc2 = <span class="number">30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span></span><br><span class="line"></span><br><span class="line">V = hints[:<span class="number">4</span>]</span><br><span class="line">k = <span class="number">2</span>^<span class="number">800</span></span><br><span class="line">M = Matrix.column([k * v <span class="keyword">for</span> v <span class="keyword">in</span> V]).augment(Matrix.identity(<span class="built_in">len</span>(V)))</span><br><span class="line">B = [b[<span class="number">1</span>:] <span class="keyword">for</span> b <span class="keyword">in</span> M.LLL()]</span><br><span class="line">M = (k * Matrix(B[:<span class="built_in">len</span>(V)-<span class="number">2</span>])).T.augment(Matrix.identity(<span class="built_in">len</span>(V)))</span><br><span class="line">B = [b[-<span class="built_in">len</span>(V):] <span class="keyword">for</span> b <span class="keyword">in</span> M.LLL() <span class="keyword">if</span> <span class="built_in">set</span>(b[:<span class="built_in">len</span>(V)-<span class="number">2</span>]) == &#123;<span class="number">0</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s, t <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(<span class="number">4</span>), repeat=<span class="number">2</span>):</span><br><span class="line">    T = s*B[<span class="number">0</span>] + t*B[<span class="number">1</span>]</span><br><span class="line">    a1, a2, a3, a4 = T</span><br><span class="line">    kq = gcd(a1 * hints[<span class="number">1</span>] - a2 * hints[<span class="number">0</span>], n)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">1</span> &lt; kq &lt; n:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;find!&#x27;</span>, kq, s, t)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">16</span>, <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> kq % i == <span class="number">0</span>:</span><br><span class="line">        kq //= i</span><br><span class="line">q = <span class="built_in">int</span>(kq)</span><br><span class="line">p = <span class="built_in">int</span>(n // kq)</span><br><span class="line">d = <span class="built_in">pow</span>(<span class="number">0x10001</span>, -<span class="number">1</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(enc2, d, n)</span><br><span class="line">flag = long_to_bytes(m).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">enc3 = <span class="number">17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755</span></span><br><span class="line">flag = long_to_bytes(<span class="built_in">pow</span>(enc3,d,n)).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># flag&#123;yOu_can_s0lve_the_@pbq_prob1em!!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="stage3——unsolved"><a href="#stage3——unsolved" class="headerlink" title="stage3——unsolved"></a>stage3——unsolved</h3><p>比赛的时候第三部分参数和第二部分一样，直接拿第二部分的私钥解密enc3即可。</p>
<p>赛后找到<a target="_blank" rel="noopener" href="https://github.com/defund/ctf/blob/master/angstromctf-2024/blahaj/solve.sage">ctf&#x2F;angstromctf-2024&#x2F;blahaj&#x2F;solve.sage at master · defund&#x2F;ctf</a></p>
<p>原题代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">p = random_prime(<span class="number">2</span>**<span class="number">1024</span>)</span><br><span class="line">q = random_prime(<span class="number">2</span>**<span class="number">1024</span>)</span><br><span class="line">a = randint(<span class="number">0</span>, <span class="number">2</span>**<span class="number">1024</span>)</span><br><span class="line">b = randint(<span class="number">0</span>, <span class="number">2</span>**<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_flag</span>(<span class="params">file=<span class="string">&#x27;flag.txt&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fin:</span><br><span class="line">        flag = fin.read()</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad_flag</span>(<span class="params">flag, bits=<span class="number">1024</span></span>):</span><br><span class="line">    pad = os.urandom(bits//<span class="number">8</span> - <span class="built_in">len</span>(flag))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(flag + pad, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_keys</span>(<span class="params">p, q</span>):</span><br><span class="line">    n = p * q</span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    <span class="keyword">return</span> n, e</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_message</span>(<span class="params">m, e, n</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">flag = read_flag()</span><br><span class="line">m = pad_flag(flag)</span><br><span class="line"></span><br><span class="line">n, e = generate_keys(p, q)</span><br><span class="line"><span class="keyword">assert</span> m &lt; n</span><br><span class="line"></span><br><span class="line">c = encrypt_message(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(p + b * q)</span><br><span class="line"><span class="built_in">print</span>(a * p + q)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">68510878638370415044742935889020774276546916983689799210290582093686515377232591362560941306242501220803210859757512468762736941602749345887425082831572206675493389611203432014126644550502117937044804472954180498370676609819898980996282130652627551615825721459553747074503843556784456297882411861526590080037</span></span><br><span class="line">y = <span class="number">117882651978564762717266768251008799169262849451887398128580060795377656792158234083843539818050019451797822782621312362313232759168181582387488893534974006037142066091872636582259199644094998729866484138566711846974126209431468102938252566414322631620261045488855395390985797791782549179665864885691057222752</span></span><br><span class="line">n = <span class="number">94789409892878223843496496113047481402435455468813255092840207010463661854593919772268992045955100688692872116996741724352837555794276141314552518390800907711192442516993891316013640874154318671978150702691578926912235318405120588096104222702992868492960182477857526176600665556671704106974346372234964363581</span></span><br><span class="line">c = <span class="number">17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">R = Integers(n)</span><br><span class="line">P.&lt;a, b, p, q&gt; = PolynomialRing(Integers(n))</span><br><span class="line">f1 = a*p + q</span><br><span class="line">f2 = p + b*q</span><br><span class="line">f3 = p*q</span><br><span class="line">I = Ideal([f1 - x, f2 - y, f3 - n])</span><br><span class="line">B = I.groebner_basis()</span><br><span class="line"></span><br><span class="line">g = B[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">z = ZZ(g.coefficient(&#123;q: <span class="number">1</span>&#125;))</span><br><span class="line"><span class="keyword">assert</span> g.constant_coefficient() == R(-y)</span><br><span class="line"></span><br><span class="line">_, (z1, _), (z2, _) = <span class="built_in">list</span>(g)</span><br><span class="line">z1 = ZZ(z1)</span><br><span class="line">z2 = ZZ(z2)</span><br><span class="line"></span><br><span class="line">S = <span class="number">2</span>^<span class="number">1024</span></span><br><span class="line"><span class="keyword">for</span> p_upper_bits <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">	p_upper = p_upper_bits &lt;&lt; <span class="number">1020</span></span><br><span class="line">	<span class="keyword">for</span> q_upper_bits <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">		q_upper = q_upper_bits &lt;&lt; <span class="number">1020</span></span><br><span class="line">		M = matrix(ZZ, [[S, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>], [S*z1, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>], [S*(z2 + p_upper + q_upper*z1), <span class="number">0</span>, <span class="number">0</span>, S], [S*n, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]])</span><br><span class="line">		B = M.LLL()</span><br><span class="line">		<span class="keyword">for</span> b <span class="keyword">in</span> B:</span><br><span class="line">			<span class="keyword">if</span> b[-<span class="number">1</span>] == S:</span><br><span class="line">				<span class="keyword">if</span> b[<span class="number">1</span>] &lt; <span class="number">0</span>:</span><br><span class="line">					b *= -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">				p_guess = b[<span class="number">1</span>] + p_upper</span><br><span class="line">				q_guess = b[<span class="number">2</span>] + q_upper</span><br><span class="line">				<span class="keyword">if</span> p_guess * q_guess == n:</span><br><span class="line">					d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (p_guess - <span class="number">1</span>)*(q_guess - <span class="number">1</span>))</span><br><span class="line">					<span class="built_in">print</span>(<span class="built_in">int</span>(<span class="built_in">pow</span>(c, d, n)).to_bytes(<span class="number">1024</span>//<span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">					exit()</span><br></pre></td></tr></table></figure>

<p>没打出来</p>
<h2 id="21-steps"><a href="#21-steps" class="headerlink" title="21_steps"></a>21_steps</h2><p>问GPT如何用python在21步内计算128bit值的汉明重量，得到</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hamming_weight</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="comment"># 1. 分离每一位和其邻位，并相加（每2位一组）</span></span><br><span class="line">    x = x - ((x &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555555555555555555555555555</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 将每4位一组中的前2位和后2位相加</span></span><br><span class="line">    x = (x &amp; <span class="number">0x33333333333333333333333333333333</span>) + ((x &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x33333333333333333333333333333333</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 将每8位一组中的前4位和后4位相加</span></span><br><span class="line">    x = (x + (x &gt;&gt; <span class="number">4</span>)) &amp; <span class="number">0x0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 将每16位一组中的前8位和后8位相加</span></span><br><span class="line">    x = (x * <span class="number">0x01010101010101010101010101010101</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 将所有累加的结果移到最低位，并提取结果</span></span><br><span class="line">    <span class="keyword">return</span> (x &gt;&gt; <span class="number">120</span>) &amp; <span class="number">0x7F</span>  <span class="comment"># 最高7位足以表示128的汉明权重</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例</span></span><br><span class="line">binary_number = <span class="number">0b110101011011011011011111000110110111011111010111011110110111101101111111110111011111011111010101011101010110101010</span></span><br><span class="line"><span class="built_in">print</span>(hamming_weight(binary_number))</span><br></pre></td></tr></table></figure>

<p>然后一步一步改成符合正则的式子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">B=A&gt;&gt;1;</span><br><span class="line">B=B&amp;113427455640312821154458202477256070485;</span><br><span class="line">A=A-B;</span><br><span class="line"><span class="comment"># 实现x = x - ((x &gt;&gt; 1) &amp; 0x55555555555555555555555555555555)</span></span><br><span class="line">B=A&gt;&gt;2;</span><br><span class="line">B=B&amp;68056473384187692692674921486353642291;</span><br><span class="line">A=A&amp;68056473384187692692674921486353642291;</span><br><span class="line">A=A+B;</span><br><span class="line"><span class="comment"># 实现x = (x &amp; 0x33333333333333333333333333333333) + ((x &gt;&gt; 2) &amp; 0x33333333333333333333333333333333)</span></span><br><span class="line">B=A&gt;&gt;4;</span><br><span class="line">A=A+B;</span><br><span class="line">A=A&amp;20016609818878733144904388672456953615;</span><br><span class="line"><span class="comment"># 实现x = (x + (x &gt;&gt; 4)) &amp; 0x0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F</span></span><br><span class="line">B=A*1334440654591915542993625911497130241;</span><br><span class="line">A=B&amp;340282366920938463463374607431768211455;</span><br><span class="line"><span class="comment"># 实现x = (x * 0x01010101010101010101010101010101) &amp; 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</span></span><br><span class="line">B=A&gt;&gt;120;</span><br><span class="line">A=B&amp;127;</span><br></pre></td></tr></table></figure>

<p>一步一步检查是否正确</p>
<blockquote>
<p>test.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hamming_weight</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="comment"># 1. 分离每一位和其邻位，并相加（每2位一组）</span></span><br><span class="line">    x = x - ((x &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555555555555555555555555555</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;x1=<span class="subst">&#123;x&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 2. 将每4位一组中的前2位和后2位相加</span></span><br><span class="line">    x = (x &amp; <span class="number">0x33333333333333333333333333333333</span>) + ((x &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x33333333333333333333333333333333</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;x2=<span class="subst">&#123;x&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 3. 将每8位一组中的前4位和后4位相加</span></span><br><span class="line">    x = (x + (x &gt;&gt; <span class="number">4</span>)) &amp; <span class="number">0x0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;x3=<span class="subst">&#123;x&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 4. 将每16位一组中的前8位和后8位相加</span></span><br><span class="line">    x = (x * <span class="number">0x01010101010101010101010101010101</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;x4=<span class="subst">&#123;x&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 5. 将所有累加的结果移到最低位，并提取结果</span></span><br><span class="line">    <span class="keyword">return</span> (x &gt;&gt; <span class="number">120</span>) &amp; <span class="number">0x7F</span>  <span class="comment"># 最高7位足以表示128的汉明权重</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">binary_number = random.getrandbits(<span class="number">128</span>)</span><br><span class="line"><span class="built_in">print</span>(hamming_weight(binary_number))</span><br><span class="line"></span><br><span class="line">A=<span class="number">0b110101011011011011011111000110110111011111010111011110110111101101111111110111011111011111010101011101010110101010</span></span><br><span class="line">B=A&gt;&gt;<span class="number">1</span></span><br><span class="line">B=B&amp;<span class="number">113427455640312821154458202477256070485</span></span><br><span class="line">A=A-B</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;A1=<span class="subst">&#123;A&#125;</span>&quot;</span>)</span><br><span class="line">B=A&gt;&gt;<span class="number">2</span></span><br><span class="line">B=B&amp;<span class="number">68056473384187692692674921486353642291</span></span><br><span class="line">A=A&amp;<span class="number">68056473384187692692674921486353642291</span></span><br><span class="line">A=A+B</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;A2=<span class="subst">&#123;A&#125;</span>&quot;</span>)</span><br><span class="line">B=A&gt;&gt;<span class="number">4</span></span><br><span class="line">A=A+B</span><br><span class="line">A=A&amp;<span class="number">20016609818878733144904388672456953615</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;A3=<span class="subst">&#123;A&#125;</span>&quot;</span>)</span><br><span class="line">B=A*<span class="number">1334440654591915542993625911497130241</span></span><br><span class="line">A=B&amp;<span class="number">340282366920938463463374607431768211455</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;A4=<span class="subst">&#123;A&#125;</span>&quot;</span>)</span><br><span class="line">B=A&gt;&gt;<span class="number">120</span>;A=B&amp;<span class="number">127</span></span><br><span class="line"><span class="built_in">print</span>(A)</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-3-1.png"></p>
<p>最后传</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">B=A&gt;&gt;1;B=B&amp;113427455640312821154458202477256070485;A=A-B;B=A&gt;&gt;2;B=B&amp;68056473384187692692674921486353642291;A=A&amp;68056473384187692692674921486353642291;A=A+B;B=A&gt;&gt;4;A=A+B;A=A&amp;20016609818878733144904388672456953615;B=A*1334440654591915542993625911497130241;A=B&amp;340282366920938463463374607431768211455;B=A&gt;&gt;120;A=B&amp;127;</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-3-2.png"></p>
<h2 id="traditional-game"><a href="#traditional-game" class="headerlink" title="traditional_game"></a>traditional_game</h2><h3 id="step1"><a href="#step1" class="headerlink" title="step1"></a>step1</h3><p>同时开两个靶机sh1和sh2，大概率使得seed一样，这样在sh1中一直输入1，如果错误的话，sh2就输入0，反之输入1</p>
<h3 id="step2"><a href="#step2" class="headerlink" title="step2"></a>step2</h3><p>尝试：</p>
<p>d_的生成原理是，先把d的高659位整除blind，最后加上<code>(d % blind)</code>，那么我记准确的高659位为$d_h$，实际上我们得到的是$d_h’$，其中<code>dh&#39; = d_ &gt;&gt; unknown_bit</code>。并且<br>$$<br>d_h &#x3D; d_h’ + x<br>$$<br>这个x的值和blind同数量级</p>
<p>$$<br>d &#x3D; ((d_h’+ x)\times 2^{365} + y)\times blind + d_l<br>$$<br>取<code>dh = d_ &gt;&gt; 365</code></p>
<p>$$<br>d &#x3D; d_h\times 2^{365} + d_x\times blind + d_l<br>$$</p>
<p>$$<br>e[((d_h’ + x)\times 2^{365} + y)\times blind + d_l] &#x3D; 1 + k[(n+1)-(p+q)]<br>$$</p>
<p>于是有<br>$$<br>(ed_h’\times 2^{365}\times blind) + (ex\times2^{365} + y)\times blind + ed_l &#x3D; 1 + k[(n+1)-(p+q)]<br>$$<br>k可以用这个式子计算得到，$k &#x3D; \frac{ed_h\times 2^{365}}{n} + 1$</p>
<p>在模$ed_h\times 2^{365}\times blind$下建立多项式<br>$$<br>f &#x3D; 1 + k[(n+1) - z] - ed_l - (ex\times 2^{365} + y)\times blind \mod (ed_h’\times 2^{365}\times blind)<br>$$<br>无果</p>
<p>正解：根据论文：<a target="_blank" rel="noopener" href="https://cic.iacr.org/p/1/3/29/pdf">Small Public Exponent Brings More: Improved Partial Key Exposure Attacks against RSA</a></p>
<p><img src="/../../images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-3-4.png"></p>
<p>根据论文一步一步实现攻击即可</p>
<p>第一步是计算$k$，我用$k &#x3D; \frac{e\times d_h}{n} + 1$计算，经检验是准确的。</p>
<p>第二步拿dh，前面就拿了</p>
<p>第三步是恢复p的高位。根据论文中，先令$S &#x3D; N + 1 - \frac{(e\times d_h)}{k}$，$D &#x3D; \sqrt{S^2 - 4n}$，计算$p_h &#x3D; \frac{S + D}{2}$，这样得到的高位大概有105位正确</p>
<p>第四步是求$p \mod blind$，根据式子$ed_l \equiv 1 + k(n+1 - p- q) \mod blind$，这里可以计算出$p + q \equiv k^{-1}(1 + k(n + 1) - ed_l) \mod blind$，记<code>s = p+q</code>，然后解一元二次方程:$x^2 - sx + n \mod blind$，得到$p \mod blind$的值</p>
<p>第五步是求$p \mod e$，和上面的思路一样</p>
<p>第六步分解n</p>
<p>我们现在有<br>$$<br>p_1 \equiv p \mod e<br>$$</p>
<p>$$<br>p_2 \equiv p \mod blind<br>$$</p>
<p>用中国剩余定理求$p_l \equiv p \mod e\times blind$</p>
<p>然后看作$p &#x3D; t\times (e\times blind) + p_l$，这个t可以用$t_0 &#x3D; \frac{p_h - p_l)}{e\times blind}$来近似，那么就有$p &#x3D; (t_0 + x)\times (e\times blind) + p_l$，这个x的差值差不多是240-245bit左右</p>
<p>用coppersmith求小根</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh1 = remote(<span class="string">&quot;&quot;</span>,)</span><br><span class="line">sh2 = remote(<span class="string">&quot;&quot;</span>,)</span><br><span class="line"></span><br><span class="line">sh1.recvuntil(<span class="string">b&quot;[+] Welcome to the game!&quot;</span>)</span><br><span class="line">sh2.recvuntil(<span class="string">b&quot;[+] Welcome to the game!&quot;</span>)</span><br><span class="line">sh1.recvuntil(<span class="string">b&quot;[+] rsa public key:&quot;</span>)</span><br><span class="line">sh2.recvuntil(<span class="string">b&quot;[+] rsa public key:&quot;</span>)</span><br><span class="line">public_key = <span class="built_in">eval</span>(sh2.recvline().strip().decode())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    sh1.recvuntil(<span class="string">b&quot;[-] b:&quot;</span>)</span><br><span class="line">    sh1.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    sh2.recvuntil(<span class="string">b&quot;[-] b:&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;wrong!&quot;</span> <span class="keyword">in</span> sh1.recvline().strip():</span><br><span class="line">        sh2.sendline(<span class="string">b&quot;0&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(sh2.recvline().strip())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sh2.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(sh2.recvline().strip())</span><br><span class="line"></span><br><span class="line">blind_bit = <span class="number">40</span></span><br><span class="line">unknown_bit = <span class="number">365</span></span><br><span class="line">n,e = public_key</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">sh2.recvuntil(<span class="string">b&quot;privkey is:&quot;</span>)</span><br><span class="line">d_,blind = <span class="built_in">eval</span>(sh2.recvline().strip().decode()[:-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;d_ = <span class="subst">&#123;d_&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;blind = <span class="subst">&#123;blind&#125;</span>&quot;</span>)</span><br><span class="line">sh2.recvuntil(<span class="string">b&quot;encrypt token is:&quot;</span>)</span><br><span class="line">c = <span class="built_in">eval</span>(sh2.recvline().strip().decode())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">dh = d_ &gt;&gt; (unknown_bit + blind_bit) &lt;&lt; (unknown_bit + blind_bit)</span><br><span class="line">dl = d_ % blind</span><br><span class="line"></span><br><span class="line"><span class="comment"># step1 calculate k</span></span><br><span class="line">k = (e*dh) // n + <span class="number">1</span></span><br><span class="line"><span class="comment"># step2 dh</span></span><br><span class="line"><span class="comment"># step3 recover the MSBs of p</span></span><br><span class="line">S = n + <span class="number">1</span> - ((e*dh - <span class="number">1</span>) // k)</span><br><span class="line">D = gmpy2.iroot(<span class="built_in">abs</span>(S**<span class="number">2</span> - <span class="number">4</span>*n),<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">ph = <span class="built_in">int</span>((S + D) // <span class="number">2</span>) &gt;&gt; (<span class="number">512</span> - <span class="number">105</span>) &lt;&lt; (<span class="number">512</span> - <span class="number">105</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step4 calculate p+q % blind</span></span><br><span class="line">s = inverse(k,blind) * (<span class="number">1</span> + k * (n+<span class="number">1</span>) - e*dl) % blind</span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Zmod(blind))</span><br><span class="line">f = x^<span class="number">2</span> - s*x + n</span><br><span class="line">res = f.roots()</span><br><span class="line">may_p_mod_blind = [<span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">0</span>]),<span class="built_in">int</span>(res[<span class="number">1</span>][<span class="number">0</span>])]</span><br><span class="line"></span><br><span class="line"><span class="comment"># step5 calculate p+q % e</span></span><br><span class="line">k_inv = inverse(k,e)</span><br><span class="line">s = (n + <span class="number">1</span> + k_inv) % e</span><br><span class="line"></span><br><span class="line"><span class="comment"># step6 factor n</span></span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Zmod(e))</span><br><span class="line">f = x^<span class="number">2</span> - s*x + n</span><br><span class="line">res = f.roots()</span><br><span class="line">may_p_mod_e = [<span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">0</span>]),<span class="built_in">int</span>(res[<span class="number">1</span>][<span class="number">0</span>])]</span><br><span class="line">moduls = <span class="built_in">int</span>(blind) * <span class="built_in">int</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p_mod_e <span class="keyword">in</span> may_p_mod_e:</span><br><span class="line">    <span class="keyword">for</span> p_mod_blind <span class="keyword">in</span> may_p_mod_blind:</span><br><span class="line">        pl = crt([p_mod_blind,p_mod_e],[blind,e])</span><br><span class="line">        th = (ph - pl) // moduls</span><br><span class="line">        PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">        f = (th + x) * moduls + pl</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">240</span>, <span class="number">246</span>):</span><br><span class="line">            roots = f.monic().small_roots(X=<span class="number">2</span>^i,beta=<span class="number">0.49</span>,epsilon=<span class="number">0.02</span>)</span><br><span class="line">            <span class="keyword">if</span> roots != []:</span><br><span class="line">                p = <span class="built_in">int</span>(f(roots[<span class="number">0</span>]))</span><br><span class="line">                <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span>(p)</span><br><span class="line">                    q = n // p</span><br><span class="line">                    d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">                    m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">                    msg = long_to_bytes(m)</span><br><span class="line">                    <span class="built_in">print</span>(msg.<span class="built_in">hex</span>())</span><br><span class="line">                    sh2.sendlineafter(<span class="string">b&quot;[-] guess token:&quot;</span>,msg.<span class="built_in">hex</span>())</span><br><span class="line">                    <span class="built_in">print</span>(sh2.recvline())</span><br><span class="line">                    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF/11-3-3.png"></p>

    </div>

    
    
    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------已经到底啦！<i class="fa fa-paw"></i>-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>DexterJie
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dexterjie.github.io/2024/10/31/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%BD%91%E9%BC%8E%E6%9D%AF%20and%20%E5%BC%BA%E7%BD%91%E6%9D%AF/" title="2024网鼎杯and强网杯">https://dexterjie.github.io/2024/10/31/赛题复现/网鼎杯 and 强网杯/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Wp/" rel="tag"># Wp</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/09/17/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024WMCTF/" rel="prev" title="2024WMCTF">
                  <i class="fa fa-chevron-left"></i> 2024WMCTF
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DexterJie</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">284k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">17:13</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->


    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
<div class="busuanzi-count">
  <script async src="/js/busuanzi.pure.mini.js"></script>
  
  <span class="site-uv" title="总访客量">
    访客量<span id="busuanzi_value_site_uv"></span>
  </span>

  <span class="site-pv" title="总访问量">
    经过<span id="busuanzi_value_site_pv"></span>次回眸与你相遇
  </span>
</div>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"waline-five-mocha.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"locale":null,"placeholder":"请文明评论呀","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2024/10/31/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%BD%91%E9%BC%8E%E6%9D%AF%20and%20%E5%BC%BA%E7%BD%91%E6%9D%AF/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right"},"mobile":{"show":true}});</script></body>

</html>
