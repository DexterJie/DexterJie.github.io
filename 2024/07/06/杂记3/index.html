<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/0.jpg">
  <link rel="mask-icon" href="/images/0.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dexterjie.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这篇文章主要记录期末月做的一些赛题">
<meta property="og:type" content="article">
<meta property="og:title" content="杂记(三)">
<meta property="og:url" content="https://dexterjie.github.io/2024/07/06/%E6%9D%82%E8%AE%B03/index.html">
<meta property="og:site_name" content="DexterJie&#39;Blog">
<meta property="og:description" content="这篇文章主要记录期末月做的一些赛题">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-07-06T14:56:37.000Z">
<meta property="article:modified_time" content="2024-07-12T08:04:42.815Z">
<meta property="article:author" content="DexterJie">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dexterjie.github.io/2024/07/06/%E6%9D%82%E8%AE%B03/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dexterjie.github.io/2024/07/06/%E6%9D%82%E8%AE%B03/","path":"2024/07/06/杂记3/","title":"杂记(三)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>杂记(三) | DexterJie'Blog</title>
  







<link rel="dns-prefetch" href="waline-five-mocha.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DexterJie'Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Never Mind the Scandal and Liber!!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1456890009&auto=1&height=66"></iframe>
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#R3CTF"><span class="nav-number">1.</span> <span class="nav-text">R3CTF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#r0system"><span class="nav-number">1.1.</span> <span class="nav-text">r0system</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#r1system"><span class="nav-number">1.2.</span> <span class="nav-text">r1system</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CryptoCTF"><span class="nav-number">2.</span> <span class="nav-text">CryptoCTF</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%86%8A%E7%8C%AB%E6%9D%AF"><span class="nav-number">3.</span> <span class="nav-text">熊猫杯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#part1"><span class="nav-number">3.1.</span> <span class="nav-text">part1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#part2"><span class="nav-number">3.2.</span> <span class="nav-text">part2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UIUCTF"><span class="nav-number">4.</span> <span class="nav-text">UIUCTF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Determined"><span class="nav-number">4.1.</span> <span class="nav-text">Determined</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Without-a-Trace"><span class="nav-number">4.2.</span> <span class="nav-text">Without a Trace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Naptime"><span class="nav-number">4.3.</span> <span class="nav-text">Naptime</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%98%A5%E7%A7%8B%E6%9D%AF%E5%A4%8F%E5%AD%A3%E8%B5%9B"><span class="nav-number">5.</span> <span class="nav-text">春秋杯夏季赛</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ezzzecc"><span class="nav-number">5.1.</span> <span class="nav-text">ezzzecc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#signature"><span class="nav-number">5.2.</span> <span class="nav-text">signature</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E5%85%85"><span class="nav-number">5.2.1.</span> <span class="nav-text">补充</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#happy2024%E2%80%94%E2%80%94Unsolved"><span class="nav-number">5.3.</span> <span class="nav-text">happy2024——Unsolved</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#not2022but2024"><span class="nav-number">5.3.1.</span> <span class="nav-text">not2022but2024</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ctfshow%E8%A5%BF%E7%93%9C%E6%9D%AF"><span class="nav-number">6.</span> <span class="nav-text">ctfshow西瓜杯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A5%87%E6%80%AA%E7%9A%84%E6%9D%A1%E5%BD%A2%E7%A0%81"><span class="nav-number">6.1.</span> <span class="nav-text">奇怪的条形码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%AF%86%E7%A0%81"><span class="nav-number">6.2.</span> <span class="nav-text">简单密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#factor"><span class="nav-number">6.3.</span> <span class="nav-text">factor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99%E4%BD%A0d%E5%8F%88%E6%80%8E%E6%A0%B7"><span class="nav-number">6.4.</span> <span class="nav-text">给你d又怎样</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%B7%E5%90%88%E5%AF%86%E7%A0%81%E4%BD%93%E7%B3%BB"><span class="nav-number">6.5.</span> <span class="nav-text">混合密码体系</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="DexterJie"
      src="/images/0.jpg">
  <p class="site-author-name" itemprop="name">DexterJie</p>
  <div class="site-description" itemprop="description">一枚只会Crypto的菜鸡</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dexterjie.github.io/2024/07/06/%E6%9D%82%E8%AE%B03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/0.jpg">
      <meta itemprop="name" content="DexterJie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DexterJie'Blog">
      <meta itemprop="description" content="一枚只会Crypto的菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="杂记(三) | DexterJie'Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          杂记(三)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-06 22:56:37" itemprop="dateCreated datePublished" datetime="2024-07-06T22:56:37+08:00">2024-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-12 16:04:42" itemprop="dateModified" datetime="2024-07-12T16:04:42+08:00">2024-07-12</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2024/07/06/%E6%9D%82%E8%AE%B03/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2024/07/06/%E6%9D%82%E8%AE%B03/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>21 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>这篇文章主要记录期末月做的一些赛题</p>
<span id="more"></span>

<h1 id="R3CTF"><a href="#R3CTF" class="headerlink" title="R3CTF"></a>R3CTF</h1><h2 id="r0system"><a href="#r0system" class="headerlink" title="r0system"></a>r0system</h2><p>审计代码发现，可以自己注册个账号完成登录</p>
<p>登录之后，在修改密码那里居然可以改所有用户的密码</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">R0System</span>(<span class="params">USERNAME</span>): </span><br><span class="line">    <span class="keyword">global</span> login_tag,PublicChannels</span><br><span class="line">    option = <span class="built_in">int</span>(<span class="built_in">input</span>((<span class="string">b&quot;Hello &quot;</span>+ USERNAME + <span class="string">b&quot;,do you need any services? &quot;</span>).decode()))</span><br><span class="line">    <span class="keyword">if</span> option == <span class="number">1</span>:</span><br><span class="line">        username     = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">b&quot;Username[HEX]: &quot;</span>.decode())) </span><br><span class="line">        new_password = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">b&quot;New Password[HEX]: &quot;</span>.decode()))</span><br><span class="line">        tag,msg = USER.reset_password(username,new_password)</span><br><span class="line">        <span class="built_in">print</span>(msg.decode())</span><br></pre></td></tr></table></figure>

<p>那思路就是改Bob的密码，然后得到Bob的私钥，再求Alice和Bob的会话密钥完成解密</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Curve</span>: </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Nist p-256</span></span><br><span class="line">        self.p = <span class="number">0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff</span></span><br><span class="line">        self.a = <span class="number">0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc</span></span><br><span class="line">        self.b = <span class="number">0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b</span></span><br><span class="line">        self.G = (<span class="number">0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296</span>, </span><br><span class="line">                  <span class="number">0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5</span>)</span><br><span class="line">        self.n = <span class="number">0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self,P, Q</span>):</span><br><span class="line">        <span class="keyword">if</span> (P == (<span class="number">0</span>, <span class="number">0</span>)):</span><br><span class="line">            <span class="keyword">return</span> Q</span><br><span class="line">        <span class="keyword">elif</span> (Q == (<span class="number">0</span>, <span class="number">0</span>)):</span><br><span class="line">            <span class="keyword">return</span> P</span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            x1, y1 = P</span><br><span class="line">            x2, y2 = Q</span><br><span class="line">            <span class="keyword">if</span> ((x1 == x2) &amp; (y1 == -y2)):</span><br><span class="line">                <span class="keyword">return</span> ((<span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> (P != Q):</span><br><span class="line">                    l = (y2 - y1) * <span class="built_in">pow</span>(x2 - x1, -<span class="number">1</span>, self.p)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    l = (<span class="number">3</span> * (x1**<span class="number">2</span>) + self.a) * <span class="built_in">pow</span>(<span class="number">2</span> * y1, -<span class="number">1</span>, self.p)</span><br><span class="line">            x3 = ((l**<span class="number">2</span>) - x1 - x2) % self.p</span><br><span class="line">            y3 = (l * (x1 - x3) - y1) % self.p</span><br><span class="line">            <span class="keyword">return</span> x3, y3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, n , P</span>):</span><br><span class="line">        Q = P</span><br><span class="line">        R = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>):</span><br><span class="line">                R = self.add(R, Q)</span><br><span class="line">            Q = self.add(Q, Q)</span><br><span class="line">            n = n // <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> R</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes,bytes_to_long,isPrime</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">curve = Curve()</span><br><span class="line">p = <span class="number">0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff</span></span><br><span class="line">a = <span class="number">0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc</span></span><br><span class="line">b = <span class="number">0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b</span></span><br><span class="line"><span class="comment"># E = EllipticCurve(GF(p),[a,b])</span></span><br><span class="line">n = <span class="number">0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551</span></span><br><span class="line"></span><br><span class="line">G = (<span class="number">0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296</span>, <span class="number">0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5</span>)</span><br><span class="line">encflag = <span class="string">&quot;e3b70f0fc960e3cc28f5b02667e5483f6dd6cc267435d33cd222071f949da4a9fc383ad4282a28c81c8b106546b0dc5e61b0908f6d0edb07a2072a9f3b3c0a2aa4b990d1a903b33e5921336f68533b7fce5cd401816016e369e6941336dcf441&quot;</span></span><br><span class="line">tmpA = <span class="string">&quot;ce760c0651d6f4e7466173d5bebe4803af2b0aea75ebb1948785e50fd1c911f18f887c172dd64d979fc501b13c5e76418e24920671610563bb0233fc1cf1a789&quot;</span></span><br><span class="line">tmpB = <span class="string">&quot;fc7ac593d124c0f5c10ed04623c5d5e80bc4af3215956cba0dcf27d9a6a7e11b4412f38ef83403e9a844e11fbc349b05795808a38cb90b99dbb165c54aa38ba2&quot;</span></span><br><span class="line"></span><br><span class="line">Ax = <span class="built_in">bytes</span>.fromhex(tmpA)[:<span class="number">32</span>]</span><br><span class="line">Ay = <span class="built_in">bytes</span>.fromhex(tmpA)[<span class="number">32</span>:]</span><br><span class="line">Bx = <span class="built_in">bytes</span>.fromhex(tmpB)[:<span class="number">32</span>]</span><br><span class="line">By = <span class="built_in">bytes</span>.fromhex(tmpB)[<span class="number">32</span>:]</span><br><span class="line">A = (bytes_to_long(Ax),bytes_to_long(Ay))</span><br><span class="line">B = (bytes_to_long(Bx),bytes_to_long(By))</span><br><span class="line"></span><br><span class="line">b = <span class="number">0x4627ff9ebfc02af8e8b2eb2a276ac028d874de10df417221d49d838bc6a5e733</span></span><br><span class="line">KEY = md5(<span class="built_in">str</span>(curve.mul(b,A)).encode()).digest()</span><br><span class="line"></span><br><span class="line">aes = AES.new(KEY,AES.MODE_ECB)</span><br><span class="line">flag = aes.decrypt(<span class="built_in">bytes</span>.fromhex(encflag))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># R3CTF&#123;p3rm1$sions_n33d_Att3nt1%n!_NeXt_l3vE1_l1Nk_1s_https://reurl.cc/Vz7GzZ_a702ba611b24&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="r1system"><a href="#r1system" class="headerlink" title="r1system"></a>r1system</h2><p>上一题做完之后，拿到这题的附件</p>
<p>审计完代码发现，这题和上题区别在于，这题初始化只有Alice一个账号，而且我们居然能注册Bob的账号</p>
<p>注册之后和Alice交换密钥就好了</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes,bytes_to_long,isPrime</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">encflag = <span class="string">&quot;b421ed525e970681412ade94b2c9eeb5365d0cec75fed997525ce31fe8878dac9f4ea3992a5e54c27acfd81d456cc8ae27ff666c470637067e05d73cd53d2da1&quot;</span></span><br><span class="line">key = <span class="string">&quot;4b257eda7fda459a7844014378f08b8e&quot;</span></span><br><span class="line"></span><br><span class="line">aes = AES.new(<span class="built_in">bytes</span>.fromhex(key),AES.MODE_ECB)</span><br><span class="line">flag = aes.decrypt(<span class="built_in">bytes</span>.fromhex(encflag))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># R3CTF&#123;pRN9_I1k3_qc9_1S_3Z_To_50IVe_38e5d6dd3eaa&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="CryptoCTF"><a href="#CryptoCTF" class="headerlink" title="CryptoCTF"></a>CryptoCTF</h1><p>另外一篇博客</p>
<h1 id="熊猫杯"><a href="#熊猫杯" class="headerlink" title="熊猫杯"></a>熊猫杯</h1><blockquote>
<p>client.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Oblivious_Transfer</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,host,port</span>):</span><br><span class="line">        self.client = socket(AF_INET,SOCK_STREAM)</span><br><span class="line">        self.client.connect((host,port))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv_para1</span>(<span class="params">self</span>):</span><br><span class="line">        self.client.send(<span class="string">b&quot;Give me RSA public key&quot;</span>)</span><br><span class="line">        self.n1, self.e1 = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self.client.recv(<span class="number">2048</span>).decode().split(<span class="string">&#x27;\n&#x27;</span>)]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;n1 = <span class="subst">&#123;self.n1&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;e1 = <span class="subst">&#123;self.e1&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv_para2</span>(<span class="params">self</span>):</span><br><span class="line">        self.client.send(<span class="string">b&quot;Give me RSA public key&quot;</span>)</span><br><span class="line">        self.n2, self.e2 = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self.client.recv(<span class="number">2048</span>).decode().split(<span class="string">&#x27;\n&#x27;</span>)]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;n2 = <span class="subst">&#123;self.n2&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;e2 = <span class="subst">&#123;self.e2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transfer1</span>(<span class="params">self</span>):</span><br><span class="line">        self.client.send(<span class="string">b&quot;Give me x&quot;</span>)</span><br><span class="line">        self.x1 = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self.client.recv(<span class="number">2048</span>).decode().split(<span class="string">&#x27;\n&#x27;</span>)]</span><br><span class="line">        <span class="comment">#self.b = randint(0, 1)</span></span><br><span class="line">        self.k1 = randint(<span class="number">1</span>, self.n1)</span><br><span class="line">        <span class="comment">#v = (pow(self.k1, self.e1, self.n1) + self.x1[self.b]) % self.n1</span></span><br><span class="line">        <span class="comment">#self.client.send(str(v).encode())</span></span><br><span class="line">        self.client.send(<span class="built_in">str</span>(self.k1).encode())</span><br><span class="line">        self.m1 = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self.client.recv(<span class="number">2048</span>).decode().split(<span class="string">&#x27;\n&#x27;</span>)]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;x1 = <span class="subst">&#123;self.x1&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;m1 = <span class="subst">&#123;self.m1&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transfer2</span>(<span class="params">self</span>):</span><br><span class="line">        self.client.send(<span class="string">b&quot;Give me x&quot;</span>)</span><br><span class="line">        self.x2 = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self.client.recv(<span class="number">2048</span>).decode().split(<span class="string">&#x27;\n&#x27;</span>)]</span><br><span class="line">        <span class="comment">#self.b = randint(0, 2)</span></span><br><span class="line">        self.k2 = randint(<span class="number">1</span>, self.n2)</span><br><span class="line">        <span class="comment">#v = (pow(self.k2, self.e2, self.n2) + self.x2[self.b]) % self.n2</span></span><br><span class="line">        <span class="comment">#self.client.send(str(v).encode())</span></span><br><span class="line">        self.client.send(<span class="built_in">str</span>(self.k2).encode())</span><br><span class="line">        self.m2 = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self.client.recv(<span class="number">2048</span>).decode().split(<span class="string">&#x27;\n&#x27;</span>)]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;x2 = <span class="subst">&#123;self.x2&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;m2 = <span class="subst">&#123;self.m2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        self.client.close()</span><br><span class="line"></span><br><span class="line">OT = Oblivious_Transfer(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">3333</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    OT.recv_para1()</span><br><span class="line">    OT.transfer1()</span><br><span class="line"></span><br><span class="line">    OT.recv_para2()</span><br><span class="line">    OT.transfer2()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    OT.close()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n1 = 11271769636481167201792947869036553992227573210518633030219178803383349111691460202925344961485630519396298556298353185729133425424986251013234507574460564567554706523170816213012134101324728485027759939177868268886490620475377111559309854971172536072912492915397424686135393068344370029572892256194814415101890916563130328570803042252136741183269883671849873603956230726294410435185435014274882048506167456427852608126478349488290872256072029149848433197043410728314084380999316723835302043375017580973032065204288589969252813061043853493941665391349852606781487173854475699462142399025313772992266906492948457481343</span></span><br><span class="line"><span class="string">e1 = 3</span></span><br><span class="line"><span class="string">x1 = [9515572144467353102693379312418710955214891592376652277288115734279056734333735433842688458064791727513305863861235023479729328042101083071837571497065148511710639753106684253478831875505030519724899081680516833763198547371577091213443181418357026416055217075672599840276222008249647801652670192401687584389238718466389175705227396073077728212161850918020236614953688339567726286493333833192267092340593829218909756169268170625006694216875605112065267454732423903631737275763224769800017009573049312062340144144829220945642953262132895898315831950065807615456546917913668105293794016444579372988387899070119905188852, 1892034120103884655057748481218744968570886603116770464293986717297275954889143292301699430583870055377213531296557183365836328935582605537911332825510113738818872104690943672685087209698335996263632901023795785958711815234874952640699783061740546868363055353091127902362863942669248423826595254894726944833887263833323809149528895833061490548685459108186763244472560195193139974039077951072951624681272257192017679341819986081273918682657482308353776379587845617737285532310255049963865808295659252810449272607145518278622472711380742500844288926728181235765064078778435360592122889548497811844849141090787687431691]</span></span><br><span class="line"><span class="string">m1 = [6016241168918008003676308976207100363787886056310414524692817266526816044605861589333265680725516797725157476881964627121341856194031952078224223712707203444145810288009516867166444302906259425595314875099543375758202468607877956110531218864874778701312073626804583736300557519077867674205675297659120854857631861820501341218694648899186245660067972817620811237063040820817563464199716096063261214384822141532599155146824331413684812783001628935032487957306346174008702256595545954862755182240217576044236510482955069793116079796093428542806091985359518377611477601123779397291583947727903087310885258578166713562127, 5440147501940638137024850606017297210337534677408842136379920848781712980462447118877171733606863014259702536891618925774163741294802932568915293766589177284295703266970860357526016987325665154313719066965567249222221131682926705272951530070261409867083615183965724021333853123572753014882129436586571389423155293377948368049140838120533008304139511510566634163176216591511566937364023875888461854372432939610104040445984493844672803393249479769170488441311099318570005369329133726459281759202562040178972797271360551614266347925035798206639977703364862505440147494902280456168540628714355582075950777307761924432387]</span></span><br><span class="line"><span class="string">n2 = 13734553138242318628382054742480981343446984988191688662254986243627157625179176065241156011696302206618179554684039418464583144145503176708791330560172722535768542184698066880611009153616062090684034664602606266851696293869899452519578725665110985148196543998607394795861120331954638386927099371326884429866634685812799207305104476545524154915042406729289612658166510017492482175075872284724725422863660604254919264739710275468027278899773185461791413509280443599747367129337405961244474327733607586747648790915994322826728272773783653766560606552040854271186948727715576352830926898026093434984246855183310757045761</span></span><br><span class="line"><span class="string">e2 = 97</span></span><br><span class="line"><span class="string">x2 = [13177195145643985162369622498401365177499138154538273683105144116544719466309962486453254331776465984111024384000978936709809981151700299715082451736814113126287335911167543580326081550513657585920705158990979388476560541554360224739435428369017964910714020825020400206978492083575209281469099197416561057829071411270433371623496230236473419547584375357556353533487865301248950946032111351087126169856720042454654832226420081909659506864195491980123873801598391036249027256808516343923925600130215162930220263798094559698140483803320057081107578634042891033997459769087238265628113428210401614417877839230901721993190, 6087668416419425621015217192937881819030086776814461931461321271071632965704332777171900656493718038405650018773284906392054768417180630397123329675678721202895156479498192567976488835849134098984496538043518882047967632186092698690848611693438041802874429890978003588117644629011459601875026269618173841010295947617126507755463408314735056141532883079433786701501106150571651039383128288126543960497006195953471865106598447153220760899089004772873548377773392286170683824466138705674297182685522941020265251198373775479428578340308681511331066572161101438312245374528237712280314548370382811282427949209246902963620]</span></span><br><span class="line"><span class="string">m2 = [11290088192896104506026832060270527943714366880404242912266063784753126354203886059118599709669598729492075209588587167909865752372998401224088902550832115846922950445881033989219174580290127597931540821558287876108098891608071532321402919702498057050600028620041146727752759548708970938132742356572135342729734097482396575542041618189798845322991442136889598236510334924501541556553680371235401907549785446331539870340463389985682807901483008146184213709636864164058105540385607059315722869586747109233390594619151596441257862747687967610987191500891685999700118692739878206205390683771336361205725982750841624412918, 13297923293604079904865691526854689771243166342933215235463378384491550135554561777664960232137603383114093048818781509117309259419714741409995439792770006827393488190799203124259891829424051546917028377316926517036925667257317044743094940629506839160375855343993956627134396913916798323848609907197075057202723651440732344941034655107043117917579554777531225809712600877171322938484588653102197119270286456014097076345973054360242768465566465700893203405936053400775455573738231554838583225080952941328332237618198730448032110880353626965942852413612822837453591096974975301303294918593974328897924663396162439300901]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>server.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert, gcd</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">length = <span class="built_in">len</span>(flag)</span><br><span class="line">flag1 = flag[:length//<span class="number">2</span>]</span><br><span class="line">flag2 = flag[length//<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Oblivious_Transfer</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,host,port</span>):</span><br><span class="line">        self.server = socket(AF_INET,SOCK_STREAM)</span><br><span class="line">        self.server.bind((host,port))</span><br><span class="line">        self.server.listen(<span class="number">5</span>)</span><br><span class="line">        self.connection, self.addr = self.server.accept()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">keygen1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            p = getPrime(<span class="number">1024</span>)</span><br><span class="line">            q = getPrime(<span class="number">1024</span>)</span><br><span class="line">            e = <span class="number">3</span></span><br><span class="line">            n = p * q</span><br><span class="line">            phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> gcd(e, phi) == <span class="number">1</span>:</span><br><span class="line">                d = invert(e, phi)</span><br><span class="line">                self.n1 = n</span><br><span class="line">                self.e1 = e</span><br><span class="line">                self.d1 = d</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">keygen2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            p = getPrime(<span class="number">1024</span>)</span><br><span class="line">            q = getPrime(<span class="number">1024</span>)</span><br><span class="line">            e = <span class="number">97</span></span><br><span class="line">            n = p * q</span><br><span class="line">            phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> gcd(e, phi) == <span class="number">1</span>:</span><br><span class="line">                d = invert(e, phi)</span><br><span class="line">                self.n2 = n</span><br><span class="line">                self.e2 = e</span><br><span class="line">                self.d2 = d</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gen_msg1</span>(<span class="params">self</span>):</span><br><span class="line">        self.msg1 = [bytes_to_long(flag1), bytes_to_long(os.urandom(length//<span class="number">2</span>))]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gen_msg2</span>(<span class="params">self</span>):</span><br><span class="line">        self.c = [randint(<span class="number">1</span>, self.n2) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">        self.msg2 = [bytes_to_long(pad(flag2, <span class="number">256</span>)), self.c[<span class="number">0</span>] * bytes_to_long(pad(flag2, <span class="number">256</span>)) + self.c[<span class="number">1</span>], bytes_to_long(os.urandom(length//<span class="number">2</span>))]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;self.c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_para1</span>(<span class="params">self</span>):</span><br><span class="line">        self.connection.recv(<span class="number">2048</span>)</span><br><span class="line">        self.connection.send(<span class="built_in">str</span>(self.n1).encode() + <span class="string">b&#x27;\n&#x27;</span> + <span class="built_in">str</span>(self.e1).encode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_para2</span>(<span class="params">self</span>):</span><br><span class="line">        self.connection.recv(<span class="number">2048</span>)</span><br><span class="line">        self.connection.send(<span class="built_in">str</span>(self.n2).encode() + <span class="string">b&#x27;\n&#x27;</span> + <span class="built_in">str</span>(self.e2).encode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transfer1</span>(<span class="params">self</span>):</span><br><span class="line">        self.connection.recv(<span class="number">2048</span>)</span><br><span class="line">        self.x1 = [randint(<span class="number">1</span>, self.n1) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">        self.connection.send(<span class="built_in">str</span>(self.x1[<span class="number">0</span>]).encode() + <span class="string">b&#x27;\n&#x27;</span> + <span class="built_in">str</span>(self.x1[<span class="number">1</span>]).encode())</span><br><span class="line">        v1 = <span class="built_in">int</span>(self.connection.recv(<span class="number">2048</span>).decode())</span><br><span class="line">        self.m1 = [(<span class="built_in">pow</span>(v1-self.x1[i], self.d1, self.n1) + self.msg1[i]) % self.n1 <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">        self.connection.send(<span class="built_in">str</span>(self.m1[<span class="number">0</span>]).encode() + <span class="string">b&#x27;\n&#x27;</span> + <span class="built_in">str</span>(self.m1[<span class="number">1</span>]).encode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transfer2</span>(<span class="params">self</span>):</span><br><span class="line">        self.connection.recv(<span class="number">2048</span>)</span><br><span class="line">        self.x2 = [randint(<span class="number">1</span>, self.n2) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">        self.connection.send(<span class="built_in">str</span>(self.x2[<span class="number">0</span>]).encode() + <span class="string">b&#x27;\n&#x27;</span> + <span class="built_in">str</span>(self.x2[<span class="number">1</span>]).encode())</span><br><span class="line">        v2 = <span class="built_in">int</span>(self.connection.recv(<span class="number">2048</span>).decode())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;v2 = <span class="subst">&#123;v2&#125;</span>&quot;</span>)</span><br><span class="line">        self.m2 = [(<span class="built_in">pow</span>(v2-self.x2[i], self.d2, self.n2) + self.msg2[i]) % self.n2 <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">        self.connection.send(<span class="built_in">str</span>(self.m2[<span class="number">0</span>]).encode() + <span class="string">b&#x27;\n&#x27;</span> + <span class="built_in">str</span>(self.m2[<span class="number">1</span>]).encode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        self.server.close()</span><br><span class="line"></span><br><span class="line">OT = Oblivious_Transfer(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">3333</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    OT.keygen1()</span><br><span class="line">    OT.gen_msg1()</span><br><span class="line">    OT.send_para1()</span><br><span class="line">    OT.transfer1()</span><br><span class="line"></span><br><span class="line">    OT.keygen2()</span><br><span class="line">    OT.gen_msg2()</span><br><span class="line">    OT.send_para2()</span><br><span class="line">    OT.transfer2()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    OT.close()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c = [2022192084163865871637311910190343009806372281260940433264866710576717827000158190013454140869282023553794168299850642713592857046603901804667940047118351375526819434245929363285575321841139031828203969945166801239181091856967945653548638281912992865859782543006093627628764190870048182733564610346559175554351590756572067638680287831888951790549721647896128434643949839982021154615115260457999786151004733151130820602433196485192091297036565179140159868992152310647228915941684271200707824836388347153359567736106504118830380335535571497974547855922884383469780130087191722420344937756494122346487016566419242463836, 12061552506303089886042745624408653176981782225020423963019198845243742139258023869466665561793608045001319021047887667664174994585869340313951796548176269089114160706384746387983277073112591591489643976442622321188641202129622786824693293150098394659731881683945896467114040450861544761586718952331369001004695294268894235852363740831011251046468659589566501557902013744612394168830044111638387497950139803719642714677584615407052702028855832555056064595619857064644590245323361565888668910950428292688990851782269368022834514035734196544300120061524133712573144079293439936276463509498262847888571155492592609260783]</span></span><br><span class="line"><span class="string">v2 = 9556276713294185634675025767802869929252472183681399946558259127635089951399817649411122499036657904914953334191629273438214371861747375930220930123236040473592720606113932507502872050616210539047321307830911690987874269273684519795136175561107095807358688729096068293698083610276557300656827563421114987688852668095314933405088107467416611145574761738655696672560862813137945205091832198111391817949039251665825121659323773270436391580589841573178391221735428798318886660824941824216932260996644044749424023313841093829840154123672637916095508058599701154434489213872161152359221137791753598589303710126033417598315</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="part1"><a href="#part1" class="headerlink" title="part1"></a>part1</h2><p>由题意得<br>$$<br>m_{11} \equiv (v_1 - x_{11})^{d_1} + msg_0 \mod n_1<br>$$</p>
<p>$$<br>m_{12} \equiv (v_1 - x_{12})^{d_1} + msg_1 \mod n_1<br>$$</p>
<p>简单化简可以得到<br>$$<br>(m_{11}-msg_0)^3 \equiv v_1 - x_{11} \mod n_1<br>$$</p>
<p>$$<br>(m_{12}-msg_1)^3 \equiv v_1 - x_{12} \mod n_1<br>$$</p>
<p>展开<br>$$<br>m_{11}^{3} - 3m_{11}^2msg_0 + 3m_{11}msg_0^2 - msg_0^3 \equiv v_1 - x_{11} \mod n_1<br>$$</p>
<p>$$<br>m_{12}^{3} - 3m_{12}^2msg_1 + 3m_{12}msg_1^2 - msg_1^3 \equiv v_1 - x_{12} \mod n_1<br>$$</p>
<p>两个式子相减得到<br>$$<br>(m_{11} - m_{12})^3 - 3(m_{11}^2msg_0 -m_{12}^2msg_1) + 3(m_{11}msg_0^2-m_{12}msg_1^2) \equiv (x_{12}-x_{11}) \mod n_1<br>$$<br>不展开也行(</p>
<p><code>msg0</code>和<code>msg1</code>都是168bit，用二元copper即可</p>
<h2 id="part2"><a href="#part2" class="headerlink" title="part2"></a>part2</h2><p>由题意得</p>
<p>$$<br>m_{21} \equiv (v_2 - x_{21})^{d_2} + msg_2 \mod n_2\<br>m_{22} \equiv (v_2 - x_{22})^{d_2} + (c_{0}\times msg_2 + c_1) \mod n_2<br>$$</p>
<p>简单化简得<br>$$<br>m_{21} - msg \equiv (v_2 - x_{21})^{d_2} \mod n_2<br>$$</p>
<p>$$<br>m_{22} - (c_0\times msg + c_1) \equiv (v_2 - x_{22})^{d_2} \mod n_2<br>$$</p>
<p>两边乘方得到<br>$$<br>(m_{21} - msg)^{e_2} \equiv (v_2 - x_{21}) \mod n_2\<br>$$</p>
<p>$$<br>(m_{22} - (c_0\times msg + c_1))^{e_2} \equiv (v_2 - x_{22}) \mod n_2<br>$$</p>
<p>然后相关消息攻击即可</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">c = [<span class="number">2022192084163865871637311910190343009806372281260940433264866710576717827000158190013454140869282023553794168299850642713592857046603901804667940047118351375526819434245929363285575321841139031828203969945166801239181091856967945653548638281912992865859782543006093627628764190870048182733564610346559175554351590756572067638680287831888951790549721647896128434643949839982021154615115260457999786151004733151130820602433196485192091297036565179140159868992152310647228915941684271200707824836388347153359567736106504118830380335535571497974547855922884383469780130087191722420344937756494122346487016566419242463836</span>, <span class="number">12061552506303089886042745624408653176981782225020423963019198845243742139258023869466665561793608045001319021047887667664174994585869340313951796548176269089114160706384746387983277073112591591489643976442622321188641202129622786824693293150098394659731881683945896467114040450861544761586718952331369001004695294268894235852363740831011251046468659589566501557902013744612394168830044111638387497950139803719642714677584615407052702028855832555056064595619857064644590245323361565888668910950428292688990851782269368022834514035734196544300120061524133712573144079293439936276463509498262847888571155492592609260783</span>]</span><br><span class="line">v2 = <span class="number">9556276713294185634675025767802869929252472183681399946558259127635089951399817649411122499036657904914953334191629273438214371861747375930220930123236040473592720606113932507502872050616210539047321307830911690987874269273684519795136175561107095807358688729096068293698083610276557300656827563421114987688852668095314933405088107467416611145574761738655696672560862813137945205091832198111391817949039251665825121659323773270436391580589841573178391221735428798318886660824941824216932260996644044749424023313841093829840154123672637916095508058599701154434489213872161152359221137791753598589303710126033417598315</span></span><br><span class="line">n1 = <span class="number">11271769636481167201792947869036553992227573210518633030219178803383349111691460202925344961485630519396298556298353185729133425424986251013234507574460564567554706523170816213012134101324728485027759939177868268886490620475377111559309854971172536072912492915397424686135393068344370029572892256194814415101890916563130328570803042252136741183269883671849873603956230726294410435185435014274882048506167456427852608126478349488290872256072029149848433197043410728314084380999316723835302043375017580973032065204288589969252813061043853493941665391349852606781487173854475699462142399025313772992266906492948457481343</span></span><br><span class="line">e1 = <span class="number">3</span></span><br><span class="line">x1 = [<span class="number">9515572144467353102693379312418710955214891592376652277288115734279056734333735433842688458064791727513305863861235023479729328042101083071837571497065148511710639753106684253478831875505030519724899081680516833763198547371577091213443181418357026416055217075672599840276222008249647801652670192401687584389238718466389175705227396073077728212161850918020236614953688339567726286493333833192267092340593829218909756169268170625006694216875605112065267454732423903631737275763224769800017009573049312062340144144829220945642953262132895898315831950065807615456546917913668105293794016444579372988387899070119905188852</span>, <span class="number">1892034120103884655057748481218744968570886603116770464293986717297275954889143292301699430583870055377213531296557183365836328935582605537911332825510113738818872104690943672685087209698335996263632901023795785958711815234874952640699783061740546868363055353091127902362863942669248423826595254894726944833887263833323809149528895833061490548685459108186763244472560195193139974039077951072951624681272257192017679341819986081273918682657482308353776379587845617737285532310255049963865808295659252810449272607145518278622472711380742500844288926728181235765064078778435360592122889548497811844849141090787687431691</span>]</span><br><span class="line">m1 = [<span class="number">6016241168918008003676308976207100363787886056310414524692817266526816044605861589333265680725516797725157476881964627121341856194031952078224223712707203444145810288009516867166444302906259425595314875099543375758202468607877956110531218864874778701312073626804583736300557519077867674205675297659120854857631861820501341218694648899186245660067972817620811237063040820817563464199716096063261214384822141532599155146824331413684812783001628935032487957306346174008702256595545954862755182240217576044236510482955069793116079796093428542806091985359518377611477601123779397291583947727903087310885258578166713562127</span>, <span class="number">5440147501940638137024850606017297210337534677408842136379920848781712980462447118877171733606863014259702536891618925774163741294802932568915293766589177284295703266970860357526016987325665154313719066965567249222221131682926705272951530070261409867083615183965724021333853123572753014882129436586571389423155293377948368049140838120533008304139511510566634163176216591511566937364023875888461854372432939610104040445984493844672803393249479769170488441311099318570005369329133726459281759202562040178972797271360551614266347925035798206639977703364862505440147494902280456168540628714355582075950777307761924432387</span>]</span><br><span class="line">n2 = <span class="number">13734553138242318628382054742480981343446984988191688662254986243627157625179176065241156011696302206618179554684039418464583144145503176708791330560172722535768542184698066880611009153616062090684034664602606266851696293869899452519578725665110985148196543998607394795861120331954638386927099371326884429866634685812799207305104476545524154915042406729289612658166510017492482175075872284724725422863660604254919264739710275468027278899773185461791413509280443599747367129337405961244474327733607586747648790915994322826728272773783653766560606552040854271186948727715576352830926898026093434984246855183310757045761</span></span><br><span class="line">e2 = <span class="number">97</span></span><br><span class="line">x2 = [<span class="number">13177195145643985162369622498401365177499138154538273683105144116544719466309962486453254331776465984111024384000978936709809981151700299715082451736814113126287335911167543580326081550513657585920705158990979388476560541554360224739435428369017964910714020825020400206978492083575209281469099197416561057829071411270433371623496230236473419547584375357556353533487865301248950946032111351087126169856720042454654832226420081909659506864195491980123873801598391036249027256808516343923925600130215162930220263798094559698140483803320057081107578634042891033997459769087238265628113428210401614417877839230901721993190</span>, <span class="number">6087668416419425621015217192937881819030086776814461931461321271071632965704332777171900656493718038405650018773284906392054768417180630397123329675678721202895156479498192567976488835849134098984496538043518882047967632186092698690848611693438041802874429890978003588117644629011459601875026269618173841010295947617126507755463408314735056141532883079433786701501106150571651039383128288126543960497006195953471865106598447153220760899089004772873548377773392286170683824466138705674297182685522941020265251198373775479428578340308681511331066572161101438312245374528237712280314548370382811282427949209246902963620</span>]</span><br><span class="line">m2 = [<span class="number">11290088192896104506026832060270527943714366880404242912266063784753126354203886059118599709669598729492075209588587167909865752372998401224088902550832115846922950445881033989219174580290127597931540821558287876108098891608071532321402919702498057050600028620041146727752759548708970938132742356572135342729734097482396575542041618189798845322991442136889598236510334924501541556553680371235401907549785446331539870340463389985682807901483008146184213709636864164058105540385607059315722869586747109233390594619151596441257862747687967610987191500891685999700118692739878206205390683771336361205725982750841624412918</span>, <span class="number">13297923293604079904865691526854689771243166342933215235463378384491550135554561777664960232137603383114093048818781509117309259419714741409995439792770006827393488190799203124259891829424051546917028377316926517036925667257317044743094940629506839160375855343993956627134396913916798323848609907197075057202723651440732344941034655107043117917579554777531225809712600877171322938484588653102197119270286456014097076345973054360242768465566465700893203405936053400775455573738231554838583225080952941328332237618198730448032110880353626965942852413612822837453591096974975301303294918593974328897924663396162439300901</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n</span>):</span><br><span class="line">    PR.&lt;m&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = (m2[<span class="number">0</span>] - m)^<span class="number">97</span> - (v2 - x2[<span class="number">0</span>])</span><br><span class="line">    g2 = (m2[<span class="number">1</span>] - (c[<span class="number">0</span>]*m + c[<span class="number">1</span>]))^<span class="number">97</span> - (v2 - x2[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">R.&lt;M0,M1&gt; = PolynomialRing(Zmod(n1))</span><br><span class="line">f = (m1[<span class="number">0</span>] - M0)^<span class="number">3</span> - (m1[<span class="number">1</span>] - M1)^<span class="number">3</span> + x1[<span class="number">0</span>] - x1[<span class="number">1</span>]</span><br><span class="line">res = small_roots(f,(<span class="number">2</span>^<span class="number">167</span>,<span class="number">2</span>^<span class="number">167</span>),m=<span class="number">2</span>,d=<span class="number">4</span>)</span><br><span class="line">msg1,_ = res[<span class="number">0</span>]</span><br><span class="line">flag1 = long_to_bytes(<span class="built_in">int</span>(msg1))</span><br><span class="line">msg2 = franklinReiter(n2)</span><br><span class="line">flag2 = long_to_bytes(<span class="built_in">int</span>(msg2))</span><br><span class="line"><span class="built_in">print</span>(flag1 + flag2)</span><br><span class="line"><span class="comment"># flag&#123;fcdb818c-0db0-348f-4145-87d8051cc3c5&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="UIUCTF"><a href="#UIUCTF" class="headerlink" title="UIUCTF"></a>UIUCTF</h1><h2 id="Determined"><a href="#Determined" class="headerlink" title="Determined"></a>Determined</h2><blockquote>
<p>server.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"><span class="keyword">from</span> SECRET <span class="keyword">import</span> FLAG, p, q, r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inputs</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[DET] First things first, gimme some numbers:&quot;</span>)</span><br><span class="line">    M = [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        M[<span class="number">0</span>][<span class="number">0</span>] = p</span><br><span class="line">        M[<span class="number">0</span>][<span class="number">2</span>] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[DET] M[0][2] = &quot;</span>))</span><br><span class="line">        M[<span class="number">0</span>][<span class="number">4</span>] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[DET] M[0][4] = &quot;</span>))</span><br><span class="line"></span><br><span class="line">        M[<span class="number">1</span>][<span class="number">1</span>] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[DET] M[1][1] = &quot;</span>))</span><br><span class="line">        M[<span class="number">1</span>][<span class="number">3</span>] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[DET] M[1][3] = &quot;</span>))</span><br><span class="line"></span><br><span class="line">        M[<span class="number">2</span>][<span class="number">0</span>] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[DET] M[2][0] = &quot;</span>))</span><br><span class="line">        M[<span class="number">2</span>][<span class="number">2</span>] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[DET] M[2][2] = &quot;</span>))</span><br><span class="line">        M[<span class="number">2</span>][<span class="number">4</span>] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[DET] M[2][4] = &quot;</span>))</span><br><span class="line"></span><br><span class="line">        M[<span class="number">3</span>][<span class="number">1</span>] = q</span><br><span class="line">        M[<span class="number">3</span>][<span class="number">3</span>] = r</span><br><span class="line"></span><br><span class="line">        M[<span class="number">4</span>][<span class="number">0</span>] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[DET] M[4][0] = &quot;</span>))</span><br><span class="line">        M[<span class="number">4</span>][<span class="number">2</span>] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[DET] M[4][2] = &quot;</span>))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">signum, frame</span>):</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;[DET] You&#x27;re trying too hard, try something simpler&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">M</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">sigma</span>):</span><br><span class="line">        l = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">                <span class="keyword">if</span> sigma[i] &gt; sigma[j]:</span><br><span class="line">                    l += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> (-<span class="number">1</span>)**l</span><br><span class="line"></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> sigma <span class="keyword">in</span> permutations([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]):</span><br><span class="line">        curr = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            curr *= M[sigma[i]][i]</span><br><span class="line">        res += sign(sigma) * curr</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[DET] Welcome&quot;</span>)</span><br><span class="line">    M = inputs()</span><br><span class="line">    <span class="keyword">if</span> M <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[DET] You tried something weird...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    res = fun(M)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[DET] Have fun: <span class="subst">&#123;res&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>gen.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> SECRET <span class="keyword">import</span> FLAG, p, q, r</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65535</span></span><br><span class="line">m = bytes_to_long(FLAG)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="comment"># printed to gen.txt</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n = 158794636700752922781275926476194117856757725604680390949164778150869764326023702391967976086363365534718230514141547968577753309521188288428236024251993839560087229636799779157903650823700424848036276986652311165197569877428810358366358203174595667453056843209344115949077094799081260298678936223331932826351</span></span><br><span class="line"><span class="string">e = 65535</span></span><br><span class="line"><span class="string">c = 72186625991702159773441286864850566837138114624570350089877959520356759693054091827950124758916323653021925443200239303328819702117245200182521971965172749321771266746783797202515535351816124885833031875091162736190721470393029924557370228547165074694258453101355875242872797209141366404264775972151904835111</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>主要思路是利用server分解n</p>
<p>首先有个固定了部分值的矩阵M，?是我们要输入的值<br>$$<br>M &#x3D;<br>\begin{pmatrix}<br>p &amp; 0 &amp; ? &amp; 0 &amp; ?\\<br>0 &amp; ? &amp; 0 &amp; ? &amp; 0\\<br>? &amp; 0 &amp; ? &amp; 0 &amp; ?\\<br>0 &amp; q &amp; 0 &amp; r &amp; 0\\<br>?&amp;0&amp;?&amp;0&amp;0<br>\end{pmatrix}<br>$$<br>第一反应是全填1，此时M如下<br>$$<br>M &#x3D;<br>\begin{pmatrix}<br>p &amp; 0 &amp; 1 &amp; 0 &amp; 1\\<br>0 &amp; 1 &amp; 0 &amp; 1 &amp; 0\\<br>1 &amp; 0 &amp; 1 &amp; 0 &amp; 1\\<br>0 &amp; q &amp; 0 &amp; r &amp; 0\\<br>1 &amp; 0 &amp; 1 &amp; 0 &amp; 0<br>\end{pmatrix}<br>$$<br>但这个时候会发现curr一定是0，但我们可以找出curr不为0的排列有</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="number">4</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>对于每个排列来看，得到的sign()值分别为</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-<span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">-<span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">-<span class="number">1</span></span><br><span class="line">-<span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>得到的curr如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pr</span><br><span class="line">pq</span><br><span class="line">r</span><br><span class="line">q</span><br><span class="line">r</span><br><span class="line">r</span><br><span class="line">q</span><br><span class="line">q</span><br></pre></td></tr></table></figure>

<p>那么得到的res就是<br>$$<br>-pr + pq +r-q+r-r-q+q<br>$$<br>即<br>$$<br>pq-pr-q+r<br>$$<br>这对我们分解n没什么关系，所以，我们的目的就是输入什么样的值，能够让res仅仅与p,q有关</p>
<p>经过测试发现</p>
<p>输入<code>1,1,0,1,1,1,1,1,1</code>，此时M如下<br>$$<br>M &#x3D;<br>\begin{pmatrix}<br>p &amp; 0 &amp; 1 &amp; 0 &amp; 1\\<br>0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\\<br>1 &amp; 0 &amp; 1 &amp; 0 &amp; 1\\<br>0 &amp; q &amp; 0 &amp; r &amp; 0\\<br>1 &amp; 0 &amp; 1 &amp; 0 &amp; 0<br>\end{pmatrix}<br>$$<br>此时输出的$res &#x3D; pq-q$</p>
<p>利用这个来求q，即完成了n的分解</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">res = <span class="number">158794636700752922781275926476194117856757725604680390949164778150869764326023702391967976086363365534718230514141547968577753309521188288428236024251993827021237309488607099396251558718631178638562077858262514078537543492352337967199580389883367433729078970596973723167029400868564841912135610784434189991222</span></span><br><span class="line">n = <span class="number">158794636700752922781275926476194117856757725604680390949164778150869764326023702391967976086363365534718230514141547968577753309521188288428236024251993839560087229636799779157903650823700424848036276986652311165197569877428810358366358203174595667453056843209344115949077094799081260298678936223331932826351</span></span><br><span class="line">e = <span class="number">65535</span></span><br><span class="line">c = <span class="number">72186625991702159773441286864850566837138114624570350089877959520356759693054091827950124758916323653021925443200239303328819702117245200182521971965172749321771266746783797202515535351816124885833031875091162736190721470393029924557370228547165074694258453101355875242872797209141366404264775972151904835111</span></span><br><span class="line"></span><br><span class="line">q = n - res</span><br><span class="line">p = n // q</span><br><span class="line">d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>

<p>回过头来可以发现其实fun就是个计算行列式的函数。</p>
<h2 id="Without-a-Trace"><a href="#Without-a-Trace" class="headerlink" title="Without a Trace"></a>Without a Trace</h2><blockquote>
<p>server.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"><span class="keyword">from</span> SECRET <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inputs</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[WAT] Define diag(u1, u2, u3. u4, u5)&quot;</span>)</span><br><span class="line">    M = [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            M[i][i] = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">f&quot;[WAT] u<span class="subst">&#123;i + <span class="number">1</span>&#125;</span> = &quot;</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">signum, frame</span>):</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;[WAT] You&#x27;re trying too hard, try something simpler&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">M</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">sigma</span>):</span><br><span class="line">        l = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">                <span class="keyword">if</span> sigma[i] &gt; sigma[j]:</span><br><span class="line">                    l += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> (-<span class="number">1</span>)**l</span><br><span class="line"></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> sigma <span class="keyword">in</span> permutations([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]):</span><br><span class="line">        curr = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            curr *= M[sigma[i]][i]</span><br><span class="line">        res += sign(sigma) * curr</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">M</span>):</span><br><span class="line">    f = [bytes_to_long(<span class="built_in">bytes</span>(FLAG[<span class="number">5</span>*i:<span class="number">5</span>*(i+<span class="number">1</span>)], <span class="string">&#x27;utf-8&#x27;</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">    F = [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        F[i][i] = f[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        R = np.matmul(F, M)</span><br><span class="line">        <span class="keyword">return</span> np.trace(R)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[WAT] You&#x27;re trying too hard, try something simpler&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[WAT] Welcome&quot;</span>)</span><br><span class="line">    M = inputs()</span><br><span class="line">    <span class="keyword">if</span> M <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[WAT] You tried something weird...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">elif</span> check(M) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[WAT] It&#x27;s not going to be that easy...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    res = fun(M)</span><br><span class="line">    <span class="keyword">if</span> res == <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[WAT] You tried something weird...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[WAT] Have fun: <span class="subst">&#123;res&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>过了check之后，服务器返回矩阵$M\times F$的迹</p>
<p>而$F$是以flag为对角元素的对角矩阵，我们只需要让$M$为单位矩阵然后传入$256^{20},256^{15},256^{10},256^5,1$，得到的值就是flag</p>
<h2 id="Naptime"><a href="#Naptime" class="headerlink" title="Naptime"></a>Naptime</h2><blockquote>
<p>task.sage</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_b</span>(<span class="params">n</span>):</span><br><span class="line">    b = []</span><br><span class="line">    b.append(randint(<span class="number">2</span>**(n-<span class="number">1</span>), <span class="number">2</span>**n))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">        lb = <span class="built_in">sum</span>(b)</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> found:</span><br><span class="line">            num = randint(<span class="built_in">max</span>(<span class="number">2</span>**(n + i), lb + <span class="number">1</span>), <span class="number">2</span>**(n + i + <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">if</span> num &gt; lb:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">                b.append(num)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_MW</span>(<span class="params">b</span>):</span><br><span class="line">    lb = <span class="built_in">sum</span>(b)</span><br><span class="line">    M = randint(lb + <span class="number">1</span>, <span class="number">2</span>*lb)</span><br><span class="line">    W = getPrime(<span class="built_in">int</span>(<span class="number">1.5</span>*<span class="built_in">len</span>(b)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> M, W</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_a</span>(<span class="params">b, M, W</span>):</span><br><span class="line">    a_ = []</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> b:</span><br><span class="line">        a_.append(num * W % M)</span><br><span class="line">    pi = np.random.permutation(<span class="built_in">list</span>(i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)))).tolist()</span><br><span class="line">    a = [a_[pi[i]] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b))]</span><br><span class="line">    <span class="keyword">return</span> a, pi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">flag, a, n</span>):</span><br><span class="line">    bitstrings = []</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="comment"># c -&gt; int -&gt; 8-bit binary string</span></span><br><span class="line">        bitstrings.append(<span class="built_in">bin</span>(<span class="built_in">ord</span>(c))[<span class="number">2</span>:].zfill(<span class="number">8</span>))</span><br><span class="line">    ct = []</span><br><span class="line">    <span class="keyword">for</span> bits <span class="keyword">in</span> bitstrings:</span><br><span class="line">        curr = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(bits):</span><br><span class="line">            <span class="keyword">if</span> b == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">                curr += a[i]</span><br><span class="line">        ct.append(curr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">ct, a, b, pi, M, W, n</span>):</span><br><span class="line">    <span class="comment"># construct inverse permuation to pi</span></span><br><span class="line">    pii = np.argsort(pi).tolist()</span><br><span class="line">    m = <span class="string">&quot;&quot;</span></span><br><span class="line">    U = <span class="built_in">pow</span>(W, -<span class="number">1</span>, M)</span><br><span class="line">    ct = [c * U % M <span class="keyword">for</span> c <span class="keyword">in</span> ct]</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> ct:</span><br><span class="line">        <span class="comment"># find b_pi(j)</span></span><br><span class="line">        diff = <span class="number">0</span></span><br><span class="line">        bits = [<span class="string">&quot;0&quot;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(n)):</span><br><span class="line">            <span class="keyword">if</span> c - diff &gt; <span class="built_in">sum</span>(b[:i]):</span><br><span class="line">                diff += b[i]</span><br><span class="line">                bits[pii[i]] = <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="comment"># convert bits to character</span></span><br><span class="line">        m += <span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join(bits), base=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag = <span class="string">&#x27;uiuctf&#123;I_DID_NOT_LEAVE_THE_FLAG_THIS_TIME&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># generate cryptosystem</span></span><br><span class="line">    n = <span class="number">8</span></span><br><span class="line">    b = get_b(n)</span><br><span class="line">    M, W = get_MW(b)</span><br><span class="line">    a, pi = get_a(b, M, W)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># encrypt</span></span><br><span class="line">    ct = enc(flag, a, n)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># public information</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;a =  &#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># decrypt</span></span><br><span class="line">    res = dec(ct, a, b, pi, M, W, n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>首先测了一下，发现直接用dec函数就可以解密，但我们缺少参数</p>
<p>各个参数并不是很大，可以用爆破的思路完成</p>
<p>我们首先求出所有12bit的素数W，再爆破M。用a求回那个被打乱的b，判断<code>sorted(b)</code>是不是一个超递增序列</p>
<p>然后再求排列pi，然后用dec解密</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange,tqdm</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_superincreasing</span>(<span class="params">sequence</span>):</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> sequence:</span><br><span class="line">        <span class="keyword">if</span> num &lt; <span class="built_in">sum</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="built_in">sum</span> += num</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">ct, a, b, pi, M, W, n</span>):</span><br><span class="line">    <span class="comment"># construct inverse permuation to pi</span></span><br><span class="line">    pii = np.argsort(pi).tolist()</span><br><span class="line">    m = <span class="string">&quot;&quot;</span></span><br><span class="line">    U = <span class="built_in">pow</span>(W, -<span class="number">1</span>, M)</span><br><span class="line">    ct = [c * U % M <span class="keyword">for</span> c <span class="keyword">in</span> ct]</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> ct:</span><br><span class="line">        <span class="comment"># find b_pi(j)</span></span><br><span class="line">        diff = <span class="number">0</span></span><br><span class="line">        bits = [<span class="string">&quot;0&quot;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(n)):</span><br><span class="line">            <span class="keyword">if</span> c - diff &gt; <span class="built_in">sum</span>(b[:i]):</span><br><span class="line">                diff += b[i]</span><br><span class="line">                bits[pii[i]] = <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="comment"># convert bits to character</span></span><br><span class="line">        m += <span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join(bits), base=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">tmp = [<span class="number">2053</span>, <span class="number">2063</span>, <span class="number">2069</span>, <span class="number">2081</span>, <span class="number">2083</span>, <span class="number">2087</span>, <span class="number">2089</span>, <span class="number">2099</span>, <span class="number">2111</span>, <span class="number">2113</span>, <span class="number">2129</span>, <span class="number">2131</span>, <span class="number">2137</span>, <span class="number">2141</span>, <span class="number">2143</span>, <span class="number">2153</span>, <span class="number">2161</span>, <span class="number">2179</span>, <span class="number">2203</span>, <span class="number">2207</span>, <span class="number">2213</span>, <span class="number">2221</span>, <span class="number">2237</span>, <span class="number">2239</span>, <span class="number">2243</span>, <span class="number">2251</span>, <span class="number">2267</span>, <span class="number">2269</span>, <span class="number">2273</span>, <span class="number">2281</span>, <span class="number">2287</span>, <span class="number">2293</span>, <span class="number">2297</span>, <span class="number">2309</span>, <span class="number">2311</span>, <span class="number">2333</span>, <span class="number">2339</span>, <span class="number">2341</span>, <span class="number">2347</span>, <span class="number">2351</span>, <span class="number">2357</span>, <span class="number">2371</span>, <span class="number">2377</span>, <span class="number">2381</span>, <span class="number">2383</span>, <span class="number">2389</span>, <span class="number">2393</span>, <span class="number">2399</span>, <span class="number">2411</span>, <span class="number">2417</span>, <span class="number">2423</span>, <span class="number">2437</span>, <span class="number">2441</span>, <span class="number">2447</span>, <span class="number">2459</span>, <span class="number">2467</span>, <span class="number">2473</span>, <span class="number">2477</span>, <span class="number">2503</span>, <span class="number">2521</span>, <span class="number">2531</span>, <span class="number">2539</span>, <span class="number">2543</span>, <span class="number">2549</span>, <span class="number">2551</span>, <span class="number">2557</span>, <span class="number">2579</span>, <span class="number">2591</span>, <span class="number">2593</span>, <span class="number">2609</span>, <span class="number">2617</span>, <span class="number">2621</span>, <span class="number">2633</span>, <span class="number">2647</span>, <span class="number">2657</span>, <span class="number">2659</span>, <span class="number">2663</span>, <span class="number">2671</span>, <span class="number">2677</span>, <span class="number">2683</span>, <span class="number">2687</span>, <span class="number">2689</span>, <span class="number">2693</span>, <span class="number">2699</span>, <span class="number">2707</span>, <span class="number">2711</span>, <span class="number">2713</span>, <span class="number">2719</span>, <span class="number">2729</span>, <span class="number">2731</span>, <span class="number">2741</span>, <span class="number">2749</span>, <span class="number">2753</span>, <span class="number">2767</span>, <span class="number">2777</span>, <span class="number">2789</span>, <span class="number">2791</span>, <span class="number">2797</span>, <span class="number">2801</span>, <span class="number">2803</span>, <span class="number">2819</span>, <span class="number">2833</span>, <span class="number">2837</span>, <span class="number">2843</span>, <span class="number">2851</span>, <span class="number">2857</span>, <span class="number">2861</span>, <span class="number">2879</span>, <span class="number">2887</span>, <span class="number">2897</span>, <span class="number">2903</span>, <span class="number">2909</span>, <span class="number">2917</span>, <span class="number">2927</span>, <span class="number">2939</span>, <span class="number">2953</span>, <span class="number">2957</span>, <span class="number">2963</span>, <span class="number">2969</span>, <span class="number">2971</span>, <span class="number">2999</span>, <span class="number">3001</span>, <span class="number">3011</span>, <span class="number">3019</span>, <span class="number">3023</span>, <span class="number">3037</span>, <span class="number">3041</span>, <span class="number">3049</span>, <span class="number">3061</span>, <span class="number">3067</span>, <span class="number">3079</span>, <span class="number">3083</span>, <span class="number">3089</span>, <span class="number">3109</span>, <span class="number">3119</span>, <span class="number">3121</span>, <span class="number">3137</span>, <span class="number">3163</span>, <span class="number">3167</span>, <span class="number">3169</span>, <span class="number">3181</span>, <span class="number">3187</span>, <span class="number">3191</span>, <span class="number">3203</span>, <span class="number">3209</span>, <span class="number">3217</span>, <span class="number">3221</span>, <span class="number">3229</span>, <span class="number">3251</span>, <span class="number">3253</span>, <span class="number">3257</span>, <span class="number">3259</span>, <span class="number">3271</span>, <span class="number">3299</span>, <span class="number">3301</span>, <span class="number">3307</span>, <span class="number">3313</span>, <span class="number">3319</span>, <span class="number">3323</span>, <span class="number">3329</span>, <span class="number">3331</span>, <span class="number">3343</span>, <span class="number">3347</span>, <span class="number">3359</span>, <span class="number">3361</span>, <span class="number">3371</span>, <span class="number">3373</span>, <span class="number">3389</span>, <span class="number">3391</span>, <span class="number">3407</span>, <span class="number">3413</span>, <span class="number">3433</span>, <span class="number">3449</span>, <span class="number">3457</span>, <span class="number">3461</span>, <span class="number">3463</span>, <span class="number">3467</span>, <span class="number">3469</span>, <span class="number">3491</span>, <span class="number">3499</span>, <span class="number">3511</span>, <span class="number">3517</span>, <span class="number">3527</span>, <span class="number">3529</span>, <span class="number">3533</span>, <span class="number">3539</span>, <span class="number">3541</span>, <span class="number">3547</span>, <span class="number">3557</span>, <span class="number">3559</span>, <span class="number">3571</span>, <span class="number">3581</span>, <span class="number">3583</span>, <span class="number">3593</span>, <span class="number">3607</span>, <span class="number">3613</span>, <span class="number">3617</span>, <span class="number">3623</span>, <span class="number">3631</span>, <span class="number">3637</span>, <span class="number">3643</span>, <span class="number">3659</span>, <span class="number">3671</span>, <span class="number">3673</span>, <span class="number">3677</span>, <span class="number">3691</span>, <span class="number">3697</span>, <span class="number">3701</span>, <span class="number">3709</span>, <span class="number">3719</span>, <span class="number">3727</span>, <span class="number">3733</span>, <span class="number">3739</span>, <span class="number">3761</span>, <span class="number">3767</span>, <span class="number">3769</span>, <span class="number">3779</span>, <span class="number">3793</span>, <span class="number">3797</span>, <span class="number">3803</span>, <span class="number">3821</span>, <span class="number">3823</span>, <span class="number">3833</span>, <span class="number">3847</span>, <span class="number">3851</span>, <span class="number">3853</span>, <span class="number">3863</span>, <span class="number">3877</span>, <span class="number">3881</span>, <span class="number">3889</span>, <span class="number">3907</span>, <span class="number">3911</span>, <span class="number">3917</span>, <span class="number">3919</span>, <span class="number">3923</span>, <span class="number">3929</span>, <span class="number">3931</span>, <span class="number">3943</span>, <span class="number">3947</span>, <span class="number">3967</span>, <span class="number">3989</span>, <span class="number">4001</span>, <span class="number">4003</span>, <span class="number">4007</span>, <span class="number">4013</span>, <span class="number">4019</span>, <span class="number">4021</span>, <span class="number">4027</span>, <span class="number">4049</span>, <span class="number">4051</span>, <span class="number">4057</span>, <span class="number">4073</span>, <span class="number">4079</span>, <span class="number">4091</span>, <span class="number">4093</span>]</span><br><span class="line">a =  [<span class="number">66128</span>, <span class="number">61158</span>, <span class="number">36912</span>, <span class="number">65196</span>, <span class="number">15611</span>, <span class="number">45292</span>, <span class="number">84119</span>, <span class="number">65338</span>]</span><br><span class="line">ct = [<span class="number">273896</span>, <span class="number">179019</span>, <span class="number">273896</span>, <span class="number">247527</span>, <span class="number">208558</span>, <span class="number">227481</span>, <span class="number">328334</span>, <span class="number">179019</span>, <span class="number">336714</span>, <span class="number">292819</span>, <span class="number">102108</span>, <span class="number">208558</span>, <span class="number">336714</span>, <span class="number">312723</span>, <span class="number">158973</span>, <span class="number">208700</span>, <span class="number">208700</span>, <span class="number">163266</span>, <span class="number">244215</span>, <span class="number">336714</span>, <span class="number">312723</span>, <span class="number">102108</span>, <span class="number">336714</span>, <span class="number">142107</span>, <span class="number">336714</span>, <span class="number">167446</span>, <span class="number">251565</span>, <span class="number">227481</span>, <span class="number">296857</span>, <span class="number">336714</span>, <span class="number">208558</span>, <span class="number">113681</span>, <span class="number">251565</span>, <span class="number">336714</span>, <span class="number">227481</span>, <span class="number">158973</span>, <span class="number">147400</span>, <span class="number">292819</span>, <span class="number">289507</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> W <span class="keyword">in</span> tqdm(tmp):</span><br><span class="line">    <span class="keyword">for</span> M <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">15</span>,<span class="number">2</span>**<span class="number">17</span>+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> gcd(M,W) == <span class="number">1</span>:</span><br><span class="line">            b = []</span><br><span class="line">            inv = inverse(W,M)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">                tmp_b = a[i] * inv % M</span><br><span class="line">                b.append(tmp_b)</span><br><span class="line">            b = <span class="built_in">sorted</span>(b)</span><br><span class="line">            <span class="keyword">if</span> is_superincreasing(b) <span class="keyword">and</span> <span class="number">128</span> &lt;= b[<span class="number">0</span>] &lt;= <span class="number">256</span>:</span><br><span class="line">                <span class="built_in">print</span>(b)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;W = <span class="subst">&#123;W&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;M = <span class="subst">&#123;M&#125;</span>&quot;</span>)</span><br><span class="line">                pi = []</span><br><span class="line">                origin_a = [num * W % M <span class="keyword">for</span> num <span class="keyword">in</span> b]      <span class="comment"># 未打乱</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">                        pi.append(origin_a.index(a[i]))</span><br><span class="line">                    <span class="built_in">print</span>(pi)</span><br><span class="line">                    flag = dec(ct, a, b, pi, M, W, <span class="number">8</span>)</span><br><span class="line">                    <span class="built_in">print</span>(flag)</span><br><span class="line">                    <span class="comment"># uiuctf&#123;i_g0t_sleepy_s0_I_13f7_th3_fl4g&#125;</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h1 id="春秋杯夏季赛"><a href="#春秋杯夏季赛" class="headerlink" title="春秋杯夏季赛"></a>春秋杯夏季赛</h1><h2 id="ezzzecc"><a href="#ezzzecc" class="headerlink" title="ezzzecc"></a>ezzzecc</h2><blockquote>
<p>cipher.txt</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">a = getPrime(<span class="number">256</span>)</span><br><span class="line">b = getPrime(<span class="number">256</span>)</span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line">m = E.random_point()</span><br><span class="line">G = E.random_point()</span><br><span class="line">k = getPrime(<span class="number">18</span>)</span><br><span class="line">K = k * G</span><br><span class="line">r = getPrime(<span class="number">256</span>)</span><br><span class="line">c1 = m + r * K</span><br><span class="line">c2 = r * G</span><br><span class="line"></span><br><span class="line">cipher_left = s2n(flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>]) * m[<span class="number">0</span>]   <span class="comment">#flag的前半部分乘m[0]，所以只要用密文的除于m[0]即可得到flag前半部分</span></span><br><span class="line">cipher_right = s2n(flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:]) * m[<span class="number">1</span>]   <span class="comment">#flag的后半部分点乘m[1]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = koZP3YQAklARRNrmYfjxoKIAXegOcG4jMOmKb08uESOkCCn72d6UM2NWgefYPEMq4EJ1M0jKaqt02Guo5Ubccjqg4QZaaHbScREx38UMLQKwG0LcDd8VFX1zkobc1ZQn4L3DhKQrgJZI55todgOdJuHN532bxScAvOF26gJyQclPtRHn3M6SHrRCEXzzmszd68PJlLB6HaabrRrCW9ZoAYSZetM5jDBtNCJLpR0CBZUUk3Oeh2MZQu2vk8DZ1QqNG49hlxGfawp1FXvAZPdMwixzkhEQnbCDcOKzYyT6BZF2Dfd940tazl7HNOswuIpLsqXQ2h56guGngMeYfMXEZV09fsB3TE0N934CLF8TbZnzFzEkOe8TPTK2mWPVSrgmbsGHnxgYWhaRQWg3yosgDfrEa5qfVl9De41PVtTw024gltovypMXK5XMhuhogs0EMN7hkLapLn6lMj</span><br><span class="line">p的格式为p=&#123;p&#125;</span><br><span class="line"></span><br><span class="line">a = <span class="number">87425770561190618633288232353256495656281438408946725202136726983601884085917</span></span><br><span class="line">b = <span class="number">107879772066707091306779801409109036008421651378615140327877558014536331974777</span></span><br><span class="line">K = (<span class="number">49293150360761418309411209621405185437426003792008480206387047056777011104939</span> : <span class="number">43598371886286324285673726736628847559547403221353820773139325027318579443479</span>)</span><br><span class="line">G = (<span class="number">34031022567935512558184471533035716554557378321289293120392294258731566673565</span> : <span class="number">74331715224220154299708533566163247663094029276428146274456519014761122295496</span>)</span><br><span class="line">私钥k小于<span class="number">1000000</span></span><br><span class="line">c1 = (<span class="number">3315847183153421424358678117707706758962521458183324187760613108746362414091</span> : <span class="number">61422809633368910312843316855658127170184420570309973276760547643460231548014</span>)</span><br><span class="line">c2 = (<span class="number">12838481482175070256758359669437500951915904121998959094172291545942862161864</span> : <span class="number">60841550842604234546787351747017749679783606696419878692095419214989669624971</span>)</span><br><span class="line">cipher_left = <span class="number">75142205156781095042041227504637709079517729950375899059488581605798510465939</span></span><br><span class="line">cipher_right = <span class="number">61560856815190247060747741878070276409743228362585436028144398174723191051815</span></span><br></pre></td></tr></table></figure>

<p>点都在曲线上，利用<br>$$<br>y \equiv x^3 + ax + b \mod p<br>$$<br>我们随意取两个点<br>$$<br>x_i^3 + ax_i +b \equiv y_i^2 \mod p<br>$$<br>进行移项<br>$$<br>k_1p &#x3D; x_1^3 + ax_1 + b - y_1^2<br>$$</p>
<p>$$<br>k_2p &#x3D; x_2^3+ax_2 +b -y_2^2<br>$$</p>
<p>然后求公因数即可得到p，得到p之后爆破私钥</p>
<p>再利用$M &#x3D; C_1-kC_2$求解</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a = <span class="number">87425770561190618633288232353256495656281438408946725202136726983601884085917</span></span><br><span class="line">b = <span class="number">107879772066707091306779801409109036008421651378615140327877558014536331974777</span></span><br><span class="line">K = (<span class="number">49293150360761418309411209621405185437426003792008480206387047056777011104939</span> , <span class="number">43598371886286324285673726736628847559547403221353820773139325027318579443479</span>)</span><br><span class="line">G = (<span class="number">34031022567935512558184471533035716554557378321289293120392294258731566673565</span> , <span class="number">74331715224220154299708533566163247663094029276428146274456519014761122295496</span>)</span><br><span class="line">c1 = (<span class="number">3315847183153421424358678117707706758962521458183324187760613108746362414091</span> , <span class="number">61422809633368910312843316855658127170184420570309973276760547643460231548014</span>)</span><br><span class="line">c2 = (<span class="number">12838481482175070256758359669437500951915904121998959094172291545942862161864</span> , <span class="number">60841550842604234546787351747017749679783606696419878692095419214989669624971</span>)</span><br><span class="line">cipher_left = <span class="number">75142205156781095042041227504637709079517729950375899059488581605798510465939</span></span><br><span class="line">cipher_right = <span class="number">61560856815190247060747741878070276409743228362585436028144398174723191051815</span></span><br><span class="line"></span><br><span class="line">k1p = (K[<span class="number">0</span>]^<span class="number">3</span> + a*K[<span class="number">0</span>] + b) - K[<span class="number">1</span>]^<span class="number">2</span></span><br><span class="line">k2p = (G[<span class="number">0</span>]^<span class="number">3</span> + a*G[<span class="number">0</span>] + b) - G[<span class="number">1</span>]^<span class="number">2</span></span><br><span class="line">p = gmpy2.gcd(k1p,k2p)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line">G = E(G)</span><br><span class="line">K = E(K)</span><br><span class="line">c1 = E(c1)</span><br><span class="line">c2 = E(c2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> trange(<span class="number">2</span>^<span class="number">17</span>,<span class="number">2</span>^<span class="number">18</span>):</span><br><span class="line">    M = c1 - c2*k</span><br><span class="line">    m1 = cipher_left * inverse(M[<span class="number">0</span>],p) % p</span><br><span class="line">    m2 = cipher_right * inverse(M[<span class="number">1</span>],p) % p</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(m1)) + long_to_bytes(<span class="built_in">int</span>(m2))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># flag&#123;2d6a7e4e-02d3-11ef-8836-a4b1c1c5a2d2&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="signature"><a href="#signature" class="headerlink" title="signature"></a>signature</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> DSA</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_proof_key</span>():</span><br><span class="line">    password = <span class="string">&#x27;happy_the_year_of_loong&#x27;</span></span><br><span class="line">    getin = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> password:</span><br><span class="line">        <span class="keyword">if</span> random.randint(<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">            getin += i.lower()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            getin += i.upper()</span><br><span class="line">    ans = hashlib.sha256(getin.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> getin,ans</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>():</span><br><span class="line">    pri = random.randint(<span class="number">2</span>,q - <span class="number">2</span>)</span><br><span class="line">    pub = <span class="built_in">pow</span>(g,pri,p)</span><br><span class="line">    <span class="keyword">return</span> pri,pub</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">m,pri</span>):</span><br><span class="line">    k = <span class="built_in">int</span>(hashlib.md5(os.urandom(<span class="number">20</span>)).hexdigest(),<span class="number">16</span>)</span><br><span class="line">    H = <span class="built_in">int</span>(hashlib.sha256(m).hexdigest(),<span class="number">16</span>)</span><br><span class="line">    r = <span class="built_in">pow</span>(g,k,p) % q</span><br><span class="line">    s = <span class="built_in">pow</span>(k,-<span class="number">1</span>,q) * (H + pri * r) % q</span><br><span class="line">    <span class="keyword">return</span> r,s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">pub,m,signature</span>):</span><br><span class="line">    r,s = signature</span><br><span class="line">    <span class="keyword">if</span> r &lt;= <span class="number">0</span> <span class="keyword">or</span> r &gt;= q <span class="keyword">or</span> s &lt;= <span class="number">0</span> <span class="keyword">or</span> s &gt;= q:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    w = <span class="built_in">pow</span>(s,-<span class="number">1</span>,q)</span><br><span class="line">    H = <span class="built_in">int</span>(hashlib.sha256(m).hexdigest(),<span class="number">16</span>)</span><br><span class="line">    u1 = H * w % q</span><br><span class="line">    u2 = r * w % q</span><br><span class="line">    v = (<span class="built_in">pow</span>(g,u1,p) * <span class="built_in">pow</span>(pub,u2,p) % p) % q</span><br><span class="line">    <span class="keyword">return</span> v == r</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Hello sir,Plz login first&#x27;</span>)</span><br><span class="line">    menu = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    1.sign</span></span><br><span class="line"><span class="string">    2.verify</span></span><br><span class="line"><span class="string">    3.get my key</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    times = <span class="number">8</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(menu)</span><br><span class="line">        <span class="keyword">if</span> times &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Timeout!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        choice = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt;&#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">            name = <span class="built_in">input</span>(<span class="string">&#x27;Username:&#x27;</span>).encode()</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;admin&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Get out!&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            r,s = sign(name,pri)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;This is your signature -- &gt; <span class="subst">&#123;r&#125;</span>,<span class="subst">&#123;s&#125;</span>&#x27;</span>)</span><br><span class="line">            times -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Sure,Plz input your signature&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(pri)</span><br><span class="line">            r = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;r:&#x27;</span>))</span><br><span class="line">            s = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;s:&#x27;</span>))</span><br><span class="line">            <span class="keyword">if</span> verify(pub,<span class="string">b&#x27;admin&#x27;</span>,(r,s)) == <span class="literal">True</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;login success!&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;you are not admin&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Oh,your key is <span class="subst">&#123;(p,q,g)&#125;</span>&#x27;</span>)</span><br><span class="line">getin,ans = gen_proof_key()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Your gift --&gt; <span class="subst">&#123;ans[:<span class="number">6</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">your_token = <span class="built_in">input</span>(<span class="string">&#x27;Plz input your token\n&gt;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> your_token != getin:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Get out!&#x27;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">key = DSA.generate(<span class="number">1024</span>)</span><br><span class="line">p, q, g = key.p, key.q, key.g</span><br><span class="line">pri, pub = gen_key()</span><br><span class="line"><span class="keyword">if</span> login() == <span class="literal">False</span>:</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read())</span><br></pre></td></tr></table></figure>

<p>关注验签过程<br>$$<br>v \equiv g^{s^{-1}\times H(admin)} \times g^{xr}\mod p \mod q<br>$$</p>
<p>$$<br>v \equiv g^{k(H(admin) + xr)^{-1}(H(admin) + xr)} \mod p \mod q \quad &#x3D; r<br>$$</p>
<p>题目要求用<code>admin</code>来验签，<del>思路很简单，就是求出k，然后自己构造出r和s发给服务器即可</del>，(并不需要求k)</p>
<p>通过$s \equiv k^{-1}(H+xr) \mod q$，有<br>$$<br>k \equiv s^{-1}(H+xr) \mod q<br>$$</p>
<p>$$<br>\therefore k \equiv s^{-1}H + s^{-1}xr \mod q<br>$$</p>
<p>令$A &#x3D; s^{-1}r \mod q,B &#x3D; s^{-1}h \mod q$<br>$$<br>\therefore k \equiv A_ix + B_i \mod q<br>$$<br>造格<br>$$<br>\begin{pmatrix}<br>t_1 &amp; t_2 &amp; … &amp; t_8 &amp; x &amp; 1<br>\end{pmatrix}<br>\begin{pmatrix}<br>q &amp; 0 &amp; … &amp; 0 &amp; 0 &amp; 0\\<br>0 &amp; q &amp; … &amp; 0 &amp; 0 &amp; 0\\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots \\<br>0 &amp; 0 &amp; … &amp; q &amp; 0 &amp; 0\\<br>A_1 &amp; A_2 &amp; … &amp; A_8 &amp; 1 &amp; 0\\<br>B_1 &amp; B_2 &amp; … &amp; B_8 &amp; 0 &amp; K<br>\end{pmatrix}<br>&#x3D;<br>\begin{pmatrix}<br>k_1 &amp; k_2 &amp; … &amp; k_8 &amp; x &amp; K<br>\end{pmatrix}<br>$$<br>q:160bit,k:128bit,x:160bit左右</p>
<p>d太大了，我们把d消去，有<br>$$<br>(r_0s_i)k_i - (r_1s_0)k_0 \equiv (h_ir_0-h_0r_i) \mod q<br>$$<br>同乘$(r_0s_i)^{-1}$有<br>$$<br>k_i - (r_0s_i)^{-1}(r_1s_0)k_0 \equiv (r_0s_i)^{-1}(h_ir_0-h_0r_i) \mod q<br>$$<br>令$A &#x3D; (r_0s_i)^{-1}(r_1s_0) \mod q$，$B &#x3D; (r_0s_i)^{-1}(h_ir_0-h_0r_i) \mod q$</p>
<p>所以有<br>$$<br>k_i \equiv A_ik_0 + B_i \mod q<br>$$<br>构造格<br>$$<br>\begin{pmatrix}<br>t_1 &amp; t_2 &amp; … &amp; t_8 &amp; k_0 &amp; 1<br>\end{pmatrix}<br>\begin{pmatrix}<br>q &amp; 0 &amp; … &amp; 0 &amp; 0 &amp; 0\\<br>0 &amp; q &amp; … &amp; 0 &amp; 0 &amp; 0\\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots \\<br>0 &amp; 0 &amp; … &amp; q &amp; 0 &amp; 0\\<br>A_1 &amp; A_2 &amp; … &amp; A_8 &amp; 1 &amp; 0\\<br>B_1 &amp; B_2 &amp; … &amp; B_8 &amp; 0 &amp; K<br>\end{pmatrix}<br>&#x3D;<br>\begin{pmatrix}<br>k_1 &amp; k_2 &amp; … &amp; k_8 &amp; k_0 &amp; K<br>\end{pmatrix}<br>$$</p>
<p>求出k0之后，我们计算$r \equiv g^{k_0} \mod p \mod q$，$s \equiv k^{-1}(H(admin) + xr) \mod q$</p>
<p>再把r,s发过去即可</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pass_proof</span>(<span class="params">head</span>):</span><br><span class="line">    password = <span class="string">&#x27;happytheyearofloong&#x27;</span></span><br><span class="line">    table = itertools.product([<span class="number">0</span>,<span class="number">1</span>],repeat=<span class="number">19</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">        getin = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(i)):</span><br><span class="line">            <span class="keyword">if</span> i[j] == <span class="number">0</span>:</span><br><span class="line">                getin += password[j].lower()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                getin += password[j].upper()</span><br><span class="line">        msg = getin[:<span class="number">5</span>] + <span class="string">&quot;_&quot;</span> + getin[<span class="number">5</span>:<span class="number">8</span>] + <span class="string">&quot;_&quot;</span> + getin[<span class="number">8</span>:<span class="number">12</span>] + <span class="string">&quot;_&quot;</span> + getin[<span class="number">12</span>:<span class="number">14</span>] + <span class="string">&quot;_&quot;</span> + getin[<span class="number">14</span>:]</span><br><span class="line">        h = hashlib.sha256(msg.encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> h[:<span class="number">6</span>] == head:</span><br><span class="line">            <span class="built_in">print</span>(msg)</span><br><span class="line">            <span class="keyword">return</span> msg</span><br><span class="line">        </span><br><span class="line">sh = remote(<span class="string">&quot;8.147.132.12&quot;</span>,<span class="number">41792</span>)</span><br><span class="line">head = sh.recvline().strip().decode().split(<span class="string">&quot; &quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">msg = pass_proof(head)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;Plz input your token&quot;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">b&quot;&gt;&quot;</span>,msg.encode())</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;3.get my key\n&quot;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">b&quot;&gt;&quot;</span>,<span class="string">b&quot;3&quot;</span>)</span><br><span class="line">(p,q,g) = <span class="built_in">eval</span>(sh.recvline().strip().decode().split(<span class="string">&quot;Oh,your key is &quot;</span>)[-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">H = []</span><br><span class="line">R = []</span><br><span class="line">S = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    name = <span class="string">b&quot;a&quot;</span>*(i+<span class="number">1</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;3.get my key\n&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;&gt;&quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;Username:&quot;</span>,name)</span><br><span class="line">    data = sh.recvline().strip().decode()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    r = <span class="built_in">int</span>(data.split(<span class="string">&quot; &quot;</span>)[-<span class="number">1</span>].split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">    s = <span class="built_in">int</span>(data.split(<span class="string">&quot; &quot;</span>)[-<span class="number">1</span>].split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    h = <span class="built_in">int</span>(hashlib.sha256(name).hexdigest(),<span class="number">16</span>)</span><br><span class="line">    R.append(r)</span><br><span class="line">    S.append(s)</span><br><span class="line">    H.append(h)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_k</span>():</span><br><span class="line">    n = <span class="built_in">len</span>(R)</span><br><span class="line">    r0 = R[<span class="number">0</span>]</span><br><span class="line">    h0 = H[<span class="number">0</span>]</span><br><span class="line">    s0 = S[<span class="number">0</span>]</span><br><span class="line">    A = []</span><br><span class="line">    B = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        a = inverse((r0 * S[i]),q) * (R[i] * s0) % q</span><br><span class="line">        b = inverse((r0 * S[i]),q) * (H[i]*r0 - h0 * R[i])</span><br><span class="line">        A.append(a)</span><br><span class="line">        B.append(b)</span><br><span class="line">        </span><br><span class="line">    Ge = Matrix(ZZ,n+<span class="number">2</span>,n+<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        Ge[i,i] = q</span><br><span class="line">        Ge[-<span class="number">2</span>,i] = A[i]</span><br><span class="line">        Ge[-<span class="number">1</span>,i] = B[i]</span><br><span class="line">    K = <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">    Ge[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">    Ge[-<span class="number">1</span>,-<span class="number">1</span>] = K</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> Ge.LLL():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(line[-<span class="number">1</span>]) == K:</span><br><span class="line">            <span class="keyword">return</span> line[-<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">k0 = get_k()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;k0 = <span class="subst">&#123;k0&#125;</span>&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;3.get my key\n&quot;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">b&quot;&gt;&quot;</span>,<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">sh.recvline()</span><br><span class="line">x = <span class="built_in">int</span>(sh.recvline().strip().decode())</span><br><span class="line">r = <span class="built_in">pow</span>(g,k0,p) % q</span><br><span class="line">hh = <span class="built_in">int</span>(hashlib.sha256(<span class="string">b&quot;admin&quot;</span>).hexdigest(),<span class="number">16</span>)</span><br><span class="line">s = <span class="built_in">pow</span>(k0,-<span class="number">1</span>,q) * (hh + x*r) % q</span><br><span class="line">sh.sendlineafter(<span class="string">b&quot;r:&quot;</span>,<span class="built_in">str</span>(r).encode())</span><br><span class="line">sh.sendlineafter(<span class="string">b&quot;s:&quot;</span>,<span class="built_in">str</span>(s).encode())</span><br><span class="line"><span class="built_in">print</span>(sh.recvline().strip().decode())</span><br><span class="line"><span class="built_in">print</span>(sh.recvline().strip().decode())</span><br></pre></td></tr></table></figure>

<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>由于对DSA没学到位，上面的思路似乎多此一举了，题目给出了私钥，所以只需要拿admin以及私钥构造r,s即可，k可以随便取</p>
<p>如果没给出私钥，那就需要按照上面的思路，先求出k，再求出私钥。</p>
<h2 id="happy2024——Unsolved"><a href="#happy2024——Unsolved" class="headerlink" title="happy2024——Unsolved"></a>happy2024——Unsolved</h2><h3 id="not2022but2024"><a href="#not2022but2024" class="headerlink" title="not2022but2024"></a>not2022but2024</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">CBC_key = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">p,q = getPrime(<span class="number">512</span>),getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">N = n**<span class="number">2</span> + <span class="number">2024</span></span><br><span class="line">hint = (<span class="built_in">pow</span>(<span class="number">3</span>, <span class="number">2022</span>, N) * p**<span class="number">2</span> + <span class="built_in">pow</span>(<span class="number">5</span>, <span class="number">2022</span>, N) * q**<span class="number">2</span>) % N</span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(CBC_key), <span class="number">65537</span>, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;h =&#x27;</span>, hint)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 104765768221225848380273603921218042896496091723683489832860494733817042387427987244507704052637674086899990536096984680534816330245712225302233334574349506189442333792630084535988347790345154447062755551340749218034086168589615547612330724516560147636445207363257849894676399157463355106007051823518400959497</span></span><br><span class="line"><span class="string">h = 7203581190271819534576999256270240265858103390821370416379729376339409213191307296184376071456158994788217095325108037303267364174843305521536186849697944281211331950784736288318928189952361923036335642517461830877284034872063160219932835448208223363251605926402262620849157639653619475171619832019229733872640947057355464330411604345531944267500361035919621717525840267577958327357608976854255222991975382510311241178822169596614192650544883130279553265361702184320269130307457859444687753108345652674084307125199795884106515943296997989031669214605935426245922567625294388093837315021593478776527614942368270286385</span></span><br><span class="line"><span class="string">c = 86362463246536854074326339688321361763048758911466531912202673672708237653371439192187048224837915338789792530365728395528053853409289475258767985600884209642922711705487919620655525967504514849941809227844374505134264182900183853244590113062802667305254224702526621210482746686566770681208335492189720633162</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>$$<br>h \equiv 3^{2022}\times p^2 + 5^{2022}\times q^{2} \mod N<br>$$</p>
<p>因为$N &#x3D; n^2 + 2024$，在模N下，$p,q$比较小</p>
<h1 id="ctfshow西瓜杯"><a href="#ctfshow西瓜杯" class="headerlink" title="ctfshow西瓜杯"></a>ctfshow西瓜杯</h1><p>这场比赛题目蛮简单的，主要拼手速吧</p>
<h2 id="奇怪的条形码"><a href="#奇怪的条形码" class="headerlink" title="奇怪的条形码"></a>奇怪的条形码</h2><p>从手机充电口看这张图片，得到密文<code>Y3Rmc2hvd3t4aWd1YmVpX21pc2NfZ3JhbV9oZXJlX2ZsYWd9</code></p>
<p>base64解码得到<code>ctfshow&#123;xigubei_misc_gram_here_flag&#125;</code></p>
<h2 id="简单密码"><a href="#简单密码" class="headerlink" title="简单密码"></a>简单密码</h2><p>密文<code>647669776d757e83817372816e707479707c888789757c92788d84838b878d9d</code></p>
<p>ctfshow转16进制是<code>63746673686f77</code></p>
<p>c对应的那个密文是c的ASCII码加一，以此类推</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="string">&quot;647669776d757e83817372816e707479707c888789757c92788d84838b878d9d&quot;</span></span><br><span class="line"></span><br><span class="line">c_block = [c[i:i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(c),<span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c_block)):</span><br><span class="line">    tmp = <span class="built_in">int</span>(c_block[i],<span class="number">16</span>)</span><br><span class="line">    m = tmp - (i+<span class="number">1</span>)</span><br><span class="line">    flag += <span class="built_in">chr</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># ctfshow&#123;xiguabei_just_ez_signin&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="factor"><a href="#factor" class="headerlink" title="factor"></a>factor</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> enc <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">hint = os.urandom(<span class="number">36</span>)</span><br><span class="line">tmp = bytes_to_long(hint)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">d = getPrime(<span class="number">400</span>)</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">e = gmpy2.invert(d,phi)</span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">leak1 = p^tmp</span><br><span class="line">leak2 = q^tmp</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;leak1 = <span class="subst">&#123;leak1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;leak2 = <span class="subst">&#123;leak2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 145462084881728813723574366340552281785604069047381248513937024180816353963950721541845665931261230969450819680771925091152670386983240444354412170994932196142227905635227116456476835756039585419001941477905953429642459464112871080459522266599791339252614674500304621383776590313803782107531212756620796159703</span></span><br><span class="line"><span class="string">e = 10463348796391625387419351013660920157452350067191419373870543363741187885528042168135531161031114295856009050029737547684735896660393845515549071092389128688718675573348847489182651631515852744312955427364280891600765444324519789452014742590962030936762237037273839906251320666705879080373711858513235704113</span></span><br><span class="line"><span class="string">c = 60700608730139668338977678601901211800978306010063875269252006068222163102100346920465298044880066999492746508990629867396189713753873657197546664480233269806308415874191048149900822050054539774370134460339681949131037133783273410066318511508768512778132786573893529705068680583697574367357381635982316477364</span></span><br><span class="line"><span class="string">leak1 = 13342820281239625174817085182586822673810894195223942279061039858850534510679297962596800315875604798047264337469828123370586584840078728059729121435462780</span></span><br><span class="line"><span class="string">leak2 = 10901899434728393473569359914062349292412269512201554924835672710780580634465799069211035290729536290605761024818770843901501694556825737462457471235151530</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>直接利用<code>leak1 ^ leak2 = p ^ q</code>剪枝</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">145462084881728813723574366340552281785604069047381248513937024180816353963950721541845665931261230969450819680771925091152670386983240444354412170994932196142227905635227116456476835756039585419001941477905953429642459464112871080459522266599791339252614674500304621383776590313803782107531212756620796159703</span></span><br><span class="line">e = <span class="number">10463348796391625387419351013660920157452350067191419373870543363741187885528042168135531161031114295856009050029737547684735896660393845515549071092389128688718675573348847489182651631515852744312955427364280891600765444324519789452014742590962030936762237037273839906251320666705879080373711858513235704113</span></span><br><span class="line">c = <span class="number">60700608730139668338977678601901211800978306010063875269252006068222163102100346920465298044880066999492746508990629867396189713753873657197546664480233269806308415874191048149900822050054539774370134460339681949131037133783273410066318511508768512778132786573893529705068680583697574367357381635982316477364</span></span><br><span class="line">leak1 = <span class="number">13342820281239625174817085182586822673810894195223942279061039858850534510679297962596800315875604798047264337469828123370586584840078728059729121435462780</span></span><br><span class="line">leak2 = <span class="number">10901899434728393473569359914062349292412269512201554924835672710780580634465799069211035290729536290605761024818770843901501694556825737462457471235151530</span></span><br><span class="line"></span><br><span class="line">gift = leak1 ^ leak2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findp</span>(<span class="params">p,q</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(p) == <span class="number">512</span>:</span><br><span class="line">        pp = <span class="built_in">int</span>(p,<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> n % pp == <span class="number">0</span>:</span><br><span class="line">            p = pp</span><br><span class="line">            q = n // p</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;p = &quot;</span>,p)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;q = &quot;</span>,n // q)</span><br><span class="line">            d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">            m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        l = <span class="built_in">len</span>(p)</span><br><span class="line">        pp = <span class="built_in">int</span>(p,<span class="number">2</span>)</span><br><span class="line">        qq = <span class="built_in">int</span>(q,<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> (pp ^ qq) % (<span class="number">2</span> ** l) == gift %(<span class="number">2</span>**l) <span class="keyword">and</span> pp * qq %(<span class="number">2</span> ** l) == n % (<span class="number">2</span>**l):</span><br><span class="line">            findp(<span class="string">&#x27;1&#x27;</span> + p,<span class="string">&#x27;1&#x27;</span> + q)</span><br><span class="line">            findp(<span class="string">&#x27;1&#x27;</span> + p,<span class="string">&#x27;0&#x27;</span> + q)</span><br><span class="line">            findp(<span class="string">&#x27;0&#x27;</span> + p,<span class="string">&#x27;1&#x27;</span> + q)</span><br><span class="line">            findp(<span class="string">&#x27;0&#x27;</span> + p,<span class="string">&#x27;0&#x27;</span> + q)</span><br><span class="line"></span><br><span class="line">findp(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="comment"># cftshow&#123;do_you_know_what_is_xor_and_prune!!!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="给你d又怎样"><a href="#给你d又怎样" class="headerlink" title="给你d又怎样"></a>给你d又怎样</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag=<span class="string">&quot;ctfshow&#123;***&#125;&quot;</span></span><br><span class="line">m=bytes_to_long(flag.encode())</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">p=getPrime(<span class="number">128</span>)</span><br><span class="line">q=getPrime(<span class="number">128</span>)</span><br><span class="line">n=p*q</span><br><span class="line">phin=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=invert(e,phin)</span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hint=&quot;</span>,<span class="built_in">pow</span>(n,e,c))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e=&quot;</span>,e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;d=&quot;</span>,d)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">c= 48794779998818255539069127767619606491113391594501378173579539128476862598083</span></span><br><span class="line"><span class="string">hint= 7680157534215495795423318554486996424970862185001934572714615456147511225105</span></span><br><span class="line"><span class="string">e= 65537</span></span><br><span class="line"><span class="string">d= 45673813678816865674850575264609274229013439838298838024467777157494920800897</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>这题主要问题是没有n</p>
<p>因为$hint \equiv n^e \mod c$</p>
<p>这个c可以分解为<code>6091 *  8010963716765433514869336359812774009376685535134030237002058632158407912</code></p>
<p>所以可以求e模c的逆元，即可得到n</p>
<p>但是此时求出来的n是比c小的，n理应比c大，所以加回一个c即可</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c= <span class="number">48794779998818255539069127767619606491113391594501378173579539128476862598083</span></span><br><span class="line">hint= <span class="number">7680157534215495795423318554486996424970862185001934572714615456147511225105</span></span><br><span class="line">e= <span class="number">65537</span></span><br><span class="line">d= <span class="number">45673813678816865674850575264609274229013439838298838024467777157494920800897</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># c = 8010963716765433514869336359812774009376685535134030237002058632158407913 * 6091</span></span><br><span class="line">phic = <span class="number">6090</span> * <span class="number">8010963716765433514869336359812774009376685535134030237002058632158407912</span></span><br><span class="line">dc = inverse(<span class="number">65537</span>,phic)</span><br><span class="line">n = <span class="built_in">pow</span>(hint,dc,c) + c</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># ctfshow&#123;Oh_u_knOw_4uler&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="混合密码体系"><a href="#混合密码体系" class="headerlink" title="混合密码体系"></a>混合密码体系</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 库</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,getPrime</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对称加密</span></span><br><span class="line">flag = <span class="string">b&#x27;ctfshow&#123;***&#125;&#x27;</span>      <span class="comment"># 密文，隐藏</span></span><br><span class="line">key = <span class="string">b&#x27;flag&#123;***&#125;&#x27;</span>      <span class="comment"># 会话密钥，隐藏</span></span><br><span class="line">iv = <span class="string">b&#x27;flag&#123;1fake_flag&#125;&#x27;</span>       <span class="comment"># AES偏移向量，已知</span></span><br><span class="line"><span class="comment"># 对明文进行填充，使其长度符合AES加密的要求</span></span><br><span class="line">padded_plaintext = pad(flag, AES.block_size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建AES加密对象</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line">ciphertext = cipher.encrypt(padded_plaintext)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密后的文本通常是字节串，转成整数便于进行会话密钥的RSA加密</span></span><br><span class="line">c1 = bytes_to_long(ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1 = <span class="subst">&#123;c1&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 非对称加密</span></span><br><span class="line">m = bytes_to_long(key)</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;q = <span class="subst">&#123;q&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c2 = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># print(&quot;hint:key需要转成字节流也就是b&#x27;&#x27;&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c1 = 10274623386006297478525964130173470046355982953419353351509177330015001060887455252482567718546651504491658563014875</span></span><br><span class="line"><span class="string">p = 126682770761631193509957156425049279522830651950325320826580754739365086374362604934854454428815835196844469535588686149210573266628767888593088817059600076401582225549728184309047483547810100015820325082976781284679340880386138390518973395696206374336712856387090369022746536868747455939074262253452873845903</span></span><br><span class="line"><span class="string">q = 99825079362327808334563489684167271427241139432727401182808888165552821217781929397837262324242177528386988701584385208395369790542025175917752058047649096340776854252623173162664426065810683048016574420043010318337693586527652970534982946701493024718805916479479658257730226388868060010370893747360166996939</span></span><br><span class="line"><span class="string">n = 12646117645119414744807511144503229609414192869007113075368323921021672404219693075011763838210400633721060798765473421092201704833591315689681668160927426685183273670665030724394172000165517517884654100267567861284096827407481978978840602383267875832034344793848710383473014512122260278131503985961857107838296047172582364612603344429943715046318283653354068887129071531081918798285138812386418361474496678248683513378861801570673376726388110813411011818940310547686977359605296489433805717348250520973842927175837164120905300831792358190183785344002217291207378744610039145999012939983693891188308725179098958690917</span></span><br><span class="line"><span class="string">c2 = 5211902378262010726785508340196935051860438587769647187076059600864676774592415052428465708887047312982844957691943180258845015420187239772414768121857728821510440178906193308448250067671679439841031484589864038401572589752057423667532898133171822921282769652197139455317095891357335645435094243006629469245881345449943250189771998449015275390517315432969774421721243965028796050948747282387052634211032729131656214346307483397410725129682422969273915759947596313513270946529649661334582775282060624547405060499311618257517792321792697831000977711752728887999320311631022598717946355057272761740061999974856808147244</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>先解RSA得到key，然后再解AES</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">c1 = <span class="number">10274623386006297478525964130173470046355982953419353351509177330015001060887455252482567718546651504491658563014875</span></span><br><span class="line">p = <span class="number">126682770761631193509957156425049279522830651950325320826580754739365086374362604934854454428815835196844469535588686149210573266628767888593088817059600076401582225549728184309047483547810100015820325082976781284679340880386138390518973395696206374336712856387090369022746536868747455939074262253452873845903</span></span><br><span class="line">q = <span class="number">99825079362327808334563489684167271427241139432727401182808888165552821217781929397837262324242177528386988701584385208395369790542025175917752058047649096340776854252623173162664426065810683048016574420043010318337693586527652970534982946701493024718805916479479658257730226388868060010370893747360166996939</span></span><br><span class="line">n = <span class="number">12646117645119414744807511144503229609414192869007113075368323921021672404219693075011763838210400633721060798765473421092201704833591315689681668160927426685183273670665030724394172000165517517884654100267567861284096827407481978978840602383267875832034344793848710383473014512122260278131503985961857107838296047172582364612603344429943715046318283653354068887129071531081918798285138812386418361474496678248683513378861801570673376726388110813411011818940310547686977359605296489433805717348250520973842927175837164120905300831792358190183785344002217291207378744610039145999012939983693891188308725179098958690917</span></span><br><span class="line">c2 = <span class="number">5211902378262010726785508340196935051860438587769647187076059600864676774592415052428465708887047312982844957691943180258845015420187239772414768121857728821510440178906193308448250067671679439841031484589864038401572589752057423667532898133171822921282769652197139455317095891357335645435094243006629469245881345449943250189771998449015275390517315432969774421721243965028796050948747282387052634211032729131656214346307483397410725129682422969273915759947596313513270946529649661334582775282060624547405060499311618257517792321792697831000977711752728887999320311631022598717946355057272761740061999974856808147244</span></span><br><span class="line"></span><br><span class="line">d = inverse(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">key = long_to_bytes(<span class="built_in">pow</span>(c2,d,n))</span><br><span class="line">iv = <span class="string">b&#x27;flag&#123;1fake_flag&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">c1 = long_to_bytes(c1)</span><br><span class="line">flag = cipher.decrypt(c1)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># ctfshow&#123;Hybrid_password_system_is_chaos&#125;</span></span><br></pre></td></tr></table></figure>




    </div>

    
    
    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------已经到底啦！<i class="fa fa-paw"></i>-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>DexterJie
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dexterjie.github.io/2024/07/06/%E6%9D%82%E8%AE%B03/" title="杂记(三)">https://dexterjie.github.io/2024/07/06/杂记3/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/06/09/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/CryptoCTF/" rel="prev" title="CryptoCTF">
                  <i class="fa fa-chevron-left"></i> CryptoCTF
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/07/14/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/WKCTF/" rel="next" title="WKCTF">
                  WKCTF <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DexterJie</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">258k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">15:40</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->


    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
<div class="busuanzi-count">
  <script async src="/js/busuanzi.pure.mini.js"></script>
  
  <span class="site-uv" title="总访客量">
    访客量<span id="busuanzi_value_site_uv"></span>
  </span>

  <span class="site-pv" title="总访问量">
    经过<span id="busuanzi_value_site_pv"></span>次回眸与你相遇
  </span>
</div>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"waline-five-mocha.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"locale":null,"placeholder":"请文明评论呀","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2024/07/06/%E6%9D%82%E8%AE%B03/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right"},"mobile":{"show":true}});</script></body>

</html>
