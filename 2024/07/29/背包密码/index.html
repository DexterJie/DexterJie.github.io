<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/0.jpg">
  <link rel="mask-icon" href="/images/0.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dexterjie.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="记录背包密码学习过程">
<meta property="og:type" content="article">
<meta property="og:title" content="背包密码">
<meta property="og:url" content="https://dexterjie.github.io/2024/07/29/%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81/index.html">
<meta property="og:site_name" content="DexterJie&#39;Blog">
<meta property="og:description" content="记录背包密码学习过程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dexterjie.github.io/images/Lattice/25.png">
<meta property="article:published_time" content="2024-07-29T00:51:37.000Z">
<meta property="article:modified_time" content="2024-08-31T02:03:05.390Z">
<meta property="article:author" content="DexterJie">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dexterjie.github.io/images/Lattice/25.png">


<link rel="canonical" href="https://dexterjie.github.io/2024/07/29/%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dexterjie.github.io/2024/07/29/%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81/","path":"2024/07/29/背包密码/","title":"背包密码"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>背包密码 | DexterJie'Blog</title>
  







<link rel="dns-prefetch" href="waline-five-mocha.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DexterJie'Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Never Mind the Scandal and Liber!!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1456890009&auto=1&height=66"></iframe>
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">背包问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B6%85%E9%80%92%E5%A2%9E%E5%BA%8F%E5%88%97"><span class="nav-number">2.</span> <span class="nav-text">超递增序列</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%83%8C%E5%8C%85%E5%8A%A0%E5%AF%86"><span class="nav-number">3.</span> <span class="nav-text">背包加密</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B"><span class="nav-number">3.1.</span> <span class="nav-text">加密过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%AF%86%E8%BF%87%E7%A8%8B"><span class="nav-number">3.2.</span> <span class="nav-text">解密过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%94%BB%E5%87%BB"><span class="nav-number">4.</span> <span class="nav-text">攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E4%B8%8D%E5%BD%93"><span class="nav-number">4.1.</span> <span class="nav-text">参数不当</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DASCTF5%E6%9C%88%E8%B5%9B%E2%80%94%E2%80%94knapsack"><span class="nav-number">4.1.1.</span> <span class="nav-text">DASCTF5月赛——knapsack</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98%E9%80%9A%E8%A7%A3"><span class="nav-number">4.2.</span> <span class="nav-text">背包问题通解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E4%BE%8B%E9%A2%98"><span class="nav-number">5.</span> <span class="nav-text">一些例题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MoeCTF2022%E2%80%94%E2%80%94MiniMiniBackPack"><span class="nav-number">5.1.</span> <span class="nav-text">MoeCTF2022——MiniMiniBackPack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MoeCTF2022%E2%80%94%E2%80%94knapsack"><span class="nav-number">5.2.</span> <span class="nav-text">MoeCTF2022——knapsack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MoeCTF2021%E2%80%94%E2%80%94BBBBBBBackpack"><span class="nav-number">5.3.</span> <span class="nav-text">MoeCTF2021——BBBBBBBackpack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2023%E5%A4%A9%E8%9E%8D%E4%BF%A1%E6%9D%AF%E2%80%94%E2%80%94easybog"><span class="nav-number">5.4.</span> <span class="nav-text">2023天融信杯——easybog</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WKCTF%E2%80%94%E2%80%94meet-me-in-the-summer"><span class="nav-number">5.5.</span> <span class="nav-text">WKCTF——meet me in the summer</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">6.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="DexterJie"
      src="/images/0.jpg">
  <p class="site-author-name" itemprop="name">DexterJie</p>
  <div class="site-description" itemprop="description">一枚只会Crypto的菜鸡</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dexterjie.github.io/2024/07/29/%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/0.jpg">
      <meta itemprop="name" content="DexterJie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DexterJie'Blog">
      <meta itemprop="description" content="一枚只会Crypto的菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="背包密码 | DexterJie'Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          背包密码
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-29 08:51:37" itemprop="dateCreated datePublished" datetime="2024-07-29T08:51:37+08:00">2024-07-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-31 10:03:05" itemprop="dateModified" datetime="2024-08-31T10:03:05+08:00">2024-08-31</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2024/07/29/%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2024/07/29/%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>13 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>记录背包密码学习过程</p>
<span id="more"></span>

<p>始发于2023年8月2日，于2024年7月29日更新</p>
<p>在学习背包密码之前，我们需要了解什么是背包问题</p>
<h1 id="背包问题"><a href="#背包问题" class="headerlink" title="背包问题"></a>背包问题</h1><p>假定一个背包可以承重$S$，现在有$n$个物品，其重量分别为$a_1,a_2\dots a_n$，试问装哪些物品可以<strong>恰好</strong>使得背包被装满，而且每个物品<strong>最多被装一次</strong>。转化成数学式子即是<br>$$<br>x_1a_1+x_2a_2+\dots+x_na_n&#x3D;S<br>$$<br>其中$x_i&#x3D;0或1$</p>
<p>显然我们必须枚举所有的 n 个物品的组合才能解决这个问题，而复杂度也就是$2^n$，这也就是背包加密的妙处所在。</p>
<p>在谈加密过程之前，先了解一下超递增序列</p>
<h1 id="超递增序列"><a href="#超递增序列" class="headerlink" title="超递增序列"></a>超递增序列</h1><p>$\begin{Bmatrix}a_1,a_2,\dots,a_n\end{Bmatrix}$是超递增序列，指的是$a_i&gt;a_1+a_2+\dots+a_{i-1}$，即第$i$个数大于前面$i-1$个数之和，也即$a_i&gt;2a_{i-1}$</p>
<p>当明文和超递增序列依次相乘再求和时<br>$$<br>x_1a_1+x_2a_2+\dots+x_na_n&#x3D;S,x_i&#x3D;<br>\begin{Bmatrix}<br>0,1<br>\end{Bmatrix},<br>a_i&gt;0<br>$$<br><strong>我们可以通过依次比较S与序列中最大的元素大小关系，来确定该元素性质</strong></p>
<p>例如，当$S&gt;a_n$时，说明$x_n&#x3D;1$</p>
<p>接下来，令$S&#x3D;S-a_n$，再比较$S$与$r_{n-1}$</p>
<p>通过n次比较，我们即可获得所有x的值</p>
<h1 id="背包加密"><a href="#背包加密" class="headerlink" title="背包加密"></a>背包加密</h1><p>背包加密算法流程如下:</p>
<p><img src="/../images/Lattice/25.png"></p>
<h2 id="加密过程"><a href="#加密过程" class="headerlink" title="加密过程"></a>加密过程</h2><ol>
<li>明文</li>
</ol>
<p>明文字符串转成二进制，生成明文序列$x &#x3D; (x_1,x_2,…,x_n),x_i \in (0,1)$</p>
<ol start="2">
<li>私钥</li>
</ol>
<p>生成一个超递增序列$r &#x3D; (r_1,r_2,…,r_n)$作为私钥序列</p>
<ol start="3">
<li>公钥</li>
</ol>
<ul>
<li>生成模数$B$，满足</li>
</ul>
<p>$$<br>B&gt;\sum_{i&#x3D;1}^{n}r_i<br>$$</p>
<ul>
<li><p>即满足$B &gt; 2r_n$，因为$r$是个超递增序列</p>
</li>
<li><p>生成乘数$A$，满足$gcd(A,B)&#x3D;1$</p>
</li>
<li><p>生成公钥序列$M&#x3D;\begin{Bmatrix}M_1,M_2,\dots,M_n\end{Bmatrix}$，其中$M_i \equiv Ar_i \mod B$</p>
</li>
</ul>
<ol start="4">
<li>密文</li>
</ol>
<p>通过以下式子生成密文<br>$$<br>S &#x3D; \sum_{i&#x3D;1}^{n}x_iM_i<br>$$</p>
<p>最后公开$M,A,B,S$</p>
<h2 id="解密过程"><a href="#解密过程" class="headerlink" title="解密过程"></a>解密过程</h2><ol>
<li><p>计算$A$关于模$B$的逆元$A^{-1}$</p>
</li>
<li><p>计算$S’$</p>
</li>
</ol>
<p>$$<br>S’\equiv A^{-1}S \equiv A^{-1}\sum_{i&#x3D;1}^nx_iM_i\equiv A^{-1}\sum_{i&#x3D;1}^nx_iAr_i \equiv \sum_{i&#x3D;1}^nx_ir_i \mod B<br>$$</p>
<ol start="3">
<li><p>利用超递增序列$r$的性质，求解明文的二进制</p>
</li>
<li><p>最后把二进制转为字符串</p>
</li>
</ol>
<h1 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h1><h2 id="参数不当"><a href="#参数不当" class="headerlink" title="参数不当"></a>参数不当</h2><p>如果乘数$A$，超递增序列$r$的大小选取不当，使得$Ar_i&lt;B$，则$Ar_i \mod B &#x3D; Ar_i$，这就导致公钥序列$M$是个很明显的超递增序列。</p>
<h3 id="DASCTF5月赛——knapsack"><a href="#DASCTF5月赛——knapsack" class="headerlink" title="DASCTF5月赛——knapsack"></a>DASCTF5月赛——knapsack</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genKey</span>(<span class="params">length</span>):</span><br><span class="line">    A, B = getPrime(<span class="number">64</span>), getPrime(<span class="number">1025</span>)</span><br><span class="line">    Rn = getPrime(<span class="number">1024</span>)</span><br><span class="line">    key1 = [Rn//<span class="number">2</span>**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>)]</span><br><span class="line">    key2 = [i*A % B sfor i <span class="keyword">in</span> key1]</span><br><span class="line">    <span class="keyword">return</span> key1,key2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">text,key</span>):</span><br><span class="line">    Sum=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(text)):</span><br><span class="line">        Sum+=<span class="built_in">int</span>(text[i])*key[i]</span><br><span class="line">    <span class="keyword">return</span> Sum</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">Ciper,Key</span>):</span><br><span class="line">    f1=<span class="built_in">open</span>(<span class="string">&quot;pub.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Key)):</span><br><span class="line">        f1.write(<span class="built_in">str</span>(Key[i])+<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line">    f2=<span class="built_in">open</span>(<span class="string">&quot;cip.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">    f2.write(<span class="built_in">hex</span>(Ciper))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FLAG = <span class="built_in">bin</span>(bytes_to_long(flag.encode()))[<span class="number">2</span>:]</span><br><span class="line">Key1,Key2 = genKey(<span class="built_in">len</span>(FLAG))</span><br><span class="line">Ciper = encrypt(FLAG,Key1)</span><br><span class="line">save(Ciper,Key2)</span><br></pre></td></tr></table></figure>

<p>首先注意到key1是个超递减的序列，而且乘数A非常小。</p>
<p>所以$A$和序列中两个最小值相乘的结果很有可能小于$B$，这样我们可以通过序列中两个最小值求$gcd$来获得$A$，</p>
<p>我们先假设最小的是$a_0$，$a_0-a_n$依次增大</p>
<p>如果能找到两个数满足$a_{i+1}&lt;a_i$，这就说明从$a_i$到$a_{i+1}$存在一次模运算</p>
<p>$A \times a_{i+1}&#x3D;A \times 2a_i \mod B$</p>
<p>所以有$B &#x3D; A(2a_i-a_{i+1})$</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/206493#h3-11">DASCTF五月月赛 暨 BJDCTF 3rd 部分WP-安全客 - 安全资讯平台 (anquanke.com)</a></p>
<h2 id="背包问题通解"><a href="#背包问题通解" class="headerlink" title="背包问题通解"></a>背包问题通解</h2><p>当密度$d &#x3D; \frac{len(M)}{log_2(max(M_i))}&lt;0.9408$时，LLL算法能通杀这类背包问题</p>
<p>用公钥序列$M&#x3D; (M_1,M_2,…,M_n)$构造格<br>$$<br>\begin{pmatrix}<br>1 &amp; 0 &amp; … &amp; 0 &amp; M_1\\<br>0 &amp; 1 &amp; … &amp; 0 &amp; M_2\\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\<br>0 &amp; 0 &amp; … &amp; 1 &amp;M_n\\<br>0 &amp; 0 &amp; … &amp; 0 &amp; S<br>\end{pmatrix}<br>$$<br>假设每一行为$V_i$，例如$V_1&#x3D;(1,0,…,0,M_1)$，不难理解$V_i$就是格$\mathcal{L}$的基</p>
<p>我们设明文序列为$x&#x3D;\begin{Bmatrix}x_1,x_2,\dots,x_n \end{Bmatrix}$，$x_i&#x3D;\begin{Bmatrix}0,1 \end{Bmatrix}$</p>
<p>很明显，对于线性组合$x_1V_1+x_2V_2+\dots+x_nV_n-V_{n+1}$必然在格点上面，因为$x_i$只能取$0$或$1$</p>
<p>则向量$\vec{t}&#x3D;x_1V_1+x_2V_2+\dots+x_nV_n-V_{n+1}$即$\overrightarrow{t} &#x3D; (x_1,x_2,\dots,x_n,0)$</p>
<p>而$||\vec{t}||&#x3D;1$,$det(\mathcal{L})&#x3D;S^{\frac{1}{n+1}}$</p>
<p>根据$Hermite$定理，$||\vec{t}||&lt;\sqrt{n+1}\times det(\mathcal{L})$</p>
<p>所以$\vec{t}$是格$\mathcal{L}$的最短向量，可以用LLL算法解决</p>
<p>其实就是说会存在一个线性组合：</p>
<p>$$<br>\begin{pmatrix}<br>x_1 &amp; x_2 &amp; … &amp; x_n &amp; -1<br>\end{pmatrix}<br>\begin{pmatrix}<br>1 &amp; 0 &amp; … &amp; 0 &amp; M_1\\<br>0 &amp; 1 &amp; … &amp; 0 &amp; M_2\\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\<br>0 &amp; 0 &amp; … &amp; 1 &amp;M_n\\<br>0 &amp; 0 &amp; … &amp; 0 &amp; S<br>\end{pmatrix}<br>&#x3D;<br>\begin{pmatrix}<br>x_1 &amp; x_2 &amp; … &amp; x_n &amp; 0<br>\end{pmatrix}<br>$$<br>进行优化，使用这个格。至于为什么说这个格是更优的,估计是行列式更大些吧<br>$$<br>L &#x3D;<br>\begin{pmatrix}<br>2 &amp; 0 &amp; … &amp; 0 &amp; M_1\\<br>0 &amp; 2 &amp; … &amp; 0 &amp; M_2\\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\<br>0 &amp; 0 &amp; … &amp; 2 &amp; M_n\\<br>1 &amp; 1 &amp; … &amp; 1 &amp; S<br>\end{pmatrix}<br>$$<br>这个对应的线性组合是<br>$$<br>\begin{pmatrix}<br>x_1 &amp; x_2 &amp; … &amp; x_n &amp; -1<br>\end{pmatrix}<br>\begin{pmatrix}<br>2 &amp; 0 &amp; … &amp; 0 &amp; M_1\\<br>0 &amp; 2 &amp; … &amp; 0 &amp; M_2\\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\<br>0 &amp; 0 &amp; … &amp; 2 &amp;M_n\\<br>1 &amp; 1 &amp; … &amp; 1 &amp; S<br>\end{pmatrix}<br>&#x3D;<br>\begin{pmatrix}<br>2x_1-1 &amp; 2x_2-1 &amp; … &amp; 2x_n-1 &amp; 0<br>\end{pmatrix}<br>$$</p>
<p>以上内容仅笔者的拙见，欢迎师傅们指点</p>
<h1 id="一些例题"><a href="#一些例题" class="headerlink" title="一些例题"></a>一些例题</h1><h2 id="MoeCTF2022——MiniMiniBackPack"><a href="#MoeCTF2022——MiniMiniBackPack" class="headerlink" title="MoeCTF2022——MiniMiniBackPack"></a>MoeCTF2022——MiniMiniBackPack</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> FLAG <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>(<span class="params">size</span>):</span><br><span class="line">    s = <span class="number">1000</span></span><br><span class="line">    key = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">        a = random.randint(s + <span class="number">1</span>, <span class="number">2</span> * s)</span><br><span class="line">        <span class="keyword">assert</span> a &gt; <span class="built_in">sum</span>(key)</span><br><span class="line">        key.append(a)</span><br><span class="line">        s += a</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">L = <span class="built_in">len</span>(<span class="built_in">bin</span>(m)[<span class="number">2</span>:])</span><br><span class="line">key = gen_key(L)</span><br><span class="line">c = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(L):</span><br><span class="line">    c += key[i]**(m&amp;<span class="number">1</span>)</span><br><span class="line">    m &gt;&gt;= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure>

<p><code>gen_key</code>生成超递增序列。$c$由背包加密得来，题目把$c$和私钥都给了。</p>
<p>把$c$依次和序列中最大的值比较即可求解</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">key = [...]</span><br><span class="line">c = <span class="number">2396891354790728703114360139080949406724802115971958909288237002299944566663978116795388053104330363637753770349706301118152757502162</span></span><br><span class="line"></span><br><span class="line">m = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(key):</span><br><span class="line">    <span class="keyword">if</span> c &gt; i:</span><br><span class="line">        m += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        c -= i</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        m += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        c -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m,<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h2 id="MoeCTF2022——knapsack"><a href="#MoeCTF2022——knapsack" class="headerlink" title="MoeCTF2022——knapsack"></a>MoeCTF2022——knapsack</h2><p>题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,long_to_bytes,GCD,inverse</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bitlength</span>(<span class="params">n</span>):<span class="comment">#判断消息长度</span></span><br><span class="line">	length=<span class="built_in">len</span>(<span class="built_in">bin</span>(bytes_to_long(n))[<span class="number">2</span>:])</span><br><span class="line">	<span class="keyword">return</span> length</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">makeKey</span>(<span class="params">n</span>):<span class="comment">#生成超递增序列，得到私钥、公钥</span></span><br><span class="line">	length=<span class="built_in">len</span>(n)</span><br><span class="line">	privKey = [randint(<span class="number">1</span>, <span class="number">65536</span>**length)]</span><br><span class="line">	<span class="built_in">sum</span> = privKey[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length):</span><br><span class="line">		privKey.append(randint(<span class="built_in">sum</span>*<span class="number">255</span> + <span class="number">1</span>, <span class="number">65536</span>**(length + i)))</span><br><span class="line">		<span class="built_in">sum</span> += privKey[i]</span><br><span class="line">	q = <span class="number">255</span>*randint(privKey[length-<span class="number">1</span>] + <span class="number">1</span>, <span class="number">2</span>*privKey[length-<span class="number">1</span>])</span><br><span class="line">	r = randint(<span class="number">1</span>, q)</span><br><span class="line">	<span class="keyword">while</span> GCD(r, q) != <span class="number">1</span>:</span><br><span class="line">		r = randint(<span class="number">1</span>, q)</span><br><span class="line">	pubKey = [ r*w % q <span class="keyword">for</span> w <span class="keyword">in</span> privKey ]<span class="comment">#将超递增序列变为非超递增序列，作为公钥</span></span><br><span class="line">	<span class="keyword">return</span> privKey, q, r, pubKey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pubKey</span>):<span class="comment">#用公钥加密消息</span></span><br><span class="line">	cipher = <span class="number">0</span></span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> bit <span class="keyword">in</span> msg:</span><br><span class="line">		cipher += bit*pubKey[i]</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher, privKey, q, r</span>):<span class="comment">#用私钥求得超递增序列并解密</span></span><br><span class="line">	d = inverse(r, q)</span><br><span class="line">	msg = cipher*d % q</span><br><span class="line">	res = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">	n = <span class="built_in">len</span>(privKey)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">		temp=<span class="number">0</span></span><br><span class="line">		<span class="keyword">if</span> msg &gt;= privKey[i]:</span><br><span class="line">			<span class="keyword">while</span> msg &gt;= privKey[i]:</span><br><span class="line">				temp=temp+<span class="number">1</span></span><br><span class="line">				msg -= privKey[i]</span><br><span class="line">			res =  <span class="built_in">bytes</span>([temp]) + res</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			res =  <span class="built_in">bytes</span>([<span class="number">0</span>]) + res </span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">privKey, q, r, pubKey=makeKey(flag)</span><br><span class="line">cipher=encrypt(flag,pubKey)</span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&quot;pubKey.txt&quot;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(pubKey))</span><br><span class="line">f.close()</span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&quot;cipher.txt&quot;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(cipher))</span><br><span class="line">f.close()</span><br><span class="line"><span class="built_in">print</span>(decrypt(encrypt(flag,pubKey),privKey,q,r))</span><br><span class="line"><span class="keyword">assert</span> decrypt(encrypt(flag,pubKey),privKey,q,r)==flag</span><br></pre></td></tr></table></figure>

<p>很标准的背包密码加密，由于只给了公钥，用格来做</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">M = []</span><br><span class="line">S = </span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(M)</span><br><span class="line">Ge = Matrix.identity(n)</span><br><span class="line">last_row = [<span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">Ge_last_row = Matrix(ZZ, <span class="number">1</span>, <span class="built_in">len</span>(last_row), last_row)</span><br><span class="line"></span><br><span class="line">last_col = M[:]</span><br><span class="line">last_col.append(S)</span><br><span class="line">Ge_last_col = Matrix(ZZ, <span class="built_in">len</span>(last_col), <span class="number">1</span>, last_col)</span><br><span class="line"></span><br><span class="line">Ge = Ge.stack(Ge_last_row)</span><br><span class="line">Ge = Ge.augment(Ge_last_col)</span><br><span class="line"></span><br><span class="line">X = Ge.LLL()[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(X)</span><br><span class="line">ans = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> X:</span><br><span class="line">    ans.append(<span class="built_in">abs</span>(i))</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(ans))</span><br></pre></td></tr></table></figure>

<h2 id="MoeCTF2021——BBBBBBBackpack"><a href="#MoeCTF2021——BBBBBBBackpack" class="headerlink" title="MoeCTF2021——BBBBBBBackpack"></a>MoeCTF2021——BBBBBBBackpack</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">flag = xxxxx</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">backpack = [<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">160</span>):</span><br><span class="line">    backpack = backpack + [random.randrange(backpack[-<span class="number">1</span>]*<span class="number">2</span>,backpack[-<span class="number">1</span>]*<span class="number">4</span>)]</span><br><span class="line"><span class="built_in">print</span>(backpack)</span><br><span class="line"></span><br><span class="line">backpack = backpack[::-<span class="number">1</span>]</span><br><span class="line">l_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> backpack:</span><br><span class="line">    l_list.append(m//i)</span><br><span class="line">    m = m % i </span><br><span class="line"><span class="built_in">print</span>(l_list)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[0, 0, 0, 0, 1, 1, 2, 2, 0, 0, 1, 1, 0, 2, 1, 0, 1, 2, 1, 1, 1, 2, 0, 0, 2, 2, 2, 1, 2, 2, 1, 1, 1, 2, 2, 2, 0, 0, 2, 1, 0, 0, 1, 0, 1, 1, 1, 0, 2, 1, 3, 0, 2, 2, 0, 0, 2, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 2, 0, 0, 1, 0, 1, 3, 0, 2, 0, 0, 1, 1, 3, 1, 2, 2, 1, 0, 0, 0, 2, 1, 1, 0, 0, 0, 1, 0, 1, 2, 1, 0, 1, 2, 0, 1, 3, 1, 0, 2, 2, 0, 1, 0, 1, 2, 1, 2, 3, 1, 0, 2, 1, 1, 2, 1, 2, 1, 0, 2, 0, 2, 2, 2, 1, 2, 1, 1, 1, 2, 3, 0, 1, 1, 2, 0, 1, 0, 0, 2, 2, 3, 2, 1, 2, 1, 1, 1, 3, 1, 0]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>已知<code>l = m // i</code><br>$$<br>m’ &#x3D; m \mod s_i<br>$$<br>我们可以从中推断，当$L_i&#x3D;0$时，$m$是不变的，当$L_i &#x3D; 1,2,3$时，$m’ \equiv m \mod s_i \longrightarrow m’ &#x3D; m - x×s_i$</p>
<p>而且最后$\frac{m}{1} &#x3D; 0$，说明最后$m&#x3D;0$</p>
<p>把$s_i$和$L_i$相乘求和就能得到$m$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">s = []</span><br><span class="line">l = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">s = <span class="built_in">list</span>(s[::-<span class="number">1</span>])</span><br><span class="line">n = <span class="built_in">len</span>(l)</span><br><span class="line">m = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    m += s[i]*l[i]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<h2 id="2023天融信杯——easybog"><a href="#2023天融信杯——easybog" class="headerlink" title="2023天融信杯——easybog"></a>2023天融信杯——easybog</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">rr = os.urandom(<span class="number">10</span>)</span><br><span class="line">flag = <span class="string">&quot;flag&#123;&quot;</span>+rr.<span class="built_in">hex</span>()+<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">flag_md5 = md5(flag.encode()).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">bin</span>(bytes_to_long(rr))[<span class="number">2</span>:].zfill(<span class="number">8</span> * <span class="built_in">len</span>(rr))</span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m</span>):</span><br><span class="line">    pubkey = [random.randint(<span class="number">2</span>,p - <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m))]</span><br><span class="line">    enc = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k,i <span class="keyword">in</span> <span class="built_in">zip</span>(pubkey,m):</span><br><span class="line">        enc += k * <span class="built_in">int</span>(i)</span><br><span class="line">        enc %= p</span><br><span class="line">    <span class="keyword">return</span> pubkey,enc</span><br><span class="line"></span><br><span class="line">pubkey,c = encrypt(m)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;pubkey = <span class="subst">&#123;pubkey&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;flag_md5 = <span class="subst">&#123;flag_md5&#125;</span>\n&quot;</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p>从<code>encrypt(m)</code>，我们可以知道$c \equiv key_i×m_i \mod p \longrightarrow c &#x3D; key_i×m_i+kp$</p>
<p>$$<br>\therefore 0 &#x3D; \sum_{i&#x3D;1}^{80}key_im_i + kp - c<br>$$<br>造格<br>$$<br>\begin{pmatrix}<br>1 &amp; 0 &amp; … &amp; 0 &amp; 0 &amp;key_1\\<br>0 &amp; 1 &amp; … &amp; 0 &amp; 0 &amp; key_2\\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp;\vdots \\<br>0 &amp; 0 &amp; … &amp; 1 &amp;0 &amp; key_n\\<br>0 &amp; 0 &amp; … &amp; 0 &amp; 1 &amp; c \\<br>0 &amp; 0 &amp; … &amp; 0 &amp; 0 &amp; p<br>\end{pmatrix}<br>$$</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">p = <span class="number">85766816683407427477074053090759168259205489535331001301483049660772943816017</span></span><br><span class="line">pubkey = []</span><br><span class="line">c = <span class="number">1381426073179447662111620044316177635969142117258054810267264948634812447218</span></span><br><span class="line">flag_md5 = <span class="string">&quot;cae8243e01090ccd03a66e3a4c52b7ee&quot;</span></span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(pubkey)</span><br><span class="line"></span><br><span class="line">Ge = Matrix(ZZ,n+<span class="number">2</span>,n+<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    Ge[i,i] = <span class="number">1</span></span><br><span class="line">    Ge[i,-<span class="number">1</span>] = pubkey[i]</span><br><span class="line"></span><br><span class="line">Ge[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">Ge[-<span class="number">2</span>,-<span class="number">1</span>] = c</span><br><span class="line">Ge[-<span class="number">1</span>,-<span class="number">1</span>] = p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">L = Ge.BKZ()</span><br><span class="line">ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> Ge.BKZ():</span><br><span class="line">    <span class="keyword">if</span> i[-<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        tmp = i[:-<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> tmp:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(j) == <span class="number">1</span>:</span><br><span class="line">                ans += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ans += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        flag = <span class="string">&quot;flag&#123;&quot;</span> + <span class="built_in">hex</span>(<span class="built_in">int</span>(ans,<span class="number">2</span>))[<span class="number">2</span>:] + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">        flag_md51 = hashlib.md5(flag.encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> flag_md51 == flag_md5:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>sagemath中的<code>BKZ()</code>可以设置参数，例如<code>BKZ(block_size = 16)</code>，指定了<code>BKZ</code>算法中的块大小。默认情况下是<code>block_size = 20</code></p>
<p>block_size越大，执行速度越慢，但结果更精确</p>
<h2 id="WKCTF——meet-me-in-the-summer"><a href="#WKCTF——meet-me-in-the-summer" class="headerlink" title="WKCTF——meet me in the summer"></a>WKCTF——meet me in the summer</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice, randint</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime, sieve_base <span class="keyword">as</span> primes, getPrime</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;WKCTF&#123;&#125;&#x27;</span></span><br><span class="line">flag = pad(flag,<span class="number">16</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myPrime</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> n.bit_length() &lt; bits:</span><br><span class="line">            n *= choice(primes)</span><br><span class="line">        <span class="keyword">if</span> isPrime(n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key, message</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="number">65537</span>, message, key)</span><br><span class="line"></span><br><span class="line">p = myPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">N = p * q</span><br><span class="line">m = [getPrime(<span class="number">512</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1024</span>)]</span><br><span class="line">enc = [encrypt(N, _) <span class="keyword">for</span> _ <span class="keyword">in</span> m]</span><br><span class="line"></span><br><span class="line">a = [randint(<span class="number">1</span>,<span class="number">2</span> ** <span class="number">50</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">70</span>)]</span><br><span class="line">b = [randint(<span class="number">1</span>,<span class="number">2</span> ** <span class="number">50</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>)]</span><br><span class="line">secret = randint(<span class="number">2</span>**<span class="number">119</span>, <span class="number">2</span>**<span class="number">120</span>)</span><br><span class="line"></span><br><span class="line">ra = <span class="number">1</span></span><br><span class="line">rb = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">120</span>):</span><br><span class="line">    <span class="keyword">if</span>(i &lt; <span class="number">70</span>):</span><br><span class="line">        <span class="keyword">if</span> (secret &gt;&gt; i) &amp; <span class="number">1</span>:</span><br><span class="line">            ra *= a[i]</span><br><span class="line">            ra %= p</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> (secret &gt;&gt; i) &amp; <span class="number">1</span>:</span><br><span class="line">            rb *= b[i-<span class="number">70</span>]</span><br><span class="line">            rb %= q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = md5(<span class="built_in">str</span>(secret).encode()).hexdigest()[<span class="number">16</span>:].encode()</span><br><span class="line">cipher = AES.new(key,AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&#x27;c = <span class="subst">&#123;cipher.encrypt(flag).<span class="built_in">hex</span>()&#125;</span>\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">f&#x27;m = <span class="subst">&#123;m&#125;</span>\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">f&#x27;b = <span class="subst">&#123;b&#125;</span>\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">f&#x27;ra = <span class="subst">&#123;ra&#125;</span>\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">f&#x27;rb = <span class="subst">&#123;rb&#125;</span>\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>此处仅讨论与ra相关的部分,<a href="https://dexterjie.github.io/2024/07/14/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/WKCTF/#Meet-me-in-the-summer%E2%80%94%E2%80%94%E5%A4%8D%E7%8E%B0">整题wp</a></p>
<p>根据题意有<br>$$<br>ra\equiv a_0k_{70}\times a_1k_{69} \times …\times a_{69}k_1 \mod p<br>$$<br>$k_i$表示第一段的第i位，需要注意的是当$k_i &#x3D; 0$的时候是不需要乘进来的，这里只是写成这样。</p>
<p>因为$p-1$光滑，我们考虑把这个式子变成一个求解离散对数的问题，这样才能利用上$p-1$光滑</p>
<p>我们随便取一个生成元g，然后对等式两边取对数，<strong>要注意的是，取对数之后模数应该变成p-1</strong><br>$$<br>\log_{g}{ra} \equiv \log_{g}{a_0k_{70}} + \log_{g}{a_1k_{69}} + … + \log_{g}{a_{69}k_1} \mod p - 1<br>$$<br>对于这个式子，当$k_i &#x3D; 1$的时候，$log_g^{a_ik_i} &#x3D; log_g^{a_i}$，刚刚前面说了$k_i &#x3D;0$的时候是不需要乘进来的，那这个取离散对数后的式子里面只包括了$k_i &#x3D; 1$的情况。</p>
<p>因此我们有<br>$$<br>\log_{g}{ra} \equiv \log_{g}{a_0} + \log_{g}{a_1} + … + \log_{g}{a_{69}} \mod p - 1<br>$$<br>这样就可以写为加法背包了</p>
<p>造格<br>$$<br>\begin{pmatrix}<br>k_{70} &amp; k_{69} &amp; … &amp; k_{1} &amp; 1 &amp; l<br>\end{pmatrix}<br>\begin{pmatrix}<br>1 &amp; 0 &amp; … &amp; 0 &amp; 0 &amp; \log_{g}{a_0}\\<br>0 &amp; 1 &amp; … &amp; 0 &amp; 0 &amp; \log_{g}{a_1}\\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots \\<br>0 &amp; 0 &amp; … &amp; 1 &amp; 0 &amp; \log_{g}{a_{69}}\\<br>0 &amp; 0 &amp; … &amp; 0 &amp; 1 &amp; \log_{g}{ra}\\<br>0 &amp; 0 &amp; … &amp; 0 &amp; 0 &amp; p - 1<br>\end{pmatrix}<br>&#x3D;<br>\begin{pmatrix}<br>k_{70} &amp; k_{69} &amp; … &amp; k_1 &amp; 1 &amp; 0<br>\end{pmatrix}<br>$$</p>
<p>这个格没出，进行优化，造下面这个格<br>$$<br>\begin{pmatrix}<br>k_{70} &amp; k_{69} &amp; … &amp; k_{1} &amp; l &amp; -1<br>\end{pmatrix}<br>\begin{pmatrix}<br>2 &amp; 0 &amp; … &amp; 0 &amp; 0 &amp; \log_{g}{a_0}\\<br>0 &amp; 2 &amp; … &amp; 0 &amp; 0 &amp; \log_{g}{a_1}\\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots \\<br>0 &amp; 0 &amp; … &amp; 2 &amp; 0 &amp; \log_{g}{a_{69}}\\<br>0 &amp; 0 &amp; … &amp; 0 &amp; 1 &amp; p - 1\\<br>1 &amp; 1 &amp; … &amp; 1 &amp; 1 &amp; \log_{g}{ra}<br>\end{pmatrix}<br>&#x3D;<br>\begin{pmatrix}<br>k_{70}-1 &amp; k_{69}-1 &amp; … &amp; k_1-1 &amp; l-1 &amp; 0<br>\end{pmatrix}<br>$$</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">810922431519561</span>, <span class="number">446272766988725</span>, <span class="number">167807402211751</span>, <span class="number">137130339017755</span>, <span class="number">214986582563833</span>, <span class="number">141074297736993</span>, <span class="number">1116944910925939</span>, <span class="number">827779449967114</span>, <span class="number">887541522977945</span>, <span class="number">698795918391810</span>, <span class="number">180874459256817</span>, <span class="number">42309568567278</span>, <span class="number">148563974468327</span>, <span class="number">43541894027392</span>, <span class="number">369461465628947</span>, <span class="number">226728238060977</span>, <span class="number">902554563386031</span>, <span class="number">369980733296039</span>, <span class="number">495826170604031</span>, <span class="number">202556971656774</span>, <span class="number">1124261777691439</span>, <span class="number">533425503636189</span>, <span class="number">393536945515725</span>, <span class="number">242107802161603</span>, <span class="number">506637008093239</span>, <span class="number">846292038115984</span>, <span class="number">686372167052341</span>, <span class="number">923093823276073</span>, <span class="number">557898577262848</span>, <span class="number">719859369760663</span>, <span class="number">51513645433906</span>, <span class="number">946714837276014</span>, <span class="number">24336055796632</span>, <span class="number">302053499607130</span>, <span class="number">970564601798660</span>, <span class="number">1082742759743394</span>, <span class="number">499339281736843</span>, <span class="number">13407991387893</span>, <span class="number">667336471542364</span>, <span class="number">38809146657917</span>, <span class="number">29069472887681</span>, <span class="number">420834834946561</span>, <span class="number">1044601747029985</span>, <span class="number">854268790341671</span>, <span class="number">918316968972873</span>, <span class="number">737863884666895</span>, <span class="number">1036231016223653</span>, <span class="number">792781009835942</span>, <span class="number">142149344663288</span>, <span class="number">828341073371968</span>, <span class="number">186470549619656</span>, <span class="number">279923049419811</span>, <span class="number">487848895651491</span>, <span class="number">737257307326881</span>, <span class="number">1065005635075133</span>, <span class="number">628186519179693</span>, <span class="number">554767859759026</span>, <span class="number">606623194910240</span>, <span class="number">497855707815081</span>, <span class="number">88176594691403</span>, <span class="number">278020899501967</span>, <span class="number">440746393631841</span>, <span class="number">921270589876795</span>, <span class="number">800698974218498</span>, <span class="number">437669423813782</span>, <span class="number">717945417305277</span>, <span class="number">191204872168085</span>, <span class="number">791101652791845</span>, <span class="number">772875127585562</span>, <span class="number">174750251898037</span>]</span><br><span class="line">ra = <span class="number">215843182933318975496532456029939484729806294336845406882490936458079210569046120528327121994744424727894554328344229010979127024288283698486557728305231262446</span></span><br><span class="line">p = <span class="number">266239931579101788237217833822346198682539336616234011732898866661722928035386747695230192006141430294833011494452114878744414084025005167432139516382471637567</span></span><br><span class="line"></span><br><span class="line">g = <span class="number">5</span></span><br><span class="line">tmp = discrete_log(mod(ra,p),mod(g,p))</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(a)</span><br><span class="line">A = [discrete_log(mod(a[i],p),mod(g,p)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line"></span><br><span class="line">d = n / log(<span class="built_in">max</span>(A), <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(CDF(d))</span><br><span class="line"></span><br><span class="line">Ge = Matrix(ZZ,n+<span class="number">2</span>,n+<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    Ge[i,i] = <span class="number">2</span></span><br><span class="line">    Ge[i,-<span class="number">1</span>] = A[i]</span><br><span class="line">    Ge[-<span class="number">1</span>,i] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">Ge[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">Ge[-<span class="number">2</span>,-<span class="number">1</span>] = p - <span class="number">1</span></span><br><span class="line">Ge[-<span class="number">1</span>,-<span class="number">1</span>] = tmp</span><br><span class="line">Ge[-<span class="number">1</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">Ge[:,-<span class="number">1</span>] *= <span class="number">2</span>^<span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> Ge.BKZ(block_size = <span class="number">26</span>):</span><br><span class="line">    <span class="keyword">if</span> line[-<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        t = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> line[:-<span class="number">2</span>]:</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">                t += <span class="string">&quot;0&quot;</span>        <span class="comment"># or 1</span></span><br><span class="line">            <span class="keyword">if</span> i == -<span class="number">1</span>:</span><br><span class="line">                t += <span class="string">&quot;1&quot;</span>        <span class="comment"># or 0 这两个来回换一下即可</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(t) == <span class="number">70</span>:</span><br><span class="line">        <span class="built_in">print</span>(t[::-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># 1100100011000011000001010101000010111110000001000010101010100100011011</span></span><br></pre></td></tr></table></figure>



<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://harry0597.com/2022/07/21/bag/">CTF·背包问题相关 | Harry’s Blog (harry0597.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://jayxv.github.io/2020/06/08/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bknapsack/">密码学学习笔记 之 knapsack | Van1sh的小屋 (jayxv.github.io)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ieice.org/publications/conference-FIT-DVDs/FIT2018/data/pdf/A-022.pdf">A-022.pdf (ieice.org)</a></p>
<p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/crypto/asymmetric/knapsack/knapsack/">背包加密 - CTF Wiki (ctf-wiki.org)</a></p>

    </div>

    
    
    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------已经到底啦！<i class="fa fa-paw"></i>-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>DexterJie
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dexterjie.github.io/2024/07/29/%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81/" title="背包密码">https://dexterjie.github.io/2024/07/29/背包密码/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/07/26/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/RSA1/" rel="prev" title="RSA部分题型收集">
                  <i class="fa fa-chevron-left"></i> RSA部分题型收集
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/08/06/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/SRCTF/" rel="next" title="SRCTF">
                  SRCTF <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DexterJie</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">298k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">18:03</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->


    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
<div class="busuanzi-count">
  <script async src="/js/busuanzi.pure.mini.js"></script>
  
  <span class="site-uv" title="总访客量">
    访客量<span id="busuanzi_value_site_uv"></span>
  </span>

  <span class="site-pv" title="总访问量">
    经过<span id="busuanzi_value_site_pv"></span>次回眸与你相遇
  </span>
</div>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"waline-five-mocha.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"locale":null,"placeholder":"请文明评论呀","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2024/07/29/%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right"},"mobile":{"show":true}});</script></body>

</html>
