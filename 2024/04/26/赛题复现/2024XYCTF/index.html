<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/0.jpg">
  <link rel="mask-icon" href="/images/0.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dexterjie.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="记录2024XYCTF——Crypto题解">
<meta property="og:type" content="article">
<meta property="og:title" content="2024XYCTF">
<meta property="og:url" content="https://dexterjie.github.io/2024/04/26/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024XYCTF/index.html">
<meta property="og:site_name" content="DexterJie&#39;Blog">
<meta property="og:description" content="记录2024XYCTF——Crypto题解">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/17.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/output.bmp">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/19.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/20.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/21.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/22.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/23.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/24.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/25.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/26.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/27.png">
<meta property="og:image" content="https://dexterjie.github.io/images/TPCTF/29.png">
<meta property="article:published_time" content="2024-04-26T08:40:14.000Z">
<meta property="article:modified_time" content="2024-04-28T10:48:20.169Z">
<meta property="article:author" content="DexterJie">
<meta property="article:tag" content="Wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dexterjie.github.io/images/TPCTF/17.png">


<link rel="canonical" href="https://dexterjie.github.io/2024/04/26/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024XYCTF/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dexterjie.github.io/2024/04/26/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024XYCTF/","path":"2024/04/26/赛题复现/2024XYCTF/","title":"2024XYCTF"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>2024XYCTF | DexterJie'Blog</title>
  







<link rel="dns-prefetch" href="waline-five-mocha.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DexterJie'Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Never Mind the Scandal and Liber!!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1456890009&auto=1&height=66"></iframe>
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Crypto"><span class="nav-number">1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Sign1n-%E7%AD%BE%E5%88%B0"><span class="nav-number">1.1.</span> <span class="nav-text">Sign1n[签到]</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#happy-to-solve1"><span class="nav-number">1.2.</span> <span class="nav-text">happy_to_solve1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#happy-to-solve2"><span class="nav-number">1.3.</span> <span class="nav-text">happy_to_solve2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#happy-to-solve3"><span class="nav-number">1.4.</span> <span class="nav-text">happy_to_solve3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#factor1"><span class="nav-number">1.5.</span> <span class="nav-text">factor1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#factor3"><span class="nav-number">1.6.</span> <span class="nav-text">factor3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#babyRSAMAX"><span class="nav-number">1.7.</span> <span class="nav-text">babyRSAMAX</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x0y"><span class="nav-number">1.8.</span> <span class="nav-text">x0y</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Complex-dlp"><span class="nav-number">1.9.</span> <span class="nav-text">Complex_dlp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E6%96%B9%E5%90%91%E7%9A%84%E5%AF%86%E7%A0%81-%E7%9B%B8%E6%80%9D"><span class="nav-number">1.10.</span> <span class="nav-text">反方向的密码 相思</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E6%96%B9%E5%90%91%E7%9A%84%E5%AF%86%E7%A0%81-%E6%83%85%E9%9A%BE"><span class="nav-number">1.11.</span> <span class="nav-text">反方向的密码 情难</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E7%94%9F%E4%B9%8B%E6%88%91%E8%A6%81%E5%BD%93oi%E7%88%B7-pro"><span class="nav-number">1.12.</span> <span class="nav-text">重生之我要当oi爷 pro</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fakeRSA"><span class="nav-number">1.13.</span> <span class="nav-text">fakeRSA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#random-rr"><span class="nav-number">1.14.</span> <span class="nav-text">random_rr</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Complex-RSA"><span class="nav-number">1.15.</span> <span class="nav-text">Complex_RSA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#easy-ecc"><span class="nav-number">1.16.</span> <span class="nav-text">easy_ecc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LCG-and-HNP"><span class="nav-number">1.17.</span> <span class="nav-text">LCG_and_HNP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#new-LCG"><span class="nav-number">1.18.</span> <span class="nav-text">new_LCG</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%82p"><span class="nav-number">1.18.1.</span> <span class="nav-text">求p</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%82q"><span class="nav-number">1.18.2.</span> <span class="nav-text">求q</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%93%9C%E5%8C%A0"><span class="nav-number">1.19.</span> <span class="nav-text">铜匠</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#part1"><span class="nav-number">1.19.1.</span> <span class="nav-text">part1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part2"><span class="nav-number">1.19.2.</span> <span class="nav-text">part2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part3"><span class="nav-number">1.19.3.</span> <span class="nav-text">part3</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Misc"><span class="nav-number">2.</span> <span class="nav-text">Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%86%8A%E5%8D%9A%E5%A3%AB"><span class="nav-number">2.1.</span> <span class="nav-text">熊博士</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#game"><span class="nav-number">2.2.</span> <span class="nav-text">game</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Re"><span class="nav-number">3.</span> <span class="nav-text">Re</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%96%B5%E5%96%B5%E5%96%B5%E7%9A%84flag%E7%A2%8E%E4%BA%86%E4%B8%80%E5%9C%B0"><span class="nav-number">3.1.</span> <span class="nav-text">喵喵喵的flag碎了一地</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%81%AA%E6%98%8E%E7%9A%84%E4%BF%A1%E4%BD%BF"><span class="nav-number">3.2.</span> <span class="nav-text">聪明的信使</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="DexterJie"
      src="/images/0.jpg">
  <p class="site-author-name" itemprop="name">DexterJie</p>
  <div class="site-description" itemprop="description">一枚只会Crypto的菜鸡</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">72</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dexterjie.github.io/2024/04/26/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024XYCTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/0.jpg">
      <meta itemprop="name" content="DexterJie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DexterJie'Blog">
      <meta itemprop="description" content="一枚只会Crypto的菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="2024XYCTF | DexterJie'Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2024XYCTF
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-26 16:40:14" itemprop="dateCreated datePublished" datetime="2024-04-26T16:40:14+08:00">2024-04-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-28 18:48:20" itemprop="dateModified" datetime="2024-04-28T18:48:20+08:00">2024-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Wp/" itemprop="url" rel="index"><span itemprop="name">Wp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2024/04/26/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024XYCTF/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2024/04/26/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024XYCTF/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>27 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>记录2024XYCTF——Crypto题解</p>
<span id="more"></span>

<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Sign1n-签到"><a href="#Sign1n-签到" class="headerlink" title="Sign1n[签到]"></a>Sign1n[签到]</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">flag=<span class="string">b&#x27;XYCTF&#123;uuid&#125;&#x27;</span></span><br><span class="line">flag=bytes_to_long(flag)</span><br><span class="line">leak=<span class="built_in">bin</span>(<span class="built_in">int</span>(flag))</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    leak += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(leak) == <span class="number">514</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">swap_bits</span>(<span class="params">input_str</span>):</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str[<span class="number">2</span>:])</span><br><span class="line">    length = <span class="built_in">len</span>(input_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length // <span class="number">2</span>):</span><br><span class="line">        temp = input_list[i]</span><br><span class="line">        input_list[i] = input_list[length - <span class="number">1</span> - i]</span><br><span class="line">        input_list[length - <span class="number">1</span> - i] = temp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line"></span><br><span class="line">input_str = leak</span><br><span class="line">result = swap_bits(input_str)</span><br><span class="line">a=result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_add</span>(<span class="params">input_str</span>):</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str)</span><br><span class="line">    length = <span class="built_in">len</span>(input_list)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        input_list[i] = <span class="built_in">str</span>((<span class="built_in">int</span>(input_list[i]) + i + <span class="number">1</span>) % <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input_str = a</span><br><span class="line">result = custom_add(input_str)</span><br><span class="line">b=result</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment">#12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567891134567789112455679912235677900123557889112356679001245568890233457780113355689901335667991134457889122355788001345578891133566790113445688902335578800124456899022346779902344567991223557880013445689911245667801134456799122355788001344578891223467799112455678912235667900123556899022346779001245578801233467789112355779912234577990233556780113</span></span><br></pre></td></tr></table></figure>

<p>关键在于</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">custom_add</span>(<span class="params">input_str</span>):</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str)</span><br><span class="line">    length = <span class="built_in">len</span>(input_list)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        input_list[i] = <span class="built_in">str</span>((<span class="built_in">int</span>(input_list[i]) + i + <span class="number">1</span>) % <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p>这个<code>i+1</code>我们能控制，只需要爆破一下<code>input_list[i]</code>即可，求出后把多余的0去掉即可</p>
<p>因为flag括号内是uuid形式，所以flag长度为43，转成int类型大概343或344bit</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="string">&quot;12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567891134567789112455679912235677900123557889112356679001245568890233457780113355689901335667991134457889122355788001345578891133566790113445688902335578800124456899022346779902344567991223557880013445689911245667801134456799122355788001344578891223467799112455678912235667900123556899022346779001245578801233467789112355779912234577990233556780113&quot;</span></span><br><span class="line"></span><br><span class="line">c = <span class="built_in">list</span>(c)</span><br><span class="line"></span><br><span class="line">m = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">    idx = i+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (idx + <span class="number">0</span>) % <span class="number">10</span> == <span class="built_in">int</span>(c[i]):</span><br><span class="line">        m += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (idx + <span class="number">1</span>) % <span class="number">10</span> == <span class="built_in">int</span>(c[i]):</span><br><span class="line">        m += <span class="string">&quot;1&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">swap_bits</span>(<span class="params">input_str</span>):</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str[<span class="number">2</span>:])</span><br><span class="line">    length = <span class="built_in">len</span>(input_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length // <span class="number">2</span>):</span><br><span class="line">        temp = input_list[i]</span><br><span class="line">        input_list[i] = input_list[length - <span class="number">1</span> - i]</span><br><span class="line">        input_list[length - <span class="number">1</span> - i] = temp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line"></span><br><span class="line">mm = swap_bits(m)</span><br><span class="line"><span class="comment"># print(mm)</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">int</span>(mm[:<span class="number">343</span>],<span class="number">2</span>))[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;cbd30ec3-469c-49bb-b757-354edbc1474d&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="happy-to-solve1"><a href="#happy-to-solve1" class="headerlink" title="happy_to_solve1"></a>happy_to_solve1</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_happy_prime</span>():</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = sympy.nextprime(p ^ ((<span class="number">1</span> &lt;&lt; <span class="number">512</span>) - <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p, q = get_happy_prime()</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line"><span class="comment"># 24852206647750545040640868093921252282805229864862413863025873203291042799096787789288461426555716785288286492530194901130042940279109598071958012303179823645151637759103558737126271435636657767272703908384802528366090871653024192321398785017073393201385586868836278447340624427705360349350604325533927890879</span></span><br><span class="line"><span class="comment"># 14767985399473111932544176852718061186100743117407141435994374261886396781040934632110608219482140465671269958180849886097491653105939368395716596413352563005027867546585191103214650790884720729601171517615620202183534021987618146862260558624458833387692782722514796407503120297235224234298891794056695442287</span></span><br></pre></td></tr></table></figure>

<p><code>q = sympy.nextprime(p ^ ((1 &lt;&lt; 512) - 1))</code>，说明$p+q \approx 2^{512}$</p>
<p>然后用费马分解法加简单爆破即可</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">24852206647750545040640868093921252282805229864862413863025873203291042799096787789288461426555716785288286492530194901130042940279109598071958012303179823645151637759103558737126271435636657767272703908384802528366090871653024192321398785017073393201385586868836278447340624427705360349350604325533927890879</span></span><br><span class="line">c = <span class="number">14767985399473111932544176852718061186100743117407141435994374261886396781040934632110608219482140465671269958180849886097491653105939368395716596413352563005027867546585191103214650790884720729601171517615620202183534021987618146862260558624458833387692782722514796407503120297235224234298891794056695442287</span></span><br><span class="line"></span><br><span class="line">tmp = gmpy2.iroot((<span class="number">2</span>**<span class="number">1024</span>-<span class="number">4</span>*n),<span class="number">2</span>)[<span class="number">0</span>]		<span class="comment"># p-q</span></span><br><span class="line">p = (tmp + <span class="number">2</span>**<span class="number">512</span>) // <span class="number">2</span>						<span class="comment"># p+q = 2**512</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    p = gmpy2.next_prime(p)</span><br><span class="line">    <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">        q = n // p</span><br><span class="line">        d = gmpy2.invert(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">        m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># XYCTF&#123;3f22f4efe3bbbc71bbcc999a0a622a1a23303cdc&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="happy-to-solve2"><a href="#happy-to-solve2" class="headerlink" title="happy_to_solve2"></a>happy_to_solve2</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_happy_prime</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        p = <span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join([random.choice(<span class="string">&quot;123&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>)]))</span><br><span class="line">        q = <span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join([random.choice(<span class="string">&quot;567&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>)]))</span><br><span class="line">        <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">            <span class="keyword">return</span> (p,q)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p ,q= get_happy_prime()</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line"><span class="comment"># 697906506747097082736076931509594586899561519277373830451275402914416296858960649459482027106166486723487162428522597262774248272216088755005277069446993003521270487750989061229071167729138628583207229945902389632065500739730301375338674342457656803764567184544685006193130563116558641331897204457729877920989968662546183628637193220770495938729301979912328865798266631957128761871326655572836258178871966196973138373358029531478246243442559418904559585334351259080578222274926069834941166567112522869638854253933559832822899069320370733424453856240903784235604251466010104012061821038897933884352804297256364409157501116832788696434711523621632436970698827611375698724661553712549209133526623456888111161142213830821361143023186927163314212097199831985368310770663850851571934739809387798422381702174820982531508641022827776262236373967579266271031713520262606203067411268482553539580686495739014567368858613520107678565628269250835478345171330669316220473129104495659093134763261751546990704365966783697780787341963138501</span></span><br><span class="line"><span class="comment"># 15338382608510229658123853967766869664415614805902686881375901510613913129713509783166104849307940522697222249215135610575923574950232430304703734941070902115225531542928076063911372434583653208797091845335372309055445058165793084767493022611384017236866283875644636448297709247897983820939676127932653341969905620998372184248499615002540300964465367892802586144532471541989379701587554152559013584302731232223608558157145208447726258296697270257713690438574144387052720564087444661641391723126013336422724892849257461024888113736420491400141226974046185174788335541496849927294459007162322360350169800422775333555264671556780282575579959795540922800428473974374953127083308485011357471204122489604452529259126463745279715109880260418631172459745078052014041370469737420965336996945150162758346789316041278073257508584646728913492088678995233817419320223417529965268756023259321213169345696631867084360523895872412636818528970356359147704910553852824463243486996533372269183746259112837981658272336703967402861994705714454</span></span><br></pre></td></tr></table></figure>

<p>p由<code>1,2,3</code>构成，q由<code>5,6,7</code>构成，写个深搜就行</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">697906506747097082736076931509594586899561519277373830451275402914416296858960649459482027106166486723487162428522597262774248272216088755005277069446993003521270487750989061229071167729138628583207229945902389632065500739730301375338674342457656803764567184544685006193130563116558641331897204457729877920989968662546183628637193220770495938729301979912328865798266631957128761871326655572836258178871966196973138373358029531478246243442559418904559585334351259080578222274926069834941166567112522869638854253933559832822899069320370733424453856240903784235604251466010104012061821038897933884352804297256364409157501116832788696434711523621632436970698827611375698724661553712549209133526623456888111161142213830821361143023186927163314212097199831985368310770663850851571934739809387798422381702174820982531508641022827776262236373967579266271031713520262606203067411268482553539580686495739014567368858613520107678565628269250835478345171330669316220473129104495659093134763261751546990704365966783697780787341963138501</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">153383826085102296581238539677668696644156148059026868813759015106139131297135097831661048493079405226972222492151356105759235749502324303047037349410709021152255315429280760639113724345836532087970918453353723090554450581657930847674930226113840172368662838756446364482977092478979838209396761279326533419699056209983721842484996150025403009644653678928025861445324715419893797015875541525590135843027312322236085581571452084477262582966972702577136904385741443870527205640874446616413917231260133364227248928492574610248881137364204914001412269740461851747883355414968499272944590071623223603501698004227753335552646715567802825755799597955409228004284739743749531270833084850113574712041224896044525292591264637452797151098802604186311724597450780520140413704697374209653369969451501627583467893160412780732575085846467289134920886789952338174193202234175299652687560232593212131693456966318670843605238958724126368185289703563591477049105538528244632434869965333722691837462591128379816582723367039674028619947057144546</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findp</span>(<span class="params">p,q</span>):</span><br><span class="line">    l = <span class="built_in">len</span>(p)</span><br><span class="line">    <span class="keyword">if</span> l == <span class="number">512</span> <span class="keyword">and</span> n % <span class="built_in">int</span>(p) == <span class="number">0</span>:</span><br><span class="line">        q = n // <span class="built_in">int</span>(p)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line">        d = gmpy2.invert(e,(<span class="built_in">int</span>(p)-<span class="number">1</span>)*(<span class="built_in">int</span>(q)-<span class="number">1</span>))</span><br><span class="line">        m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        table1 = [<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>]</span><br><span class="line">        table2 = [<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;7&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> table1:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> table2:</span><br><span class="line">                pp = <span class="built_in">int</span>(i + p)</span><br><span class="line">                qq = <span class="built_in">int</span>(j + q)</span><br><span class="line">                <span class="keyword">if</span> pp * qq % <span class="number">10</span>**l == n % <span class="number">10</span>**l:</span><br><span class="line">                    findp(i+p,j+q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># findp(&#x27;1&#x27;,&#x27;5&#x27;)</span></span><br><span class="line"><span class="comment"># findp(&#x27;1&#x27;,&#x27;7&#x27;)</span></span><br><span class="line"><span class="comment"># findp(&#x27;3&#x27;,&#x27;5&#x27;)</span></span><br><span class="line">findp(<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;7&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>素数最低位只可能是奇数，只需要考虑<code>1,5</code>,<code>1,7</code>,<code>3,5</code>,<code>3,7</code>即可</p>
<h2 id="happy-to-solve3"><a href="#happy-to-solve3" class="headerlink" title="happy_to_solve3"></a>happy_to_solve3</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">n = <span class="number">1024</span></span><br><span class="line">rho = <span class="number">2</span></span><br><span class="line">gamma = <span class="number">0.352</span></span><br><span class="line">delta = (<span class="number">1</span> - gamma) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_happy_prime</span>():</span><br><span class="line">    p = getPrime(n // <span class="number">2</span>)</span><br><span class="line">    q = getPrime(n // <span class="number">2</span>)</span><br><span class="line">    N = p * q</span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * q - p &gt; gmpy2.iroot(N, <span class="number">3</span>)[<span class="number">0</span>] <span class="keyword">and</span> <span class="number">2</span> * q - p &lt; <span class="built_in">int</span>(N**gamma / <span class="number">16</span>):</span><br><span class="line">        d = random.randint(<span class="built_in">int</span>(N ** (delta - <span class="number">0.001</span>)), <span class="built_in">int</span>(N**delta))</span><br><span class="line">        e = gmpy2.invert(d, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> N, e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N, e = get_happy_prime()</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="built_in">print</span>(N)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, N))</span><br><span class="line"><span class="comment"># 262520792590557046276663232446026434827811478251833823563978322470880473096166170973396967071440576532100045206129176936699321058518888771220060450723297988984995658582283884954240129867538637146924315603797818982078845855992582229939200744016516540207525916858674450616913948112117516831530578235916528257187</span></span><br><span class="line"><span class="comment"># 202935305174706906986376186864051444100197589482194720650385604617995167023220940138899902073948844285283834058445151666398192104922822110762965750590312021079147170573038600118139119881722125346545331027913695559130179278058419339157557267195396326664433859683010193688491694572425231599139974726246205888139</span></span><br><span class="line"><span class="comment"># 66173406204647583141174847814283540389326401056490970592017577810775087017197392456634167609680060931553017712058528056769618111925816921272571306246667527546366331057781905353553621522209713637253380859235235590286779517552635935384231694255450099095196595516174794966487058693308544109311774074970769293357</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第一感觉是出自某论文，关键词<code>&quot;RSA&quot; &quot;d &lt; n^0.324&quot;</code>，搜到名为<code>Revisiting Wiener’s Attack – New Weak Keys in RSA</code>的论文</p>
<p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2008/228.pdf">228.pdf (iacr.org)</a>，根据题目条件，定位到论文的<strong>Proposition 2</strong>，就是把$\frac{e}{n-\lceil\frac{3}{\sqrt{2}}\sqrt{n}\rceil+1}$作为$\frac{k}{d}$的收敛子</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">262520792590557046276663232446026434827811478251833823563978322470880473096166170973396967071440576532100045206129176936699321058518888771220060450723297988984995658582283884954240129867538637146924315603797818982078845855992582229939200744016516540207525916858674450616913948112117516831530578235916528257187</span></span><br><span class="line">e = <span class="number">202935305174706906986376186864051444100197589482194720650385604617995167023220940138899902073948844285283834058445151666398192104922822110762965750590312021079147170573038600118139119881722125346545331027913695559130179278058419339157557267195396326664433859683010193688491694572425231599139974726246205888139</span></span><br><span class="line">c = <span class="number">66173406204647583141174847814283540389326401056490970592017577810775087017197392456634167609680060931553017712058528056769618111925816921272571306246667527546366331057781905353553621522209713637253380859235235590286779517552635935384231694255450099095196595516174794966487058693308544109311774074970769293357</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 227356514376456085145407643699497785267575964192664414706015618659113920770516068763728136578026699605165351438105331282008556258187994169710089246109279146381472361264666736466411449942059568093916061632275622633234439324940363916123064654025553033995485190281219787597633737574334427577414563344330427377471759256645329</span></span><br><span class="line"><span class="comment"># e = 85356738187677927267094758044990579754357485762742350715347494115752841684037367619580505169859555149633498979366195155524089607956973186706608891521632808424477556097376663853312064312353402461172064273993869764933453316151177386412753448356073872108358709307048969215446586611896268736369229047317637983628682308907311</span></span><br><span class="line">n_2 = sqrt(n)</span><br><span class="line"></span><br><span class="line">temp = <span class="built_in">int</span>(n_2 * <span class="number">3</span> / sqrt(<span class="number">2</span>)) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">phi = n - temp + <span class="number">1</span></span><br><span class="line">cf = continued_fraction(e / phi)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    k = cf.numerator(i)</span><br><span class="line">    d = cf.denominator(i)</span><br><span class="line">    <span class="keyword">if</span> (e*d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(d)</span><br><span class="line">        m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line">       	<span class="comment"># XYCTF&#123;68f1880cdafd99fbf9a156946cb39dd86477886f1d115636e149e12c16f99af0&#125;</span></span><br></pre></td></tr></table></figure>

<p>开根号建议用<code>sqrt</code>，别用<code>gmpy2.iroot</code></p>
<h2 id="factor1"><a href="#factor1" class="headerlink" title="factor1"></a>factor1</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">d = getPrime(<span class="number">512</span>)</span><br><span class="line">e = gmpy2.invert(d, (p**<span class="number">3</span> - <span class="number">1</span>) * (q**<span class="number">3</span> - <span class="number">1</span>))</span><br><span class="line">flag = <span class="string">&quot;XYCTF&#123;&quot;</span> + hashlib.md5(<span class="built_in">str</span>(p + q).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(p * q)</span><br><span class="line"><span class="comment"># 172005065945326769176157335849432320425605083524943730546805772515111751580759726759492349719668775270727323745284785341119685198468883978645793770975366048506237371435027612758232099414404389043740306443065413069994232238075194102578269859784981454218948784071599231415554297361219709787507633404217550013282713899284609273532223781487419770338416653260109238572639243087280632577902857385265070736208291583497988891353312351322545840742380550393294960815728021248513046077985900158814037534487146730483099151396746751774427787635287611736111679074330407715700153025952858666841328055071403960165321273972935204988906850585454805923440635864200149694398767776539993952528995717480620593326867245714074205285828967234591508039849777840636255379730281105670496110061909219669860172557450779495125345533232776767292561378244884362014224844319802810586344516400297830227894063759083198761120293919537342405893653545157892446163</span></span><br><span class="line"><span class="comment"># 99075185389443078008327214328328747792385153883836599753096971412377366865826254033534293886034828804219037466246175526347014045811852531994537520303063113985486063022444972761276531422538694915030159420989401280012025249129111871649831185047820236417385693285461420040134313833571949090757635806658958193793</span></span><br></pre></td></tr></table></figure>

<p>$$<br>\because ed \equiv 1 \mod (p^3-1)(q^3 - 1)<br>$$</p>
<p>$$<br>\therefore ed &#x3D; k(p^3-1)(q^3-1) + 1<br>$$</p>
<p>$p^3 - 1\approx p^3$，$q^3-1\approx q^3$<br>$$<br>\therefore ed &#x3D; kn^3 + 1<br>$$<br>同除$d\times n^3$有<br>$$<br>\frac{e}{n^3} &#x3D; \frac{k}{d} + \frac{1}{d\times n^3}<br>$$<br>即<br>$$<br>\frac{e}{n^3} \approx \frac{k}{d}<br>$$<br>连分数展开求得$(p^3-1)(q^3-1)$</p>
<p>然后联立$n &#x3D; p\times q$解方程即可</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">99075185389443078008327214328328747792385153883836599753096971412377366865826254033534293886034828804219037466246175526347014045811852531994537520303063113985486063022444972761276531422538694915030159420989401280012025249129111871649831185047820236417385693285461420040134313833571949090757635806658958193793</span></span><br><span class="line">e = <span class="number">172005065945326769176157335849432320425605083524943730546805772515111751580759726759492349719668775270727323745284785341119685198468883978645793770975366048506237371435027612758232099414404389043740306443065413069994232238075194102578269859784981454218948784071599231415554297361219709787507633404217550013282713899284609273532223781487419770338416653260109238572639243087280632577902857385265070736208291583497988891353312351322545840742380550393294960815728021248513046077985900158814037534487146730483099151396746751774427787635287611736111679074330407715700153025952858666841328055071403960165321273972935204988906850585454805923440635864200149694398767776539993952528995717480620593326867245714074205285828967234591508039849777840636255379730281105670496110061909219669860172557450779495125345533232776767292561378244884362014224844319802810586344516400297830227894063759083198761120293919537342405893653545157892446163</span></span><br><span class="line"></span><br><span class="line">cf = continued_fraction(Integer(e) / Integer(n^<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in trange(2,2000):</span></span><br><span class="line"><span class="comment">#     k = int(cf.numerator(i))       #取连分数的分子</span></span><br><span class="line"><span class="comment">#     d = int(cf.denominator(i))</span></span><br><span class="line"><span class="comment">#     if (e*d - 1)%k == 0:</span></span><br><span class="line"><span class="comment">#         print(f&quot;k = &#123;k&#125;&quot;)</span></span><br><span class="line"><span class="comment">#         print(f&quot;d = &#123;d&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">k = <span class="number">1494016303704162064457264904035459059241052443477469129020991127731711502975536480528822831565100775167693515363479900721259984367515846296462994230670260</span></span><br><span class="line">d = <span class="number">8447122254265361577759220083550460887840558233627984117576685838469227480934556534673167325385487344741530262745308367064419215281251764917289925433582347</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># phi = (e * d - 1) // k</span></span><br><span class="line"><span class="comment"># f1 = (p^3 - 1)*(q^3 - 1) == phi</span></span><br><span class="line"><span class="comment"># f2 = p*q == n</span></span><br><span class="line"><span class="comment"># res = solve([f1,f2],[p,q])</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">9212046353930376594996890089494718736894378991991381248242532319628627449681664076081705664941905594411935750003102856235503684466394327681725704255564467</span></span><br><span class="line">q = <span class="number">10754959493573546439510276829300246769373124436128170955050379041986504869221750743052397622171703140881050431144683659643071578143360949942206693325622779</span></span><br><span class="line">flag = <span class="string">&quot;XYCTF&#123;&quot;</span> + hashlib.md5(<span class="built_in">str</span>(p + q).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;a83211a70e18145a59671c08ddc67ba4&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="factor3"><a href="#factor3" class="headerlink" title="factor3"></a>factor3</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;XYCTF&#123;*****&#125;&#x27;</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gainPrime</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x = random.getrandbits(<span class="number">256</span>)</span><br><span class="line">        y = random.getrandbits(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> y % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        p = x ** <span class="number">3</span> + <span class="number">3</span> * y ** <span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> p.bit_length() == <span class="number">768</span> <span class="keyword">and</span> p % <span class="number">2</span> == <span class="number">1</span> <span class="keyword">and</span> isPrime(p):</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">p, q = gainPrime(), gainPrime()</span><br><span class="line">N = p * q</span><br><span class="line">phi = (p ** <span class="number">2</span> + p + <span class="number">1</span>) * (q ** <span class="number">2</span> + q + <span class="number">1</span>)</span><br><span class="line">d = getPrime(<span class="number">320</span>)</span><br><span class="line">e = inverse(d, phi)</span><br><span class="line">c = d**<span class="number">2</span>^m</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;N: <span class="subst">&#123;N&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c: <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">N: <span class="number">913125842482770239379848062277162627509794409924607555622246822717218133091223291889541294440266178282194506242444509803611492259403578922020590849630191477864719052980160940803309686069818208833547621252544423652489179493083138385424424384165228024273745733240109761707533778691158938848158094054261174692601673435971526522219273943464877956131040249169850420336023942653021547841666224446678539579529590840999008107782784268926145671962239929431694391039559247</span></span><br><span class="line">e: <span class="number">494518390582436635999115147756676313570637682518235195828939117782099618734167908630788943568232122157772909140885391963441876427590731524706959546524212914108888799081844320513851526790475333924396837458796755678072486028072639014677580265244176441153444956871730684233063789931539669072735599696830757690822185323538738397827461580678488181113667710378657058297572328491762536595872579603698945272140918157163640403488075948987156585480146162739943419183496337465468187233821931312507662218106713861638334075899266373256620752680354704533272722692596941861606161634082613228896420520465402725359166156632884432690715903666803067996854084671477445131853993177110154928274312496230096270510089973592664248613332000290545537840595645944390047611474888693558676781309912289044962293014118087259307560444929227407113819165713213046898243995956550944640168932947118400215917515277554126694376415569909534496134700668701465649939</span></span><br><span class="line">c: <span class="number">4450931337369461482106945992542133557585962894030505065110870389112565329875502952762182372926117037373210509516570958483606566274369840551132381128665744266165792377925899683228751870742727716</span></span><br></pre></td></tr></table></figure>

<p>参考论文：<a target="_blank" rel="noopener" href="https://eprint.iacr.org/2021/1160.pdf">1160.pdf (iacr.org)</a></p>
<p><img src="/../../images/TPCTF/17.png" alt="17"></p>
<p>攻击条件是：$ed \equiv 1 \mod (p^2+p+1)(q^2+q+1)$，$e &#x3D; N^{\alpha},\frac{3}{2}&lt;\alpha&lt;\frac{5}{2}$，$d &#x3D; N^{\delta},\delta &lt; \frac{5}{4} -\frac{1}{2}\alpha$</p>
<p>本题$\alpha \approx 1.999$，$\delta &#x3D; 0.208$，满足式子$\delta &lt; \frac{5}{4}-\frac{1}{2}\alpha$</p>
<p>只需要把$\phi(n_0)$用论文中提到的式子代替，然后连分数展开，我们就可以得到d</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">913125842482770239379848062277162627509794409924607555622246822717218133091223291889541294440266178282194506242444509803611492259403578922020590849630191477864719052980160940803309686069818208833547621252544423652489179493083138385424424384165228024273745733240109761707533778691158938848158094054261174692601673435971526522219273943464877956131040249169850420336023942653021547841666224446678539579529590840999008107782784268926145671962239929431694391039559247</span></span><br><span class="line">e = <span class="number">494518390582436635999115147756676313570637682518235195828939117782099618734167908630788943568232122157772909140885391963441876427590731524706959546524212914108888799081844320513851526790475333924396837458796755678072486028072639014677580265244176441153444956871730684233063789931539669072735599696830757690822185323538738397827461580678488181113667710378657058297572328491762536595872579603698945272140918157163640403488075948987156585480146162739943419183496337465468187233821931312507662218106713861638334075899266373256620752680354704533272722692596941861606161634082613228896420520465402725359166156632884432690715903666803067996854084671477445131853993177110154928274312496230096270510089973592664248613332000290545537840595645944390047611474888693558676781309912289044962293014118087259307560444929227407113819165713213046898243995956550944640168932947118400215917515277554126694376415569909534496134700668701465649939</span></span><br><span class="line">c = <span class="number">4450931337369461482106945992542133557585962894030505065110870389112565329875502952762182372926117037373210509516570958483606566274369840551132381128665744266165792377925899683228751870742727716</span></span><br><span class="line"></span><br><span class="line">n_2 = sqrt(n)</span><br><span class="line">temp = <span class="number">0.5</span>*(n + n_2 + <span class="number">1</span>)^<span class="number">2</span> + <span class="number">0.5</span>*(n + <span class="number">0.75</span>*sqrt(<span class="number">2</span>)*n_2 + <span class="number">1</span>)^<span class="number">2</span> + <span class="number">0.1875</span>*n</span><br><span class="line"></span><br><span class="line">cf = continued_fraction(e / temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    k = cf.numerator(i)</span><br><span class="line">    d = cf.denominator(i)</span><br><span class="line">    <span class="keyword">if</span> (e*d - <span class="number">1</span>) % k == <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">int</span>(d).bit_length() == <span class="number">320</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;k = <span class="subst">&#123;k&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;d = <span class="subst">&#123;d&#125;</span>&quot;</span>)</span><br><span class="line">        m = c ^^ d^<span class="number">2</span></span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line">        <span class="comment"># XYCTF&#123;I_love_to_read_the_crypto_paper_and_try_to_ak_them&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="babyRSAMAX"><a href="#babyRSAMAX" class="headerlink" title="babyRSAMAX"></a>babyRSAMAX</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;XYCTF&#123;******&#125;&#x27;</span></span><br><span class="line">e = <span class="string">&#x27;?&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getBabyPrime</span>(<span class="params">nbits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> p.bit_length() &lt;= nbits:</span><br><span class="line">            p *= choice(sieve_base)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> isPrime(p+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> p+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">p = getBabyPrime(<span class="number">512</span>)</span><br><span class="line">q = getBabyPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">gift1 = (<span class="built_in">pow</span>(p,e,n)-<span class="built_in">pow</span>(q,e,n)) % n</span><br><span class="line">gift2 = <span class="built_in">pow</span>(p+q,e,n)</span><br><span class="line"></span><br><span class="line">t = <span class="number">65537</span></span><br><span class="line">x = bytes_to_long(e)</span><br><span class="line">y = <span class="built_in">pow</span>(x, t, n)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = powmod(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gift1 = <span class="subst">&#123;gift1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gift2 = <span class="subst">&#123;gift2&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;y = <span class="subst">&#123;y&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 39332423872740210783246069030855946244104982381157166843977599780233911183158560901377359925435092326653303964261550158658551518626014048783435245471536959844874036516931542444719549997971482644905523459407775392702211086149279473784796202020281909706723380472571862792003687423791576530085747716706475220532321</span></span><br><span class="line"><span class="string">gift1 = 4549402444746338327349007235818187793950285105091726167573552412678416759694660166956782755631447271662108564084382098562999950228708300902201571583419116299932264478381197034402338481872937576172197202519770782458343606060544694608852844228400457232100904217062914047342663534138668490328400022651816597367310</span></span><br><span class="line"><span class="string">gift2 = 111061215998959709920736448050860427855012026815376672067601244053580566359594802604251992986382187891022583247997994146019970445247509119719411310760491983876636264003942870756402328634092146799825005835867245563420135253048223898334460067523975023732153230791136870324302259127159852763634051238811969161011462</span></span><br><span class="line"><span class="string">c = 16938927825234407267026017561045490265698491840814929432152839745035946118743714566623315033802681009017695526374397370343984360997903165842591414203197184946588470355728984912522040744691974819630118163976259246941579063687857994193309554129816268931672391946592680578681270693589911021465752454315629283033043</span></span><br><span class="line"><span class="string">y = 1813650001270967709841306491297716908969425248888510985109381881270362755031385564927869313112540534780853966341044526856705589020295048473305762088786992446350060024881117741041260391405962817182674421715239197211274668450947666394594121764333794138308442124114744892164155894256326961605137479286082964520217</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>需要先求e，求e得先把n分解了<br>$$<br>\because gift_1\equiv p^e - q^e \mod n<br>$$</p>
<p>$$<br>gift_2 \equiv (p+q)^e \equiv p^e + q^e \mod n<br>$$</p>
<p>则有<br>$$<br>gift_1 \equiv p^e \mod q<br>$$</p>
<p>$$<br>\therefore gift_2 \equiv p^e \mod q<br>$$</p>
<p>则<code>gcd(gift1 - gift2,n) = q</code></p>
<p>n分解后解出e &#x3D; 4096，一眼12次Rabin，网上找个脚本套用即可</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">39332423872740210783246069030855946244104982381157166843977599780233911183158560901377359925435092326653303964261550158658551518626014048783435245471536959844874036516931542444719549997971482644905523459407775392702211086149279473784796202020281909706723380472571862792003687423791576530085747716706475220532321</span></span><br><span class="line">gift1 = <span class="number">4549402444746338327349007235818187793950285105091726167573552412678416759694660166956782755631447271662108564084382098562999950228708300902201571583419116299932264478381197034402338481872937576172197202519770782458343606060544694608852844228400457232100904217062914047342663534138668490328400022651816597367310</span></span><br><span class="line">gift2 = <span class="number">111061215998959709920736448050860427855012026815376672067601244053580566359594802604251992986382187891022583247997994146019970445247509119719411310760491983876636264003942870756402328634092146799825005835867245563420135253048223898334460067523975023732153230791136870324302259127159852763634051238811969161011462</span></span><br><span class="line">c = <span class="number">16938927825234407267026017561045490265698491840814929432152839745035946118743714566623315033802681009017695526374397370343984360997903165842591414203197184946588470355728984912522040744691974819630118163976259246941579063687857994193309554129816268931672391946592680578681270693589911021465752454315629283033043</span></span><br><span class="line">y = <span class="number">1813650001270967709841306491297716908969425248888510985109381881270362755031385564927869313112540534780853966341044526856705589020295048473305762088786992446350060024881117741041260391405962817182674421715239197211274668450947666394594121764333794138308442124114744892164155894256326961605137479286082964520217</span></span><br><span class="line">t = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">q = gmpy2.gcd(gift1-gift2,n)</span><br><span class="line">p = n // q</span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(t,phi)</span><br><span class="line">e = long_to_bytes(<span class="built_in">pow</span>(y,d,n))</span><br><span class="line"><span class="comment"># XYCTF&#123;e==4096&#125;</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">4096</span></span><br><span class="line"><span class="comment"># print(gmpy2.gcd(e,phi))</span></span><br><span class="line"></span><br><span class="line">inv_p = gmpy2.invert(p, q)</span><br><span class="line">inv_q = gmpy2.invert(q, p)</span><br><span class="line">cs = [c]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    ps = []</span><br><span class="line">    <span class="keyword">for</span> c2 <span class="keyword">in</span> cs:</span><br><span class="line">        r = <span class="built_in">pow</span>(c2, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">        s = <span class="built_in">pow</span>(c2, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line"></span><br><span class="line">        x = (r * inv_q * q + s * inv_p * p) % n</span><br><span class="line">        y = (r * inv_q * q - s * inv_p * p) % n</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> ps:</span><br><span class="line">            ps.append(x)</span><br><span class="line">        <span class="keyword">if</span> n - x <span class="keyword">not</span> <span class="keyword">in</span> ps:</span><br><span class="line">            ps.append(n - x)</span><br><span class="line">        <span class="keyword">if</span> y <span class="keyword">not</span> <span class="keyword">in</span> ps:</span><br><span class="line">            ps.append(y)</span><br><span class="line">        <span class="keyword">if</span> n - y <span class="keyword">not</span> <span class="keyword">in</span> ps:</span><br><span class="line">            ps.append(n - y)</span><br><span class="line">    cs = ps</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> cs:</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line">    <span class="comment"># XYCTF&#123;Rabin_is_so_biggggg!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="x0y"><a href="#x0y" class="headerlink" title="x0y"></a>x0y</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">flag = pad(flag, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt</span>(<span class="params">key, plaintext</span>):</span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> cipher.encrypt(plaintext)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key, plaintext, iv</span>):</span><br><span class="line">    ciphertext = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plaintext), AES.block_size):</span><br><span class="line">        key_block = aes_encrypt(key, iv)</span><br><span class="line">        ciphertext_block = <span class="built_in">bytes</span>(</span><br><span class="line">            [plaintext[i + j] ^ key_block[j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(AES.block_size)]</span><br><span class="line">        )</span><br><span class="line">        ciphertext += ciphertext_block</span><br><span class="line">        iv = key_block</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;1.print\n2.input\n3.exit&quot;</span>)</span><br><span class="line">        a = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> a == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>((iv + encrypt(key, flag, iv)).<span class="built_in">hex</span>())</span><br><span class="line">        <span class="keyword">elif</span> a == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">            ivs = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;iv: &quot;</span>))</span><br><span class="line">            inputs = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;message: &quot;</span>))</span><br><span class="line">            <span class="built_in">print</span>(encrypt(key, inputs, ivs).<span class="built_in">hex</span>())</span><br><span class="line">        <span class="keyword">elif</span> a == <span class="string">&quot;3&quot;</span>:</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;You need input 1,2,3&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>注意到加密的时候是把明文块中每个明文和加密后的iv进行异或</p>
<p>而输入1之后我们是可以得到iv和加密后的flag，输入2可以让我们输入自己的iv和想加密的信息</p>
<p>根据异或的特性只要把iv和密文输入，服务器就会帮我们解密出明文</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;xyctf.top&quot;</span>,port)</span><br><span class="line"></span><br><span class="line">sh.recvline()</span><br><span class="line">sh.recvline()</span><br><span class="line">sh.recvline()</span><br><span class="line">sh.sendlineafter(<span class="string">b&quot;&gt;&quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">msg = sh.recvline().decode().strip()</span><br><span class="line"></span><br><span class="line">iv = msg[:<span class="number">32</span>]</span><br><span class="line">cipher = msg[<span class="number">32</span>:]</span><br><span class="line">sh.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">b&quot;iv:&quot;</span>,iv.encode())</span><br><span class="line">sh.sendlineafter(<span class="string">b&quot;message:&quot;</span>,cipher.encode())</span><br><span class="line">m = sh.recvline().decode().strip()</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">bytes</span>.fromhex(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;eddbb551-df9c-4723-897b-101538b64ea2&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Complex-dlp"><a href="#Complex-dlp" class="headerlink" title="Complex_dlp"></a>Complex_dlp</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        self.re = re</span><br><span class="line">        self.im = im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = self.re * c.re - self.im * c.im</span><br><span class="line">        im_ = self.re * c.im + self.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.im == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(self.re)</span><br><span class="line">        <span class="keyword">elif</span> self.re == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(self.im) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;-&#x27;</span> <span class="keyword">if</span> self.im &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>i&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.im&#125;</span>i&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.re&#125;</span> <span class="subst">&#123;<span class="string">&#x27;+&#x27;</span> <span class="keyword">if</span> self.im &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;-&#x27;</span>&#125;</span> <span class="subst">&#123;<span class="built_in">abs</span>(self.im)&#125;</span>i&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = flag.strip(<span class="string">b&quot;XYCTF&#123;&quot;</span>).strip(<span class="string">b&quot;&#125;&quot;</span>)</span><br><span class="line">p = <span class="number">1127236854942215744482170859284245684922507818478439319428888584898927520579579027</span></span><br><span class="line">g = Complex(<span class="number">3</span>, <span class="number">7</span>)</span><br><span class="line">x = bytes_to_long(flag)</span><br><span class="line"><span class="built_in">print</span>(complex_pow(g, x, p))</span><br><span class="line"><span class="comment"># 5699996596230726507553778181714315375600519769517892864468100565238657988087817 + 198037503897625840198829901785272602849546728822078622977599179234202360717671908i</span></span><br></pre></td></tr></table></figure>

<p>没有接触过复数域dlp，所以第一想法是想着能不能把它转换到实数域，然后用实数域求解离散对数的方法来做</p>
<p>注意到复数的一个性质：</p>
<p>对于复数$a+bi$，它的模为$|a+bi| &#x3D; \sqrt{a^2+b^2}$</p>
<p>而$(a+bi)^2 &#x3D;a^2-b^2 + 2abi$，它的模为$|(a+bi)^2| &#x3D; \sqrt{a^4+b^4-2a^2b^2+4a^2b^2} &#x3D; a^2+b^2$</p>
<p>利用次方和模长的关系，对于本题有<br>$$<br>(3+7i)^x \equiv c_{re} + c_{im}i \mod p<br>$$<br>我们可以把它转换成<br>$$<br>|3+7i|^x \equiv |c_{re}+c_{im}i| \mod p<br>$$<br>可以平方一些，即<br>$$<br>(|3+7i|^2)^x \equiv |c_{re} + c_{im}i|^2 \mod p<br>$$</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">1127236854942215744482170859284245684922507818478439319428888584898927520579579027</span></span><br><span class="line"></span><br><span class="line">g = <span class="number">3</span>^<span class="number">2</span> + <span class="number">7</span>^<span class="number">2</span></span><br><span class="line">a = <span class="number">5699996596230726507553778181714315375600519769517892864468100565238657988087817</span> </span><br><span class="line">b = <span class="number">198037503897625840198829901785272602849546728822078622977599179234202360717671908</span></span><br><span class="line">c = (a^<span class="number">2</span> + b^<span class="number">2</span>) % p</span><br><span class="line"></span><br><span class="line">x = discrete_log(mod(c,p),mod(g,p))</span><br><span class="line">flag = <span class="string">b&quot;XYCTF&#123;&quot;</span> + <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">int</span>(x))[<span class="number">2</span>:]) + <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;___c0mp13x_d1p_15_3@5y_f0r_y0u___&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="反方向的密码-相思"><a href="#反方向的密码-相思" class="headerlink" title="反方向的密码 相思"></a>反方向的密码 相思</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha256(x.encode()).digest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="keyword">return</span> message + <span class="built_in">hash</span>(<span class="built_in">str</span>(<span class="built_in">len</span>(message)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(pad(flag))</span><br><span class="line">p = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">q = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="comment"># 120440199294949712392334113337541924034371176306546446428347114627162894108760435789068328282135879182130546564535108930827440004987170619301799710272329673259390065147556073101312748104743572369383346039000998822862286001416166288971531241789864076857299162050026949096919395896174243383291126202796610039053</span></span><br><span class="line"><span class="comment"># 143413213355903851638663645270518081058249439863120739973910994223793329606595495141951165221740599158773181585002460087410975579141155680671886930801733174300593785562287068287654547100320094291092508723488470015821072834947151827362715749438612812148855627557719115676595686347541785037035334177162406305243</span></span><br></pre></td></tr></table></figure>

<p>填充的信息可以用爆破的方式，相当于m的低位泄露，我们还可以利用上flag的头，这样就是m的高位加低位泄露</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">c = <span class="number">120440199294949712392334113337541924034371176306546446428347114627162894108760435789068328282135879182130546564535108930827440004987170619301799710272329673259390065147556073101312748104743572369383346039000998822862286001416166288971531241789864076857299162050026949096919395896174243383291126202796610039053</span></span><br><span class="line">n = <span class="number">143413213355903851638663645270518081058249439863120739973910994223793329606595495141951165221740599158773181585002460087410975579141155680671886930801733174300593785562287068287654547100320094291092508723488470015821072834947151827362715749438612812148855627557719115676595686347541785037035334177162406305243</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha256(x.encode()).digest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>,<span class="number">40</span>):									<span class="comment">#i代表&#123;&#125;中未知数的个数</span></span><br><span class="line">    prefix = bytes_to_long(<span class="string">b&quot;XYCTF&#123;&quot;</span>) * <span class="number">256</span>^(<span class="number">32</span> + <span class="number">1</span> + i)</span><br><span class="line">    </span><br><span class="line">    pad = <span class="built_in">hash</span>(<span class="built_in">str</span>(i+<span class="number">7</span>))</span><br><span class="line">    low = bytes_to_long(<span class="string">b&quot;&#125;&quot;</span> + pad)</span><br><span class="line">    </span><br><span class="line">    R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    </span><br><span class="line">    f = (prefix + x*<span class="number">256</span>^<span class="number">33</span> + low)^<span class="number">3</span> - c</span><br><span class="line">    f = f.monic()</span><br><span class="line">    res = f.small_roots(X=<span class="number">256</span>^i)</span><br><span class="line">    <span class="keyword">if</span> res != []:</span><br><span class="line">        m = prefix + <span class="built_in">int</span>(res[<span class="number">0</span>])*<span class="number">256</span>^<span class="number">33</span> + low</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>

<p>flag的长度应该比较普通，所以可以适当缩小范围，不过还需要注意flag拼接后的值</p>
<h2 id="反方向的密码-情难"><a href="#反方向的密码-情难" class="headerlink" title="反方向的密码 情难"></a>反方向的密码 情难</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha512(x.encode()).digest() * <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="keyword">return</span> (message[: <span class="built_in">len</span>(message) // <span class="number">2</span>] + <span class="built_in">hash</span>(<span class="built_in">str</span>(<span class="built_in">len</span>(message))) + message[<span class="built_in">len</span>(message) // <span class="number">2</span> :])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">q = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">2</span></span><br><span class="line">m = bytes_to_long(pad(flag))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="comment"># 3335299537518434350008670067273514020883265809787658909900831303201069228111667477512288715627313377374377192065531931991830331266940281529429758933125645068623703704431432931062515459304407129764836169638068667723468109909932687335727824459807903558617156661138991973933280805156893120951135488168923425258119689993859896540097318197048436676318334502053269738046279338047497258783747007084564814994803144049365117574904704816542523015746396519693505167963245600047742456478545640334467678554748227823020862550712083249012329745708139070338928730226897923885785783461594034339595106377701306570280371612953393097739</span></span><br><span class="line"><span class="comment"># 26278624299187148406559772770865336226934633734285979741424867540828670397865189685966828527168795621543490979182417570078991930822041468539855006585233692884235331084907340302530060261742100702658312435180527335101284800616106884692498603300926488358017928867672861988448488439356448543527810620591324774111321619391264173779312033252573140028630441135269056099074531502841259940379636699304810677716177080486265721322966814104627525953974143476452058638927511594884002185219080847495835727300670028011001853179659250270200020884333850083063514830095064730932997593930711871108436386821290545084229347398808220810263</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>记<code>len(flag) = l</code><br>$$<br>flag &#x3D; m_1\times 256^{128 + \frac{l}{2}} + hash \times 256^{\frac{l}{2}} + m_2<br>$$</p>
<p>未知数为$m_1,m_2$，可以用二元copper</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha512(x.encode()).digest() * <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">l,n,c</span>):</span><br><span class="line">    R.&lt;m1,m2&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    pad = bytes_to_long(<span class="built_in">hash</span>(<span class="built_in">str</span>(l)))</span><br><span class="line">    <span class="keyword">if</span> l % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        f = (m1*<span class="number">2</span>^(pad.bit_length() + <span class="number">8</span>*(l // <span class="number">2</span>)+<span class="number">8</span>) + pad*<span class="number">2</span>^(<span class="number">8</span>*(l // <span class="number">2</span>)+<span class="number">8</span>) + m2)^<span class="number">2</span> - c</span><br><span class="line">        res = small_roots(f,bounds=(<span class="number">256</span>^(l//<span class="number">2</span>),<span class="number">256</span>^(l//<span class="number">2</span>+<span class="number">1</span>)),m = <span class="number">1</span>,d=<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">if</span> res != []:</span><br><span class="line">            x,y = res[<span class="number">0</span>]</span><br><span class="line">            m = x *<span class="number">2</span>^(pad.bit_length() + <span class="number">8</span>*(l // <span class="number">2</span>)+<span class="number">8</span>) + pad*<span class="number">2</span>^(<span class="number">8</span>*(l // <span class="number">2</span>)+<span class="number">8</span>) + y</span><br><span class="line">            msg = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">            flag = msg[:l // <span class="number">2</span>] + msg[-(l//<span class="number">2</span> + <span class="number">1</span>):]</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;len(flag) = <span class="subst">&#123;l&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        f = (m1*<span class="number">2</span>^(pad.bit_length() + <span class="number">8</span>*(l // <span class="number">2</span>)) + pad*<span class="number">2</span>^(<span class="number">8</span>*(l // <span class="number">2</span>)) + m2)^<span class="number">2</span> - c</span><br><span class="line">        res = small_roots(f,bounds=(<span class="number">256</span>^(l//<span class="number">2</span>),<span class="number">256</span>^(l//<span class="number">2</span>)),m = <span class="number">1</span>,d=<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">if</span> res != []:</span><br><span class="line">            x,y = res[<span class="number">0</span>]</span><br><span class="line">            m = x *<span class="number">2</span>^(pad.bit_length() + <span class="number">8</span>*(l // <span class="number">2</span>)) + pad*<span class="number">2</span>^(<span class="number">8</span>*(l // <span class="number">2</span>)) + y</span><br><span class="line">            msg = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">            flag = msg[:l // <span class="number">2</span>] + msg[-(l//<span class="number">2</span>):]</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;len(flag) = <span class="subst">&#123;l&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> trange(<span class="number">65</span>,<span class="number">77</span>):</span><br><span class="line">    c = <span class="number">3335299537518434350008670067273514020883265809787658909900831303201069228111667477512288715627313377374377192065531931991830331266940281529429758933125645068623703704431432931062515459304407129764836169638068667723468109909932687335727824459807903558617156661138991973933280805156893120951135488168923425258119689993859896540097318197048436676318334502053269738046279338047497258783747007084564814994803144049365117574904704816542523015746396519693505167963245600047742456478545640334467678554748227823020862550712083249012329745708139070338928730226897923885785783461594034339595106377701306570280371612953393097739</span></span><br><span class="line">    n = <span class="number">26278624299187148406559772770865336226934633734285979741424867540828670397865189685966828527168795621543490979182417570078991930822041468539855006585233692884235331084907340302530060261742100702658312435180527335101284800616106884692498603300926488358017928867672861988448488439356448543527810620591324774111321619391264173779312033252573140028630441135269056099074531502841259940379636699304810677716177080486265721322966814104627525953974143476452058638927511594884002185219080847495835727300670028011001853179659250270200020884333850083063514830095064730932997593930711871108436386821290545084229347398808220810263</span></span><br><span class="line">    attack(l,n,c)</span><br></pre></td></tr></table></figure>

<p>经测试，在二元copper中</p>
<p><code>m=1,d=3</code>，可以有出长度为64的flag，相当于两个界都是$2^{256}$</p>
<p><code>m=1,d=4</code>，可以有出长度为76的flag，相当于两个界都是$2^{304}$</p>
<h2 id="重生之我要当oi爷-pro"><a href="#重生之我要当oi爷-pro" class="headerlink" title="重生之我要当oi爷 pro"></a>重生之我要当oi爷 pro</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">a, b, p</span>):</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)):</span><br><span class="line">        t += <span class="built_in">pow</span>(a, i, p) * b[i] % p</span><br><span class="line">    <span class="keyword">return</span> t % p</span><br><span class="line"></span><br><span class="line">p = <span class="number">1041231053</span></span><br><span class="line"></span><br><span class="line">a = <span class="built_in">open</span>(<span class="string">&quot;flag.png&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">b = <span class="built_in">open</span>(<span class="string">&quot;enc.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    b.write(<span class="built_in">str</span>(i) + <span class="built_in">str</span>(f(i, a, p)) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>题目的意思就是要恢复下面这个多项式的系数<br>$$<br>y_0 \equiv x_0^0b_0 + x_0^1b_1 + … + x_0^nb_n \mod p<br>$$</p>
<p>$$<br>y_1 \equiv x_1^0b_0 + x_1^1b_1 + … + x_1^nb_n \mod p<br>$$</p>
<p>$$<br>\vdots<br>$$</p>
<p>$$<br>y_n \equiv x_n^0b_0 + x_n^1b_1 + … + x_n^nb_n \mod p<br>$$</p>
<p>运用到多项式快速插值的知识，可以参考：<a target="_blank" rel="noopener" href="https://cekavis.github.io/fast-polynomial-evaluation-and-interpolation/">多项式的多点求值和快速插值 - Cekavis’s notes</a></p>
<p>不过这道题来自picoCTF2024的flag_printer，找遍互联网只找到了一个wp<a target="_blank" rel="noopener" href="https://github.com/PetePriority/picoctf-2024">GitHub - PetePriority&#x2F;picoctf-2024: picoCTF 2024 writeups</a></p>
<p>这个exp对于原题需要6-7小时，本题跑了2-3小时就出了</p>
<p><img src="/../../images/TPCTF/output.bmp" alt="output"></p>
<p><code>flag&#123;1A2Q3E71528AP49Q0RT&#125;</code></p>
<h2 id="fakeRSA"><a href="#fakeRSA" class="headerlink" title="fakeRSA"></a>fakeRSA</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;XYCTF&#123;******&#125;&#x27;</span></span><br><span class="line">n = ZZ(bytes_to_long(flag))</span><br><span class="line">p = getPrime(<span class="built_in">int</span>(<span class="number">320</span>))</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line">G = Zmod(p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">function</span>(<span class="params">X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">part</span>(<span class="params">a, b, c</span>):</span><br><span class="line">        <span class="keyword">return</span> vector([<span class="number">9</span> * a - <span class="number">36</span> * c, <span class="number">6</span> * a - <span class="number">27</span> * c, b])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parts</span>(<span class="params">n</span>):</span><br><span class="line">        Gx.&lt;a, b, c&gt; = G[]</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>: <span class="keyword">return</span> vector([a, b, c])</span><br><span class="line">        mid = parts(n // <span class="number">2</span>)</span><br><span class="line">        result = mid(*mid)</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>: <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>: <span class="keyword">return</span> part(*result)</span><br><span class="line">    <span class="keyword">return</span> parts(n)(X, Y, Z)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(function(<span class="number">69</span>, <span class="number">48</span>, <span class="number">52</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#1849790472911267366045392456893126092698743308291512220657006129900961168811898822553602045875909</span></span><br><span class="line"><span class="comment">#(1431995965813617415860695748430644570118959991271395110995534704629241309597572003500157255135707, 1011565891130611736600822618382801465506651972373410962205810570075870804325974377971089090196019, 784497518859893244278116222363814433595961164446277297084989532659832474887622082585456138030246)</span></span><br></pre></td></tr></table></figure>

<p>代码主要实现的是矩阵快速幂，<code>part(a,b,c)</code>可以用矩阵相乘的形式表示：</p>
<p><img src="/../../images/TPCTF/19.png"></p>
<p>而最后可以表示为</p>
<p><img src="/../../images/TPCTF/20.png"></p>
<p><code>an,bn,cn</code>是我们最后得到的值，而<code>a0,b0,c0 = 69,48,52</code></p>
<p>记</p>
<p><img src="/../../images/TPCTF/21.png"></p>
<p>所以本题问题就是：</p>
<p><img src="/../../images/TPCTF/22.png"></p>
<p>不过这个形式不像常规离散对数的形式$c \equiv g^x \mod p$</p>
<p>我们需要把它往这个形式转化，注意到</p>
<p><img src="/../../images/TPCTF/23.png"></p>
<p>我们可以在原式子上添两行，凑出</p>
<p><img src="/../../images/TPCTF/24.png"></p>
<p>因为<code>a0,b0,c0</code>以及<code>an,bn,cn</code>已知，所以补上的两行我们是可以求的</p>
<p>记为$B \equiv A\times L^n \mod p$</p>
<p>我们只需要做一个变换即可求得$L^n \equiv B\times A^{-1}\mod p$，记为$M$，或者通过sagemath解矩阵方程(推荐这个，因为我在乘逆矩阵的时候老是出错)</p>
<p>这个时候我们已知$L,L^n$，就相当于求解$M \equiv L^n \mod p$，不过这个L的形式不容易求离散对数</p>
<p>我们可以把矩阵L转为Jordan标准型(可以参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/517900683">【矩阵论】Jordan 标准型及其求解方法 - 知乎 (zhihu.com)</a>做个了解)，相当于有个矩阵P，使得</p>
<p><img src="/../../images/TPCTF/25.png"></p>
<p>记Jordan标准化后的矩阵为$T$，即$P^{-1}LP &#x3D; T$，则$L &#x3D; PTP^{-1}$</p>
<p>即变为求解$M \equiv (PTP^{-1})^n \equiv PT^nP^{-1} \mod p$，也就是求解$P^{-1}MP^{-1} \equiv T^n \mod p$</p>
<p>因为矩阵T是Jordan标准型，他有这样的形式：</p>
<p><img src="/../../images/TPCTF/26.png"></p>
<p>简单推导可以推断出</p>
<p><img src="/../../images/TPCTF/27.png"></p>
<p>通过这个形式，我们可以很容易计算出$n &#x3D; \frac{nt^{n-1} \times t}{t^n}$，对应$n &#x3D; \frac{T[0][0]\times T^n[0][1]}{T^n[0][0]}$</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">1849790472911267366045392456893126092698743308291512220657006129900961168811898822553602045875909</span></span><br><span class="line">L = Matrix(Zmod(p),[</span><br><span class="line">    [<span class="number">9</span>,<span class="number">6</span>,<span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],</span><br><span class="line">    [-<span class="number">36</span>,-<span class="number">27</span>,<span class="number">0</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">A0 = vector(Zmod(p),[<span class="number">69</span>,<span class="number">48</span>,<span class="number">52</span>])</span><br><span class="line">A1 = A0 * L</span><br><span class="line">A2 = A1 * L</span><br><span class="line">An = vector(Zmod(p),[<span class="number">1431995965813617415860695748430644570118959991271395110995534704629241309597572003500157255135707</span>, <span class="number">1011565891130611736600822618382801465506651972373410962205810570075870804325974377971089090196019</span>, <span class="number">784497518859893244278116222363814433595961164446277297084989532659832474887622082585456138030246</span>])</span><br><span class="line">An1 = An * L</span><br><span class="line">An2 = An1 * L</span><br><span class="line"></span><br><span class="line">A = Matrix(Zmod(p),[A0,A1,A2])</span><br><span class="line">B = Matrix(Zmod(p),[An,An1,An2])</span><br><span class="line">M = A.solve_right(B)                                 <span class="comment"># L^n</span></span><br><span class="line"></span><br><span class="line">L_Jor, P = L.jordan_form(transformation=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">T = L_Jor</span><br><span class="line">Tn = ~P * M * P                                      <span class="comment"># T^n</span></span><br><span class="line"></span><br><span class="line">m = T[<span class="number">0</span>][<span class="number">0</span>] * Tn[<span class="number">0</span>][<span class="number">1</span>] // Tn[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;y0u_finally_f0und_t3h_s3cr3ts!!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="random-rr"><a href="#random-rr" class="headerlink" title="random_rr"></a>random_rr</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line">flag=<span class="string">b&#x27;XYCTF&#123;uuid&#125;&#x27;</span></span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">n = <span class="number">472993274721871037103726599805149366727531552333249750035977291933239067588481589544777397613192273114354221827196579379954069925604091911249655707080927769808587176515295614018992848517984372306879552247519117116110554431341268358177159108949791969262793325836353834899335531293329721598226413212541536002401507477776699642647348576111445702197483449777741566350285229621935507081895389023444249054515395783080003733803406382744631528246608154546123270319561514117323480441428953306734274538511770278887429407127143049023747710881993279361892937905382946820141513009017756811296722630617325141162244806884220212939955235410280899112731530527048274396186038160728562551536558223235783656985493518204710943916486379681906506757757594165379493317173050550893487151879681122510523721157284728808336110950008840684602353984682117748018347433177541603140491131603068512706893984834735290809952944273565203183330739252949245209529232254867201402656024997949207918675051941911990640248052951780195402390132237903538546705181463959793972284823588987652138458328270662652334799233015314673544813649692428544375538627858921763941533600553536579901589575693816746953261108022490849251974419402753031545629158199093099096735356165044275617408697</span></span><br><span class="line">rr = <span class="number">11898141078345200236264081467585899457224809417108457314508072413792599039332439547789237898270544336909458761754683941320649771736625000667170176071314483</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>():</span><br><span class="line">    fw = <span class="built_in">open</span>(<span class="string">&quot;random&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">648</span>):</span><br><span class="line">        fw.write(<span class="built_in">str</span>(random.getrandbits(<span class="number">32</span>))+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    fw.close()</span><br><span class="line"></span><br><span class="line">generate()</span><br><span class="line">key = <span class="built_in">str</span>(random.getrandbits(<span class="number">32</span>))</span><br><span class="line">key1= <span class="built_in">int</span>(<span class="built_in">str</span>(key)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">ks = [randint(<span class="number">0</span>, rr**(i+key1-<span class="number">1</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">c1 = <span class="built_in">pow</span>(<span class="built_in">sum</span>(k*flag**i <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(ks)), <span class="number">127</span>, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(flag, <span class="number">65537</span>, n)</span><br><span class="line">ks = [<span class="built_in">pow</span>(<span class="number">69</span>, k+key, rr**(i+key1)) <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(ks)]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ks = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c1 = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c2 = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>前面是一个常规的随机数预测，套用脚本就能算出<code>key = 3168111950</code>，则<code>key1 = 3</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> extend_mt19937_predictor <span class="keyword">import</span> ExtendMT19937Predictor</span><br><span class="line"></span><br><span class="line">predictor = ExtendMT19937Predictor()</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;random&quot;</span>,<span class="string">&quot;rb&quot;</span>).readlines()</span><br><span class="line"></span><br><span class="line">D = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(f)):</span><br><span class="line">    D.append(<span class="built_in">eval</span>(f[i]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">648</span>):</span><br><span class="line">    predictor.setrandbits(D[_], <span class="number">32</span>)</span><br><span class="line">key = predictor.predict_getrandbits(<span class="number">32</span>)</span><br><span class="line">key1= <span class="built_in">int</span>(<span class="built_in">str</span>(key)[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="comment"># 3168111950</span></span><br></pre></td></tr></table></figure>

<p>然后就是<br>$$<br>c_1 \equiv  k_0\times flag^0 + k_1\times flag^1 + … + k_n\times flag^n \mod n<br>$$</p>
<p>$$<br>c_2 \equiv flag^{65537} \mod n<br>$$</p>
<p>以及$ks_i \equiv 69^{k_i+key} \mod rr^{i+key1}$，$key$和$key1$都是已知的</p>
<p>在鸡块师傅的博客中看过类似的题，因为模数至少都是3次幂，对这种模数来说可以用p-adic的discrete_log去计算出模p^(i-1)下的值，只有一次幂下难以求解。具体原理可以看鸡块师傅的解释-&gt;<a target="_blank" rel="noopener" href="https://tangcuxiaojikuai.xyz/post/d4b677a0.html">2024-bi0sCTF-wp-crypto | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>求解完这个dlp问题之后就可以求得$k_i$了，然后就是两个明文做gcd，由于度比较大所以选择HGCD，同时由于两个多项式根相同，所以可以将f2先模f1后再做HGCD能更节省时间。</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">rr = </span><br><span class="line">ks = [...]</span><br><span class="line">c1 = </span><br><span class="line">c2 = </span><br><span class="line">final = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 dlog by p-adic</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">16</span>):</span><br><span class="line">    R = Zp(rr, prec=i+<span class="number">3</span>)</span><br><span class="line">    x = (R(ks[i]).log() / R(<span class="number">69</span>).log()).lift()</span><br><span class="line">    final.append(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 HGCD</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HGCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * b.degree() &lt;= a.degree() <span class="keyword">or</span> a.degree() == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    m = a.degree() // <span class="number">2</span></span><br><span class="line">    a_top, a_bot = a.quo_rem(x^m)</span><br><span class="line">    b_top, b_bot = b.quo_rem(x^m)</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a_top, b_top)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    q, e = c.quo_rem(d)</span><br><span class="line">    d_top, d_bot = d.quo_rem(x^(m // <span class="number">2</span>))</span><br><span class="line">    e_top, e_bot = e.quo_rem(x^(m // <span class="number">2</span>))</span><br><span class="line">    S00, S01, S10, S11 = HGCD(d_top, e_top)</span><br><span class="line">    RET00 = S01 * R00 + (S00 - q * S01) * R10</span><br><span class="line">    RET01 = S01 * R01 + (S00 - q * S01) * R11</span><br><span class="line">    RET10 = S11 * R00 + (S10 - q * S11) * R10</span><br><span class="line">    RET11 = S11 * R01 + (S10 - q * S11) * R11</span><br><span class="line">    <span class="keyword">return</span> RET00, RET01, RET10, RET11</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="built_in">print</span>(a.degree(), b.degree())</span><br><span class="line">    q, r = a.quo_rem(b)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a, b)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> c.monic()</span><br><span class="line">    q, r = c.quo_rem(d)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    <span class="keyword">return</span> GCD(d, r)</span><br><span class="line"></span><br><span class="line">key = <span class="number">3168111950</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f1 = <span class="built_in">sum</span>((k-key)*x**i <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(final))^((<span class="number">1</span>&lt;&lt;<span class="number">7</span>)-<span class="number">1</span>) - c1</span><br><span class="line">f2 = x^((<span class="number">1</span>&lt;&lt;<span class="number">16</span>)+<span class="number">1</span>) - c2</span><br><span class="line">f2 = f2 % f1</span><br><span class="line">res = GCD(f1,f2)</span><br><span class="line"></span><br><span class="line">m = -res.monic().coefficients()[<span class="number">0</span>]</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;ba76e13f-269e-4481-baf0-4a50ad17f891&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Complex-RSA"><a href="#Complex-RSA" class="headerlink" title="Complex_RSA"></a>Complex_RSA</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        self.re = re</span><br><span class="line">        self.im = im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = self.re * c.re - self.im * c.im</span><br><span class="line">        im_ = self.re * c.im + self.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.im == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(self.re)</span><br><span class="line">        <span class="keyword">elif</span> self.re == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(self.im) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;-&#x27;</span> <span class="keyword">if</span> self.im &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>i&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.im&#125;</span>i&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.re&#125;</span> <span class="subst">&#123;<span class="string">&#x27;+&#x27;</span> <span class="keyword">if</span> self.im &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;-&#x27;</span>&#125;</span> <span class="subst">&#123;<span class="built_in">abs</span>(self.im)&#125;</span>i&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">key = getRandomNBitInteger(m.bit_length())</span><br><span class="line">c = m ^ key</span><br><span class="line">com = Complex(key, c)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">e = <span class="number">9</span></span><br><span class="line">enc = complex_pow(com, e, p * q)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"><span class="built_in">print</span>(Complex(p, q) * Complex(p, q))</span><br><span class="line"><span class="comment"># 66350931528185981323649477263900844564494528747802437244889229343520648562164950914433406604580038018765783183569276743239888668912948977370163046257917321742455772852779551569446155827368453262479370103326286297164105599131090881306108546341785251895116423206455175290083968296281375908109039893280371271943 + 65266730684129269806656018828265187384002656633231286337130178390517924611751697965395744944541329793503617856896706439809241745206839328124348693486741656130890593895436661857688522977866438805549144904296596887218275440542852887148071837153436265722614658566275517205322945316112048487893204059562830581004i</span></span><br><span class="line"><span class="comment"># -28814875173103880290298835537218644402443395484370652510062722255203946330565951328874411874019897676900075613671629765922970689802650462822117767927082712245512492082864958877932682404829188622269636302484189627580600076246836248427780151681898051243380477561480415972565859837597822263289141887833338111120 + 235362412848885579543400940934854106052672292040465052424316433330114813432317923674803623227280862945857543620663672974955235166884830751834386990766053503640556408758413592161122945636548462064584183165189050320898315823173824074873376450569212651128285746330837777597290934043912373820690250920839961482862i</span></span><br></pre></td></tr></table></figure>

<p>$$<br>C \equiv M^9 \mod n<br>$$</p>
<p>$\because gcd(e,phi) &#x3D; e$，$gcd(e,p^2-1) &#x3D; 3,gcd(e,q^2-1) &#x3D; 3$</p>
<p>利用扩展欧几里得算法求出$e\times d_p \equiv 3 \mod p^2-1$以及$e\times d_q \equiv 3 \mod q^2-1$，<strong>这里算出来的结果一定要再模一下，血的教训</strong></p>
<p>于是有$M^3p \equiv C^{d_p} \mod p$以及$M^3q \equiv C^{d_q} \mod q$</p>
<p>再把$M^3p$和$M^3q$展开，对于复数$z &#x3D; a + bi$，展开得到$z^3 &#x3D; (a^3 - 3ab^2) + (3a^2b-b^3)i$</p>
<p>分别解出$a_p \equiv a\mod p$，$a_q \equiv a \mod q$以及$b_p \equiv b \mod p$,$b_q \equiv b \mod q$</p>
<p>然后crt得到$a,b$，也就是$key$和$c$</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        self.re = re</span><br><span class="line">        self.im = im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = self.re * c.re - self.im * c.im</span><br><span class="line">        im_ = self.re * c.im + self.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.im == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(self.re)</span><br><span class="line">        <span class="keyword">elif</span> self.re == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(self.im) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;-&#x27;</span> <span class="keyword">if</span> self.im &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>i&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.im&#125;</span>i&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.re&#125;</span> <span class="subst">&#123;<span class="string">&#x27;+&#x27;</span> <span class="keyword">if</span> self.im &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;-&#x27;</span>&#125;</span> <span class="subst">&#123;<span class="built_in">abs</span>(self.im)&#125;</span>i&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># temp1 = -28814875173103880290298835537218644402443395484370652510062722255203946330565951328874411874019897676900075613671629765922970689802650462822117767927082712245512492082864958877932682404829188622269636302484189627580600076246836248427780151681898051243380477561480415972565859837597822263289141887833338111120 </span></span><br><span class="line"><span class="comment"># temp2 = 235362412848885579543400940934854106052672292040465052424316433330114813432317923674803623227280862945857543620663672974955235166884830751834386990766053503640556408758413592161122945636548462064584183165189050320898315823173824074873376450569212651128285746330837777597290934043912373820690250920839961482862</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># var(&#x27;p q&#x27;)</span></span><br><span class="line"><span class="comment"># f1 = p^2 - q^2 == temp1</span></span><br><span class="line"><span class="comment"># f2 = 2*p*q == temp2</span></span><br><span class="line"><span class="comment"># res = solve([f1,f2],[p,q])</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line">p = <span class="number">10205509456040823453782883291824829705816298450992336115902525676510986341532486274067943978039013674207011185602314114359146043975207543018267242312660911</span></span><br><span class="line">q = <span class="number">11531144714660489617244423924607904114688972598683439999377362467380544567879231460623526800789918614728790840508257630983753525432337178000220918002499321</span></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">9</span></span><br><span class="line">phi = (p^<span class="number">2</span>-<span class="number">1</span>)*(q^<span class="number">2</span>-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">C = Complex(<span class="number">66350931528185981323649477263900844564494528747802437244889229343520648562164950914433406604580038018765783183569276743239888668912948977370163046257917321742455772852779551569446155827368453262479370103326286297164105599131090881306108546341785251895116423206455175290083968296281375908109039893280371271943</span>,<span class="number">65266730684129269806656018828265187384002656633231286337130178390517924611751697965395744944541329793503617856896706439809241745206839328124348693486741656130890593895436661857688522977866438805549144904296596887218275440542852887148071837153436265722614658566275517205322945316112048487893204059562830581004</span>)</span><br><span class="line">_,dp,y1 = gmpy2.gcdext(e,p^<span class="number">2</span>-<span class="number">1</span>)</span><br><span class="line">_,dq,y2 = gmpy2.gcdext(e,q^<span class="number">2</span>-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dp = dp % (p^<span class="number">2</span> - <span class="number">1</span>)					</span><br><span class="line">dq = dq % (q^<span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> e * dp % (p^<span class="number">2</span>-<span class="number">1</span>) == <span class="number">3</span></span><br><span class="line"><span class="keyword">assert</span> e * dq % (q^<span class="number">2</span>-<span class="number">1</span>) == <span class="number">3</span></span><br><span class="line">M3p = complex_pow(C,dp,p)</span><br><span class="line">M3q = complex_pow(C,dq,q)</span><br><span class="line"></span><br><span class="line">cxp = <span class="built_in">int</span>(M3p.re)</span><br><span class="line">cyp = <span class="built_in">int</span>(M3p.im)</span><br><span class="line">cxq = <span class="built_in">int</span>(M3q.re)</span><br><span class="line">cyq = <span class="built_in">int</span>(M3q.im)</span><br><span class="line"></span><br><span class="line">R.&lt;a,b&gt; = PolynomialRing(Zmod(p))</span><br><span class="line"></span><br><span class="line">f1 = a^<span class="number">3</span> - <span class="number">3</span>*a*b^<span class="number">2</span> - cxp</span><br><span class="line">f2 = <span class="number">3</span>*a^<span class="number">2</span>*b - b^<span class="number">3</span> - cyp</span><br><span class="line">g1 = f1.sylvester_matrix(f2,b).det().univariate_polynomial().monic()</span><br><span class="line">h1 = f2.sylvester_matrix(f1,a).det().univariate_polynomial().monic()</span><br><span class="line">res_ap = g1.roots()</span><br><span class="line">res_bp = h1.roots()</span><br><span class="line"></span><br><span class="line">R.&lt;a,b&gt; = PolynomialRing(Zmod(q))</span><br><span class="line"></span><br><span class="line">f3 = a^<span class="number">3</span> - <span class="number">3</span>*a*b^<span class="number">2</span> - cxq</span><br><span class="line">f4 = <span class="number">3</span>*a^<span class="number">2</span>*b - b^<span class="number">3</span> - cyq</span><br><span class="line">g2 = f3.sylvester_matrix(f4,b).det().univariate_polynomial().monic()</span><br><span class="line">h2 = f4.sylvester_matrix(f3,a).det().univariate_polynomial().monic()</span><br><span class="line">res_aq = g2.roots()</span><br><span class="line">res_bq = h2.roots()</span><br><span class="line"></span><br><span class="line">K = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res_ap:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res_aq:</span><br><span class="line">        k = CRT_list([<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>])],[p,q])</span><br><span class="line">        <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> K:</span><br><span class="line">            K.append(k)</span><br><span class="line"></span><br><span class="line">enc = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res_bp:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res_bq:</span><br><span class="line">        c = CRT_list([<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>])],[p,q])</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> enc:</span><br><span class="line">            enc.append(c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> K:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">        m = key ^^ c</span><br><span class="line">        flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag <span class="keyword">or</span> <span class="string">b&quot;XYCTF&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="comment"># flag&#123;Complex_is_so_fun_and_I_think_you_know_Sylvester!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="easy-ecc"><a href="#easy-ecc" class="headerlink" title="easy_ecc"></a>easy_ecc</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, secret,SECRET</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag[<span class="number">6</span>:-<span class="number">1</span>] == sha256(long_to_bytes(secret)).hexdigest().encode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECC_easy</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.a = <span class="number">1365855822212045061018261334821659180641576788523935479</span></span><br><span class="line">        self.b = <span class="number">17329427219955161804703200105884322768704934833367341</span></span><br><span class="line">        self.p = <span class="number">1365855822212045061018261334821659180641576788523935481</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, P, Q</span>):</span><br><span class="line">        mul_inv = <span class="keyword">lambda</span> x: <span class="built_in">pow</span>(x, -<span class="number">1</span>, self.p)</span><br><span class="line">        x1, y1 = P</span><br><span class="line">        x2, y2 = Q</span><br><span class="line">        <span class="keyword">if</span> P!=Q:</span><br><span class="line">            l=(y2-y1)*inverse(x2-x1,self.p)%self.p</span><br><span class="line">        <span class="keyword">else</span>:l=(<span class="number">3</span>*x1**<span class="number">2</span>+<span class="number">2</span>*self.a*x1+<span class="number">1</span>)*inverse(<span class="number">2</span>*self.b*y1,self.p)%self.p</span><br><span class="line">        temp1 = (self.b*l**<span class="number">2</span>-self.a-x1-x2)%self.p</span><br><span class="line">        temp2 = ((<span class="number">2</span>*x1+x2+self.a)*l-self.b*l**<span class="number">3</span>-y1)%self.p</span><br><span class="line">        x3 = temp1</span><br><span class="line">        y3 = temp2</span><br><span class="line">        <span class="keyword">return</span> x3, y3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, x, P</span>):</span><br><span class="line">        Q = SECRET</span><br><span class="line">        x = x % self.p</span><br><span class="line">        <span class="keyword">while</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> x &amp; <span class="number">1</span>:</span><br><span class="line">                Q = self.add(Q, P)</span><br><span class="line">            P = self.add(P, P)</span><br><span class="line">            x &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ispoint</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> (self.a * x ** <span class="number">2</span> + x ** <span class="number">3</span>+x) % self.p == (self.b * y ** <span class="number">2</span>) % self.p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ecc = ECC_easy()</span><br><span class="line">LLLL = (<span class="number">1060114032187482137663886206406014543797784561116139791</span>,<span class="number">752764811411303365258802649951280929945966659818544966</span>)</span><br><span class="line"><span class="keyword">assert</span> ecc.ispoint(LLLL[<span class="number">0</span>], LLLL[<span class="number">1</span>])</span><br><span class="line">END = ecc.mul(secret, LLLL)</span><br><span class="line"><span class="built_in">print</span>(END)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (695174082657148306737473938393010922439779304870471540,414626357054958506867453055549756701310099524292082869)</span></span><br></pre></td></tr></table></figure>

<p>题目给的是一个蒙哥马利曲线：$Kt^2 \equiv s^3 + Js^2 + s \mod p$</p>
<p>参考这篇文章<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/524180490">Ed25519与Curve25519：概念与相互转换 - 知乎 (zhihu.com)</a>，把蒙哥马利曲线映射到维尔斯特拉斯曲线，即$y^2 \equiv x^3 + 1098066776930223927329092382214459309226361965213x + 1263248714105743124314734095577181018742053879965591734 \mod p$</p>
<p>发现是个Singular Curve，参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/oyrd/p/16216474.html">Curve learning1 - hash_hash - 博客园 (cnblogs.com)</a></p>
<p>上述的曲线写为这样的形式$y^2 \equiv (x + r_1)^2(x+r_2)$</p>
<p>其中<code>r1 = 544257272453066077953551360625531658485543339865638914</code></p>
<p><code>r2 = 277341277305912905111158613570595863670490108792657653</code>，根据参考博客</p>
<p>做代换$t &#x3D; x+r_1$，然后通过$y^2 \equiv t^3 + r\times t^2$，计算出$r &#x3D; 1098939827064891888175868587766723385826523557450954220$</p>
<p>然后做代换$\phi &#x3D; \frac{y+\alpha x}{y-\alpha x}$($\alpha^2 \equiv r \mod p$)，这里的$x$其实是代换后的$t$</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line">K = <span class="number">17329427219955161804703200105884322768704934833367341</span></span><br><span class="line">J = <span class="number">1365855822212045061018261334821659180641576788523935479</span></span><br><span class="line">p = <span class="number">1365855822212045061018261334821659180641576788523935481</span></span><br><span class="line">G = (<span class="number">1060114032187482137663886206406014543797784561116139791</span>,<span class="number">752764811411303365258802649951280929945966659818544966</span>)</span><br><span class="line">C = (<span class="number">695174082657148306737473938393010922439779304870471540</span>,<span class="number">414626357054958506867453055549756701310099524292082869</span>)</span><br><span class="line"></span><br><span class="line">A = ((<span class="number">3</span> - J^<span class="number">2</span>)*inverse(<span class="number">3</span>*K^<span class="number">2</span>,p)) % p</span><br><span class="line">B = ((<span class="number">2</span>*J^<span class="number">3</span> - <span class="number">9</span>*J)*inverse(<span class="number">27</span>*K^<span class="number">3</span>,p)) % p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_weier</span>(<span class="params">x,y</span>):</span><br><span class="line">    xW = (<span class="number">3</span>*x+J) * inverse_mod(<span class="number">3</span>*K, p) % p</span><br><span class="line">    yW = y * inverse_mod(K, p) % p</span><br><span class="line">    <span class="keyword">assert</span> yW^<span class="number">2</span> % p == (xW^<span class="number">3</span>+A*xW+B) % p</span><br><span class="line">    <span class="keyword">return</span> (xW,yW)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GG = to_weier(G[<span class="number">0</span>],G[<span class="number">1</span>])</span><br><span class="line">CC = to_weier(C[<span class="number">0</span>],C[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">r1 = <span class="number">544257272453066077953551360625531658485543339865638914</span></span><br><span class="line">r2 = <span class="number">277341277305912905111158613570595863670490108792657653</span></span><br><span class="line">tG = (GG[<span class="number">0</span>] + r1) % p</span><br><span class="line">tC = (CC[<span class="number">0</span>] + r1) % p</span><br><span class="line"></span><br><span class="line">r = <span class="number">1098939827064891888175868587766723385826523557450954220</span></span><br><span class="line"><span class="comment"># R.&lt;alpha&gt; = PolynomialRing(Zmod(p))</span></span><br><span class="line"><span class="comment"># f = alpha^2 - r</span></span><br><span class="line"><span class="comment"># print(f.roots())</span></span><br><span class="line">alpha = <span class="number">1003930426227501665054311651540310392036896175643136673</span></span><br><span class="line"><span class="comment"># alpha = 361925395984543395963949683281348788604680612880798808</span></span><br><span class="line"></span><br><span class="line">g = ((GG[<span class="number">1</span>] + alpha*tG) * inverse((GG[<span class="number">1</span>]-alpha*tG),p)) % p</span><br><span class="line">y = ((CC[<span class="number">1</span>] + alpha*tC) * inverse((CC[<span class="number">1</span>]-alpha*tC),p)) % p</span><br><span class="line"></span><br><span class="line">secret = discrete_log(mod(y,p),mod(g,p))</span><br><span class="line"><span class="built_in">print</span>(secret)</span><br><span class="line"><span class="comment"># 235532498456072807669363480669523682659923973393</span></span><br><span class="line">flag = <span class="string">b&quot;XYCTF&#123;&quot;</span> + sha256(long_to_bytes(secret)).hexdigest().encode() + <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;ec9a6e17537e81b7f593f65f7e2ca5d575e6b34c504c24e4afb40c1e9dc4be0d&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="LCG-and-HNP"><a href="#LCG-and-HNP" class="headerlink" title="LCG_and_HNP"></a>LCG_and_HNP</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed, a, b, p</span>):</span><br><span class="line">        self.seed = seed</span><br><span class="line">        self.a = a</span><br><span class="line">        self.b = b</span><br><span class="line">        self.p = p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = (self.seed * self.a + self.b) % self.p</span><br><span class="line">        <span class="keyword">return</span> self.seed &gt;&gt; (self.p.bit_length() - <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">a = random.randint(<span class="number">1</span>, p)</span><br><span class="line">b = random.randint(<span class="number">1</span>, p)</span><br><span class="line">seed = random.randint(<span class="number">1</span>, p)</span><br><span class="line">out = []</span><br><span class="line">lcg = LCG(seed, a, b, p)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    out.append(lcg.<span class="built_in">next</span>())</span><br><span class="line">key = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    key += <span class="built_in">str</span>(lcg.<span class="built_in">next</span>())</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(key) &gt;= m:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&quot;p=<span class="subst">&#123;p&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;a=<span class="subst">&#123;a&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;b=<span class="subst">&#123;b&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;out=<span class="subst">&#123;out&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;c=<span class="subst">&#123;<span class="built_in">int</span>(key)^m&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>已知$X_{n+1} \equiv aX_n + b \mod p$</p>
<p>把$X_n$拆为高位和低位之和，即$X_n &#x3D; H_n+L_n$</p>
<p>于是有$H_{n+1}+L_{n+1} \equiv a(H_n+L_n) + b \mod p$</p>
<p>$\therefore L_{n+1} \equiv aL_n+(aH_n+b-H_{n+1})\mod p$</p>
<p>因为$L_2 \equiv aL_1 + (aH_1+b-H_2) \mod p$</p>
<p>$L_3 \equiv a(aL_1 + aH_1+b-H_2)+aH_2+b-H_3 \mod p$，即$L_3 \equiv a^2L_1+(aH_2+b-H_3+a^2H_1+b-H_2) \mod p$</p>
<p>于是能得到$L_i$与$L_1$的关系</p>
<p>则有$L_{i} \equiv A_iL_1 +B_i \mod p$，即$L_{i+1} &#x3D; A_iL_1 + B_i + k_{i}p$</p>
<p>构造格</p>
<p><img src="/../../images/TPCTF/29.png"></p>
<p>因为$L_i &#x3D; 120bit$，所以最后调一个$2^{120}$</p>
<p>恢复出求出$L_1$之后得到$seed_1$，再恢复seed</p>
<p>恢复seed后，浅浅爆一下key，大概就是40次左右能出flag，运气挺好，刚好就是40</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = <span class="number">183640370379099520304414468793633666661</span></span><br><span class="line">a = <span class="number">36108041497607074474855679331694767924</span></span><br><span class="line">b = <span class="number">65925932211985158779695144876342622462</span></span><br><span class="line">c = [<span class="number">0</span>,<span class="number">34</span>, <span class="number">95</span>, <span class="number">100</span>, <span class="number">114</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">17</span>, <span class="number">118</span>, <span class="number">115</span>, <span class="number">29</span>, <span class="number">73</span>, <span class="number">47</span>, <span class="number">12</span>, <span class="number">133</span>, <span class="number">78</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">73</span>, <span class="number">87</span>, <span class="number">15</span>, <span class="number">85</span>, <span class="number">47</span>, <span class="number">20</span>, <span class="number">136</span>, <span class="number">6</span>, <span class="number">106</span>, <span class="number">74</span>, <span class="number">27</span>, <span class="number">116</span>, <span class="number">8</span>]</span><br><span class="line">cipher = <span class="number">6003642257316152022364486167163125577018867662610595926973616937741281227891381713617380</span></span><br><span class="line"><span class="comment">#0是seed的高位</span></span><br><span class="line"></span><br><span class="line">length = <span class="built_in">len</span>(c)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">    c[i] = c[i] &lt;&lt; <span class="number">120</span></span><br><span class="line"></span><br><span class="line">A = [<span class="number">1</span>]</span><br><span class="line">B = [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length-<span class="number">1</span>):</span><br><span class="line">    Ai = a*A[i-<span class="number">1</span>] % m</span><br><span class="line">    Bi = (a*B[i-<span class="number">1</span>] + a*c[i]+b-c[i+<span class="number">1</span>]) % m</span><br><span class="line">    A.append(Ai)</span><br><span class="line">    B.append(Bi)</span><br><span class="line"></span><br><span class="line">A = A[<span class="number">1</span>:]</span><br><span class="line">B = B[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">M = Matrix(length,length)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length-<span class="number">2</span>):</span><br><span class="line">    M[i,i] = m</span><br><span class="line">    M[-<span class="number">1</span>,i] = B[i]</span><br><span class="line">    M[-<span class="number">2</span>,i] = A[i]</span><br><span class="line">M[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">120</span></span><br><span class="line">M[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">inv = gmpy2.invert(a,m)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> M.LLL():</span><br><span class="line">    <span class="keyword">if</span> i[-<span class="number">1</span>] == <span class="number">2</span>^<span class="number">120</span>:</span><br><span class="line">        L1 = i[-<span class="number">2</span>]</span><br><span class="line">        seed1 = c[<span class="number">1</span>] + L1</span><br><span class="line">        seed = inv * (seed1 - b) % m</span><br><span class="line">        <span class="keyword">if</span> ((a * seed + b) % m) &gt;&gt; <span class="number">120</span> == c[<span class="number">1</span>] &gt;&gt; <span class="number">120</span>:</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">                seed = (a * seed + b) % m</span><br><span class="line">            key = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">                seed = (a * seed % m + b) % m</span><br><span class="line">                temp = seed &gt;&gt; <span class="number">120</span></span><br><span class="line">                key += <span class="built_in">str</span>(temp)</span><br><span class="line">                msg = cipher ^^ <span class="built_in">int</span>(key)</span><br><span class="line">                flag = long_to_bytes(<span class="built_in">int</span>(msg))</span><br><span class="line">                <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag <span class="keyword">or</span> <span class="string">b&quot;XYCTF&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">                    <span class="built_in">print</span>(flag)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"><span class="comment"># XYCTF&#123;2h1_21_ZHi_5h0u_yU_zI_xI3_l@0&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="new-LCG"><a href="#new-LCG" class="headerlink" title="new_LCG"></a>new_LCG</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q * r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG1</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed, a, b, m</span>):</span><br><span class="line">        self.seed = seed</span><br><span class="line">        self.a = a</span><br><span class="line">        self.b = b</span><br><span class="line">        self.m = m</span><br><span class="line">        self.<span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        old_seed = self.seed</span><br><span class="line">        self.seed = (self.a * self.seed + self.b * self.<span class="built_in">sum</span>) % self.m</span><br><span class="line">        self.<span class="built_in">sum</span> += old_seed</span><br><span class="line">        <span class="keyword">return</span> self.seed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG2</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed, q, A, B</span>):</span><br><span class="line">        self.E = EllipticCurve(GF(q), [A, B])</span><br><span class="line">        self.P = self.E.lift_x(seed)</span><br><span class="line">        self.b = self.E.random_point()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.P = self.P + self.b</span><br><span class="line">        <span class="keyword">return</span> self.P[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a1 = random.randint(<span class="number">1</span>, p)</span><br><span class="line">b1 = random.randint(<span class="number">1</span>, p)</span><br><span class="line">seed1 = random.randint(<span class="number">1</span>, p)</span><br><span class="line">lcg1 = LCG1(seed1, a1, b1, p)</span><br><span class="line">c1 = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    c1.append(lcg1.<span class="built_in">next</span>())</span><br><span class="line"></span><br><span class="line">a2 = random.randint(<span class="number">1</span>, q)</span><br><span class="line">b2 = random.randint(<span class="number">1</span>, q)</span><br><span class="line">seed2 = random.randint(<span class="number">1</span>, q)</span><br><span class="line">lcg2 = LCG2(seed2, q, a2, b2)</span><br><span class="line">c2 = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    c2.append(lcg2.<span class="built_in">next</span>())</span><br><span class="line"></span><br><span class="line">c = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(c, e, n))</span><br><span class="line"><span class="built_in">print</span>(c1)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"><span class="comment"># 942554394956393500634473023924044851150783066435925660508624376974971108656861080872622432250172571195245180102507380675343264066303507696268870722959770362631674931170602993210221083436437860191861911457384526742569208842886612504579678703976889217504241741044075116270718940025586448491942058697669033418724145042156461740336592337509609124425828725269151627786668070531098444935129266626770404736852607352075247856808563388127774523912002202264558855255067503</span></span><br><span class="line"><span class="comment"># 91351185520045025851535940537599785616890151570421939971146348618267656786110090770321857244701820126026227283965934212135946431643320325513590505155214070540638751565105300361430272638957420276596026161454413739823593506516275224444666187442238624864548263927274591212614561916913851855552516864387460946267629794664216228596534684933791607740725160394841711539767932339281214673649553407414347293480522175832736301571839298158011533849603878482322619858083471</span></span><br><span class="line"><span class="comment"># [6924229081976334180193477951417117275396656434968000032228908231511246053064833236257422745299036986875244562025221130619850904830372215788197314906896784,707045810464337488125013716300756405499020414540801863434513087687914538170573314824134496890600422837133767094273649381435979038909605432188919586751472,561487665739111774897165274560908487232457333748910467998343202097778699925650682704996443560224288857862513676706660506594465853704042586896087391214886,6498834369085375452441121562339384727357898216850540864190840194924515286757125433756518026123451611578553656133012172518080309106483207567929943790044792,5508345401684913940610183958526398635406187349043368834080838153611810896629693027245511688366776749176652858929409374912959736262162942801190344337268446,7604410082265211154108357446507297790451766698177313130672954202813796888988719242951127448112228332967892794819415211618572734294964346056056171483002307,7699815879242527638422887386550759485127768822609011364311314299885418068889791030639324882736871756700299169635780542149704586720216395186814592666988591,829748131720382599696653359722612708514830904084605048590882951300049701148883021283243506081300427041733299385325284399270633917941134488957784480285437,7084115400374950827522650500486495223539292992998875483730758098005030106055310282589342193536381973309924074043955222228738842206417828828756951777504457,7482796067314266426215648326036921955183807741134787613584977300821023398375789725848056657250086288687570875979072368004217788222537115232191230702833854]</span></span><br><span class="line"><span class="comment"># [12573984103581521249597169818949825744876735847170990673204303602848066091917704946653820386665801380026230957120354174481948164514637637956459534723582285, 6441954407109995413858792101472089558106780628459991101662507565699664222341697230094798036088532393057448200220905589679548875702178737462785403325555226, 11684244745641367106386196774447204674089853123966422387024948921795099192025069760680924547214190425118261001002764397184950251157744938735586522727499550, 10396243416373326695473843427139385116708652845789644861965876346553795313454773668473030130335970707089781482749749170266279229263892370064669233541305377, 9090748241360606371310281608818966855338110969397659720953951845805983771894064629343960530245792700858927510839835850767728294266738917884471006979663157, 11489848045104749332790333272128633885019156159805805159750174723808043569789257625027794186359921080743368220606914862583644262009648261345452266067697628, 649349258009900424806913260265314442160901414078390702088746248078789581041616487825633046538335114117254875547413590064940767523651802950986197978665018, 6302136940345077947382276151657194124073457559487274425879887978386901058162385833414602346299055653879087077862824771863209271498552774720708307840705334, 5844526398244645236473089500608731415060125566027525405618000580381149761653744142808567706048834618328671311836990498943019718294135733114642775270792763, 4834548043993868659061606699822957422840040425976833628462093089330507589865407793951971491111695171201542345470702059513427268037868859282999222070054388]</span></span><br></pre></td></tr></table></figure>

<p>思路比较明显，通过两个lcg求出$p,q$，再解最后的RSA</p>
<h3 id="求p"><a href="#求p" class="headerlink" title="求p"></a>求p</h3><p><code>self.seed = (self.a * self.seed + self.b * self.sum) % self.m</code>根据这个式子，往下推导，再用gb基即可求出p</p>
<h3 id="求q"><a href="#求q" class="headerlink" title="求q"></a>求q</h3><p>根据题目有$P_{i+1} &#x3D; P_i + B$，直接按照椭圆曲线加法展开的话，变量很多，不会处理。最后参考鸡块师傅的思路<br>$$<br>P_1 &#x3D; P_2 - B<br>$$</p>
<p>$$<br>P_3 &#x3D; P_2 + B<br>$$</p>
<p>记$B &#x3D; (B_x,B_y)$，则$-B &#x3D; (B_x,-B_y)$，则对于$P_1,P_3$有<br>$$<br>x_1 &#x3D; (\frac{-B_y-y_2}{B_x-x_2})^2 - x_2 - B_x &#x3D; (\frac{B_y+y_2}{B_x-x_2})^2 - x_2 - B_x<br>$$</p>
<p>$$<br>x_3 &#x3D; (\frac{B_y - y_2}{B_x - x_2})^2 - x_2 - B_x<br>$$</p>
<p>相加得<br>$$<br>x_1 + x_3 &#x3D; (\frac{B_y+y_2}{B_x-x_2})^2 + (\frac{B_y - y_2}{B_x - x_2})^2 - 2x_2 - 2B_x<br>$$<br>展开合并同类项得<br>$$<br>(x_1+x_3)(B_x-x_2)^2 &#x3D; 2(B_y^2+y_2^2) - 2(x_2+B_x)(B_x-x_2)^2<br>$$<br>纵坐标可以用$y^2 \equiv x^3 + ax + b \mod q$来进行替换，即<br>$$<br>(x_1+x_3)(B_x-x_2)^2 &#x3D; 2(B_x^3+aB_x + b+x_2^3 + ax_2 + b) - 2(x_2+B_x)(B_x-x_2)^2<br>$$<br>此时未知数只有$B_x,a,b,q$，通过gb基即可完成求解</p>
<blockquote>
<p>exp</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">result = [<span class="number">6924229081976334180193477951417117275396656434968000032228908231511246053064833236257422745299036986875244562025221130619850904830372215788197314906896784</span>,<span class="number">707045810464337488125013716300756405499020414540801863434513087687914538170573314824134496890600422837133767094273649381435979038909605432188919586751472</span>,<span class="number">561487665739111774897165274560908487232457333748910467998343202097778699925650682704996443560224288857862513676706660506594465853704042586896087391214886</span>,<span class="number">6498834369085375452441121562339384727357898216850540864190840194924515286757125433756518026123451611578553656133012172518080309106483207567929943790044792</span>,<span class="number">5508345401684913940610183958526398635406187349043368834080838153611810896629693027245511688366776749176652858929409374912959736262162942801190344337268446</span>,<span class="number">7604410082265211154108357446507297790451766698177313130672954202813796888988719242951127448112228332967892794819415211618572734294964346056056171483002307</span>,<span class="number">7699815879242527638422887386550759485127768822609011364311314299885418068889791030639324882736871756700299169635780542149704586720216395186814592666988591</span>,<span class="number">829748131720382599696653359722612708514830904084605048590882951300049701148883021283243506081300427041733299385325284399270633917941134488957784480285437</span>,<span class="number">7084115400374950827522650500486495223539292992998875483730758098005030106055310282589342193536381973309924074043955222228738842206417828828756951777504457</span>,<span class="number">7482796067314266426215648326036921955183807741134787613584977300821023398375789725848056657250086288687570875979072368004217788222537115232191230702833854</span>]</span><br><span class="line">n = <span class="number">942554394956393500634473023924044851150783066435925660508624376974971108656861080872622432250172571195245180102507380675343264066303507696268870722959770362631674931170602993210221083436437860191861911457384526742569208842886612504579678703976889217504241741044075116270718940025586448491942058697669033418724145042156461740336592337509609124425828725269151627786668070531098444935129266626770404736852607352075247856808563388127774523912002202264558855255067503</span></span><br><span class="line">c = <span class="number">91351185520045025851535940537599785616890151570421939971146348618267656786110090770321857244701820126026227283965934212135946431643320325513590505155214070540638751565105300361430272638957420276596026161454413739823593506516275224444666187442238624864548263927274591212614561916913851855552516864387460946267629794664216228596534684933791607740725160394841711539767932339281214673649553407414347293480522175832736301571839298158011533849603878482322619858083471</span></span><br><span class="line">c2 = [<span class="number">12573984103581521249597169818949825744876735847170990673204303602848066091917704946653820386665801380026230957120354174481948164514637637956459534723582285</span>, <span class="number">6441954407109995413858792101472089558106780628459991101662507565699664222341697230094798036088532393057448200220905589679548875702178737462785403325555226</span>, <span class="number">11684244745641367106386196774447204674089853123966422387024948921795099192025069760680924547214190425118261001002764397184950251157744938735586522727499550</span>, <span class="number">10396243416373326695473843427139385116708652845789644861965876346553795313454773668473030130335970707089781482749749170266279229263892370064669233541305377</span>, <span class="number">9090748241360606371310281608818966855338110969397659720953951845805983771894064629343960530245792700858927510839835850767728294266738917884471006979663157</span>, <span class="number">11489848045104749332790333272128633885019156159805805159750174723808043569789257625027794186359921080743368220606914862583644262009648261345452266067697628</span>, <span class="number">649349258009900424806913260265314442160901414078390702088746248078789581041616487825633046538335114117254875547413590064940767523651802950986197978665018</span>, <span class="number">6302136940345077947382276151657194124073457559487274425879887978386901058162385833414602346299055653879087077862824771863209271498552774720708307840705334</span>, <span class="number">5844526398244645236473089500608731415060125566027525405618000580381149761653744142808567706048834618328671311836990498943019718294135733114642775270792763</span>, <span class="number">4834548043993868659061606699822957422840040425976833628462093089330507589865407793951971491111695171201542345470702059513427268037868859282999222070054388</span>]</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">R.&lt;a,b,x&gt; = PolynomialRing(ZZ)</span><br><span class="line">f1 = a*x - result[<span class="number">0</span>]</span><br><span class="line">f2 = a^<span class="number">2</span>*x + b*x - result[<span class="number">1</span>]</span><br><span class="line">f3 = a^<span class="number">3</span>*x + <span class="number">2</span>*a*b*x + b*x - result[<span class="number">2</span>]</span><br><span class="line">f4 = a^<span class="number">4</span>*x + <span class="number">3</span>*a^<span class="number">2</span>*b*x + <span class="number">2</span>*a*b*x + b^<span class="number">2</span>*x + b*x - result[<span class="number">3</span>]</span><br><span class="line">f5 = a^<span class="number">5</span>*x + <span class="number">4</span>*a^<span class="number">3</span>*b*x + <span class="number">3</span>*a^<span class="number">2</span>*b*x + <span class="number">3</span>*a*b^<span class="number">2</span>*x + <span class="number">2</span>*a*b*x + <span class="number">2</span>*b^<span class="number">2</span>*x + b*x - result[<span class="number">4</span>]</span><br><span class="line">f6 = a^<span class="number">6</span>*x + <span class="number">5</span>*a^<span class="number">4</span>*b*x + <span class="number">4</span>*a^<span class="number">3</span>*b*x + <span class="number">6</span>*a^<span class="number">2</span>*b^<span class="number">2</span>*x + <span class="number">3</span>*a^<span class="number">2</span>*b*x + <span class="number">6</span>*a*b^<span class="number">2</span>*x + b^<span class="number">3</span>*x + <span class="number">2</span>*a*b*x + <span class="number">3</span>*b^<span class="number">2</span>*x + b*x - result[<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">F = [f1,f2,f3,f4,f5,f6]</span><br><span class="line">I = Ideal(F).groebner_basis()</span><br><span class="line">p = ZZ(I[<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">PR.&lt;a,b,Bx&gt; = PolynomialRing(ZZ)</span><br><span class="line">F = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>-<span class="number">1</span>):</span><br><span class="line">    f = (Bx-c2[i])^<span class="number">2</span>*(c2[i-<span class="number">1</span>]+c2[i+<span class="number">1</span>]) - <span class="number">2</span>*(Bx^<span class="number">3</span>+a*Bx+b+c2[i]^<span class="number">3</span>+a*c2[i]+b) + <span class="number">2</span>*(Bx+c2[i])*(Bx-c2[i])^<span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    F.append(f)</span><br><span class="line">res = Ideal(F).groebner_basis()</span><br><span class="line">q = ZZ(res[<span class="number">3</span>].univariate_polynomial()(<span class="number">0</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">r = n // p // q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"><span class="comment"># flag&#123;71fc0bc1-167a-43f0-ab0f-e0df3bea8ed3&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="铜匠"><a href="#铜匠" class="headerlink" title="铜匠"></a>铜匠</h2><blockquote>
<p>task.py</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">m1 = getRandomRange(<span class="number">1</span>, m)</span><br><span class="line">m2 = getRandomRange(<span class="number">1</span>, m)</span><br><span class="line">m3 = m - m1 - m2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task1</span>():</span><br><span class="line">    e = <span class="number">149</span></span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(m1, e, n), d &gt;&gt; <span class="number">222</span> &lt;&lt; <span class="number">222</span>, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task2</span>():</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q = getPrime(<span class="number">1024</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(m2, e, n), (p + q) &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">624</span>) - <span class="number">1</span>), n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task3</span>():</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(m3, e, n), (p ^ q) &gt;&gt; <span class="number">200</span>, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c1, leak1, n1 = task1()</span><br><span class="line">c2, leak2, n2 = task2()</span><br><span class="line">c3, leak3, n3 = task3()</span><br><span class="line"><span class="built_in">print</span>(c1, leak1, n1)</span><br><span class="line"><span class="built_in">print</span>(c2, leak2, n2)</span><br><span class="line"><span class="built_in">print</span>(c3, leak3, n3)</span><br><span class="line"><span class="comment"># (89623543982221289730635223555830551523170205418976759060541832483843039074358160566735322009158596405712449020903311144480669706226166537602750967447480664875090686428406188847601970724994074417752345460791736191511081890913041143570455636020205647345764692062144226011846336769477026234106683791286490222089, 138474880017294332349992670187778287774153347391371789199005713563195654993662610111557185709277805165708109047494971468100563949333712521647405765501704478862377527360106399421209690341743821320754482338590671565510629203215009008479290995785318405211007685664887994061938667418220613430135743123498167435264, 146331610798417415036517077006943013321623040860385791423062775325646472298267580898028515394910588437521335092742913111680737790430660749825981979147191282007208147041227246620008377726207734522466015971515317594545750944838673018946440525615131606652748549901880641896940968837669894325535750125282351577689)</span></span><br><span class="line"><span class="comment"># (5473961166821344576614003060897848014482672788904094340704447882490091115468180944569409159343222459801235179587721232166576530621751748850763430788036935832653535110975154800191323351333883661451331971042214143454441651165718504131976920077768864850035471790911190772583977173388975105970866592974077361193822302653046511418190410043729876062517148438923211673300268277037622337403526399584759202097925983596261279676101079771530118525540842499517622478819211528345668513680064744443628779623340175578509413636950545134641050948185944279029949957748464529075830770617236599864271566534714755373562527112224962839980,62964793504732923650344975634773688108135580826064134090114181449607062497690184718845295432644650580930430061411603385577783897575232298084007041511817031640186953023971498914096209984730,20748652069632848434897928314437138341436264859802586939154590237186029244907936870477844563166827587536149170710720365760129683024401957095447466056746469055173897234659911291443605912459271248059341147358511860537769587963189092648473894868209838600346115919726589891777340166174017389513260737891557712152871714337946675533597049874155202056200170954033849176655928144354665553271709442011723088448485570394208728775665739819536229908847043007472178803394055783543378990699834066614262050119443421709878598533329555838915158259138297060574425019923291353077080236769586821808150397875920110335669136563171420068201)</span></span><br><span class="line"><span class="comment"># (34640310217688693418173336791306022698488916505988760907493665070072623574363578354500529023855888624978101429772253437880445815006839767802433777006836665709335479076676231470534690281412388704665083311568028710188940132495410474044569100181764053297307413009214044407982980600917158732129850605715306726034, 3763587651775261955566046684899146246387485307521708557610018711932791630073528010801142052497, 94848869174430082173244966077736519396702141299429965725051314270443078621842166791082354594193554380275167898342497998871366256044865879909218309960595691008663632410356093966762639308253848450178310347612630814852054763933063313537694449475061227647475480417779126252294793767003555255527593551612032661749)</span></span><br></pre></td></tr></table></figure>

<h3 id="part1"><a href="#part1" class="headerlink" title="part1"></a>part1</h3><p>不会做</p>
<h3 id="part2"><a href="#part2" class="headerlink" title="part2"></a>part2</h3><p>由题意知$leak_2 \equiv p+q \mod 2^{624}$，除此之外还可以得到$n_{low} \equiv p\times q \mod 2^{624}$</p>
<p>于是有$n_{low} \equiv p(leak_2 - p) \mod 2^{624}$，解这个方程，然后得到p的低位，再用coppersmith</p>
<h3 id="part3"><a href="#part3" class="headerlink" title="part3"></a>part3</h3><p>题目给出<code>p ^ q</code>的高312位，参考鸡块师傅的博客：<a target="_blank" rel="noopener" href="https://tangcuxiaojikuai.xyz/post/e872e217.html">2023-鹏城杯-wp-crypto | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>剪枝的目的是为了求p的高位，再用coppersmith</p>
<blockquote>
<p>exp（仅限后面两part）</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">c1,leak1,n1 = (<span class="number">89623543982221289730635223555830551523170205418976759060541832483843039074358160566735322009158596405712449020903311144480669706226166537602750967447480664875090686428406188847601970724994074417752345460791736191511081890913041143570455636020205647345764692062144226011846336769477026234106683791286490222089</span>, <span class="number">138474880017294332349992670187778287774153347391371789199005713563195654993662610111557185709277805165708109047494971468100563949333712521647405765501704478862377527360106399421209690341743821320754482338590671565510629203215009008479290995785318405211007685664887994061938667418220613430135743123498167435264</span>, <span class="number">146331610798417415036517077006943013321623040860385791423062775325646472298267580898028515394910588437521335092742913111680737790430660749825981979147191282007208147041227246620008377726207734522466015971515317594545750944838673018946440525615131606652748549901880641896940968837669894325535750125282351577689</span>)</span><br><span class="line">c2,leak2,n2 = (<span class="number">5473961166821344576614003060897848014482672788904094340704447882490091115468180944569409159343222459801235179587721232166576530621751748850763430788036935832653535110975154800191323351333883661451331971042214143454441651165718504131976920077768864850035471790911190772583977173388975105970866592974077361193822302653046511418190410043729876062517148438923211673300268277037622337403526399584759202097925983596261279676101079771530118525540842499517622478819211528345668513680064744443628779623340175578509413636950545134641050948185944279029949957748464529075830770617236599864271566534714755373562527112224962839980</span>,<span class="number">62964793504732923650344975634773688108135580826064134090114181449607062497690184718845295432644650580930430061411603385577783897575232298084007041511817031640186953023971498914096209984730</span>,<span class="number">20748652069632848434897928314437138341436264859802586939154590237186029244907936870477844563166827587536149170710720365760129683024401957095447466056746469055173897234659911291443605912459271248059341147358511860537769587963189092648473894868209838600346115919726589891777340166174017389513260737891557712152871714337946675533597049874155202056200170954033849176655928144354665553271709442011723088448485570394208728775665739819536229908847043007472178803394055783543378990699834066614262050119443421709878598533329555838915158259138297060574425019923291353077080236769586821808150397875920110335669136563171420068201</span>)</span><br><span class="line">c3,leak3,n3 = (<span class="number">34640310217688693418173336791306022698488916505988760907493665070072623574363578354500529023855888624978101429772253437880445815006839767802433777006836665709335479076676231470534690281412388704665083311568028710188940132495410474044569100181764053297307413009214044407982980600917158732129850605715306726034</span>, <span class="number">3763587651775261955566046684899146246387485307521708557610018711932791630073528010801142052497</span>, <span class="number">94848869174430082173244966077736519396702141299429965725051314270443078621842166791082354594193554380275167898342497998871366256044865879909218309960595691008663632410356093966762639308253848450178310347612630814852054763933063313537694449475061227647475480417779126252294793767003555255527593551612032661749</span>)</span><br><span class="line">e1 = <span class="number">149</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># part2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt2</span>(<span class="params">n2,c2,leak2</span>):</span><br><span class="line">    n2_low = n2 % <span class="number">2</span>^<span class="number">624</span></span><br><span class="line">    var(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">    f = p * (leak2 - p) - n2_low</span><br><span class="line">    res = solve_mod(f,<span class="number">2</span>^<span class="number">624</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        plow = <span class="built_in">int</span>(i[<span class="number">0</span>])</span><br><span class="line">        R.&lt;x&gt; = PolynomialRing(Zmod(n2))</span><br><span class="line">        f2 = x * <span class="number">2</span>^<span class="number">624</span> + plow</span><br><span class="line">        f2 = f2.monic()</span><br><span class="line">        root = f2.small_roots(X = <span class="number">2</span>^<span class="number">400</span>,beta=<span class="number">0.4</span>)</span><br><span class="line">        <span class="keyword">if</span> root != []:</span><br><span class="line">            p2 = <span class="built_in">int</span>(root[<span class="number">0</span>])*<span class="number">2</span>^<span class="number">624</span> + plow</span><br><span class="line">            q2 = n2 // p2</span><br><span class="line">            d = gmpy2.invert(e,(p2-<span class="number">1</span>)*(q2-<span class="number">1</span>))</span><br><span class="line">            m2 = <span class="built_in">pow</span>(c2,d,n2)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> m2</span><br><span class="line">        </span><br><span class="line"><span class="comment"># m2 = decrypt2(n2,c2,leak2)</span></span><br><span class="line">m2 = <span class="number">637474741382124491125351127892971159828342019036405954553729272346832023284163998914076056292480317209934960796148267118196288511438260371617371342378683017480560448795</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># part3</span></span><br><span class="line"></span><br><span class="line">leak3 = leak3 &lt;&lt; <span class="number">200</span></span><br><span class="line">leak3 = <span class="built_in">bin</span>(leak3)[<span class="number">2</span>:].zfill(<span class="number">512</span>)</span><br><span class="line">leakbits = <span class="number">200</span>                          <span class="comment"># 缺失的位数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findp</span>(<span class="params">pp,qq,l</span>):</span><br><span class="line">    p_Min = <span class="built_in">int</span>(pp + (<span class="number">512</span>-l)*<span class="string">&quot;0&quot;</span>,<span class="number">2</span>)</span><br><span class="line">    p_Max = <span class="built_in">int</span>(pp + (<span class="number">512</span>-l)*<span class="string">&quot;1&quot;</span>,<span class="number">2</span>)</span><br><span class="line">    q_Min = <span class="built_in">int</span>(qq + (<span class="number">512</span>-l)*<span class="string">&quot;0&quot;</span>,<span class="number">2</span>)</span><br><span class="line">    q_Max = <span class="built_in">int</span>(qq + (<span class="number">512</span>-l)*<span class="string">&quot;1&quot;</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(l == <span class="number">512</span> - leakbits):</span><br><span class="line">        R.&lt;x&gt; = PolynomialRing(Zmod(n3))</span><br><span class="line">        phigh = p_Min</span><br><span class="line">        f3 = phigh + x</span><br><span class="line">        root = f3.small_roots(X=<span class="number">2</span>^leakbits, beta=<span class="number">0.499</span>)</span><br><span class="line">        <span class="keyword">if</span> root != []:</span><br><span class="line">            p3 = phigh + <span class="built_in">int</span>(root[<span class="number">0</span>])</span><br><span class="line">            q3 = n3 // p3</span><br><span class="line">            d = gmpy2.invert(e,(p3-<span class="number">1</span>)*(q3-<span class="number">1</span>))</span><br><span class="line">            m3 = <span class="built_in">pow</span>(c3,d,n3)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;m3 = <span class="subst">&#123;m3&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (p_Max * q_Max &lt; n3) <span class="keyword">or</span> (p_Min * q_Min &gt; n3):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 以下是根据异或来操作的</span></span><br><span class="line">    <span class="keyword">if</span> leak3[l] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        findp(pp + <span class="string">&#x27;1&#x27;</span>,qq + <span class="string">&#x27;1&#x27;</span>,l+<span class="number">1</span>)</span><br><span class="line">        findp(pp + <span class="string">&#x27;0&#x27;</span>,qq + <span class="string">&#x27;0&#x27;</span>,l+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> leak3[l] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        findp(pp + <span class="string">&#x27;1&#x27;</span>,qq + <span class="string">&#x27;0&#x27;</span>,l+<span class="number">1</span>)</span><br><span class="line">        findp(pp + <span class="string">&#x27;0&#x27;</span>,qq + <span class="string">&#x27;1&#x27;</span>,l+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">findp(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">m3 = <span class="number">334132319136130454419386550847309794306389604470819859736266178647538718607667083644497296078054806893307642673035506225568447967643224450929477875810797878149197295514</span></span><br></pre></td></tr></table></figure>





<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="熊博士"><a href="#熊博士" class="headerlink" title="熊博士"></a>熊博士</h2><blockquote>
<p>CBXGU{ORF_BV_NVR_BLF_CRZL_QQ}</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://wtool.com.cn/atbash.html">埃特巴什码 - Atbash Cipher - 在线工具网 (wtool.com.cn)</a></p>
<blockquote>
<p>xyctf{liu_ye_mei_you_xiao_jj}</p>
</blockquote>
<h2 id="game"><a href="#game" class="headerlink" title="game"></a>game</h2><p>谷歌识图秒出</p>
<p>游戏名叫<code>Papers, Please</code></p>
<p>flag:<code>XYCTF&#123;Papers Please&#125;</code></p>
<h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h1><h2 id="喵喵喵的flag碎了一地"><a href="#喵喵喵的flag碎了一地" class="headerlink" title="喵喵喵的flag碎了一地"></a>喵喵喵的flag碎了一地</h2><p>Shift+F12得到第一段<code>flag&#123;My_fl@g_h4s_</code></p>
<p>IDA左边函数列表找到第二段<code>br0ken_4parT_</code></p>
<p>在第二段函数处<code>Ctrl+x</code>即可找到什么位置指向了该函数，找到第三段<code>Bu7_Y0u_c@n_f1x_1t!&#125;</code></p>
<p><code>flag&#123;My_fl@g_h4s_br0ken_4parT_Bu7_Y0u_c@n_f1x_1t!&#125;</code></p>
<h2 id="聪明的信使"><a href="#聪明的信使" class="headerlink" title="聪明的信使"></a>聪明的信使</h2><p>Shift+F12得到密文<code>oujp&#123;H0d_TwXf_Lahyc0_14_e3ah_Rvy0ac@wc!&#125;</code></p>
<p>凯撒解密，移位9解密得到明文<code>flag&#123;Y0u_KnOw_Crypt0_14_v3ry_Imp0rt@nt!&#125;</code></p>

    </div>

    
    
    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------已经到底啦！<i class="fa fa-paw"></i>-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>DexterJie
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dexterjie.github.io/2024/04/26/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024XYCTF/" title="2024XYCTF">https://dexterjie.github.io/2024/04/26/赛题复现/2024XYCTF/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Wp/" rel="tag"># Wp</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/04/24/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E5%B8%95%E9%B2%81%E6%9D%AF/" rel="prev" title="帕鲁杯">
                  <i class="fa fa-chevron-left"></i> 帕鲁杯
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/05/12/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E9%BB%84%E6%B2%B3%E6%B5%81%E5%9F%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/" rel="next" title="第二届黄河流域网络安全技能挑战赛">
                  第二届黄河流域网络安全技能挑战赛 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DexterJie</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">244k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">14:46</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->


    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
<div class="busuanzi-count">
  <script async src="/js/busuanzi.pure.mini.js"></script>
  
  <span class="site-uv" title="总访客量">
    访客量<span id="busuanzi_value_site_uv"></span>
  </span>

  <span class="site-pv" title="总访问量">
    经过<span id="busuanzi_value_site_pv"></span>次回眸与你相遇
  </span>
</div>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"waline-five-mocha.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"locale":null,"placeholder":"请文明评论呀","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2024/04/26/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024XYCTF/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right"},"mobile":{"show":true}});</script></body>

</html>
