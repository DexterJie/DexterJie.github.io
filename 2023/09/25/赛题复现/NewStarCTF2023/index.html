<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/0.jpg">
  <link rel="mask-icon" href="/images/0.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dexterjie.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="2023NewStarCTF——Crypto——Wp（前两周）">
<meta property="og:type" content="article">
<meta property="og:title" content="2023NewStarCTF">
<meta property="og:url" content="https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/NewStarCTF2023/index.html">
<meta property="og:site_name" content="DexterJie&#39;Blog">
<meta property="og:description" content="2023NewStarCTF——Crypto——Wp（前两周）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dexterjie.github.io/images/Ancient/0.jpg">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/0.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/1.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/2.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/3.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/4.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/5.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/6.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/7.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/8.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/9.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/10.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/11.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/12.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/13.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023newstar/14.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023%E9%A2%86%E8%88%AA%E6%9D%AF/3.png">
<meta property="article:published_time" content="2023-09-25T10:19:45.000Z">
<meta property="article:modified_time" content="2023-11-05T06:02:12.329Z">
<meta property="article:author" content="DexterJie">
<meta property="article:tag" content="Wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dexterjie.github.io/images/Ancient/0.jpg">


<link rel="canonical" href="https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/NewStarCTF2023/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/NewStarCTF2023/","path":"2023/09/25/赛题复现/NewStarCTF2023/","title":"2023NewStarCTF"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>2023NewStarCTF | DexterJie'Blog</title>
  







<link rel="dns-prefetch" href="waline-five-mocha.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DexterJie'Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">诗酒趁年华</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1456890009&auto=1&height=66"></iframe>
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Week1"><span class="nav-number">1.</span> <span class="nav-text">Week1</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto"><span class="nav-number">1.1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#brainfuck"><span class="nav-number">1.1.1.</span> <span class="nav-text">brainfuck</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Caesar%E2%80%99s-Secert"><span class="nav-number">1.1.2.</span> <span class="nav-text">Caesar’s Secert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fence"><span class="nav-number">1.1.3.</span> <span class="nav-text">Fence</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vigenere"><span class="nav-number">1.1.4.</span> <span class="nav-text">Vigenère</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyrsa"><span class="nav-number">1.1.5.</span> <span class="nav-text">babyrsa</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Small-d"><span class="nav-number">1.1.6.</span> <span class="nav-text">Small d</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyxor"><span class="nav-number">1.1.7.</span> <span class="nav-text">babyxor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyencoding"><span class="nav-number">1.1.8.</span> <span class="nav-text">babyencoding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Affine"><span class="nav-number">1.1.9.</span> <span class="nav-text">Affine</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyaes"><span class="nav-number">1.1.10.</span> <span class="nav-text">babyaes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Misc"><span class="nav-number">1.2.</span> <span class="nav-text">Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CyberChef%E2%80%99s-Secret"><span class="nav-number">1.2.1.</span> <span class="nav-text">CyberChef’s Secret</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reverse"><span class="nav-number">1.3.</span> <span class="nav-text">Reverse</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-RE"><span class="nav-number">1.3.1.</span> <span class="nav-text">easy_RE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Segments"><span class="nav-number">1.3.2.</span> <span class="nav-text">Segments</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ELF"><span class="nav-number">1.3.3.</span> <span class="nav-text">ELF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%92%B3"><span class="nav-number">1.3.4.</span> <span class="nav-text">咳</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Endian"><span class="nav-number">1.3.5.</span> <span class="nav-text">Endian</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AndroXor"><span class="nav-number">1.3.6.</span> <span class="nav-text">AndroXor</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web"><span class="nav-number">1.4.</span> <span class="nav-text">Web</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%84%E9%9C%B2%E7%9A%84%E7%A7%98%E5%AF%86"><span class="nav-number">1.4.1.</span> <span class="nav-text">泄露的秘密</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Week2"><span class="nav-number">2.</span> <span class="nav-text">Week2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto-1"><span class="nav-number">2.1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BB%B4%E5%95%A4"><span class="nav-number">2.1.1.</span> <span class="nav-text">滴啤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E6%AD%A2%E4%B8%80%E4%B8%AApi"><span class="nav-number">2.1.2.</span> <span class="nav-text">不止一个pi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#halfcandecode"><span class="nav-number">2.1.3.</span> <span class="nav-text">halfcandecode</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#part1"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">part1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#part2"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">part2</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rotate-Xor"><span class="nav-number">2.1.4.</span> <span class="nav-text">Rotate Xor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#partial-decrypt"><span class="nav-number">2.1.5.</span> <span class="nav-text">partial decrypt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#broadcast"><span class="nav-number">2.1.6.</span> <span class="nav-text">broadcast</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Week3"><span class="nav-number">3.</span> <span class="nav-text">Week3</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto-2"><span class="nav-number">3.1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Rabin%E2%80%99s-RSA"><span class="nav-number">3.1.1.</span> <span class="nav-text">Rabin’s RSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E6%98%8E%E7%9A%84%E5%AF%86%E7%A0%81%E9%A2%98"><span class="nav-number">3.1.2.</span> <span class="nav-text">小明的密码题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyrandom"><span class="nav-number">3.1.3.</span> <span class="nav-text">babyrandom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#knapsack"><span class="nav-number">3.1.4.</span> <span class="nav-text">knapsack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-crt%E2%80%94%E2%80%94%E2%80%94%E7%95%99%E7%A9%BA"><span class="nav-number">3.1.5.</span> <span class="nav-text">easy_crt———留空</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Door%E2%80%94%E2%80%94%E2%80%94%E7%95%99%E7%A9%BA"><span class="nav-number">3.1.6.</span> <span class="nav-text">Door———留空</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Week4"><span class="nav-number">4.</span> <span class="nav-text">Week4</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto-3"><span class="nav-number">4.1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RSA-Variation-II"><span class="nav-number">4.1.1.</span> <span class="nav-text">RSA Variation II</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyNTRU"><span class="nav-number">4.1.2.</span> <span class="nav-text">babyNTRU</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Smart"><span class="nav-number">4.1.3.</span> <span class="nav-text">Smart</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#signin"><span class="nav-number">4.1.4.</span> <span class="nav-text">signin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#error"><span class="nav-number">4.1.5.</span> <span class="nav-text">error</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%B3%E6%B1%82%E8%A7%A3%E7%9F%A9%E9%98%B5%E6%96%B9%E7%A8%8B%EF%BC%9A-begin-pmatrix-x-1-times-66-y-1-times-66-z-1-times-66-1-end-pmatrix-begin-pmatrix-A-66-times-200-B-66-times-200-C-66-times-200-e-1-times-200-end-pmatrix"><span class="nav-number">5.</span> <span class="nav-text">即求解矩阵方程：$$\begin{pmatrix}x_{1\times 66} &amp; y_{1\times 66} &amp; z_{1\times 66} &amp; 1\end{pmatrix}\begin{pmatrix}A_{66\times 200} \B_{66\times 200} \C_{66\times 200} \e_{1\times 200}\end{pmatrix}</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Week5"><span class="nav-number">6.</span> <span class="nav-text">Week5</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto-4"><span class="nav-number">6.1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#School-of-CRC32"><span class="nav-number">6.1.1.</span> <span class="nav-text">School of CRC32</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#last-signin"><span class="nav-number">6.1.2.</span> <span class="nav-text">last_signin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PseudoHell-EASY-PseudoHell-Hard"><span class="nav-number">6.1.3.</span> <span class="nav-text">PseudoHell_EASY &amp; PseudoHell_Hard</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Challenge1"><span class="nav-number">6.1.3.1.</span> <span class="nav-text">Challenge1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Challenge2"><span class="nav-number">6.1.3.2.</span> <span class="nav-text">Challenge2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Challenge3"><span class="nav-number">6.1.3.3.</span> <span class="nav-text">Challenge3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Challenge4"><span class="nav-number">6.1.3.4.</span> <span class="nav-text">Challenge4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Challenge5"><span class="nav-number">6.1.3.5.</span> <span class="nav-text">Challenge5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%EF%BC%8C%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF"><span class="nav-number">6.1.3.6.</span> <span class="nav-text">最后，值得注意的是</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E7%9A%84%E6%9C%80%E5%90%8E"><span class="nav-number">7.</span> <span class="nav-text">最后的最后</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="DexterJie"
      src="/images/0.jpg">
  <p class="site-author-name" itemprop="name">DexterJie</p>
  <div class="site-description" itemprop="description">一枚Crypto新手</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/NewStarCTF2023/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/0.jpg">
      <meta itemprop="name" content="DexterJie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DexterJie'Blog">
      <meta itemprop="description" content="一枚Crypto新手">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="2023NewStarCTF | DexterJie'Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023NewStarCTF
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-25 18:19:45" itemprop="dateCreated datePublished" datetime="2023-09-25T18:19:45+08:00">2023-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-05 14:02:12" itemprop="dateModified" datetime="2023-11-05T14:02:12+08:00">2023-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Wp/" itemprop="url" rel="index"><span itemprop="name">Wp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/NewStarCTF2023/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/NewStarCTF2023/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>32 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>2023NewStarCTF——Crypto——Wp（前两周）</p>
<span id="more"></span>

<p>除了密码，其他的内容建议别看，瞎做的</p>
<h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="brainfuck"><a href="#brainfuck" class="headerlink" title="brainfuck"></a>brainfuck</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">++++++++[&gt;&gt;++&gt;++++&gt;++++++&gt;++++++++&gt;++++++++++&gt;++++++++++++&gt;++++++++++++++&gt;++++++++++++++++&gt;++++++++++++++++++&gt;++++++++++++++++++++&gt;++++++++++++++++++++++&gt;++++++++++++++++++++++++&gt;++++++++++++++++++++++++++&gt;++++++++++++++++++++++++++++&gt;++++++++++++++++++++++++++++++&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;&gt;&gt;&gt;++++++.&gt;----.&lt;-----.&gt;-----.&gt;-----.&lt;&lt;&lt;-.&gt;&gt;++..&lt;.&gt;.++++++.....------.&lt;.&gt;.&lt;&lt;&lt;&lt;&lt;+++.&gt;&gt;&gt;&gt;+.&lt;&lt;&lt;+++++++.&gt;&gt;&gt;+.&lt;&lt;&lt;-------.&gt;&gt;&gt;-.&lt;&lt;&lt;+.+++++++.--..&gt;&gt;&gt;&gt;---.-.&lt;&lt;&lt;&lt;-.+++.&gt;&gt;&gt;&gt;.&lt;&lt;&lt;&lt;-------.+.&gt;&gt;&gt;&gt;&gt;++.</span><br></pre></td></tr></table></figure>

<p>找个<a target="_blank" rel="noopener" href="https://www.splitbrain.org/services/ook">网站</a>解密即可</p>
<p><code>flag&#123;Oiiaioooooiai#b7c0b1866fe58e12&#125;</code></p>
<h3 id="Caesar’s-Secert"><a href="#Caesar’s-Secert" class="headerlink" title="Caesar’s Secert"></a>Caesar’s Secert</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kqfl&#123;hf3x4w<span class="string">&#x27;x_h1umjw_n5_a4wd_3fed&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>flag</code>对应<code>kqfl</code>发现移动了5位</p>
<p><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/kaisamima.php">凯撒解密</a>网站解密，得到<code>flag&#123;ca3s4r&#39;s_c1pher_i5_v4ry_3azy&#125;</code></p>
<h3 id="Fence"><a href="#Fence" class="headerlink" title="Fence"></a>Fence</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fa&#123;ereigtepanet6680&#125;lgrodrn_h_litx<span class="comment">#8fc3</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/zhalanmima.php">栅栏解密</a>网站解密，栅栏数为2</p>
<p><code>flag&#123;reordering_the_plaintext#686f8c03&#125;</code></p>
<h3 id="Vigenere"><a href="#Vigenere" class="headerlink" title="Vigenère"></a>Vigenère</h3><p>题目描述：<code>le chiffre indéchiffrable</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pqcq&#123;qc_m1kt4_njn_5slp0b_lkyacx_gcdy1ud4_g3nv5x0&#125;</span><br></pre></td></tr></table></figure>

<p>对表👇，发现<code>f</code>对应<code>p</code>，<code>l</code>对应<code>q</code>，<code>a</code>对应<code>c</code>，<code>g</code>对应<code>q</code>，判断出<code>key=KFCK</code>，<strong>而且，题目描述是法语</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.guballa.de/vigenere-solver">Vigenere Solver | guballa.de</a>网站解密<strong>把English换成French</strong>，直接秒了，没用上<code>key</code></p>
<p><code>flag&#123;la_c1fr4_del_5ign0r_giovan_batt1st4_b3ll5s0&#125;</code></p>
<p><img src="/../../images/Ancient/0.jpg"></p>
<h3 id="babyrsa"><a href="#babyrsa" class="headerlink" title="babyrsa"></a>babyrsa</h3><p>题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>(<span class="params">n</span>):</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">        res *= getPrime(n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n = gen_prime(<span class="number">32</span>)</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    m = bytes_to_long(flag)</span><br><span class="line">    c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line"><span class="comment"># 17290066070594979571009663381214201320459569851358502368651245514213538229969915658064992558167323586895088933922835353804055772638980251328261</span></span><br><span class="line"><span class="comment"># 14322038433761655404678393568158537849783589481463521075694802654611048898878605144663750410655734675423328256213114422929994037240752995363595</span></span><br></pre></td></tr></table></figure>

<p>题目说了n很容易分解，<a target="_blank" rel="noopener" href="http://www.factordb.com/index.php">网站</a>解密</p>
<p><img src="/../../images/2023newstar/0.png"></p>
<p>得到一堆因子之后就常规解即可，没什么坑</p>
<p><strong>我推荐用Sagemath的</strong><code>factor</code>函数，直接分解n，不用一个一个输值</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line">phi = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> factor(n):</span><br><span class="line">    phi *= i[<span class="number">0</span>] - <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">d = gmpy2.invert(<span class="number">65537</span>,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"><span class="comment">#flag&#123;us4_s1ge_t0_cal_phI&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Small-d"><a href="#Small-d" class="headerlink" title="Small d"></a>Small d</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">d = getPrime(<span class="number">32</span>)</span><br><span class="line">e = inverse(d, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">n = p*q</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = 6755916696778185952300108824880341673727005249517850628424982499865744864158808968764135637141068930913626093598728925195859592078242679206690525678584698906782028671968557701271591419982370839581872779561897896707128815668722609285484978303216863236997021197576337940204757331749701872808443246927772977500576853559531421931943600185923610329322219591977644573509755483679059951426686170296018798771243136530651597181988040668586240449099412301454312937065604961224359235038190145852108473520413909014198600434679037524165523422401364208450631557380207996597981309168360160658308982745545442756884931141501387954248</span></span><br><span class="line"><span class="comment"># e = 8614531087131806536072176126608505396485998912193090420094510792595101158240453985055053653848556325011409922394711124558383619830290017950912353027270400567568622816245822324422993074690183971093882640779808546479195604743230137113293752897968332220989640710311998150108315298333817030634179487075421403617790823560886688860928133117536724977888683732478708628314857313700596522339509581915323452695136877802816003353853220986492007970183551041303875958750496892867954477510966708935358534322867404860267180294538231734184176727805289746004999969923736528783436876728104351783351879340959568183101515294393048651825</span></span><br><span class="line"><span class="comment"># n = 19873634983456087520110552277450497529248494581902299327237268030756398057752510103012336452522030173329321726779935832106030157682672262548076895370443461558851584951681093787821035488952691034250115440441807557595256984719995983158595843451037546929918777883675020571945533922321514120075488490479009468943286990002735169371404973284096869826357659027627815888558391520276866122370551115223282637855894202170474955274129276356625364663165723431215981184996513023372433862053624792195361271141451880123090158644095287045862204954829998614717677163841391272754122687961264723993880239407106030370047794145123292991433</span></span><br></pre></td></tr></table></figure>

<p>维纳攻击，网上找个脚本就能出</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continuedFra</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;计算连分数</span></span><br><span class="line"><span class="string">    :param x: 分子</span></span><br><span class="line"><span class="string">    :param y: 分母</span></span><br><span class="line"><span class="string">    :return: 连分数列表</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cf = []</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        cf.append(x // y)</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    <span class="keyword">return</span> cf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gradualFra</span>(<span class="params">cf</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;计算传入列表最后的渐进分数</span></span><br><span class="line"><span class="string">    :param cf: 连分数列表</span></span><br><span class="line"><span class="string">    :return: 该列表最后的渐近分数</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    numerator = <span class="number">0</span></span><br><span class="line">    denominator = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cf[::-<span class="number">1</span>]:</span><br><span class="line">        <span class="comment"># 这里的渐进分数分子分母要分开</span></span><br><span class="line">        numerator, denominator = denominator, x * denominator + numerator</span><br><span class="line">    <span class="keyword">return</span> numerator, denominator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_pq</span>(<span class="params">a, b, c</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用韦达定理解出pq，x^2−(p+q)∗x+pq=0</span></span><br><span class="line"><span class="string">    :param a:x^2的系数</span></span><br><span class="line"><span class="string">    :param b:x的系数</span></span><br><span class="line"><span class="string">    :param c:pq</span></span><br><span class="line"><span class="string">    :return:p，q</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    par = gmpy2.isqrt(b * b - <span class="number">4</span> * a * c)</span><br><span class="line">    <span class="keyword">return</span> (-b + par) // (<span class="number">2</span> * a), (-b - par) // (<span class="number">2</span> * a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getGradualFra</span>(<span class="params">cf</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;计算列表所有的渐近分数</span></span><br><span class="line"><span class="string">    :param cf: 连分数列表</span></span><br><span class="line"><span class="string">    :return: 该列表所有的渐近分数</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    gf = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(cf) + <span class="number">1</span>):</span><br><span class="line">        gf.append(gradualFra(cf[:i]))</span><br><span class="line">    <span class="keyword">return</span> gf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wienerAttack</span>(<span class="params">e, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param e:</span></span><br><span class="line"><span class="string">    :param n:</span></span><br><span class="line"><span class="string">    :return: 私钥d</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cf = continuedFra(e, n)</span><br><span class="line">    gf = getGradualFra(cf)</span><br><span class="line">    <span class="keyword">for</span> d, k <span class="keyword">in</span> gf:</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> (e * d - <span class="number">1</span>) % k != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">        p, q = solve_pq(<span class="number">1</span>, n - phi + <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> p * q == n:</span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = </span><br><span class="line">e = </span><br><span class="line">n = </span><br><span class="line"></span><br><span class="line">d = wienerAttack(e, n)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode())</span><br><span class="line"><span class="comment"># flag&#123;learn_some_continued_fraction_technique#dc16885c&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="babyxor"><a href="#babyxor" class="headerlink" title="babyxor"></a>babyxor</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ciphertext = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> flag:</span><br><span class="line">    ciphertext.append(f ^ key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(ciphertext).<span class="built_in">hex</span>())</span><br><span class="line"><span class="comment"># e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2</span></span><br></pre></td></tr></table></figure>

<p>了解一下异或的性质，通过flag的开头<code>flag&#123;</code>，以及密文的一小部分，即可求出<code>key=143</code>。<strong>需要注意类型转换</strong></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">c = <span class="string">&quot;e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2&quot;</span></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(c)</span><br><span class="line"></span><br><span class="line">key = <span class="built_in">ord</span>(<span class="string">&#x27;f&#x27;</span>) ^ c[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># print(key)</span></span><br><span class="line">key = <span class="number">143</span></span><br><span class="line">m = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    m.append(i ^ key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(m).<span class="built_in">hex</span>())</span><br><span class="line">flag = <span class="string">&quot;666c61677b7830725f31355f73796d6d337472795f616e645f65347a792121212121217d&quot;</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">16</span>)))</span><br><span class="line"><span class="comment">#flag&#123;x0r_15_symm3try_and_e4zy!!!!!!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="babyencoding"><a href="#babyencoding" class="headerlink" title="babyencoding"></a>babyencoding</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">part 1 of flag: ZmxhZ3tkYXp6bGluZ19lbmNvZGluZyM0ZTBhZDQ=</span><br><span class="line">part 2 of flag: MYYGGYJQHBSDCZJRMQYGMMJQMMYGGN3BMZSTIMRSMZSWCNY=</span><br><span class="line">part 3 of flag: =8S4U,3DR8SDY,C`S-F5F-C(S,S&lt;R-C`Q9F8S87T`</span><br></pre></td></tr></table></figure>

<p>第一部分密文包括大小写字母和数字，判断是base64（具体码表自行了解），网站解密👉<a target="_blank" rel="noopener" href="https://www.toolhelper.cn/EncodeDecode/Base64EncodeDecode">Base64解密</a></p>
<p>第二部分密文只有大写字母，判断是base32（具体码表自行了解），网站解密👉<a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/base.php">Base32解密</a></p>
<p>第三部分是UUencode，（不知道判断依据，我硬试出来的），网站解密👉<a target="_blank" rel="noopener" href="http://web.chacuo.net/charsetuuencode">在线UUencode解码</a></p>
<p><code>flag&#123;dazzling_encoding#4e0ad4f0ca08d1e1d0f10c0c7afe422fea7c55192c992036ef623372601ff3a&#125;</code></p>
<h3 id="Affine"><a href="#Affine" class="headerlink" title="Affine"></a>Affine</h3><p>题目:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag, key</span><br><span class="line"></span><br><span class="line">modulus = <span class="number">256</span></span><br><span class="line"></span><br><span class="line">ciphertext = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> flag:</span><br><span class="line">    ciphertext.append((key[<span class="number">0</span>]*f + key[<span class="number">1</span>]) % modulus)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(ciphertext).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment"># dd4388ee428bdddd5865cc66aa5887ffcca966109c66edcca920667a88312064</span></span><br></pre></td></tr></table></figure>

<p>设<code>key[0]=a</code>，<code>key[1]=b</code>，密文记作<code>c</code>，密文记作<code>x</code></p>
<p>于是有等式$c_1 \equiv ax_1 +b \mod 256$，$c_2\equiv ax_2 + b \mod 256$</p>
<p>两式相减得$c_1-c_2 \equiv a(x_1-x_2) \mod 256$，于是$a \equiv (c_1-c_2)\times(x_1-x_2)^{-1} \mod 256$</p>
<p>求出$a$之后，$b \equiv c -ax \mod 256$</p>
<p>有了$a,b$之后，根据$x \equiv (c - b)\times a^{-1} \mod 256$求得$x$</p>
<p>这里$x_1,x_2$从flag的头部<code>flag&#123;</code>选取，<strong>需要注意的就是对应上c</strong>，实际做的过程中，会有逆元不存在的情况（多尝试）</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">c = <span class="string">&quot;dd4388ee428bdddd5865cc66aa5887ffcca966109c66edcca920667a88312064&quot;</span></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(c)</span><br><span class="line"></span><br><span class="line">mod = <span class="number">256</span></span><br><span class="line">m = <span class="string">b&quot;flag&quot;</span></span><br><span class="line"></span><br><span class="line">a = (c[<span class="number">2</span>]-c[<span class="number">1</span>])*gmpy2.invert((m[<span class="number">2</span>]-m[<span class="number">1</span>]),mod) % mod			</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment">#a = 17</span></span><br><span class="line">b = (c[<span class="number">2</span>] - a*m[<span class="number">2</span>]) % mod</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment">#b = 23</span></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    flag.append((i-b)*gmpy2.invert(a,mod) % mod)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag).<span class="built_in">hex</span>())</span><br><span class="line">flag = <span class="string">&quot;666c61677b346666316e655f6331706865725f69355f766572795f33617a797d&quot;</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">16</span>)))</span><br><span class="line"><span class="comment">#flag&#123;4ff1ne_c1pher_i5_very_3azy&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="babyaes"><a href="#babyaes" class="headerlink" title="babyaes"></a>babyaes</h3><p>题目：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">return</span> data + <span class="string">b&quot;&quot;</span>.join([<span class="string">b&#x27;\x00&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span> - <span class="built_in">len</span>(data))])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag_ = pad(flag)</span><br><span class="line">    key = os.urandom(<span class="number">16</span>) * <span class="number">2</span></span><br><span class="line">    iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(bytes_to_long(key) ^ bytes_to_long(iv) ^ <span class="number">1</span>)</span><br><span class="line">    aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    enc_flag = aes.encrypt(flag_)</span><br><span class="line">    <span class="built_in">print</span>(enc_flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"><span class="comment"># 3657491768215750635844958060963805125333761387746954618540958489914964573229</span></span><br><span class="line"><span class="comment"># b&#x27;&gt;]\xc1\xe5\x82/\x02\x7ft\xf1B\x8d\n\xc1\x95i&#x27;</span></span><br></pre></td></tr></table></figure>

<p>根据异或的性质发现，<code>key</code>和<code>iv</code>异或之后，有一半的<code>key</code>是不受影响的，根据这个特性，我们可以求出<code>key</code></p>
<p>求出<code>key</code>之后反求<code>iv</code></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">tmp = <span class="number">3657491768215750635844958060963805125333761387746954618540958489914964573229</span> ^ <span class="number">1</span></span><br><span class="line">tmp1 = long_to_bytes(tmp)</span><br><span class="line"></span><br><span class="line">key = tmp1[:<span class="number">16</span>] * <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="comment">#key = b&#x27;\x08\x16\x11%\xa0\xa6\xc5\xcb^\x02\x99NF`\xea,\x08\x16\x11%\xa0\xa6\xc5\xcb^\x02\x99NF`\xea,&#x27;</span></span><br><span class="line">iv = long_to_bytes(bytes_to_long(key)^bytes_to_long(tmp1))</span><br><span class="line"><span class="built_in">print</span>(iv)</span><br><span class="line"><span class="comment">#iv = b&#x27;\xe3Z\x19Ga&gt;\x07\xcc\xd1\xa1X\x01c\x11\x16\x00&#x27;</span></span><br><span class="line">c = <span class="string">b&#x27;&gt;]\xc1\xe5\x82/\x02\x7ft\xf1B\x8d\n\xc1\x95i&#x27;</span></span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">flag = aes.decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><code>flag&#123;firsT_cry_Aes&#125;</code></p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="CyberChef’s-Secret"><a href="#CyberChef’s-Secret" class="headerlink" title="CyberChef’s Secret"></a>CyberChef’s Secret</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">来签到吧！下面这个就是flag，不过它看起来好像怪怪的:-)</span><br><span class="line">M5YHEUTEKFBW6YJWKZGU44CXIEYUWMLSNJLTOZCXIJTWCZD2IZRVG4TJPBSGGWBWHFMXQTDFJNXDQTA=</span><br></pre></td></tr></table></figure>

<p><code>base32</code> -&gt; <code>base58</code>  -&gt; <code>base64</code></p>
<p><code>flag&#123;Base_15_S0_Easy_^_^&#125;</code></p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="easy-RE"><a href="#easy-RE" class="headerlink" title="easy_RE"></a>easy_RE</h3><p><img src="/../../images/2023newstar/1.png"></p>
<p>转ASCII码，再拼起来</p>
<p><code>flag&#123;we1c0me_to_rev3rse!!&#125;</code></p>
<h3 id="Segments"><a href="#Segments" class="headerlink" title="Segments"></a>Segments</h3><p>ida64打开–&gt;<code>shift-F7</code></p>
<p><img src="/../../images/2023newstar/2.png"></p>
<p><code>flag&#123;You_ar3_g0od_at_f1ding_ELF_segments&#125;</code></p>
<h3 id="ELF"><a href="#ELF" class="headerlink" title="ELF"></a>ELF</h3><p>IDA打开</p>
<p><img src="/../../images/2023newstar/3.png"></p>
<p>再查看<code>encode</code>函数</p>
<p><img src="/../../images/2023newstar/4.png"></p>
<p>传入字符串<code>s</code>，把<code>s</code>中的每个字符先和<code>0x20</code>异或，再加上16</p>
<p>整个流程就是，用户传入一个字符串<code>s</code>，经过<code>encode()</code>函数加密，再经过<code>base64</code>加密，把<code>base64</code>加密后的字符串和<code>VlxRV2t0II8kX2WPJ15fZ49nWFEnj3V8do8hYy9t</code>比较。<code>strcmp(a,b)</code>：如果<code>a</code>,<code>b</code>相等，返回<code>0</code></p>
<p>我们把密文解密回去就是<code>flag</code></p>
<p><strong>另外：Linux执行ELF文件，要先<code>chmod +x +文件名</code></strong></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">c = <span class="string">b&quot;VlxRV2t0II8kX2WPJ15fZ49nWFEnj3V8do8hYy9t&quot;</span></span><br><span class="line">m = base64.b64decode(c)</span><br><span class="line"></span><br><span class="line">mes = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">    mm = (m[i]-<span class="number">16</span>) ^ <span class="number">0x20</span></span><br><span class="line">    mes += <span class="built_in">chr</span>(mm)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(mes)</span><br><span class="line"><span class="comment">#flag&#123;D0_4ou_7now_wha7_ELF_1s?&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="咳"><a href="#咳" class="headerlink" title="咳"></a>咳</h3><p><strong>Exeinfo Pe</strong>查壳</p>
<p><img src="/../../images/2023newstar/5.png"></p>
<p>发现加壳了</p>
<p>用upx脱壳</p>
<p><img src="/../../images/2023newstar/6.png"></p>
<p>脱壳后再丢入Exeinfo PE:</p>
<p><img src="/../../images/2023newstar/7.png"></p>
<p>丢入IDA</p>
<p><img src="/../../images/2023newstar/8.png"></p>
<p>我们传入一个字符串作为<code>Str1</code>，经过for循环，最后把<code>Str1</code>和<code>enc</code>比较，<code>enc=gmbh|D1ohsbuv2bu21ot1oQb332ohUifG2stuQ[HBMBYZ2fwf2~</code></p>
<p>发现for循环中，每次把<code>Str1[i]</code>都自增了一次，所以只要把密文每个字符减去1就是flag</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="string">&quot;gmbh|D1ohsbuv2bu21ot1oQb332ohUifG2stuQ[HBMBYZ2fwf2~&quot;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    m = <span class="built_in">ord</span>(i) - <span class="number">1</span></span><br><span class="line">    flag += <span class="built_in">chr</span>(m)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;C0ngratu1at10ns0nPa221ngTheF1rstPZGALAXY1eve1&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Endian"><a href="#Endian" class="headerlink" title="Endian"></a>Endian</h3><p><img src="/../../images/2023newstar/9.png"></p>
<p>主要看这段验证函数</p>
<p>需要确保<code>v5</code>每次都等于<code>array[i] ^ 0x12345678</code></p>
<p><img src="/../../images/2023newstar/10.png"></p>
<p>由上图知<code>array = [0x75553A1E,0x7B583A03,0x4D58220C,0x7B50383D,0x736B3819,0x0]</code></p>
<p>把<code>array</code>异或上<code>0x12345678</code>即是明文</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a = [<span class="number">0x75553A1E</span>,<span class="number">0x7B583A03</span>,<span class="number">0x4D58220C</span>,<span class="number">0x7B50383D</span>,<span class="number">0x736B3819</span>,<span class="number">0x0</span>]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    m = long_to_bytes(a[i] ^ <span class="number">0x12345678</span>)[::-<span class="number">1</span>]</span><br><span class="line">    flag += m</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag + <span class="string">b&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="comment">#flag&#123;llittl_Endian_a&#125;</span></span><br></pre></td></tr></table></figure>

<p>因为涉及大小端的知识，所以要逆序一下</p>
<p>值得注意的是<code>v5 += 4</code>指的是从<code>v5[:4]</code>到<code>v5[4:8]</code>，4为一个划分</p>
<h3 id="AndroXor"><a href="#AndroXor" class="headerlink" title="AndroXor"></a>AndroXor</h3><p>安卓逆向，用上JEB工具</p>
<p><img src="/../../images/2023newstar/11.png"></p>
<p><img src="/../../images/2023newstar/12.png"></p>
<p>找到关键函数以及调用该函数的地方</p>
<p>加密过程可以理解为<code>c[i] = s[i] ^ s1[i % len(s1)]</code></p>
<p>而c就是后面这段数组，从调用出可以知道<code>s1=happyx3</code></p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&quot;happyx3&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">c = [<span class="string">&#x27;\u000E&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\u0011&#x27;</span>, <span class="string">&#x27;\u0017&#x27;</span>, <span class="string">&#x27;\u0002&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\u001E&#x27;</span>, <span class="string">&#x27;\u0014&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\u0002&#x27;</span>, <span class="string">&#x27;\f&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;\u000B&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;\u0019&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">    m = <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)]) ^ <span class="built_in">ord</span>(c[i])</span><br><span class="line">    flag += <span class="built_in">chr</span>(m)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;3z_And0r1d_X0r_x1x1&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="泄露的秘密"><a href="#泄露的秘密" class="headerlink" title="泄露的秘密"></a>泄露的秘密</h3><p>参考<a target="_blank" rel="noopener" href="https://c1oudfl0w0.github.io/blog/2023/05/10/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">在野web手的文章</a></p>
<blockquote>
<p>robots后台泄露</p>
</blockquote>
<p>访问<code>url/robots.txt</code></p>
<p>得到<code>flag&#123;r0bots_1s_s0_us3ful</code></p>
<blockquote>
<p>php源码泄露</p>
</blockquote>
<p>访问<code>url/www.zip</code>，连同<code>robots.txt</code>都给了</p>
<p>得到<code>_4nd_www.zip_1s_s0_d4ng3rous&#125;</code></p>
<p>flag:<code>flag&#123;r0bots_1s_s0_us3ful_4nd_www.zip_1s_s0_d4ng3rous&#125;</code></p>
<h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><h2 id="Crypto-1"><a href="#Crypto-1" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="滴啤"><a href="#滴啤" class="headerlink" title="滴啤"></a>滴啤</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>(<span class="params">number</span>):</span><br><span class="line">    p = getPrime(number//<span class="number">2</span>)</span><br><span class="line">    q = getPrime(number//<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> p,q</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">p,q = gen_prime(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(p*q)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(d%(p-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m,e,p*q))</span><br><span class="line"><span class="comment"># 93172788492926438327710592564562854206438712390394636149385608321800134934361353794206624031396988124455847768883785503795521389178814791213054124361007887496351504099772757164211666778414800698976335767027868761735533195880182982358937211282541379697714874313863354097646233575265223978310932841461535936931</span></span><br><span class="line"><span class="comment"># 307467153394842898333761625034462907680907310539113349710634557900919735848784017007186630645110812431448648273172817619775466967145608769260573615221635</span></span><br><span class="line"><span class="comment"># 52777705692327501332528487168340175436832109866218597778822262268417075157567880409483079452903528883040715097136293765188858187142103081639134055997552543213589467751037524482578093572244313928030341356359989531451789166815462417484822009937089058352982739611755717666799278271494933382716633553199739292089</span></span><br></pre></td></tr></table></figure>

<p>$\because d_p \equiv d \mod (p-1)$</p>
<p>左右同乘$e$得到</p>
<p>$\therefore d_p \times e \equiv d \times e \mod (p-1)$</p>
<p>则$d \times e &#x3D; k_1(p-1)+d_p\times e$</p>
<p>又$\because d\times e &#x3D; k_2(p-1)(q-1) + 1$</p>
<p>化简得$d_p \times e &#x3D; (p-1)[k_2(q-1)-k_1] + 1$</p>
<p>$\because d_p &lt; p - 1$，$\therefore 0 &lt; k_2(q-1)-k_1 &lt; e$</p>
<p>遍历$i \in (0,e)$的所有值，如果$d_p \times e - 1$能够整除$i$，那我们就可以求得$p-1$</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">93172788492926438327710592564562854206438712390394636149385608321800134934361353794206624031396988124455847768883785503795521389178814791213054124361007887496351504099772757164211666778414800698976335767027868761735533195880182982358937211282541379697714874313863354097646233575265223978310932841461535936931</span></span><br><span class="line">dp = <span class="number">307467153394842898333761625034462907680907310539113349710634557900919735848784017007186630645110812431448648273172817619775466967145608769260573615221635</span></span><br><span class="line">c = <span class="number">52777705692327501332528487168340175436832109866218597778822262268417075157567880409483079452903528883040715097136293765188858187142103081639134055997552543213589467751037524482578093572244313928030341356359989531451789166815462417484822009937089058352982739611755717666799278271494933382716633553199739292089</span></span><br><span class="line">e =<span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dp_leak</span>(<span class="params">dp,c,n,e</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,e):</span><br><span class="line">        t = (dp * e - <span class="number">1</span>) % i        </span><br><span class="line">        <span class="keyword">if</span> t == <span class="number">0</span>:</span><br><span class="line">            p = (dp * e - <span class="number">1</span>) // i + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">                q = n // p</span><br><span class="line">                d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line">                </span><br><span class="line">dp_leak(dp,c,n,e)</span><br><span class="line"><span class="comment">#flag&#123;cd5ff82d-989c-4fbf-9543-3f98ab567546&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="不止一个pi"><a href="#不止一个pi" class="headerlink" title="不止一个pi"></a>不止一个pi</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p**<span class="number">3</span>*q**<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q = &quot;</span>,q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p = &quot;</span>,p)</span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m,<span class="number">65537</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = &quot;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># q =  115478867870347527660680329271012852043845868401928361076102779938370270670897498759391844282137149013845956612257534640259997979275610235395706473965973203544920469416283181677660262509481282536465796731401967694683575843183509430017972506752901270887444490905891490955975762524187534052478173966117471143713</span></span><br><span class="line"><span class="comment"># p =  171790960371317244087615913047696670778115765201883835525456016207966048658582417842936925149582378305610304505530997833147251832289276125084339614808085356814202236463900384335878760177630501950384919794386619363394169016560485152083893183420911295712446925318391793822371390439655160077212739260871923935217</span></span><br><span class="line"><span class="comment"># c =  4459183928324369762397671605317600157512712503694330767938490496225669985050002776253470841193156951087663107866714426230222002399666306287642591077990897883174134404896800482234781531592939043551832049756571987010173667074168282355520711905659013076509353523088583347373358980842707686611157050425584598825151399870268083867269912139634929397957514376826145870752116583185351576051776627208882377413433140577461314504762388617595282085102271510792305560608934353515552201553674287954987323321512852114353266359364282603487098916608302944694600227628787791876600901537888110093703612414836676571562487005330299996908873589228072982641114844761980143047920770114535924959765518365614709272297666231481655857243004072049094078525569460293381479558148506346966064906164209362147313371962567040047084516510135054571080612077333228195608109065475260832580192321853906138811139036658485688320161530131239854003996457871663456850196483520239675981391047452381998620386899101820782421605287708727667663038905378115235163773867508258208867367314108701855709002634592329976912239956212490788262396106230191754680813790425433763427315230330459349320412354189010684525105318610102936715203529222491642807382215023468936755584632849348996666528981269240867612068382243822300418856599418223875522408986596925018975565057696218423036459144392625166761522424721268971676010427096379610266649911939139451989246194525553533699831110568146220347603627745407449761792135898110139743498767543521297525802809254842518002190381508964357001211353997061417710783337</span></span><br></pre></td></tr></table></figure>

<p>$\because n &#x3D; p^3\times q^2$，$\therefore \phi(n) &#x3D; p^2\times (p-1) \times q \times (q-1)$</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">q =  <span class="number">115478867870347527660680329271012852043845868401928361076102779938370270670897498759391844282137149013845956612257534640259997979275610235395706473965973203544920469416283181677660262509481282536465796731401967694683575843183509430017972506752901270887444490905891490955975762524187534052478173966117471143713</span></span><br><span class="line">p =  <span class="number">171790960371317244087615913047696670778115765201883835525456016207966048658582417842936925149582378305610304505530997833147251832289276125084339614808085356814202236463900384335878760177630501950384919794386619363394169016560485152083893183420911295712446925318391793822371390439655160077212739260871923935217</span></span><br><span class="line">c =  <span class="number">4459183928324369762397671605317600157512712503694330767938490496225669985050002776253470841193156951087663107866714426230222002399666306287642591077990897883174134404896800482234781531592939043551832049756571987010173667074168282355520711905659013076509353523088583347373358980842707686611157050425584598825151399870268083867269912139634929397957514376826145870752116583185351576051776627208882377413433140577461314504762388617595282085102271510792305560608934353515552201553674287954987323321512852114353266359364282603487098916608302944694600227628787791876600901537888110093703612414836676571562487005330299996908873589228072982641114844761980143047920770114535924959765518365614709272297666231481655857243004072049094078525569460293381479558148506346966064906164209362147313371962567040047084516510135054571080612077333228195608109065475260832580192321853906138811139036658485688320161530131239854003996457871663456850196483520239675981391047452381998620386899101820782421605287708727667663038905378115235163773867508258208867367314108701855709002634592329976912239956212490788262396106230191754680813790425433763427315230330459349320412354189010684525105318610102936715203529222491642807382215023468936755584632849348996666528981269240867612068382243822300418856599418223875522408986596925018975565057696218423036459144392625166761522424721268971676010427096379610266649911939139451989246194525553533699831110568146220347603627745407449761792135898110139743498767543521297525802809254842518002190381508964357001211353997061417710783337</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">n = p**<span class="number">3</span>*q**<span class="number">2</span></span><br><span class="line">phi = p**<span class="number">2</span>*(p-<span class="number">1</span>) * q*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment">#flag&#123;bu_zhi_yige_p1dsaf&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="halfcandecode"><a href="#halfcandecode" class="headerlink" title="halfcandecode"></a>halfcandecode</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>(<span class="params">number</span>):</span><br><span class="line">    p = getPrime(number // <span class="number">2</span>)</span><br><span class="line">    q = gmpy2.next_prime(p)</span><br><span class="line">    <span class="keyword">return</span> p * q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_hash</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> md5(m.encode()).hexdigest()</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = gen_prime(<span class="number">1024</span>)</span><br><span class="line">m1 = bytes_to_long(flag[:<span class="built_in">len</span>(flag) // <span class="number">2</span>].encode() + os.urandom(<span class="number">8</span>))</span><br><span class="line">c1 = <span class="built_in">pow</span>(m1, e, n)</span><br><span class="line">m2 = flag[<span class="built_in">len</span>(flag) // <span class="number">2</span>:]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;out.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="built_in">str</span>(n) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="built_in">str</span>(c1) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> m2:</span><br><span class="line">        f.write(<span class="built_in">str</span>(md5_hash(t))+<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">113021375625152132650190712599981988437204747209058903684387817901743950240396649608148052382567758817980625681440722581705541952712770770893410244646286485083142929097056891857721084849003860977390188797648441292666187101736281034814846427200984062294497391471725496839508139522313741138689378936638290593969</span><br><span class="line">43054766235531111372528859352567995977948625157340673795619075138183683929001986100833866227688081563803862977936680822407924897357491201356413493645515962458854570731176193055259779564051991277092941379392700065150286936607784073707448630150405898083000157174927733260198355690620639487049523345380364948649</span><br><span class="line">4a8a08f09d37b73795649038408b5f33</span><br><span class="line">03c7c0ace395d80182db07ae2c30f034</span><br><span class="line">e1671797c52e15f763380b45e841ec32</span><br><span class="line">b14a7b8059d9c055954c92674ce60032</span><br><span class="line">e358efa489f58062f10dd7316b65649e</span><br><span class="line">cfcd208495d565ef66e7dff9f98764da</span><br><span class="line">b14a7b8059d9c055954c92674ce60032</span><br><span class="line">8fa14cdd754f91cc6554c9e71929cce7</span><br><span class="line">0cc175b9c0f1b6a831c399e269772661</span><br><span class="line">4a8a08f09d37b73795649038408b5f33</span><br><span class="line">e358efa489f58062f10dd7316b65649e</span><br><span class="line">cfcd208495d565ef66e7dff9f98764da</span><br><span class="line">4b43b0aee35624cd95b910189b3dc231</span><br><span class="line">cbb184dd8e05c9709e5dcaedaa0495cf</span><br></pre></td></tr></table></figure>

<h4 id="part1"><a href="#part1" class="headerlink" title="part1"></a>part1</h4><p>这部分，$p,q$很接近，直接把$n$开根号取下一个素数作为$p$</p>
<h4 id="part2"><a href="#part2" class="headerlink" title="part2"></a>part2</h4><p>哈希，爆破就完了</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">113021375625152132650190712599981988437204747209058903684387817901743950240396649608148052382567758817980625681440722581705541952712770770893410244646286485083142929097056891857721084849003860977390188797648441292666187101736281034814846427200984062294497391471725496839508139522313741138689378936638290593969</span></span><br><span class="line">c = <span class="number">43054766235531111372528859352567995977948625157340673795619075138183683929001986100833866227688081563803862977936680822407924897357491201356413493645515962458854570731176193055259779564051991277092941379392700065150286936607784073707448630150405898083000157174927733260198355690620639487049523345380364948649</span></span><br><span class="line">HASH = [<span class="string">&quot;4a8a08f09d37b73795649038408b5f33&quot;</span>,<span class="string">&quot;03c7c0ace395d80182db07ae2c30f034&quot;</span>,<span class="string">&quot;e1671797c52e15f763380b45e841ec32&quot;</span>,<span class="string">&quot;b14a7b8059d9c055954c92674ce60032&quot;</span>,<span class="string">&quot;e358efa489f58062f10dd7316b65649e&quot;</span>,<span class="string">&quot;cfcd208495d565ef66e7dff9f98764da&quot;</span>,<span class="string">&quot;b14a7b8059d9c055954c92674ce60032&quot;</span>,<span class="string">&quot;8fa14cdd754f91cc6554c9e71929cce7&quot;</span>,<span class="string">&quot;0cc175b9c0f1b6a831c399e269772661&quot;</span>,<span class="string">&quot;4a8a08f09d37b73795649038408b5f33&quot;</span>,<span class="string">&quot;e358efa489f58062f10dd7316b65649e&quot;</span>,<span class="string">&quot;cfcd208495d565ef66e7dff9f98764da&quot;</span>,<span class="string">&quot;4b43b0aee35624cd95b910189b3dc231&quot;</span>,<span class="string">&quot;cbb184dd8e05c9709e5dcaedaa0495cf&quot;</span>]</span><br><span class="line"></span><br><span class="line">t = gmpy2.iroot(n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">p = gmpy2.next_prime(t)</span><br><span class="line">q = n // p</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">flag1 = long_to_bytes(m)[:-<span class="number">8</span>]</span><br><span class="line"></span><br><span class="line">flag2 = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="built_in">len</span>(HASH)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        <span class="built_in">hash</span> = hashlib.md5(<span class="built_in">chr</span>(j).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hash</span> == HASH[i]:</span><br><span class="line">            flag2 += <span class="built_in">chr</span>(j)</span><br><span class="line">flag = flag1+ flag2.encode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;two_cloabcse_t0_fact0r&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Rotate-Xor"><a href="#Rotate-Xor" class="headerlink" title="Rotate Xor"></a>Rotate Xor</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">k1 = getPrime(<span class="number">64</span>)</span><br><span class="line">k2 = getPrime(<span class="number">64</span>)</span><br><span class="line">ROUND = <span class="number">12</span></span><br><span class="line">ciphertext = xor(flag, long_to_bytes(k1))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">round_rotate_left</span>(<span class="params">num, step</span>):</span><br><span class="line">    <span class="keyword">return</span> ((num) &lt;&lt; step | num &gt;&gt; (<span class="number">64</span>-step)) &amp; <span class="number">0xffffffffffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_key</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(ROUND):</span><br><span class="line">        key = round_rotate_left(key, <span class="number">3</span>) ^ k2</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ciphertext =&#x27;</span>, ciphertext)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;enc_k1 =&#x27;</span>, encrypt_key(k1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;k2 =&#x27;</span>, k2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ciphertext = b&#x27;\x8dSyy\xd2\xce\xe2\xd2\x98\x0fth\x9a\xc6\x8e\xbc\xde`zl\xc0\x85\xe0\xe4\xdfQlc&#x27;</span></span><br><span class="line"><span class="comment"># enc_k1 = 7318833940520128665</span></span><br><span class="line"><span class="comment"># k2 = 9982833494309156947</span></span><br></pre></td></tr></table></figure>

<p>根据<code>round_rotate_left(num,step)</code>的特点</p>
<p>假设此函数加密后的结果为<code>c</code>，那么<code>c</code>的低<code>num</code>位就是<code>m</code>的高<code>num</code>位，<code>c</code>的高<code>64-num</code>位就是<code>m</code>的低<code>64-num</code>位，拼接即可</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Cryptodome.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">key,ROUND</span>):</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(ROUND):</span><br><span class="line">        key= k2 ^ key</span><br><span class="line">        bin_k = <span class="built_in">bin</span>(key)[<span class="number">2</span>:].zfill(<span class="number">64</span>)</span><br><span class="line">        k_h = bin_k[-<span class="number">3</span>:]</span><br><span class="line">        k_l = bin_k[:-<span class="number">3</span>]</span><br><span class="line">        key = <span class="built_in">int</span>(k_h + k_l,<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">b&#x27;\x8dSyy\xd2\xce\xe2\xd2\x98\x0fth\x9a\xc6\x8e\xbc\xde`zl\xc0\x85\xe0\xe4\xdfQlc&#x27;</span></span><br><span class="line">enc_k1 = <span class="number">7318833940520128665</span></span><br><span class="line">k2 = <span class="number">9982833494309156947</span></span><br><span class="line">ROUND = <span class="number">12</span></span><br><span class="line">k1 = decrypt(enc_k1,ROUND)</span><br><span class="line"><span class="built_in">print</span>(k1)</span><br><span class="line">flag = xor(ciphertext,long_to_bytes(k1))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;z3_s0lv3r_15_bri11i4nt&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="partial-decrypt"><a href="#partial-decrypt" class="headerlink" title="partial decrypt"></a>partial decrypt</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">n = p*q </span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line">dp = inverse(e, (p-<span class="number">1</span>))</span><br><span class="line">dq = inverse(e, (q-<span class="number">1</span>))</span><br><span class="line">m1 = <span class="built_in">pow</span>(c,dp, p)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c,dq, q)</span><br><span class="line">q_inv = inverse(q, p)</span><br><span class="line">h = (q_inv*(m1-m2)) % p</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m2 =&#x27;</span>, m2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;h =&#x27;</span>, h)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q =&#x27;</span>, q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># m2 = 4816725107096625408335954912986735584642230604517017890897348901815741632668751378729851753037917164989698483856004115922538576470127778342121497852554884</span></span><br><span class="line"><span class="comment"># h = 4180720137090447835816240697100630525624574275</span></span><br><span class="line"><span class="comment"># q = 7325294399829061614283539157853382831627804571792179477843187097003503398904074108324900986946175657737035770512213530293277111992799331251231223710406931</span></span><br></pre></td></tr></table></figure>

<p>考点：dp,dq泄露</p>
<p>原理见👉<a href="https://dexterjie.github.io/2023/07/06/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/RSA1/#%E4%B9%9D%E3%80%81dp-dq%E6%B3%84%E9%9C%B2">RSA(一) | DexterJie’Blog</a></p>
<p>最后得到</p>
<p>$m_p \equiv c^{d_p} \mod p$</p>
<p>$m_q \equiv c^{d_q} \mod q$</p>
<p>$m &#x3D; ((m_q - m_p)\times p^{-1})\times p + m_p \mod n$，其中$p^{-1}$是$p$模$q$的逆元</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">m2 = <span class="number">4816725107096625408335954912986735584642230604517017890897348901815741632668751378729851753037917164989698483856004115922538576470127778342121497852554884</span></span><br><span class="line">h = <span class="number">4180720137090447835816240697100630525624574275</span></span><br><span class="line">q = <span class="number">7325294399829061614283539157853382831627804571792179477843187097003503398904074108324900986946175657737035770512213530293277111992799331251231223710406931</span></span><br><span class="line"></span><br><span class="line">m = h * q + m2</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment">#flag&#123;rsa_with_crt#b12a3a020c9cc5f1a6df4618256f7c88c83fdd95aab1a2b2656d760475bd0bf1&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="broadcast"><a href="#broadcast" class="headerlink" title="broadcast"></a>broadcast</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">menu = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Welcome to RSA Broadcasting system</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">please select your option:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. brocast the flag</span></span><br><span class="line"><span class="string">2. exit</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">e = <span class="number">17</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">broadcast_the_flag</span>():</span><br><span class="line">    p = getPrime(<span class="number">256</span>)</span><br><span class="line">    q = getPrime(<span class="number">256</span>)</span><br><span class="line">    n=p*q</span><br><span class="line">    m = bytes_to_long(flag)</span><br><span class="line">    c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;e =&#x27;</span>, e)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(menu)</span><br><span class="line">    opt = <span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        opt = <span class="built_in">int</span>(opt)</span><br><span class="line">        <span class="keyword">if</span> opt == <span class="number">1</span>:</span><br><span class="line">            broadcast_the_flag()</span><br><span class="line">        <span class="keyword">elif</span> opt == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;invalid option&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;oh no, something wrong!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>考点：中国剩余定理</p>
<p>一般$e&#x3D;3$的时候，3组n,c就能解决，但是这题$e&#x3D;17$，需要17组n,c才能解</p>
<p>所以写个脚本进行nc</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;node4.buuoj.cn&#x27;</span>                  <span class="comment">#ip地址</span></span><br><span class="line">port =  <span class="number">28352</span>                              <span class="comment">#端口</span></span><br><span class="line"></span><br><span class="line">sh = remote(host,port)                  <span class="comment">#建立连接  </span></span><br><span class="line">N = []</span><br><span class="line">C = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">17</span>):</span><br><span class="line">    data = sh.recvuntil(<span class="string">b&quot;&gt;&quot;</span>)</span><br><span class="line">    <span class="comment"># print(data.decode())</span></span><br><span class="line">    sh.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    n = sh.recvline().decode().split(<span class="string">&#x27;=&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    N.append(<span class="built_in">eval</span>(n))</span><br><span class="line">    c = sh.recvline().decode().split(<span class="string">&#x27;=&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    C.append(<span class="built_in">eval</span>(c))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(N) &gt;= <span class="number">17</span>:</span><br><span class="line">        M = crt(N,C)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> M:</span><br><span class="line">            m = gmpy2.iroot(<span class="built_in">int</span>(j),<span class="number">17</span>)[<span class="number">0</span>]</span><br><span class="line">            flag = long_to_bytes(m)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;d0_n0t_sh0ut_loud1y_1n_th3_d4rk_f0r3st&#125;</span></span><br></pre></td></tr></table></figure>



<h1 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h1><h2 id="Crypto-2"><a href="#Crypto-2" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Rabin’s-RSA"><a href="#Rabin’s-RSA" class="headerlink" title="Rabin’s RSA"></a>Rabin’s RSA</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">p = getPrime(<span class="number">64</span>)</span><br><span class="line">q = getPrime(<span class="number">64</span>)</span><br><span class="line"><span class="keyword">assert</span> p % <span class="number">4</span> == <span class="number">3</span></span><br><span class="line"><span class="keyword">assert</span> q % <span class="number">4</span> == <span class="number">3</span></span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">e = <span class="number">2</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 201354090531918389422241515534761536573</span></span><br><span class="line"><span class="comment"># c = 20442989381348880630046435751193745753</span></span><br></pre></td></tr></table></figure>

<p>n能分解，对Rabin不是很熟悉，套了一下Rabin脚本</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p= <span class="number">13934102561950901579</span></span><br><span class="line">q= <span class="number">14450452739004884887</span></span><br><span class="line">n= p*q</span><br><span class="line">c= <span class="number">20442989381348880630046435751193745753</span></span><br><span class="line">e= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">mp = <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">mq = <span class="built_in">pow</span>(c, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">inv_p = gmpy2.invert(p, q)</span><br><span class="line">inv_q = gmpy2.invert(q, p)</span><br><span class="line"></span><br><span class="line">a = (inv_p * p * mq + inv_q * q * mp) % n</span><br><span class="line">b = n - <span class="built_in">int</span>(a)</span><br><span class="line">c = (inv_p * p * mq - inv_q * q * mp) % n</span><br><span class="line">d = n - <span class="built_in">int</span>(c)</span><br><span class="line"><span class="comment"># 因为rabin 加密有四种结果，全部列出。</span></span><br><span class="line">aa = [a, b, c, d]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> aa:</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(i)))</span><br><span class="line">    <span class="comment"># flag&#123;r4b1n#4c58&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="小明的密码题"><a href="#小明的密码题" class="headerlink" title="小明的密码题"></a>小明的密码题</h3><blockquote>
<p>高位泄露的考点</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> *</span><br><span class="line">flag_part = flag_content + <span class="string">&#x27;#&#x27;</span> + secret_token</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag_part.encode())</span><br><span class="line"></span><br><span class="line">e = <span class="number">5</span></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag_part =&#x27;</span>, flag_part)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;--- hint begin ---&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag = &quot;flag&#123;&quot; + flag_part + &quot;&#125;&quot;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;type of secret_token is&#x27;</span>, <span class="built_in">type</span>(secret_token))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;length of secret_token is&#x27;</span>, <span class="built_in">len</span>(secret_token))</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 131889193322687215946601811511407251196213571687093913054335139712633125177496800529685285401802802683116451016274353008428347997732857844896393358010946452397522017632024075459908859131965234835870443110233375074265933004741459359128684375786221535003839961829770182916778717973782408036072622166388614214899</span></span><br><span class="line"><span class="comment"># c = 11188201757361363141578235564807411583085091933389381887827791551369738717117549969067660372214366275040055647621817803877495473068767571465521881010707873686036336475554105314475193676388608812872218943728455841652208711802376453034141883236142677345880594246879967378770573385522326039206400578260353074379</span></span><br><span class="line"><span class="comment"># flag_part = sm4ll_r00ts_is_brilliant#◼️◼️◼️◼️◼️◼️◼️◼️</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># --- hint begin ---</span></span><br><span class="line"><span class="comment"># flag = &quot;flag&#123;&quot; + flag_part + &quot;&#125;&quot;</span></span><br><span class="line"><span class="comment"># type of secret_token is &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line"><span class="comment"># length of secret_token is 8</span></span><br></pre></td></tr></table></figure>

<p>只有密文后8位不知道，把已知明文转为整形，然后左移64位，用copper</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line">e = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;sm4ll_r00ts_is_brilliant#&quot;</span></span><br><span class="line">m1 = bytes_to_long(flag)</span><br><span class="line">m1 = m1 &lt;&lt; <span class="number">64</span></span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (m1 + x)^e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">root = f.small_roots(X = <span class="number">2</span>^<span class="number">64</span>)</span><br><span class="line"><span class="built_in">print</span>(root)</span><br><span class="line">m = m1 + root[<span class="number">0</span>]</span><br><span class="line">flag = <span class="string">b&quot;flag&#123;&quot;</span> + long_to_bytes(<span class="built_in">int</span>(m)) + <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;sm4ll_r00ts_is_brilliant#cc0dac72&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="babyrandom"><a href="#babyrandom" class="headerlink" title="babyrandom"></a>babyrandom</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"></span><br><span class="line">p = <span class="number">64999433139797068147576269731948390094958654326970231465808792590598519729077</span></span><br><span class="line"></span><br><span class="line">a = randrange(<span class="number">2</span>, p)</span><br><span class="line">b = randrange(<span class="number">2</span>, p)</span><br><span class="line">x = bytes_to_long(flag)</span><br><span class="line">menu = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Random as a Service with LCG backend</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter your option</span></span><br><span class="line"><span class="string">1. Reset</span></span><br><span class="line"><span class="string">2. Get</span></span><br><span class="line"><span class="string">3. Exit</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GetRandom</span>():</span><br><span class="line">    <span class="keyword">global</span> x</span><br><span class="line">    nx = (a*x + b) % p</span><br><span class="line">    <span class="built_in">print</span>(nx)</span><br><span class="line">    x = nx</span><br><span class="line">    </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(menu)</span><br><span class="line">    opt = <span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        opt = <span class="built_in">int</span>(opt)</span><br><span class="line">        <span class="keyword">if</span> opt == <span class="number">1</span>:</span><br><span class="line">            x = bytes_to_long(flag)</span><br><span class="line">        <span class="keyword">elif</span> opt == <span class="number">2</span>:</span><br><span class="line">            GetRandom()</span><br><span class="line">        <span class="keyword">elif</span> opt == <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;invalid option&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;oh no, something wrong!&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<p>从靶机获取几组数据然后求解lcg即可</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">output =  []</span><br><span class="line"></span><br><span class="line">t = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(output)):</span><br><span class="line">    t.append(output[i]-output[i-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">T = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(t)-<span class="number">1</span>):</span><br><span class="line">    T.append(t[i+<span class="number">1</span>]*t[i-<span class="number">1</span>] - t[i]**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">m = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(T)-<span class="number">1</span>):</span><br><span class="line">    mm = gmpy2.gcd(T[i],T[i+<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> isPrime(mm):</span><br><span class="line">        m.append(<span class="built_in">int</span>(mm))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">            <span class="keyword">if</span> isPrime(mm // i):</span><br><span class="line">                mm = mm // i</span><br><span class="line">                m.append(<span class="built_in">int</span>(mm))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="comment">#print(m)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">    <span class="keyword">if</span> isPrime(i):</span><br><span class="line">        a = gmpy2.invert(t[<span class="number">0</span>],i) * t[<span class="number">1</span>] % i</span><br><span class="line">        b = output[<span class="number">1</span>] - a*output[<span class="number">0</span>] % i</span><br><span class="line">        a_ = gmpy2.invert(a,i)</span><br><span class="line"></span><br><span class="line">        seed = a_ * (output[<span class="number">0</span>]-b) % i</span><br><span class="line">        flag = long_to_bytes(seed)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            <span class="comment">#flag&#123;lcg_1s_n0t_s3cur3#fb528ba5&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="knapsack"><a href="#knapsack" class="headerlink" title="knapsack"></a>knapsack</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"></span><br><span class="line">m = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(<span class="built_in">int</span>(codecs.encode(flag,  <span class="string">&#x27;hex&#x27;</span>), <span class="number">16</span>))[<span class="number">2</span>:]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># from ASIS Cyber Security Contest Quals 2014</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">makeKey</span>(<span class="params">n</span>):</span><br><span class="line">    privKey = [random.randint(<span class="number">1</span>, <span class="number">4</span>**n)]</span><br><span class="line">    s = privKey[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n):</span><br><span class="line">        privKey.append(random.randint(s + <span class="number">1</span>, <span class="number">4</span>**(n + i)))</span><br><span class="line">        s += privKey[i]</span><br><span class="line">    q = random.randint(privKey[n-<span class="number">1</span>] + <span class="number">1</span>, <span class="number">2</span>*privKey[n-<span class="number">1</span>])</span><br><span class="line">    r = random.randint(<span class="number">1</span>, q)</span><br><span class="line">    <span class="keyword">while</span> gmpy2.gcd(r, q) != <span class="number">1</span>:</span><br><span class="line">        r = random.randint(<span class="number">1</span>, q)</span><br><span class="line">    pubKey = [ r*w % q <span class="keyword">for</span> w <span class="keyword">in</span> privKey ]</span><br><span class="line">    <span class="keyword">return</span> privKey, q, r, pubKey</span><br><span class="line"></span><br><span class="line">priv, q, r, pub = makeKey(<span class="built_in">len</span>(m))</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="built_in">sum</span>([i*j <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(pub, m)])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ciphertext)</span><br><span class="line"><span class="built_in">print</span>(pub)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ciphertext</span></span><br><span class="line"><span class="comment"># pub</span></span><br></pre></td></tr></table></figure>

<p>背包密码，构造格</p>
<p><img src="/../../images/2023newstar/13.png"></p>
<p>S是密文，M是公钥</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">M = <span class="comment">#公钥</span></span><br><span class="line">S = <span class="comment">#密文</span></span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(M)</span><br><span class="line">Ge = Matrix.identity(n)</span><br><span class="line">last_row = [<span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">Ge_last_row = Matrix(ZZ, <span class="number">1</span>, <span class="built_in">len</span>(last_row), last_row)</span><br><span class="line"></span><br><span class="line">last_col = M[:]</span><br><span class="line">last_col.append(S)</span><br><span class="line">Ge_last_col = Matrix(ZZ, <span class="built_in">len</span>(last_col), <span class="number">1</span>, last_col)</span><br><span class="line"></span><br><span class="line">Ge = Ge.stack(Ge_last_row)</span><br><span class="line">Ge = Ge.augment(Ge_last_col)</span><br><span class="line"></span><br><span class="line">X = Ge.LLL()[-<span class="number">1</span>]</span><br><span class="line">X = X[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">m = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> X:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(i) == <span class="number">1</span>:</span><br><span class="line">        m += <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(i) == <span class="number">0</span>:</span><br><span class="line">        m += <span class="string">&quot;0&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">flag = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">int</span>(m,<span class="number">2</span>))[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;Lattice_reduction#c3662541&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="easy-crt———留空"><a href="#easy-crt———留空" class="headerlink" title="easy_crt———留空"></a>easy_crt———留空</h3><h3 id="Door———留空"><a href="#Door———留空" class="headerlink" title="Door———留空"></a>Door———留空</h3><h1 id="Week4"><a href="#Week4" class="headerlink" title="Week4"></a>Week4</h1><h2 id="Crypto-3"><a href="#Crypto-3" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="RSA-Variation-II"><a href="#RSA-Variation-II" class="headerlink" title="RSA Variation II"></a>RSA Variation II</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">N = p*p*q</span><br><span class="line"></span><br><span class="line">d= inverse(N, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)//GCD(p-<span class="number">1</span>, q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, N, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;N =&#x27;</span>, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;d =&#x27;</span>, d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = 1653396627113549535760516503668455111392369905404419847336187180051939350514408518095369852411718553340156505246372037811032919080426885042549723125598742783778413642221563616358386699697645814225855089454045984443096447166740882693228043505960011332616740785976743150624114653594631779427044055729185392854961786323215146318588164139423925400772680226861699990332420246447180631417523181196631188540323779487858453719444807515638025771586275969579201806909799448813112034867089866513864971414742370516244653259347267231436131850871346106316007958256749016599758599549180907260093080500469394473142003147643172770078092713912200110043214435078277125844112816260967490086038358669788006182833272351526796228536135638071670829206746835346784997437044707950580087067666459222916040902038574157577881880027391425763503693184264104932693985833980182986816664377018507487697769866530103927375926578569947076633923873193100147751463</span></span><br><span class="line"><span class="comment"># N = 1768427447158131856514034889456397424027937796617829756303525705316152314769129050888899742667986532346611229157207778487065194513722005516611969754197481310330149721054855689646133721600838194741123290410384315980339516947257172981002480414254023253269098539962527834174781356657779988761754582343096332391763560921491414520707112852896782970123018263505426447126195645371941116395659369152654368118569516482251442513192892626222576419747048343942947570016045016127917578272819812760632788343321742583353340158009324794626006731057267603803701663256706597904789047060978427573361035171008822467120148227698893238773305320215769410594974360573727150122036666987718934166622785421464647946084162895084248352643721808444370307254417501852264572985908550839933862563001186477021313236113690793843893640190378131373214104044465633483953616402680853776480712599669132572907096151664916118185486737463253559093537311036517461749439</span></span><br><span class="line"><span class="comment"># d = 20650646933118544225095544552373007455928574480175801658168105227037950105642248948645762488881219576174131624593293487325329703919313156659700002234392400636474610143032745113473842675857323774566945229148664969659797779146488402588937762391470971617163496433008501858907585683428652637958844902909796849080799141999490231877378863244093900363251415972834146031490928923962271054053278056347181254936750536280638321211545167520935870220829786490686826062142415755063724639110568511969041175019898031990455911525941036727091961083201123910761290998968240338217895275414072475701909497518616112236380389851984377079</span></span><br></pre></td></tr></table></figure>

<p>考察了<strong>Schmidt-Samoa密码系统</strong>，[<a target="_blank" rel="noopener" href="https://blog.csdn.net/MikeCoke/article/details/113915715">GUET-CTF2019]Uncle Sam（考点：Schmidt-Samoa密码系统）-CSDN博客</a></p>
<p>密钥生成：①公钥：$N &#x3D; p^2q$，②私钥：$d &#x3D; invert(N,(p-1)(q-1))$</p>
<p>加密：$C &#x3D; m^N \mod N$</p>
<p>解密：$m &#x3D; C^d \mod pq$</p>
<p>攻击：</p>
<p>$\because Nd \equiv 1 \mod (p-1)(q-1)$</p>
<p>任意选取一个$a$，有$ a^{Nd} &#x3D; a^{k(p-1)(q-1) + 1} &#x3D; a \times a^{k(p-1)(q-1)} \equiv a \mod pq$</p>
<p>$\therefore k\times pq &#x3D; a^{Nd} - a$</p>
<p>与N求公因数得到$pq$，即可求得明文</p>
<p>更多参考：<a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/05/13/crypto-%E5%85%B6%E4%BB%96%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/index.html">其他加密算法 | Lazzaro (lazzzaro.github.io)</a></p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">N =  </span><br><span class="line"><span class="comment">#N = p^2*q</span></span><br><span class="line">d = </span><br><span class="line">c = </span><br><span class="line">tmp = <span class="built_in">pow</span>(<span class="number">2</span>,d*N,N) - <span class="number">2</span></span><br><span class="line">pq = gmpy2.gcd(mpz(tmp),N)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,pq)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># flag&#123;l3arn_s0m3_e1ement4ry_numb3r_the0ry&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="babyNTRU"><a href="#babyNTRU" class="headerlink" title="babyNTRU"></a>babyNTRU</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">q = getPrime(<span class="number">2048</span>)</span><br><span class="line"></span><br><span class="line">f = getPrime(<span class="number">1024</span>)</span><br><span class="line">g = getPrime(<span class="number">768</span>)</span><br><span class="line"></span><br><span class="line">h = (inverse(f, q) * g) % q</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">e = (getPrime(<span class="number">32</span>) * h + m) % q</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>((h, q))</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (8916452722821418463248726825721257021744194286874706915832444631771596616116491775091473142798867278598586482678387668986764461265131119164500473719939894343163496325556340181429675937641495981353857724627081847304246987074303722642172988864138967404024201246050387152854001746763104417773214408906879366958729744259612777257542351501592019483745621824894790096639205771421560295175633152877667720038396154571697861326821483170835238092879747297506606983322890706220824261581533324824858599082611886026668788577757970984892292609271082176311433507931993672945925883985629311514143607457603297458439759594085898425992, 31985842636498685945330905726539498901443694955736332073639744466389039373143618920511122288844282849407290205804991634167816417468703459229138891348115191921395278336695684210437130681337971686008048054340499654721317721241239990701099685207253476642931586563363638141636011941268962999641130263828151538489139254625099330199557503153680089387538863574480134898211311252227463870838947777479309928195791241005127445821671684607237706849308372923372795573732000365072815112119533702614620325238183899266147682193892866330678076925199674554569018103164228278742151778832319406135513140669049734660019551179692615505961)</span></span><br><span class="line"><span class="comment"># 20041713613876382007969284056698149007154248857420752520496829246324512197188211029665990713599667984019715503486507126224558092176392282486689347953069815123212779090783909545244160318938357529307482025697769394114967028564546355310883670462197528011181768588878447856875173263800885048676190978206851268887445527785387532167370943745180538168965461612097037041570912365648125449804109299630958840398397721916860876687808474004391843869813396858468730877627733234832744328768443830669469345926766882446378765847334421595034470639171397587395341977453536859946410431252287203312913117023084978959318406160721042580688</span></span><br></pre></td></tr></table></figure>



<p>$\because h \equiv f^{-1}\times g \mod q$</p>
<p>$\therefore g &#x3D; hf +kq$</p>
<p>又$\because e \equiv xh +m \mod q$</p>
<p>$\therefore e &#x3D; xh + m +kq$</p>
<p>$\therefore m &#x3D; e-xh -kq$</p>
<p>构造格</p>
<p><img src="/../../images/2023newstar/14.png"></p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(h,q) = (, )</span><br><span class="line">e = </span><br><span class="line"></span><br><span class="line">Ge = Matrix(ZZ,[</span><br><span class="line">    [q,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>,q,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line">    [h,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>,h,<span class="number">0</span>,<span class="number">2</span>^<span class="number">1000</span>,<span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>,e,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^<span class="number">1024</span>]</span><br><span class="line">])</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> Ge.LLL():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(line[-<span class="number">1</span>]) == <span class="number">2</span>^<span class="number">1024</span>:</span><br><span class="line">        m = <span class="built_in">abs</span>(line[<span class="number">1</span>])</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line">        <span class="comment"># flag&#123;Lattice_reduction_magic_on_NTRU#82b08b2d&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Smart"><a href="#Smart" class="headerlink" title="Smart"></a>Smart</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = <span class="number">75206427479775622966537995406541077245842499523456803092204668034148875719001</span></span><br><span class="line">a = <span class="number">40399280641537685263236367744605671534251002649301968428998107181223348036480</span></span><br><span class="line">b = <span class="number">34830673418515139976377184302022321848201537906033092355749226925568830384464</span></span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line"></span><br><span class="line">d = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">G = E.random_element()</span><br><span class="line"></span><br><span class="line">P = d * G</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(G)</span><br><span class="line"><span class="built_in">print</span>(P)</span><br><span class="line"></span><br><span class="line"><span class="comment"># (63199291976729017585116731422181573663076311513240158412108878460234764025898 : 11977959928854309700611217102917186587242105343137383979364679606977824228558 : 1)</span></span><br><span class="line"><span class="comment"># (75017275378438543246214954287362349176908042127439117734318700769768512624429 : 39521483276009738115474714281626894361123804837783117725653243818498259351984 : 1)</span></span><br></pre></td></tr></table></figure>

<p>SmartAttack</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">p = </span><br><span class="line">a = </span><br><span class="line">b = </span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">G = (,)</span><br><span class="line">P = (,)</span><br><span class="line"></span><br><span class="line">G = E(G)</span><br><span class="line">P = E(P)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SmartAttack</span>(<span class="params">P,Q,p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    Eqp = EllipticCurve(Qp(p, <span class="number">2</span>), [ ZZ(t) + randint(<span class="number">0</span>,p)*p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants() ])</span><br><span class="line"></span><br><span class="line">    P_Qps = Eqp.lift_x(ZZ(P.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> P_Qp <span class="keyword">in</span> P_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(P_Qp.xy()[<span class="number">1</span>]) == P.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    Q_Qps = Eqp.lift_x(ZZ(Q.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> Q_Qp <span class="keyword">in</span> Q_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(Q_Qp.xy()[<span class="number">1</span>]) == Q.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    p_times_P = p*P_Qp</span><br><span class="line">    p_times_Q = p*Q_Qp</span><br><span class="line"></span><br><span class="line">    x_P,y_P = p_times_P.xy()</span><br><span class="line">    x_Q,y_Q = p_times_Q.xy()</span><br><span class="line"></span><br><span class="line">    phi_P = -(x_P/y_P)</span><br><span class="line">    phi_Q = -(x_Q/y_Q)</span><br><span class="line">    k = phi_Q/phi_P</span><br><span class="line">    <span class="keyword">return</span> ZZ(k)</span><br><span class="line"></span><br><span class="line">d = SmartAttack(G,P,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(d)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># flag&#123;m1nd_y0ur_p4rameter#167d&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime,bytes_to_long, sieve_base</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uniPrime</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> n.bit_length() &lt; bits:</span><br><span class="line">            n *= choice(sieve_base)</span><br><span class="line">        <span class="keyword">if</span> isPrime(n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p=uniPrime(<span class="number">512</span>)</span><br><span class="line">q=uniPrime(<span class="number">512</span>)</span><br><span class="line">n=p*q</span><br><span class="line">e= <span class="number">196608</span></span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n= 3326716005321175474866311915397401254111950808705576293932345690533263108414883877530294339294274914837424580618375346509555627578734883357652996005817766370804842161603027636393776079113035745495508839749006773483720698066943577445977551268093247748313691392265332970992500440422951173889419377779135952537088733</span></span><br><span class="line"><span class="string">c= 2709336316075650177079376244796188132561250459751152184677022745551914544884517324887652368450635995644019212878543745475885906864265559139379903049221765159852922264140740839538366147411533242116915892792672736321879694956051586399594206293685750573633107354109784921229088063124404073840557026747056910514218246</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>$p-1$光滑分解$n$	</p>
<p>$e &#x3D; 196608 &#x3D; 2^{16} \times 3$</p>
<p>解16次rabin，再开3次根号</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">smooth</span>(<span class="params">N</span>):</span><br><span class="line">    a = <span class="number">2</span></span><br><span class="line">    n = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        a = <span class="built_in">pow</span>(a, n, N)</span><br><span class="line">        res = gmpy2.gcd(a - <span class="number">1</span>, N)</span><br><span class="line">        <span class="keyword">if</span> res != <span class="number">1</span> <span class="keyword">and</span> res != N:</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">n= </span><br><span class="line">c= </span><br><span class="line">e = <span class="number">196608</span></span><br><span class="line"></span><br><span class="line">p = smooth(n)</span><br><span class="line"><span class="comment"># print(p)</span></span><br><span class="line"><span class="comment"># p = 11104262127139631006017377403513327506789883414594983803879501935187577746510780983414313264114974863256190649020310407750155332724309172387489473534782137699</span></span><br><span class="line">q = n//p</span><br><span class="line"></span><br><span class="line">x0=gmpy2.invert(p,q)</span><br><span class="line">x1=gmpy2.invert(q,p)</span><br><span class="line">cs = [c]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    ps = []</span><br><span class="line">    <span class="keyword">for</span> c2 <span class="keyword">in</span> cs:</span><br><span class="line">        r = <span class="built_in">pow</span>(c2, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">        s = <span class="built_in">pow</span>(c2, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line"></span><br><span class="line">        x = (r * x1 * q + s * x0 * p) % n</span><br><span class="line">        y = (r * x1 * q - s * x0 * p) % n</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> ps:</span><br><span class="line">            ps.append(x)</span><br><span class="line">        <span class="keyword">if</span> n - x <span class="keyword">not</span> <span class="keyword">in</span> ps:</span><br><span class="line">            ps.append(n - x)</span><br><span class="line">        <span class="keyword">if</span> y <span class="keyword">not</span> <span class="keyword">in</span> ps:</span><br><span class="line">            ps.append(y)</span><br><span class="line">        <span class="keyword">if</span> n - y <span class="keyword">not</span> <span class="keyword">in</span> ps:</span><br><span class="line">            ps.append(n - y)</span><br><span class="line">    cs = ps</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> ps:</span><br><span class="line">    mm = gmpy2.iroot(m,<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> mm[<span class="number">1</span>]:</span><br><span class="line">        flag = long_to_bytes(mm[<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="comment"># flag&#123;new1sstar_welcome_you&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">data = [<span class="built_in">ord</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> flag]</span><br><span class="line"></span><br><span class="line">mod = <span class="number">0x42</span></span><br><span class="line">n = <span class="number">200</span></span><br><span class="line">p = <span class="number">5</span></span><br><span class="line">q = <span class="number">2</span>**<span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">E</span>():</span><br><span class="line">  <span class="keyword">return</span> vector(ZZ, [<span class="number">1</span> - random.randint(<span class="number">0</span>,p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">creatematrix</span>():</span><br><span class="line">  <span class="keyword">return</span> matrix(ZZ, [[q//<span class="number">2</span> - random.randint(<span class="number">0</span>,q) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(mod)])</span><br><span class="line"></span><br><span class="line">A, B, C= creatematrix(), creatematrix(), creatematrix()</span><br><span class="line">x = vector(ZZ, data[<span class="number">0</span>:mod])</span><br><span class="line">y = vector(ZZ, data[mod:<span class="number">2</span>*mod])</span><br><span class="line">z = vector(ZZ, data[<span class="number">2</span>*mod:<span class="number">3</span>*mod])</span><br><span class="line">e = E()</span><br><span class="line">b = x*B+y*A+z*C + e</span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line">res += <span class="string">&quot;A=&quot;</span> + <span class="built_in">str</span>(A) +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">res += <span class="string">&quot;B=&quot;</span> + <span class="built_in">str</span>(B) +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">res += <span class="string">&quot;C=&quot;</span> + <span class="built_in">str</span>(C) +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">res += <span class="string">&quot;b=&quot;</span> + <span class="built_in">str</span>(b) +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;enc.out&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  f.write(res)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>格基规约 + 矩阵求解</p>
</blockquote>
<p>$b &#x3D; x_{1\times 66}A_{66\times 200} + y_{1\times 66}B_{66\times 200} + z_{1\times 66}C_{66\times 200} + e_{1\times 200}$</p>
<h1 id="即求解矩阵方程：-begin-pmatrix-x-1-times-66-y-1-times-66-z-1-times-66-1-end-pmatrix-begin-pmatrix-A-66-times-200-B-66-times-200-C-66-times-200-e-1-times-200-end-pmatrix"><a href="#即求解矩阵方程：-begin-pmatrix-x-1-times-66-y-1-times-66-z-1-times-66-1-end-pmatrix-begin-pmatrix-A-66-times-200-B-66-times-200-C-66-times-200-e-1-times-200-end-pmatrix" class="headerlink" title="即求解矩阵方程：$$\begin{pmatrix}x_{1\times 66} &amp; y_{1\times 66} &amp; z_{1\times 66} &amp; 1\end{pmatrix}\begin{pmatrix}A_{66\times 200} \B_{66\times 200} \C_{66\times 200} \e_{1\times 200}\end{pmatrix}"></a>即求解矩阵方程：<br>$$<br>\begin{pmatrix}<br>x_{1\times 66} &amp; y_{1\times 66} &amp; z_{1\times 66} &amp; 1<br>\end{pmatrix}<br>\begin{pmatrix}<br>A_{66\times 200} \<br>B_{66\times 200} \<br>C_{66\times 200} \<br>e_{1\times 200}<br>\end{pmatrix}</h1><p>b_{1\times 200}<br>$$<br>但是我们缺少$e_{1\times 200}$</p>
<p>因为e是一个很小的向量，所以可以用LLL算法规约出e</p>
<p>$\because e &#x3D; xA +yB +zC - b$，即构造格：<br>$$<br>\begin{pmatrix}<br>A_{66\times 200} \<br>B_{66\times 200} \<br>C_{66\times 200} \<br>b_{1\times 200}<br>\end{pmatrix}<br>\longrightarrow e &#x3D; (…)_{1\times 100}<br>$$<br>得到e之后解矩阵方程即可</p>
<p>这题还有一个比较烦人的点就是数据太大，建议用记事本进行替换</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">A =</span><br><span class="line">B = </span><br><span class="line">C =</span><br><span class="line">b =</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A = Matrix(ZZ,A)</span><br><span class="line">B = Matrix(ZZ,B)</span><br><span class="line">C = Matrix(ZZ,C)</span><br><span class="line">b = vector(b)</span><br><span class="line">Ge = A.stack(B).stack(C).stack(b)</span><br><span class="line">e = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> Ge.LLL()[<span class="number">0</span>]]</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="comment"># [-4, -1, 1, 0, -1, 1, -1, -4, -1, -4, -4, -1, -1, 1, 1, -3, -2, 0, -3, -3, -4, -3, -3, -2, -1, -1, 1, 1, 0, -2, -2, -1, -3, -4, -1, -1, -2, -1, 1, -3, -4, 0, 0, 1, 0, -1, -4, -2, -3, -3, 1, 0, -1, -4, -4, -3, 0, 1, 0, -1, -1, -4, -2, -1, -4, 1, -2, 1, -2, 1, -4, 1, -2, -4, 0, 0, -1, 0, -3, -3, -1, -2, 0, -4, 1, -2, 1, 0, -3, -4, -4, -3, 0, -4, 1, 1, -4, -1, -4, -4, -4, 0, -3, -3, 0, -2, -3, -3, -4, 0, 0, -1, -1, -1, 0, 0, -4, 1, 0, -3, -2, 1, 1, 1, -2, 0, 0, -1, -2, -3, 1, -1, 1, -4, -1, 0, -2, 0, -2, -1, -2, 1, -4, 0, -1, 1, -1, 0, -1, -3, -1, -3, -3, 0, 0, 0, -2, -1, 0, 1, -3, -4, -3, -4, 1, -1, -1, -3, 1, -3, 0, -1, -3, -1, -4, -1, -2, -4, -4, -1, -3, -2, 0, 0, 1, -3, -2, -1, -1, -4, -1, 0, 1, -2, -4, -2, -1, 0, -1, -1]</span></span><br><span class="line">e = vector(ZZ,e)</span><br><span class="line"></span><br><span class="line">Y = A.stack(B).stack(C).stack(e)</span><br><span class="line">X = Y.solve_left(b)</span><br><span class="line"><span class="built_in">print</span>(X)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> X[:-<span class="number">1</span>]:</span><br><span class="line">    flag += <span class="built_in">chr</span>(i)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># congratulations, here is your flag:flag&#123;try_lear1n_wi0h_t1e_error&#125;congratulations, here is your flag:flag&#123;try_lear1n_wi0h_t1e_error&#125;congratulations, here is your flag:flag&#123;try_lear1n_wi0h_t1e_error&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="Week5"><a href="#Week5" class="headerlink" title="Week5"></a>Week5</h1><h2 id="Crypto-4"><a href="#Crypto-4" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="School-of-CRC32"><a href="#School-of-CRC32" class="headerlink" title="School of CRC32"></a>School of CRC32</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"></span><br><span class="line">ROUND = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">LENGTH = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Extreme hard CRC32 challenge&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ARE YOU READY&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROUND):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ROUND&#x27;</span>, i, <span class="string">&#x27;!&#x27;</span>*<span class="built_in">int</span>(i/<span class="number">75</span> + <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    target = secrets.randbits(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Here is my CRC32 value: &#x27;</span>, <span class="built_in">hex</span>(target))</span><br><span class="line"></span><br><span class="line">    dat = <span class="built_in">input</span>(<span class="string">&#x27;Show me some data &gt; &#x27;</span>)</span><br><span class="line">    raw = <span class="built_in">bytes</span>.fromhex(dat)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> zlib.crc32(raw) == target <span class="keyword">and</span> <span class="built_in">len</span>(raw) == LENGTH:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;GREAT&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;OH NO&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Congratulation! Here is your flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>考到了crc32的逆向（碰撞），网上找了脚本<a target="_blank" rel="noopener" href="https://pypi.org/project/crcsolver/%EF%BC%8C%E6%A0%B9%E6%8D%AE%E4%BE%8B%E5%AD%90%E6%94%B9%E6%94%B9%E5%8D%B3%E5%8F%AF">https://pypi.org/project/crcsolver/，根据例子改改即可</a></p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> crcsolver</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">28855</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    data = sh.recvuntil(<span class="string">b&quot;Here is my CRC32 value:&quot;</span>)</span><br><span class="line">    c = <span class="built_in">eval</span>(sh.recvline().decode())</span><br><span class="line">    m = crcsolver.solve(<span class="string">b&#x27;_&#x27;</span>*<span class="number">20</span>, <span class="built_in">range</span>(<span class="number">8</span>*<span class="number">20</span>), c, zlib.crc32)</span><br><span class="line">    message = <span class="built_in">hex</span>(bytes_to_long(m))[<span class="number">2</span>:].zfill(<span class="number">40</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;Show me some data &gt;&quot;</span>,message)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<p>需要注意的是，传给服务器的数据需要是16进制形式，而且，得填充满40位，否则报错</p>
<p>关键代码<code>m = crcsolver.solve(b&#39;_&#39;*20, range(8*20), c, zlib.crc32)</code></p>
<h3 id="last-signin"><a href="#last-signin" class="headerlink" title="last_signin"></a>last_signin</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;?&#x27;</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p, q = getPrime(<span class="number">1024</span>), getPrime(<span class="number">1024</span>)</span><br><span class="line">N = p * q</span><br><span class="line">gift = p&amp;(<span class="number">2</span>**<span class="number">923</span>-<span class="number">2</span>**<span class="number">101</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;N = &quot;</span>,N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;gift = &quot;</span>,gift)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = &quot;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">N =  12055968471523053394851394038007091122809367392467691213651520944038861796011063965460456285088011754895260428814358599592032865236006733879843493164411907032292051539754520574395252298997379020268868972160297893871261713263196092380416876697472160104980015554834798949155917292189278888914003846758687215559958506116359394743135211950575060201887025032694825084104792059271584351889134811543088404952977137809673880602946974798597506721906751835019855063462460686036567578835477249909061675845157443679947730585880392110482301750827802213877643649659069945187353987713717145709188790427572582689339643628659515017749</span></span><br><span class="line"><span class="string">p0 =  70561167908564543355630347620333350122607189772353278860674786406663564556557177660954135010748189302104288155939269204559421198595262277064601483770331017282701354382190472661583444774920297367889959312517009682740631673940840597651219956142053575328811350770919852725338374144</span></span><br><span class="line"><span class="string">c =  2475592349689790551418951263467994503430959303317734266333382586608208775837696436139830443942890900333873206031844146782184712381952753718848109663188245101226538043101790881285270927795075893680615586053680077455901334861085349972222680322067952811365366282026756737185263105621695146050695385626656638309577087933457566501579308954739543321367741463532413790712419879733217017821099916866490928476372772542254929459218259301608413811969763001504245717637231198848196348656878611788843380115493744125520080930068318479606464623896240289381601711908759450672519228864487153103141218567551083147171385920693325876018</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>第一眼用了二元copper，没跑出</p>
<p>然后用了网上的脚本<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/193939#h3-28">D^3CTF 官方Write Up-安全客 - 安全资讯平台 (anquanke.com)</a></p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N =  </span><br><span class="line">p0 =  </span><br><span class="line">c =  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bivariate</span>(<span class="params">pol, XX, YY, kk=<span class="number">4</span></span>):</span><br><span class="line">    N = pol.parent().characteristic()</span><br><span class="line"></span><br><span class="line">    f = pol.change_ring(ZZ)</span><br><span class="line">    PR, (x, y) = f.parent().objgens()</span><br><span class="line"></span><br><span class="line">    idx = [(k - i, i) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(kk + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k + <span class="number">1</span>)]</span><br><span class="line">    monomials = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> t: PR(x ** t[<span class="number">0</span>] * y ** t[<span class="number">1</span>]), idx))</span><br><span class="line">    <span class="comment"># collect the shift-polynomials</span></span><br><span class="line">    g = []</span><br><span class="line">    <span class="keyword">for</span> h, i <span class="keyword">in</span> idx:</span><br><span class="line">        <span class="keyword">if</span> h == <span class="number">0</span>:</span><br><span class="line">            g.append(y ** h * x ** i * N)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            g.append(y ** (h - <span class="number">1</span>) * x ** i * f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice basis</span></span><br><span class="line">    M = Matrix(ZZ, <span class="built_in">len</span>(g))</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(M.nrows()):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(M.ncols()):</span><br><span class="line">            h, i = idx[col]</span><br><span class="line">            M[row, col] = g[row][h, i] * XX ** h * YY ** i</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    B = M.LLL()</span><br><span class="line"></span><br><span class="line">    PX = PolynomialRing(ZZ, <span class="string">&#x27;xs&#x27;</span>)</span><br><span class="line">    xs = PX.gen()</span><br><span class="line">    PY = PolynomialRing(ZZ, <span class="string">&#x27;ys&#x27;</span>)</span><br><span class="line">    ys = PY.gen()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Transform LLL-reduced vectors to polynomials</span></span><br><span class="line">    H = [(i, PR(<span class="number">0</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(B.nrows())]</span><br><span class="line">    H = <span class="built_in">dict</span>(H)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(B.nrows()):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(B.ncols()):</span><br><span class="line">            H[i] += PR((monomials[j] * B[i, j]) / monomials[j](XX, YY))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Find the root</span></span><br><span class="line">    poly1 = H[<span class="number">0</span>].resultant(H[<span class="number">1</span>], y).subs(x=xs)</span><br><span class="line">    poly2 = H[<span class="number">0</span>].resultant(H[<span class="number">2</span>], y).subs(x=xs)</span><br><span class="line">    poly = gcd(poly1, poly2)</span><br><span class="line">    x_root = poly.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    poly1 = H[<span class="number">0</span>].resultant(H[<span class="number">1</span>], x).subs(y=ys)</span><br><span class="line">    poly2 = H[<span class="number">0</span>].resultant(H[<span class="number">2</span>], x).subs(y=ys)</span><br><span class="line">    poly = gcd(poly1, poly2)</span><br><span class="line">    y_root = poly.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x_root, y_root</span><br><span class="line"></span><br><span class="line">PR = PolynomialRing(Zmod(N), names=<span class="string">&#x27;x,y&#x27;</span>)</span><br><span class="line">x, y = PR.gens()</span><br><span class="line">pol = <span class="number">2</span> ** <span class="number">923</span> * x + y + p0</span><br><span class="line"></span><br><span class="line">x, y = bivariate(pol, <span class="number">2</span> ** <span class="number">101</span>, <span class="number">2</span> ** <span class="number">101</span>)</span><br><span class="line">p = <span class="number">2</span> ** <span class="number">923</span> * x + y + p0</span><br><span class="line">q = N // p</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">d = inverse(e, (p - <span class="number">1</span>)*(q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">int</span>(<span class="built_in">pow</span>(c, d, N))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>



<h3 id="PseudoHell-EASY-PseudoHell-Hard"><a href="#PseudoHell-EASY-PseudoHell-Hard" class="headerlink" title="PseudoHell_EASY &amp; PseudoHell_Hard"></a>PseudoHell_EASY &amp; PseudoHell_Hard</h3><p>这两道题的解题关键在于分清每一关的<code>function1</code>和<code>function2</code>的区别</p>
<p>challenges:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a:<span class="built_in">bytes</span>,b:<span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="built_in">len</span>(b)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([i ^ j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(a,b)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PRP</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        self.domain_cache = &#123;&#125;</span><br><span class="line">        self.range_cache = &#123;&#125;</span><br><span class="line">        self.n = n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tran</span>(<span class="params">self, m, inverse = <span class="literal">False</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">            x = m</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">in</span> self.domain_cache:</span><br><span class="line">                <span class="keyword">return</span> self.domain_cache[x]</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                y = os.urandom(self.n)</span><br><span class="line">                <span class="keyword">if</span> y <span class="keyword">in</span> self.range_cache:<span class="keyword">continue</span></span><br><span class="line">                self.domain_cache[x] = y</span><br><span class="line">                self.range_cache[y] = x    </span><br><span class="line">                <span class="keyword">return</span> y</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y = m</span><br><span class="line">            <span class="keyword">if</span> y <span class="keyword">in</span> self.range_cache:</span><br><span class="line">                <span class="keyword">return</span> self.range_cache[y]</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                x = os.urandom(self.n)</span><br><span class="line">                <span class="keyword">if</span> x <span class="keyword">in</span> self.domain_cache:<span class="keyword">continue</span></span><br><span class="line">                self.domain_cache[x] = y</span><br><span class="line">                self.range_cache[y] = x    </span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PRF</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        self.domain_cache = &#123;&#125;</span><br><span class="line">        self.range_cache = &#123;&#125;</span><br><span class="line">        self.n = n </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tran</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> self.domain_cache:</span><br><span class="line">            self.domain_cache[x] = os.urandom(self.n)</span><br><span class="line">        <span class="keyword">return</span> self.domain_cache[x]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge1</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge1, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge2</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge2, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge3</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">            L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">if</span> inverse <span class="keyword">or</span> <span class="keyword">not</span> inverse:        </span><br><span class="line">            <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M,inverse)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge4</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.PRP1 = PRP(self.block_size)</span><br><span class="line">        self.PRP2 = PRP(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        X, T = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        X = xor(X, T)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            X = xor(self.PRP1.tran(X, inverse),T)</span><br><span class="line">        <span class="keyword">return</span> X</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> self.PRP2.tran(M, inverse)[:self.block_size]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M,inverse)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge5</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">1</span></span><br><span class="line">        self.input_size = self.block_size</span><br><span class="line">        self.PRP = PRP(self.block_size)</span><br><span class="line">        self.PRF = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> xor(<span class="built_in">bytes</span>(<span class="number">1</span>),self.PRP.tran(M))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> xor(self.PRF.tran(M),<span class="built_in">bytes</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge 5, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br></pre></td></tr></table></figure>

<p>problems:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> challenge <span class="keyword">import</span> Challenge1,Challenge2,Challenge3,Challenge4,Challenge5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag_easy,flag_hard</span><br><span class="line">roll_left = <span class="number">56</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">guess_coin</span>(<span class="params">level, query_num</span>):</span><br><span class="line">    Ch = level()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(query_num):</span><br><span class="line">        msg = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;msg? &gt; &quot;</span>))</span><br><span class="line">        inverse = <span class="built_in">input</span>(<span class="string">&quot;inverse? &gt; &quot;</span>) == <span class="string">&#x27;y&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(msg) == Ch.input_size</span><br><span class="line">        <span class="built_in">print</span>(Ch.roll(msg, inverse).<span class="built_in">hex</span>())</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">input</span>(<span class="string">&quot;coin? &gt; &quot;</span>) == <span class="built_in">str</span>(Ch.coin) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roll_challenge</span>(<span class="params">challenge_level, challenge</span>):</span><br><span class="line">    <span class="keyword">global</span> roll_left</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Challenge Level: <span class="subst">&#123;challenge_level&#125;</span>&quot;</span>)</span><br><span class="line">    roll_num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">f&quot;How many times are required to roll for solving <span class="subst">&#123;challenge_level&#125;</span>? &gt; &quot;</span>))</span><br><span class="line">    roll_left -= roll_num</span><br><span class="line">    [guess_coin(challenge, roll_num) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>)]</span><br><span class="line"></span><br><span class="line">roll_challenge(<span class="string">&quot;1&quot;</span>, Challenge1)</span><br><span class="line">roll_challenge(<span class="string">&quot;2&quot;</span>, Challenge2)</span><br><span class="line">roll_challenge(<span class="string">&quot;3&quot;</span>, Challenge3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> roll_left &lt;= <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You passed all challenges for EASY but times limit exceeded. Try harder :(&quot;</span>)</span><br><span class="line">    exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag for easy is &quot;</span>, flag_easy)</span><br><span class="line"></span><br><span class="line">roll_challenge(<span class="string">&quot;4&quot;</span>, Challenge4)</span><br><span class="line">roll_challenge(<span class="string">&quot;5&quot;</span>, Challenge5)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> roll_left &lt;= <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You passed all challenges for HARD but times limit exceeded. Try harder :(&quot;</span>)</span><br><span class="line">    exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag for hard is &quot;</span>, flag_hard)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在此之前，先进行一些声明，希望可以帮助大家理解</p>
<p>我们把题目中<code>self.domain_cache = &#123;&#125;</code>称为定义域</p>
<p><code>self.range_cache = &#123;&#125;</code>称为值域</p>
<p><code>tran(m,inverse)</code>函数的意思就是，当<code>inverse = False</code>的时候，先判断<code>m</code>是否在定义域中，如果在定义域中，那么直接返回<code>f(m)</code>，如果不在的话，随机生成一个<code>y</code>与<code>m</code>对应，并且二者形成双射关系</p>
<p>当<code>inverse = True</code>时，判断<code>m</code>是否在值域中，如果在值域中，就返回$f^{-1}(m)$，如果不在，随机生成一个<code>x</code>，并且二者形成双射关系</p>
<h4 id="Challenge1"><a href="#Challenge1" class="headerlink" title="Challenge1"></a>Challenge1</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge1</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge1, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br></pre></td></tr></table></figure>

<p>分析<code>function1</code>，设我们输入的数据为$M$，记$L_0,R_0$分别代表左半部分和右半部分，记<code>RO1.tran(R)</code>为$f(R)$</p>
<p>可以看到，$L_0$和$R_0$经过<code>function1</code>的作用后，返回的是$R_0,L_0\otimes f(R_0)$</p>
<p>而<code>function2</code>就是返回$f(M)$</p>
<p>因此，我们可以传入<code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</code>，</p>
<p>如果执行了<code>function1</code>，那么服务器返回的数据的前半部分是<code>aaaaaaaaaaaaaaaa</code></p>
<p>如果执行了<code>function2</code>，那么服务器返回的数据是随机的一段数据</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve1</span>():</span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;ow many times are required to roll for solving 1?&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>).encode())</span><br><span class="line">    msg = <span class="string">&quot;a&quot;</span>*<span class="number">32</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;msg? &gt;&quot;</span>,msg.encode())</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;inverse? &gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>).encode())</span><br><span class="line">        data = sh.recvline().decode().strip()</span><br><span class="line">        <span class="keyword">if</span> data[:<span class="number">16</span>] == <span class="string">&quot;a&quot;</span>*<span class="number">16</span>:</span><br><span class="line">            m = <span class="string">&quot;0&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = <span class="string">&quot;1&quot;</span></span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;coin? &gt;&quot;</span>,m.encode())</span><br></pre></td></tr></table></figure>

<h4 id="Challenge2"><a href="#Challenge2" class="headerlink" title="Challenge2"></a>Challenge2</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge2</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> self.RO2.tran(M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge2, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br></pre></td></tr></table></figure>

<p>和上一关的区别在于，<code>function1</code>多了一步轮换加密</p>
<p>还是设我们输入的数据为$M$，记$L_0,R_0$分别代表左半部分和右半部分，记<code>RO1.tran(R)</code>为$f(R)$</p>
<p>经过推导可以知道</p>
<p>第一次加密得到的是$R_0$，$L_0\otimes f(R_0)$</p>
<p>第二次加密得到的是$L_0 \otimes f(R_0)$，$R_0\otimes f(L_0\otimes f(R_0))$</p>
<p>最后我们得到的数据的左右部分分别是：$L_0 \otimes f(R_0)$，$R_0\otimes f(L_0\otimes f(R_0))$</p>
<p>这关需要两次来完成</p>
<p>在这两次中，我们需要控制$R_0$相等，即两次$M$的右半部分一样，修改左半部分</p>
<p>于是我们可以将服务器两次返回的数据的左半部分进行异或</p>
<p>即$(L_0 \otimes f(R_0))\otimes (L_1\otimes f(R_0)) &#x3D; L_0 \otimes L_1$</p>
<p>将两次回的数据的左半部分异或后的结果和$L_0\otimes L_1$比较，如果相等，说明执行了<code>function1</code></p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve2</span>():</span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;ow many times are required to roll for solving 2?&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>).encode())</span><br><span class="line">    msg1 = <span class="string">b&quot;61&quot;</span> * <span class="number">16</span></span><br><span class="line">    msg2 = <span class="string">b&quot;62&quot;</span> * <span class="number">8</span> + <span class="string">b&quot;61&quot;</span> *<span class="number">8</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;msg? &gt;&quot;</span>,msg1)</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;inverse? &gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>).encode())</span><br><span class="line">        data1 = sh.recvline().decode().strip()</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;msg? &gt;&quot;</span>,msg2)</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;inverse? &gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>).encode())</span><br><span class="line">        data2 = sh.recvline().decode().strip()</span><br><span class="line">        L1 = <span class="built_in">bytes</span>.fromhex(data1[:<span class="number">16</span>])</span><br><span class="line">        L2 = <span class="built_in">bytes</span>.fromhex(data2[:<span class="number">16</span>])</span><br><span class="line">        <span class="keyword">if</span> xor(L1,L2) == xor(<span class="string">b&quot;a&quot;</span>*<span class="number">8</span>,<span class="string">b&quot;b&quot;</span>*<span class="number">8</span>):</span><br><span class="line">            m = <span class="string">&quot;0&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = <span class="string">&quot;1&quot;</span></span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;coin? &gt;&quot;</span>,m.encode())</span><br></pre></td></tr></table></figure>

<h4 id="Challenge3"><a href="#Challenge3" class="headerlink" title="Challenge3"></a>Challenge3</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge3</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.RO1 = PRF(self.block_size)</span><br><span class="line">        self.RO2 = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">            L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">            L, R = R, xor(L, self.RO1.tran(R))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            L, R = M[:self.block_size], M[self.block_size:]</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">            L, R = xor(R, self.RO1.tran(L)), L</span><br><span class="line">        <span class="keyword">return</span> L+R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">if</span> inverse <span class="keyword">or</span> <span class="keyword">not</span> inverse:        </span><br><span class="line">            <span class="keyword">return</span> self.RO2.tran(M)</span><br></pre></td></tr></table></figure>

<p>在这一关，开启了<code>inverse</code>功能</p>
<p>设我们输入的数据为$M$，记$L_0,R_0$分别代表左半部分和右半部分，记<code>RO1.tran(R)</code>为$f(R)$</p>
<p><strong>这关需要2次</strong></p>
<p>先分析<code>function1</code>：</p>
<p>当<code>inverse = False</code>时：</p>
<p>经过推导可以知道</p>
<p>第一次加密得到的是$R_0$，$L_0\otimes f(R_0)$</p>
<p>第二次加密得到的是$L_0 \otimes f(R_0)$，$R_0\otimes f(L_0\otimes f(R_0))$</p>
<p>第三次加密得到的是$R_0\otimes f(L_0\otimes f(R_0))$，$(L_0\otimes f(R_0))\otimes f(R_0\otimes f(L_0\otimes f(R_0)))$</p>
<p>返回第三次加密的结果</p>
<p>当<code>inverse = True</code>时：</p>
<p>经过推导可以知道</p>
<p>第一次加密得到的是$R_0\otimes f(L_0)$，$L_0$</p>
<p>第二次加密得到的是$L_0\otimes f(R_0\otimes f(L_0))$，$R_0 \otimes f(L_0)$</p>
<p>第三次加密得到的是$(R_0\otimes f(L_0))\otimes f(L_0\otimes f(R_0\otimes f(L_0)))$，$L_0\otimes f(R_0\otimes f(L_0))$</p>
<p><strong>对比两种情况下得到的左右两部分</strong></p>
<p>我们只要让两次输入的左右部分互换（<strong>注意开启</strong><code>inverse</code>），即可使得$L_1 &#x3D; R_2$，$L_1$指第一次接受到数据的左半部分，$R_2$指第二次接收到数据的右半部分</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve3</span>():</span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;ow many times are required to roll for solving 3?&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>).encode())</span><br><span class="line">    msg1 = <span class="string">b&quot;62&quot;</span> * <span class="number">8</span> + <span class="string">b&quot;61&quot;</span> * <span class="number">8</span></span><br><span class="line">    msg2 = <span class="string">b&quot;61&quot;</span> * <span class="number">8</span> + <span class="string">b&quot;62&quot;</span> * <span class="number">8</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;msg? &gt;&quot;</span>,msg1)</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;inverse? &gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>).encode())</span><br><span class="line">        data1 = sh.recvline().decode().strip()</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;msg? &gt;&quot;</span>,msg2)</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;inverse? &gt;&quot;</span>,<span class="string">&quot;y&quot;</span>.encode())</span><br><span class="line">        data2 = sh.recvline().decode().strip()</span><br><span class="line">        L1 = <span class="built_in">bytes</span>.fromhex(data1[:<span class="number">16</span>])</span><br><span class="line">        R2 = <span class="built_in">bytes</span>.fromhex(data2[<span class="number">16</span>:])</span><br><span class="line">        <span class="keyword">if</span> L1 == R2: </span><br><span class="line">            m = <span class="string">&quot;0&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = <span class="string">&quot;1&quot;</span></span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;coin? &gt;&quot;</span>,m.encode())</span><br></pre></td></tr></table></figure>

<h4 id="Challenge4"><a href="#Challenge4" class="headerlink" title="Challenge4"></a>Challenge4</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge4</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        self.input_size = <span class="number">2</span> * self.block_size</span><br><span class="line">        self.PRP1 = PRP(self.block_size)</span><br><span class="line">        self.PRP2 = PRP(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        X, T = M[:self.block_size], M[self.block_size:]</span><br><span class="line">        X = xor(X, T)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            X = xor(self.PRP1.tran(X, inverse),T)</span><br><span class="line">        <span class="keyword">return</span> X</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> self.PRP2.tran(M, inverse)[:self.block_size]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M,inverse)</span><br></pre></td></tr></table></figure>

<p>设我们输入的数据为$M$，记$X_0,T_0$分别代表左半部分和右半部分，记<code>RO1.tran(R)</code>为$f(R)$，这关有<code>inverse</code></p>
<p><strong>这关需要2次</strong></p>
<p><code>function1</code>中，当<code>inverse = False</code>时</p>
<p>$X&#x3D;X_0 \otimes T_0$</p>
<p>第一次加密后得到$X_1 &#x3D; f(X) \otimes T_0$</p>
<p>第二次加密后得到$X_2 &#x3D; f(X_1) \otimes T_0$</p>
<p>当<code>inverse = True</code>时</p>
<p>$X &#x3D; X_0 \otimes T_0$</p>
<p>第一次加密后得到$X_1 &#x3D; f^{-1}(X)\otimes T_0$</p>
<p>第二次加密后得到$X_2 &#x3D; f^{-1}(X_1)\otimes T_0$</p>
<p><strong>第一次</strong>在<code>inverse = False</code>的时候，传入$X_0,T_0$</p>
<p>我们只要把第一次（<code>inverse = False</code>时的结果）即$f(X_1) \otimes T_0$和$T_0$拼接再次传入服务器</p>
<p>先经过异或，得到$f(X_1)$</p>
<p>然后第一次加密得到$C_1 &#x3D; X_1 \otimes T_0 &#x3D; f(X)$</p>
<p>第二次加密得到$C_2 &#x3D; X \otimes T_0 &#x3D; X_0$</p>
<p>把第二次的结果和第一次传入的$X_0$对比，即可知道执行了<code>function1</code>还是<code>function2</code></p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve4</span>():</span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;ow many times are required to roll for solving 4?&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>).encode())</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">        msg1 = <span class="string">b&quot;61&quot;</span> * <span class="number">16</span></span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;msg? &gt;&quot;</span>,msg1)</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;inverse? &gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>).encode())</span><br><span class="line">        data1 = sh.recvline().decode().strip()</span><br><span class="line">        X1 = <span class="built_in">bytes</span>.fromhex(data1)</span><br><span class="line">        msg2 = <span class="built_in">hex</span>(bytes_to_long(X1))[<span class="number">2</span>:].zfill(<span class="number">16</span>).encode() + <span class="string">b&quot;61&quot;</span> * <span class="number">8</span></span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;msg? &gt;&quot;</span>,msg2)</span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;inverse? &gt;&quot;</span>,<span class="string">&quot;y&quot;</span>.encode())</span><br><span class="line">        data2 = sh.recvline().decode().strip()</span><br><span class="line">        X2 = <span class="built_in">bytes</span>.fromhex(data2)</span><br><span class="line">        <span class="keyword">if</span> X2 == <span class="string">b&quot;a&quot;</span>*<span class="number">8</span>:</span><br><span class="line">            m = <span class="string">&quot;0&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = <span class="string">&quot;1&quot;</span></span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;coin? &gt;&quot;</span>,m.encode())</span><br></pre></td></tr></table></figure>

<h4 id="Challenge5"><a href="#Challenge5" class="headerlink" title="Challenge5"></a>Challenge5</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge5</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.coin = os.urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">1</span></span><br><span class="line">        self.block_size = <span class="number">1</span></span><br><span class="line">        self.input_size = self.block_size</span><br><span class="line">        self.PRP = PRP(self.block_size)</span><br><span class="line">        self.PRF = PRF(self.input_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> xor(<span class="built_in">bytes</span>(<span class="number">1</span>),self.PRP.tran(M))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">function2</span>(<span class="params">self, M</span>):</span><br><span class="line">        <span class="keyword">return</span> xor(self.PRF.tran(M),<span class="built_in">bytes</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">roll</span>(<span class="params">self, M, inverse</span>):</span><br><span class="line">        <span class="keyword">assert</span> inverse == <span class="literal">False</span>, <span class="string">&quot;In Challenge 5, inverse is not allowed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [self.function1,self.function2][self.coin](M)</span><br></pre></td></tr></table></figure>

<p>这关没有<code>inverse</code>功能，而且输入的数据大小减少了</p>
<p><code>function1</code>和<code>function2</code>的区别是<code>PRP.tran(M)</code>和<code>PRF.tran(M)</code>的区别</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PRP</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        self.domain_cache = &#123;&#125;</span><br><span class="line">        self.range_cache = &#123;&#125;</span><br><span class="line">        self.n = n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tran</span>(<span class="params">self, m, inverse = <span class="literal">False</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">            x = m</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">in</span> self.domain_cache:</span><br><span class="line">                <span class="keyword">return</span> self.domain_cache[x]</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                y = os.urandom(self.n)</span><br><span class="line">                <span class="keyword">if</span> y <span class="keyword">in</span> self.range_cache:<span class="keyword">continue</span></span><br><span class="line">                self.domain_cache[x] = y</span><br><span class="line">                self.range_cache[y] = x    </span><br><span class="line">                <span class="keyword">return</span> y</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y = m</span><br><span class="line">            <span class="keyword">if</span> y <span class="keyword">in</span> self.range_cache:</span><br><span class="line">                <span class="keyword">return</span> self.range_cache[y]</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                x = os.urandom(self.n)</span><br><span class="line">                <span class="keyword">if</span> x <span class="keyword">in</span> self.domain_cache:<span class="keyword">continue</span></span><br><span class="line">                self.domain_cache[x] = y</span><br><span class="line">                self.range_cache[y] = x    </span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PRF</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        self.domain_cache = &#123;&#125;</span><br><span class="line">        self.range_cache = &#123;&#125;</span><br><span class="line">        self.n = n </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tran</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> self.domain_cache:</span><br><span class="line">            self.domain_cache[x] = os.urandom(self.n)</span><br><span class="line">        <span class="keyword">return</span> self.domain_cache[x]</span><br></pre></td></tr></table></figure>

<p>这两个区别很明显的一个点是</p>
<p><code>PRP</code>生成的<code>y</code>都是不同的，就是说保证了值域的元素全部都不同，而<code>PRF</code>并没有这个效果</p>
<p>于是我们需要利用这个点</p>
<p>前面4关用了7次机会，我们还有48次机会</p>
<p><code>PRF</code>里面元素都不同的概率为$t &#x3D; 1\times \frac{255}{256}\times\frac{254}{256} \times…\times  \frac{209}{256} &#x3D; 0.009029416209217144$</p>
<p> 这个概率算是比较低了</p>
<p>我们输入48个数据，判断接收到的数据是否有相等的，如果有相等的，说明执行了<code>function2</code></p>
<p>因为$t &#x3D; 0.009029416209217144$，所以我们判断失败的概率只有$0.009029416209217144$</p>
<p>因为要重复进行33次，所以我们通关失败的概率为$t^{33} &#x3D; 3.4416696557688015\times 10^{-68}$，概率低的可怕</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve5</span>():</span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;ow many times are required to roll for solving 5?&quot;</span>,<span class="built_in">str</span>(<span class="number">48</span>).encode())</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">33</span>):</span><br><span class="line">        C = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):</span><br><span class="line">            msg = <span class="built_in">hex</span>(<span class="number">48</span> + i)[<span class="number">2</span>:].encode()</span><br><span class="line">            sh.sendlineafter(<span class="string">b&quot;msg? &gt;&quot;</span>,msg)</span><br><span class="line">            sh.sendlineafter(<span class="string">b&quot;inverse? &gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>).encode())</span><br><span class="line">            data = sh.recvline().decode().strip()</span><br><span class="line">            c = <span class="built_in">bytes</span>.fromhex(data)</span><br><span class="line">            C.append(c)</span><br><span class="line">        C_ = <span class="built_in">set</span>(C)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(C) != <span class="built_in">len</span>(C_):</span><br><span class="line">            m = <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = <span class="string">&quot;0&quot;</span></span><br><span class="line">        sh.sendlineafter(<span class="string">b&quot;coin? &gt;&quot;</span>,m.encode())</span><br></pre></td></tr></table></figure>

<h4 id="最后，值得注意的是"><a href="#最后，值得注意的是" class="headerlink" title="最后，值得注意的是"></a>最后，值得注意的是</h4><p>注意一些细节，比如服务器传给我们的是16进制的数据，我们需要转成字节</p>
<p>而且<code>bytes.fromhex(a)</code>接受的这个<code>a</code>的长度必须是偶数</p>
<h1 id="最后的最后"><a href="#最后的最后" class="headerlink" title="最后的最后"></a>最后的最后</h1><p>星盟安全团队纳新！</p>
<p>欢迎师傅们加群（346014666）学习、讨论！</p>
<p><img src="/../../images/2023%E9%A2%86%E8%88%AA%E6%9D%AF/3.png"></p>

    </div>

    
    
    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------已经到底啦！<i class="fa fa-paw"></i>-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>DexterJie
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/NewStarCTF2023/" title="2023NewStarCTF">https://dexterjie.github.io/2023/09/25/赛题复现/NewStarCTF2023/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Wp/" rel="tag"># Wp</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/09/25/SystemView/" rel="prev" title="SystemView">
                  <i class="fa fa-chevron-left"></i> SystemView
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023MoeCTF/" rel="next" title="2023MoeCTF">
                  2023MoeCTF <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DexterJie</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">157k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:31</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->


    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
<div class="busuanzi-count">
  <script async src="/js/busuanzi.pure.mini.js"></script>
  
  <span class="site-uv" title="总访客量">
    访客量<span id="busuanzi_value_site_uv"></span>
  </span>

  <span class="site-pv" title="总访问量">
    经过<span id="busuanzi_value_site_pv"></span>次回眸与你相遇
  </span>
</div>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"waline-five-mocha.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"locale":null,"placeholder":"请文明评论呀","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/NewStarCTF2023/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right"},"mobile":{"show":true}});</script></body>

</html>
