<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/0.jpg">
  <link rel="mask-icon" href="/images/0.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dexterjie.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="记录MoeCTF2023部分题解，主要是Crypto，还有一些其他方向的简单题">
<meta property="og:type" content="article">
<meta property="og:title" content="2023MoeCTF">
<meta property="og:url" content="https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023MoeCTF/index.html">
<meta property="og:site_name" content="DexterJie&#39;Blog">
<meta property="og:description" content="记录MoeCTF2023部分题解，主要是Crypto，还有一些其他方向的简单题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/10.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/0.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/7.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/1.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/2.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/8.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/3.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/4.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/5.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/6.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/14.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/15.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/16.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/0.jpg">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/17.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/18.png">
<meta property="og:image" content="https://dexterjie.github.io/images/2023MoeCTF/19.png">
<meta property="article:published_time" content="2023-09-25T13:54:11.000Z">
<meta property="article:modified_time" content="2023-10-14T15:13:02.426Z">
<meta property="article:author" content="DexterJie">
<meta property="article:tag" content="Wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dexterjie.github.io/images/2023MoeCTF/10.png">


<link rel="canonical" href="https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023MoeCTF/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023MoeCTF/","path":"2023/09/25/赛题复现/2023MoeCTF/","title":"2023MoeCTF"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>2023MoeCTF | DexterJie'Blog</title>
  







<link rel="dns-prefetch" href="waline-five-mocha.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DexterJie'Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Never Mind the Scandal and Liber!!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1456890009&auto=1&height=66"></iframe>
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Crypto"><span class="nav-number">1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95"><span class="nav-number">1.1.</span> <span class="nav-text">简单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#baby-e"><span class="nav-number">1.1.1.</span> <span class="nav-text">baby_e</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bad-E"><span class="nav-number">1.1.2.</span> <span class="nav-text">bad_E</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#factor-signin"><span class="nav-number">1.1.3.</span> <span class="nav-text">factor_signin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#n-n"><span class="nav-number">1.1.4.</span> <span class="nav-text">n&amp;n</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#p-q"><span class="nav-number">1.1.5.</span> <span class="nav-text">|p-q|</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rsa-signin"><span class="nav-number">1.1.6.</span> <span class="nav-text">rsa_signin</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E7%AD%89"><span class="nav-number">1.2.</span> <span class="nav-text">中等</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#flag-exchange"><span class="nav-number">1.2.1.</span> <span class="nav-text">flag_exchange</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#minipack"><span class="nav-number">1.2.2.</span> <span class="nav-text">minipack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bad-random"><span class="nav-number">1.2.3.</span> <span class="nav-text">bad_random</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#giant-e"><span class="nav-number">1.2.4.</span> <span class="nav-text">giant_e</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#factorize-me"><span class="nav-number">1.2.5.</span> <span class="nav-text">factorize_me</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%BE"><span class="nav-number">1.3.</span> <span class="nav-text">难</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#xorrrrrrrrr"><span class="nav-number">1.3.1.</span> <span class="nav-text">xorrrrrrrrr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ez-chian"><span class="nav-number">1.3.2.</span> <span class="nav-text">ez_chian</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#broken-hash"><span class="nav-number">1.3.3.</span> <span class="nav-text">broken_hash</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#F"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">F</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#block-hash"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">_block_hash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hash"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">_hash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bytes2blocks"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">bytes2blocks</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hash-1"><span class="nav-number">1.3.3.5.</span> <span class="nav-text">hash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-number">1.3.3.6.</span> <span class="nav-text">分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#feistel"><span class="nav-number">1.3.4.</span> <span class="nav-text">feistel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#feistel-promax"><span class="nav-number">1.3.5.</span> <span class="nav-text">feistel_promax</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81"><span class="nav-number">2.</span> <span class="nav-text">古典密码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ezrot"><span class="nav-number">2.1.</span> <span class="nav-text">ezrot</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9A%87%E5%B8%9D%E7%9A%84%E6%96%B0%E5%AF%86%E7%A0%81"><span class="nav-number">2.2.</span> <span class="nav-text">皇帝的新密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E6%98%AF%E7%9A%87%E5%B8%9D%E7%9A%84%E6%96%B0%E5%AF%86%E7%A0%81"><span class="nav-number">2.3.</span> <span class="nav-text">不是皇帝的新密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E5%8F%AF%E7%9A%84%E6%96%B0%E5%9B%B4%E5%A2%99"><span class="nav-number">2.4.</span> <span class="nav-text">可可的新围墙</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8C%AB%E8%A8%80%E5%96%B5%E8%AF%AD"><span class="nav-number">2.5.</span> <span class="nav-text">猫言喵语</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jail"><span class="nav-number">3.</span> <span class="nav-text">Jail</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Jail-level-0"><span class="nav-number">3.1.</span> <span class="nav-text">Jail level 0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jail-level-1"><span class="nav-number">3.2.</span> <span class="nav-text">Jail level 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jail-level-2"><span class="nav-number">3.3.</span> <span class="nav-text">Jail level 2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jail-level-3"><span class="nav-number">3.4.</span> <span class="nav-text">Jail level 3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jail-level-4"><span class="nav-number">3.5.</span> <span class="nav-text">Jail level 4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Leak-level-0"><span class="nav-number">3.6.</span> <span class="nav-text">Leak level 0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Leak-level-1"><span class="nav-number">3.7.</span> <span class="nav-text">Leak level 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Leak-level-2"><span class="nav-number">3.8.</span> <span class="nav-text">Leak level 2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pwn"><span class="nav-number">4.</span> <span class="nav-text">pwn</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#test-nc"><span class="nav-number">4.1.</span> <span class="nav-text">test_nc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fd"><span class="nav-number">4.2.</span> <span class="nav-text">fd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#baby-calculator"><span class="nav-number">4.3.</span> <span class="nav-text">baby_calculator</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#int-overflow"><span class="nav-number">4.4.</span> <span class="nav-text">int_overflow</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reverse"><span class="nav-number">5.</span> <span class="nav-text">Reverse</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#base-64"><span class="nav-number">5.1.</span> <span class="nav-text">base_64</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XOR"><span class="nav-number">5.2.</span> <span class="nav-text">XOR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ANDROID"><span class="nav-number">5.3.</span> <span class="nav-text">ANDROID</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UPX"><span class="nav-number">5.4.</span> <span class="nav-text">UPX!</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="DexterJie"
      src="/images/0.jpg">
  <p class="site-author-name" itemprop="name">DexterJie</p>
  <div class="site-description" itemprop="description">一枚只会Crypto的菜鸡</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">72</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023MoeCTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/0.jpg">
      <meta itemprop="name" content="DexterJie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DexterJie'Blog">
      <meta itemprop="description" content="一枚只会Crypto的菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="2023MoeCTF | DexterJie'Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023MoeCTF
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-25 21:54:11" itemprop="dateCreated datePublished" datetime="2023-09-25T21:54:11+08:00">2023-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-14 23:13:02" itemprop="dateModified" datetime="2023-10-14T23:13:02+08:00">2023-10-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Wp/" itemprop="url" rel="index"><span itemprop="name">Wp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023MoeCTF/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023MoeCTF/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>32 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>记录MoeCTF2023部分题解，主要是Crypto，还有一些其他方向的简单题</p>
<span id="more"></span>

<p>密码题难度有梯度。</p>
<p>稍微整理了一下对于笔者而言的难度梯度</p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="简单"><a href="#简单" class="headerlink" title="简单"></a>简单</h2><h3 id="baby-e"><a href="#baby-e" class="headerlink" title="baby_e"></a>baby_e</h3><p>题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long</span><br><span class="line"></span><br><span class="line">p,q = getPrime(<span class="number">2048</span>),getPrime(<span class="number">2048</span>)</span><br><span class="line">e = <span class="number">7</span></span><br><span class="line">n = p*q</span><br><span class="line">m = bytes_to_long(<span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read().strip())</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = &quot;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c =  147693154873835354725007152781732424355869776162377337823960431913672366269917723916891506269449726723757821517328874729037838600793748824028829185409932536014732765063216715033843955453706710187792772702199448156372644163429786386035008302836467605094954587157232829525150652611067567669525072625329634860065850520051628272535479197120008981979404760445193750864902244921407742155742716289495581989134730376783828846663464819337418977287363028738701414486788851136608957124505485242331701209645216580641917007780811842757125048746184068597664780265422321550909392419865169775282217442331295071069272774722564587602419768461231775480847018941840911357926330143045826277813722919121117172763493242590521245640828462665947672485094793188432098216701511715232654611338293295459889814699850788048985878279440740712956248569068077253790198036918598519191892836075254345518967666166925163908185663991353344555402397055977817370082929420443034626201745027965444069777059760865359310439815816749939498993014457995041394803598825093836045546578310632172636478575946653375857640993393714607308326474003446154152048840071034349831168612740218034679021240949747357214453636633636662650940968576792518622437627529244515229173</span></span><br><span class="line"><span class="comment"># n =  553409369582823237678532685244026647155180191225879439432235077135813123637186465008813830373646133388592395760175777499266561095087891764348044063111935877931069321764391883899483374576303169645488542398590564148654412004383012178107972880058460460806768779452529433458826925606225797078653905380530651390617109384086518728626571028089036812787671647095695947167204428442727185744172445701874820612799168887428075695751162763647868386879374037826876671079326544820609721731078985096813307183878793033824330869698508952853770794414757655681370862323768018291030331209143189638496644361618184164228294031490537429556439588954274708598530042700988138862000054458742762198052079867259365645914383561162796796952346445529346145323567650621600171442575319262718389389870407629339714751583360252884338116164466349449862781112019462555743429653595045695696967783338371470032332852204294900011651434678829104876529439166176589508898757122660322523937330848536715937381297551894198974459004139082562228022412335520195652419375915216074658463954339332593244483927157329404652516225481116614815221154229491846087288087715884363786672244655901308480290011237244562251084095684531716327141154558809471185132979704992609461470501119328696999713829</span></span><br></pre></td></tr></table></figure>

<p>小明文攻击</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">e = <span class="number">7</span></span><br><span class="line">c = </span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">t = gmpy2.iroot(c,e)</span><br><span class="line"><span class="keyword">if</span> t[<span class="number">1</span>]:</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(t[<span class="number">0</span>]))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        m = gmpy2.iroot(k*n+c,e)</span><br><span class="line">        <span class="keyword">if</span> m[<span class="number">1</span>]:</span><br><span class="line">            <span class="built_in">print</span>(m[<span class="number">0</span>])</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(m[<span class="number">0</span>]))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="bad-E"><a href="#bad-E" class="headerlink" title="bad_E"></a>bad_E</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p) <span class="comment"># 6853495238262155391975011057929314523706159020478084061020122347902601182448091015650787022962180599741651597328364289413042032923330906135304995252477571</span></span><br><span class="line"><span class="built_in">print</span>(q) <span class="comment"># 11727544912613560398705401423145382428897876620077115390278679983274961030035884083100580422155496261311510530671232666801444557695190734596546855494472819</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,p*q)</span><br><span class="line"><span class="built_in">print</span>(c) <span class="comment"># 63388263723813143290256836284084914544524440253054612802424934400854921660916379284754467427040180660945667733359330988361620691457570947823206385692232584893511398038141442606303536260023122774682805630913037113541880875125504376791939861734613177272270414287306054553288162010873808058776206524782351475805</span></span><br></pre></td></tr></table></figure>

<p>常规思路发现，$e$和$phi$不互素，而且$e$能整除$phi$。试了其他方法，没解决</p>
<p>最后尝试AMM算法</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = </span><br><span class="line">q = </span><br><span class="line">c = </span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM</span>(<span class="params">o, r, q</span>):</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n----------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Start to run Adleman-Manders-Miller Root Extraction Method&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(r, o, q))</span><br><span class="line">    g = GF(q)</span><br><span class="line">    o = g(o)</span><br><span class="line">    p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="keyword">while</span> p ^ ((q-<span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find p:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s = s // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find s:&#123;&#125;, t:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(s, t))</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find alp:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(alp))</span><br><span class="line">    a = p ^ (r**(t-<span class="number">1</span>) * s)</span><br><span class="line">    b = o ^ (r*alp - <span class="number">1</span>)</span><br><span class="line">    c = p ^ s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ^ (r^(t-<span class="number">1</span>-i))</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Calculating DLP...&#x27;</span>)</span><br><span class="line">            j = - discrete_log(d, a)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Finish DLP...&#x27;</span>)</span><br><span class="line">        b = b * (c^r)^j</span><br><span class="line">        h = h * c^j</span><br><span class="line">        c = c^r</span><br><span class="line">    result = o^alp * h</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Find one solution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(result))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">onemod</span>(<span class="params">p,r</span>): </span><br><span class="line">    t=p-<span class="number">2</span> </span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">pow</span>(t,(p-<span class="number">1</span>) // r,p)==<span class="number">1</span>: </span><br><span class="line">        t -= <span class="number">1</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(t,(p-<span class="number">1</span>) // r,p) </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solution</span>(<span class="params">p,root,e</span>):  </span><br><span class="line">    g = onemod(p,e) </span><br><span class="line">    may = <span class="built_in">set</span>() </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(e): </span><br><span class="line">        may.add(root * <span class="built_in">pow</span>(g,i,p)%p) </span><br><span class="line">    <span class="keyword">return</span> may</span><br><span class="line"></span><br><span class="line">cp = c % p</span><br><span class="line"></span><br><span class="line">mp = AMM(cp,e,p)</span><br><span class="line"></span><br><span class="line">mps = solution(p,mp,e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> mps:</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(i))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;moectf&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="factor-signin"><a href="#factor-signin" class="headerlink" title="factor_signin"></a>factor_signin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> prod</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read().strip()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">72</span></span><br><span class="line"></span><br><span class="line">m1 = <span class="built_in">int</span>.from_bytes(flag[:<span class="number">36</span>],<span class="string">&quot;big&quot;</span>)</span><br><span class="line">m2 = <span class="built_in">int</span>.from_bytes(flag[<span class="number">36</span>:],<span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p,q = getPrime(<span class="number">2048</span>),getPrime(<span class="number">2048</span>)</span><br><span class="line">n1 = p*q</span><br><span class="line">c1 = <span class="built_in">pow</span>(m1,e,n1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c1 = &quot;</span>,c1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n1 = &quot;</span>,n1)</span><br><span class="line"></span><br><span class="line">primes = [getPrime(<span class="number">64</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">n2 = prod(primes)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2,e,n2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c2 = &quot;</span>,c2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n2 = &quot;</span>,n2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c1 =  10004937130983861141937782436252502991050957330184611684406783226971057978666503675149401388381995491152372622456604317681236160071166819028679754762162125904637599991943368450200313304999566592294442696755822585022667008378021280392976010576970877334159755332946926433635584313137140987588847077645814987268595739733550220882135750267567373532603503399428451548677091911410732474324157868011686641243202218731844256789044721309478991918322850448456919991540932206923861653518190974620161055008847475600980152660468279765607319838003177639654115075183493029803981527882155542925959658123816315099271123470754815045214896642428657264709805029840253303446203030294879166242867850331945166255924821406218090304893024711068773287842075208409312312188560675094244318565148284432361706108491327014254387317744284876018328591380705408407853404828189643214087638328376675071962141118973835178054884474523241911240926274907256651801384433652425740230755811160476356172444327762497910600719286629420662696949923799255603628210458906831175806791599965316549386396788014703044837917283461862338269599464440202019922379625071512100821922879623930069349084917919100015782270736808388388006084027673781004085620817521378823838335749279055639005125</span></span><br><span class="line"><span class="comment"># n1 =  343504538870081878757729748260620800783581983635281373321527119223374418103340873199654926888439040391545101913132680017655039577253974802351999985470115474655124168592386965001556620077117966153475518658881140827499124290142523464795351995478153288872749817655925271395693435582010998996210909883510311066017237567799370371513462802547313382594409676803895262837061350017911885033133654781876923251129406855067993830824618637981136966134029212516871210627954762147349788788999116702635535406398258621926040887099782494271000823401788337120154104692934583729065189687995570122890809807661370008740283447636580308161498808092269041815719148127168137018600113465985504975054319601741498799761500526467431533990903047624407330243357514588557352746347337683868781554819821575385685459666842162355673947984514687068626166144076257334426612302554448774082488600083569900006274897032242821388126274957846236552373226099112200392102883351088570736254707966329366625911183721875374731791052229266503696334310835323523568132399330263642353927504971311717117370721838701629885670598853025212521537158141447625623337563164790788106598854822686494249848796441153496412236527242235888308435573209980270776407776277489669763803746640746378181948641</span></span><br><span class="line"><span class="comment"># c2 =  4948422459907576438725352912593232312182623872749480015295307088166392790756090961680588458629287353136729331282506869598853654959933189916541367579979613191505226006688017103736659670745715837820780269669982614187726024837483992949073998289744910800139692315475427811724840888983757813069849711652177078415791290894737059610056340691753379065563574279210755232749774749757141836708161854072798697882671844015773796030086898649043727563289757423417931359190238689436180953442515869613672008678717039516723747808793079592658069533269662834322438864456440701995249381880745586708718334052938634931936240736457181295</span></span><br><span class="line"><span class="comment"># n2 =  8582505375542551134698364096640878629785534004976071646505285128223700755811329156276289439920192196962008222418309136528180402357612976316670896973298407081310073283979903409463559102445223030866575563539261326076167685019121804961393115251287057504682389257841337573435085535013992761172452417731887700665115563173984357419855481847035192853387338980937451843809282267888616833734087813693242841580644645315837196205981207827105545437201799441352173638172133698491126291396194764373021523547130703629001683366722885529834956411976212381935354905525700646776572036418453784898084635925476199878640087165680193737</span></span><br></pre></td></tr></table></figure>

<p>前半部分发现$n_1$可以分解，分解得到$p,q$</p>
<p>后半部分用yafu分解$n_2$，得到所有因子</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">c1 =  </span><br><span class="line">n1 =  </span><br><span class="line">c2 =  </span><br><span class="line">n2 =  </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p1 = </span><br><span class="line">q1 = n1 //p1</span><br><span class="line">d1 = gmpy2.invert(e,(p1-<span class="number">1</span>)*(q1-<span class="number">1</span>))</span><br><span class="line">m1 = <span class="built_in">pow</span>(c1,d1,n1)</span><br><span class="line">flag1 = long_to_bytes(<span class="built_in">int</span>(m1))</span><br><span class="line"></span><br><span class="line">p = </span><br><span class="line">phi2 = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> p:</span><br><span class="line">    phi2 *= i-<span class="number">1</span></span><br><span class="line">    d2 = gmpy2.invert(e,phi2)</span><br><span class="line">    m2 = <span class="built_in">pow</span>(c2,d2,n2)</span><br><span class="line">    flag2 = long_to_bytes(m2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag1+flag2)</span><br></pre></td></tr></table></figure>

<h3 id="n-n"><a href="#n-n" class="headerlink" title="n&amp;n"></a>n&amp;n</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read().strip().encode()</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">n = p * q</span><br><span class="line">e1 = <span class="number">0x114514</span></span><br><span class="line">e2 = <span class="number">19198101</span></span><br><span class="line"></span><br><span class="line">c1 = <span class="built_in">pow</span>(m,e1,n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m,e2,n)</span><br><span class="line"><span class="built_in">print</span>(c1) </span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5776799746376051463605370130675046329799612910435315968508603116759552095183027263116443417343895252766060748671845650457077393391989018107887540639775168897954484319381180406512474784571389477212123123540984850033695748142755414954158933345476509573211496722528388574841686164433315356667366007165419697987147258498693175698918104120849579763098045116744389310549687579302444264316133642674648294049526615350011916160649448726069001139749604430982881450187865197137222762758538645387391379108182515717949428258503254717940765994927802512049427407583200118969062778415073135339774546277230281966880715506688898978925</span></span><br><span class="line"><span class="comment"># 4664955020023583143415931782261983177552050757537222070347847639906354901601382630034645762990079537901659753823666851165175187728532569040809797389706253282757017586285211791297567893874606446000074515260509831946210526182765808878824360460569061258723122198792244018463880052389205906620425625708718545628429086424549277715280217165880900037900983008637302744555649467104208348070638137050458275362152816916837534704113775562356277110844168173111385779258263874552283927767924979691542028126412133709129601685315027689094437957165812994784648540588277901241854031439324974562449032290219652206466731675967045633360</span></span><br><span class="line"><span class="comment"># 13612969130810965900902742090064423006385890357159609755971027204203418808937093492927060428980020085273603754747223030702684866992231913349067578014240319426522039068836171388168087260774376277346092066880984406890296520951318296354893551565670293486797637522297989653182109744864444697818991039473180752980752117041574628063002176339235126861152739066489620021077091941250365101779354009854706729448088217051728432010328667839532327286559570597994183126402340332924370812383312664419874352306052467284992411543921858024469098268800500500651896608097346389396273293747664441553194179933758992070398387066135330851531</span></span><br></pre></td></tr></table></figure>

<p>共模攻击</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">c1 = </span><br><span class="line">c2 = </span><br><span class="line">n = </span><br><span class="line">e1 = <span class="number">0x114514</span></span><br><span class="line"></span><br><span class="line">e2 = <span class="number">19198101</span></span><br><span class="line"></span><br><span class="line">t = gmpy2.gcd(e1,e2)</span><br><span class="line"><span class="keyword">if</span> t == <span class="number">1</span>:</span><br><span class="line">    s,x,y = gmpy2.gcdext(e1,e2)</span><br><span class="line">    m = (<span class="built_in">pow</span>(c1,x,n)*<span class="built_in">pow</span>(c2,y,n))%n</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    s,x,y = gmpy2.gcdext(e1,e2)</span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        m = gmpy2.iroot((<span class="built_in">pow</span>(c1,x,n)*<span class="built_in">pow</span>(c2,y,n)+k*n)%n,t)</span><br><span class="line">        <span class="keyword">if</span> m[<span class="number">1</span>]:</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(m[<span class="number">0</span>]))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="p-q"><a href="#p-q" class="headerlink" title="|p-q|"></a>|p-q|</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">72</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag,<span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, isPrime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next_prime</span>(<span class="params">p</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p += <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">2048</span>)</span><br><span class="line">q = next_prime(p)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 329960318345010350458589325571454799968957932130539403944044204698872359769449414256378111233592533561892402020955736786563103586897940757198920737583107357264433730515123570697570757034221232010688796344257587359198400915567115397034901247038275403825404094129637119512164953012131445747740645183682571690806238508035172474685818036517880994658466362305677430221344381425792427288500814551334928982040579744048907401043058567486871621293983772331951723963911377839286050368715384227640638031857101612517441295926821712605955984000617738833973829140899288164786111118033301974794123637285172303688427806450817155786233788027512244397952849209700013205803489334055814513866650854230478124920442832221946442593769555237909177172933634236392800414176981780444770542047378630756636857018730168151824307814244094763132088236333995807013617801783919113541391133267230410179444855465611792191833319172887852945902960736744468250550722314565805440432977225703650102517531531476188269635151281661081058374242768608270563131619806585194608795817118466680430500830137335634289617464844004904410907221482919453859885955054140320857757297655475489972268282336250384384926216818756762307686391740965586168590784252524275489515352125321398406426217</span></span><br><span class="line"><span class="comment"># c = 307746143297103281117512771170735061509547958991947416701685589829711285274762039205145422734327595082350457374530975854337055433998982493020603245187129916580627539476324521854057990929173492940833073106540441902619425074887573232779899379436737429823569006431370954961865581168635086246592539153824456681688944066925973182272443586463636373955966146029489121226571408532284480270826510961605206483011204059402338926815599691009406841471142048842308786000059979977645988396524814553253493672729395573658564825709547262230219183672493306100392069182994445509803952976016630731417479238769736432223194249245020320183199001774879893442186017555682902409661647546547835345461056900610391514595370600575845979413984555709077635397717741521573798309855584473259503981955303774208127361309229536010653615696850725905168242705387575720694946072789441481191449772933265705810128547553027708513478130258801233619669699177901566688737559102165508239876805822898509541232565766265491283807922473440397456701500524925191214292669986798631732639221198138026031561329502985577205314190565609214349344303324429408234237832110076900414483795318189628198913032900272406887003325858236057373096880675754802725017537119549989304878960436575670784578550</span></span><br></pre></td></tr></table></figure>

<p>根据题目意思，$p,q$很相近，先把$n$开根，再求下一个素数得到$p$</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">t = gmpy2.iroot(n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">p = gmpy2.next_prime(t)</span><br><span class="line">q = n // p</span><br><span class="line">d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<h3 id="rsa-signin"><a href="#rsa-signin" class="headerlink" title="rsa_signin"></a>rsa_signin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read().strip()</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q = getPrime(<span class="number">1024</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 17524722204224696445172535263975543817720644608816706978363749891469511686943372362091928951563219068859089058278944528021615923888948698587206920445508493551162845371086030869059282352535451058203615402089133135136481314666971507135484450966505425514285114192275051972496161810571035753943880190780759479521486741046704043699838021850105638224212696697865987677760179564370167062037563913329993433080123575434871852732981112883423565015771421868680113407260917902892944119552200927337996135278491046562185003012971570532979090484837684759828977460570826320870379601193678304983534424368152743368343335213808684523217</span></span><br><span class="line"><span class="string">c = 6870605439714128574950893771863182370595667973241984289208050776870220326525943524507319708560433091378319367164606150977103661770065561661544375425887970907060665421562712515902428061727268441585629591525591001533188276465911918724808701356962871139957343861919730086334623932624184172272488406793955068827527130338853980609365042071290967556159598511667974987218999253443575482949258292953639729393456515185185102248985930422080581185292420347510600574229080211050520146551505605537486989306457793451086767402197128573781597156939709237045132856159368959981648969874765462190363842275826077556314448408825308218451</span></span><br><span class="line"><span class="string">n = 24974121071274650888046048586598797033399902532613815354986756278905133499432183463847175542164798764762683121930786715931063152122056911933710481566265603626437742951648885379847799327315791800670175616973945640322985175516271373004547752061826574576722667907302681961850865961386200909397231865804894418194711076667760169256682834206788730947602211228930301853348503098156592000286467190760378847541148772869356389938999094673945092387627113807899212568399028514283219850734634544982646070106811651490010946670117927664594365986238107951837041859682547029079035013475238052160645871718246031144694712586073789250183</span></span><br><span class="line"><span class="string">c = 10324627733161143472233272675096997859064721978612320424254305978486200326061730105384511258706433940176741256952824288120499229240005823611541292676234913505775165761543820764046537413943393325463602612485849366939102550336256797820440347815027443410399157963547486098366749815425187247171697678576246606105486928212486117878157055321965270364583625270716186820068538749425299073309429589410882809098930213978117176627031795312102177342499674234163614021182116065492884880492891668658240362567156235958605768725892407536211503981819707919444725863397622629226309480836486427388484176463279384813974310500625102568341</span></span><br><span class="line"><span class="string">n = 14215826065753265334521416948225868542990756976323308408298887797364519400310818641526401662106853573185085731682502059761982246604277475488691297554851873224516934619888327644352138127883043558424300092247604877819821625587944308487310522092440517150600171819145803937177931473336108429889165189521078678397694303305705260759351843006130968234071638035667854938070597400634242396852782331461576526836227336952718230741560369621645218729592233657856104560425642219241082727756696967324334634822771842625681505869025740662258929200756109704988223034840699133778958569054445520305361142302393767439478256174414187983763</span></span><br><span class="line"><span class="string">c = 415916446053083522663299405080903121619846594209033663622616979372099135281363175464579440520262612010099820951944229484417996994283898028928384268216113118778734726335389504987546718739928112684600918108591759061734340607527889972020273454098314620790710425294297542021830654957828983606433731988998097351888879368160881316237557097381718444193741788664735559392675419489952796677690968481917700683813252460912749931286739585465657312416977086336732056497161860235343155953578618273940135486362350057858779130960380833359506761436212727289297656191243565734621757889931250689354508999144817518599291078968866323093</span></span><br><span class="line"><span class="string">n = 12221355905532691305226996552124162033756814028292708728711809229588190407700199452617060657420166395065565154239801465361510672853972152857415394695376825120759202857555325904640144375262531345320714166285999668052224661520834318497234299585219832943519644095197479639328120838919035625832361810964127485907587199925564724081163804724975965691571850962714258888527902920462746795712011579424322515292865504642938090200503979483095345893697972170153990274670257331483858538617460680462369680572833191232126527727222302641204529110948993583190295067970240051042000918629138767209918572311469915774910003970381965123241</span></span><br><span class="line"><span class="string">c = 2248834602646305164283014556051672824689884721514190813323189875541899566338153534858709617544459297836048770439230174669883719627734394673012731609952869246171300132019334542245094425654362711870373095782083791160029789553806741967408922001051006100049326921742208757147339981269528740944842177729701945606827918253016001436218891580980192743564642120923356793292885805519110411357830040053435569937296612987581482128241218218550319154933831743819546558930918761162723110000328532730751591375727881221199739397698390594797621758011191224528339478784930214820615602510460640307707682865125229937141010351138099874025</span></span><br><span class="line"><span class="string">n = 18152103454920389919231636321286527841833809319334215885641536161086810144890443857211776387914779781628740172079478910188540146498426564211851629962338413488555121865779016981727229209606498886170396500155102635962395243364899026418106378234307821492609778555173516000309435730752571818439328803899462791834490025768785383592935046996428331508608555503567191807692523852530836008436655164751054189301721070209363416058642811329040202582026786024825518381761299547703962502636888833428457116986351812252188468878701301184044948733274488264320930936362549028124581962244201377136969591119942276742760215403738913067567</span></span><br><span class="line"><span class="string">c = 2797812094994121597295362327809389195134238119144547570610194659000554967367804835006774413888965325870488368112707535584687083342412367127561646136089638402907513075405746055834487062923240856950047936297155455745928810738711368950139327254040579266046642851362228893522740216519732851152162928545416236075387903789535000820423985522550638100049857678600662008021574841083416323980817348573062083159710189689337626277009675683473560325178417766400002763719953723259300977655801234386662217462862844994462505601804422871991694828697337752697234180117437785537788728412520613916334045368736691714704501962513954509705</span></span><br><span class="line"><span class="string">n = 22877887459293720334652698748191453972019668578065068224653972884599636421200068659750242304040301306798039254241668648594556654589309801728248683586229288074709849246660525799452637187132633064172425677552176203292787732404537215347782229753837476655088638984496409603054524994383358547132112778403912563916886533181616856401929346567686400616307916690806467019665390260267596320840786982457521423178851498130935577260638269429250197050326097193841333205073650802709022947551398142692735680419453533128176592587955634333425401930362881423044363132586170013458300714163531162544301477356808388416864173949089028317961</span></span><br><span class="line"><span class="string">c = 12271947322974809255127222556723394446467844330408506340843897575503534175121932185624776713618037572593449207329510171212097269297133492090526270770286000839978630002819714376964416081198925899119135271459404333829811516667576167576916805217016117373027245648473458331936273975110163065432285322832123169216976420362833557809289561705091817949915218278430834098156335989014645979633658818904753942786129126233956314517292746008579152368541316795082120147520597254020266752859205131887527661767589367756335766220841483940854397440079467053684289006956034944336788288196391829411432383541473132962783883758561108297747</span></span><br><span class="line"><span class="string">n = 19844333358004073542783728196775487079202832688982038135532362073659058674903791697765527614270399097276261983744620537925712167578187109058145015032736796457938148615396547198728652435169126585595701228287449135664667959433491335769206692390262797325133960778920452511673878233190120432257482339068405290918739453464061987163074129048150451046315248186376609350095502130018696275764450248681787926130463463923862832714969425813770847493135627599129546112143050369344208092649256659330284904392961574494907186727388685504929586018639846040474616307662546605623294842316524163106100888851228858194942825157286544846177</span></span><br><span class="line"><span class="string">c = 9531264751315473345056673937611382755236533664089452852716992791452558274873158812669513178040971923528201631609089069182049526587423864397527252061341857426422965190913745048414029690931254119437249218321954899956104589066479231204536856131403590472063496956452030342299863907499976917750846369802185896519725837163530049157920978007252920334447236842959033879772444475877613295594785710745889554296655932909212643500877218304116451889820444820534937901427158918411546484157737612926382420354101675658160847653151539420222526999426483473829341628599881460824765758346670633385844187252696874025582747177333702736465</span></span><br><span class="line"><span class="string">n = 16956880944655068255446705024149899655327230949463546092744762226005904114738078692036960935391303255804754787864713189658290361949509917704853428701870609882427423574672772606814823959758208695540116440342488334213300943604780971422918744381486937517952553797134323570131582724393100092308466968491068503301604506186521656059375518680612292667310641047190088814753025794048591445267711939066523165042651430468971452726568222388482323097260496415484997546126185688914792795834046855221759289007609518312601640548469651358391745947588643697900883634533872314566389446271647587564348026861264979727062157272541149018781</span></span><br><span class="line"><span class="string">c = 16110326928338602237561005337578085623028116490564329920738844771341250444164294693848130674347672763073995755532723894042946521372321947507527854966013459795492930736187058535665041545095683801386814190612817128504426590828954205050425979880047802547011117626354405687170961272200066258220699329112978151044633994329352673342582175349200008181837211288847301836681860817044391028992501763375849046751094019224570802498414368189170656992427042010362385494565216988561215657424755648213390551881450141899860811844684546992754530755092358644968088017107313907435586729574798046187046145596726569637758312033849476689378</span></span><br><span class="line"><span class="string">n = 16472195897077185060734002588086375750797253422014472876266294484788862733424113898147596402056889527985731623940969291811284437034420929030659419753779530635563455664549165618528767491631867637613948406196511848103083967995689432928779805192695209899686072900265108597626632371718430059561807147486376536203800038054012500244392964187780217667805308512187849789773573138494622201856638931435423778275004491853486855300574479177472267767506041000072575623287557610576406578525902565241580838652860552046216587141709709405062150243990097835181557208274750462554811004137033087430556692966525170882625891516050207318491</span></span><br><span class="line"><span class="string">c = 11867731823522211833301190385669833752050387304375114576570892885641949969365352586215693183003550684262313893105989683214739695968039039944442567581277252581988489020834299896625977474857889570528169919064941042132119301236852358823696947330423679033138054012027878783478922023431469564210485180679933264749281963405243082505688901662659030897104957499953192201440290084373968716271056483463909282407034181891901928790601973222643210525000717355062752079302291729448234374709852429885984987094307177760741403086538949190424454337896501402430653783597070178968921411867485584517214777073301007918941216316241784521708</span></span><br><span class="line"><span class="string">n = 13890749889361612188368868998653029697326614782260719535555306236512452110708495623964530174188871342332417484996749651846510646453983388637377706674890018646246874688969342600780781646175634455109757266442675502522791531161284420286435654971819525519296719668701529481662071464145515727217108362496784024871976015116522898184301395037566514980846499856316532479656908169681719288258287756566886281183699239684997698487409138330229321935477734921670373632304542254938831218652340699024011371979519574576890581492623709896310465567043899767342676912434857372520308852745792360420376574037705943820090308501053778144141</span></span><br><span class="line"><span class="string">c = 6250115196713939477947942995075509357173312813431601073354390451609559579925704891503987992181988654989477525811826607070378476102616752398280691012244301950194800995432882828020405062344160270290542566163969692748126314259624623341922057435728127596172871894887055305291345372720594481096374310285437492746765510292863238933163142677773310305789984897974266961231555124787205980411992251387207335655129551950825339766848166539671565212408741432649813058363660321480995187545006718837863674527475323414266732366507905974800565463011676462244368010182725161416783875646259625352308599198614681446394427674340328493047</span></span><br><span class="line"><span class="string">n = 21457499145521259498911107987303777576783467581104197687610588208126845121702391694574491025398113729462454256070437978257494064504146718372095872819969887408622112906108590961892923178192792218161103488204912792358327748493857104191029765218471874759376809136402361582721860433355338373725980783308091544879562698835405262108188595630215081260699112737457564998798692048522706388318528370551365364702529068656665853097899157141017378975007689790000067275142731212069030175682911154288533716549782283859340452266837760560153014200605378914071410125895494331253564598702942990036163269043699029806343766286247742865671</span></span><br><span class="line"><span class="string">c = 6269656777204332618433779865483197625538144405832409880710764183039800286008967127279281167109250083159801218370191973055663058165456565194979210256278526713608759141588082614531352489547674696723140599892318118960648862531538435596775798128845789504910467783731144808685373807716609662688064728614003904579841055786083326311313295311152563668422289435606771091246147867715987583149743032723028324394173498623642539175178996531881058274717907066845565199058931743481410454382746158558886667761300257488769795092777021292335562818583719708133179974425584610403335487082478848975656282384575767178925517257692365828720</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>多组$n$中可能存在公因数$p$。</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n0 = </span><br><span class="line">c0 = </span><br><span class="line"></span><br><span class="line">n1 = </span><br><span class="line">c1 = </span><br><span class="line"></span><br><span class="line">n2 = </span><br><span class="line">c2 = </span><br><span class="line"></span><br><span class="line">n3 = </span><br><span class="line">c3 = </span><br><span class="line"></span><br><span class="line">n4 = </span><br><span class="line">c4 = </span><br><span class="line"></span><br><span class="line">n5 = </span><br><span class="line">c5 = </span><br><span class="line"></span><br><span class="line">n6 = </span><br><span class="line">c6 = </span><br><span class="line"></span><br><span class="line">n7 = </span><br><span class="line">c7 = </span><br><span class="line"></span><br><span class="line">n8 = </span><br><span class="line">c8 = </span><br><span class="line"></span><br><span class="line">n9 = </span><br><span class="line">c9 = </span><br><span class="line"></span><br><span class="line">n10 = </span><br><span class="line">c10 = </span><br><span class="line"></span><br><span class="line">n = [n0,n1,n2,n3,n4,n5,n6,n7,n8,n9,n10]</span><br><span class="line">c = [c0,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)):</span><br><span class="line">        <span class="keyword">if</span> (i!=j):</span><br><span class="line">            t = gmpy2.gcd(n[i],n[j])</span><br><span class="line">            <span class="keyword">if</span> t != <span class="number">1</span>:</span><br><span class="line">                p = t</span><br><span class="line">                q = n[i] // p</span><br><span class="line">                d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">                m = <span class="built_in">pow</span>(c[i],d,n[i])</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<h2 id="中等"><a href="#中等" class="headerlink" title="中等"></a>中等</h2><h3 id="flag-exchange"><a href="#flag-exchange" class="headerlink" title="flag_exchange"></a>flag_exchange</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">diffie_hellman</span>(<span class="params">p, flag</span>):</span><br><span class="line">    alice_privKey = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    alice_pubKey = <span class="built_in">pow</span>(<span class="number">7</span>, alice_privKey, p)</span><br><span class="line">    bob_privKey = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    bob_pubKey = <span class="built_in">pow</span>(<span class="number">7</span>, bob_privKey, p)</span><br><span class="line"></span><br><span class="line">    superkey = <span class="built_in">pow</span>(bob_pubKey, alice_privKey, p)</span><br><span class="line">    m = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (m * superkey) % p, alice_pubKey, bob_pubKey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chall</span>(<span class="params"><span class="built_in">input</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>], <span class="built_in">print</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>]</span>):</span><br><span class="line">    p = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;P = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> p.bit_length() &gt;= <span class="number">1024</span>:</span><br><span class="line">        c, alice_pubKey, bob_pubKey = diffie_hellman(p, flag)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Alice&#x27;s public key: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(alice_pubKey))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Bob&#x27;s public key: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(bob_pubKey))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Ciphertext: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(c))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invalid P&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>类似于DAS7月赛的EzDHKE</p>
<p>传一个光滑的$p$，这样可以很快求出私钥$a,b$。</p>
<p>求出私钥后，求出$superkey$</p>
<p>因为返回的密文$c$满足$c\equiv m ×superkey \mod p$，$\therefore m \equiv c × superkey^{-1} \mod p$</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造一个很光滑的p，即p可以分解成许多小素数之积</span></span><br><span class="line">p = <span class="number">1</span></span><br><span class="line">i = <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span>  isPrime(p+<span class="number">1</span>) ==<span class="literal">False</span> <span class="keyword">or</span> p.bit_length()&lt;<span class="number">1024</span> :</span><br><span class="line">    p *= i</span><br><span class="line">    i = gmpy2.next_prime(i)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(p+1) </span></span><br><span class="line"></span><br><span class="line">g = <span class="number">7</span></span><br><span class="line">p = <span class="number">20404068993016374194542464172774607695659797117423121913227131032339026169175929902244453757410468728842929862271605567818821685490676661985389839958622802465986881376139404138376153096103140834665563646740160279755212317501356863003638612390661668406235422311783742390510526587257026500302696834793248526734305801634165948702506367176701233298064616663553716975429048751575597150417381063934255689124486029492908966644747931</span></span><br><span class="line">A = <span class="number">20336091449271352050000450320351597189353592062279377142884247684088072216754371140723688503847322269500056016823378486967669507529408071986247421480538070427020298314420596325895121922786822444746298488308935254197730980462214370281102952073051791017954008911348128021296665124600273965642418702110947948173149809724203543773244607616601110670126605337319276524135448598308833199821995622969372761107826550795621362415457182</span></span><br><span class="line">B = <span class="number">3016038452071464751422492594184606815201979377859418872430468328543181786920301668755954977729921559697635702877324759319811639923934643618711315555467453055288843246623654939387741368313873206560664229687375070952935800932126812264287402142801364732994539469801252414404987968911552061069354407508916590343552775560281691608737262245571829068155383159065889848197300894149747651679644288337413872066182471443965426404626423</span></span><br><span class="line">c = <span class="number">8101058129734054038632640353434785588447342802920921913999474154497466343094694993166042668700504613189281291125022077749043805204765309971981658929422844998392130190493145455241084775180221325627765838099393607299071835294706132501949635214088146102721237571159346281928107966372652823580266088579392328383545323322931789769149936581855383571990955947284354676448353798975087410774586309247023597516943906734455833918792577</span></span><br><span class="line"></span><br><span class="line">a = discrete_log(mod(A,p),mod(g,p))</span><br><span class="line"></span><br><span class="line">b = discrete_log(mod(B,p),mod(g,p))</span><br><span class="line"></span><br><span class="line">superkey = <span class="built_in">pow</span>(B, a, p)</span><br><span class="line"></span><br><span class="line">p = gmpy2.mpz(p)</span><br><span class="line">superkey = gmpy2.mpz(superkey)</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(superkey,p) % p</span><br><span class="line">m = c*d % p</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>

<h3 id="minipack"><a href="#minipack" class="headerlink" title="minipack"></a>minipack</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">72</span></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(<span class="string">b&quot;\xff&quot;</span> + flag + <span class="string">b&quot;\xff&quot;</span>, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">long2bits</span>(<span class="params">long</span>):</span><br><span class="line">    bits = []</span><br><span class="line">    <span class="keyword">while</span> long &gt; <span class="number">0</span>:</span><br><span class="line">        bits.append(long &amp; <span class="number">1</span>)</span><br><span class="line">        long &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">reversed</span>(bits))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params"><span class="built_in">len</span></span>):</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>):</span><br><span class="line">        delta = random.randint(<span class="number">1</span>, <span class="number">10000</span>)</span><br><span class="line">        x = <span class="built_in">sum</span> + delta</span><br><span class="line">        out.append(x)</span><br><span class="line">        <span class="built_in">sum</span> += x</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = genkey(<span class="number">74</span> * <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;key.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    fs.write(<span class="built_in">str</span>(key))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, keys</span>):</span><br><span class="line">    data = long2bits(m)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(data) == <span class="built_in">len</span>(keys)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>((k <span class="keyword">if</span> (p == <span class="number">1</span>) <span class="keyword">else</span> <span class="number">1</span>) <span class="keyword">for</span> p, k <span class="keyword">in</span> <span class="built_in">zip</span>(data, keys))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;ciphertext.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    fs.write(<span class="built_in">str</span>(encrypt(m, key)))</span><br></pre></td></tr></table></figure>

<p>给的$key$实际上从第二项开始就是一个超递增序列了，利用这个性质，我们便可以恢复$m$的每一位。</p>
<p>需要注意的是，加密的$m$是把高位和$key$的小值相乘的。</p>
<p>我们恢复的时候是通过$key$恢复$m$的每一位，所以恢复的是$m$的低位，因此最后需要逆序</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">key = [...]</span><br><span class="line">c = <span class="number">44096612931024003148407895164090667174657344536623354666642108463093659898867859567157728084018394988840266329206836985537987081415020571845239234014695335928717091578810470705259929</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(key):</span><br><span class="line">    <span class="keyword">if</span> c &gt; i:</span><br><span class="line">        m += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        c -= i</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        m += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        c -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">msg = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(m):</span><br><span class="line">    msg += i</span><br><span class="line"></span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(msg,<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="bad-random"><a href="#bad-random" class="headerlink" title="bad_random"></a>bad_random</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read().strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_params</span>(<span class="params">self</span>):</span><br><span class="line">        self.m = random.randint(<span class="number">10000</span>, <span class="number">20000</span>)</span><br><span class="line">        self.a = random.randint(<span class="number">10000</span>, <span class="number">20000</span>)</span><br><span class="line">        self.c = random.randint(<span class="number">1</span>, self.a-<span class="number">1</span>)</span><br><span class="line">        self.x = random.randint(<span class="number">0</span>, self.m-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_all_output</span>(<span class="params">self</span>):</span><br><span class="line">        x0 = self.x</span><br><span class="line">        s = <span class="built_in">set</span>()</span><br><span class="line">        <span class="keyword">while</span> (t := self()) <span class="keyword">not</span> <span class="keyword">in</span> s:</span><br><span class="line">            s.add(t)</span><br><span class="line">        self.x = x0</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.set_params()</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(self.get_all_output()) &lt; <span class="number">10</span>:</span><br><span class="line">            self.set_params()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self</span>):</span><br><span class="line">        self.x = (self.a * self.x + self.c) % self.m</span><br><span class="line">        <span class="keyword">return</span> self.x</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chall</span>(<span class="params"><span class="built_in">input</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>], <span class="built_in">print</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>]</span>):</span><br><span class="line">    <span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">    <span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters</span><br><span class="line">    s = <span class="string">&quot;&quot;</span>.join(random.choices(ascii_letters, k=<span class="number">16</span>))</span><br><span class="line">    h = md5(s.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;&lt;!&gt; md5(XXXXXXXX+<span class="subst">&#123;s[<span class="number">8</span>:]&#125;</span>) == <span class="subst">&#123;h&#125;</span>&quot;</span>)</span><br><span class="line">    i = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXXXXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> md5((i + s[<span class="number">8</span>:]).encode()).hexdigest() != h:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&lt;!&gt; ACCESS DENIED &lt;!&gt;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    inst = LCG()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Let&#x27;s play a simple game! If you can guess the right number, I will give your the flag! You have 10 tries&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> tries <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        i = <span class="built_in">input</span>(<span class="string">f&quot;Give me a number, you have failed for <span class="subst">&#123;tries&#125;</span> times: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(i) == (right := inst()):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Congurations! You win the game! Your flag is here: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Oh, you are wrong! The right number is <span class="subst">&#123;right&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>题目要求预测下一个随机数(<del>笔者在做题的时候，花了很多时间预测第一轮的值，审题的重要性</del>)，一个lcg问题</p>
<p>大家可能会疑惑这都没有输出，怎么预测啊。</p>
<p>需要注意的是，题目给了10次预测机会，如果回答错误，就会给予我们正确答案，我们可以用9次机会获得数据，再根据LCG的原理进行预测</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    table = string.ascii_letters + string.digits</span><br><span class="line"></span><br><span class="line">    host = <span class="string">&#x27;cl.akarin.tk&#x27;</span>                  </span><br><span class="line">    port =  <span class="number">10001</span>                              </span><br><span class="line">    </span><br><span class="line">    GeShi = <span class="string">b&#x27;Give me XXXX: &#x27;</span>  </span><br><span class="line">    sh = remote(host,port)                  </span><br><span class="line">    data = sh.recvuntil(GeShi).decode()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">    proof = data.split(<span class="string">&#x27;md5&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    Xnum = proof.split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">0</span>].upper().count(<span class="string">&quot;X&quot;</span>)           </span><br><span class="line">    tail = proof.split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;)&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">hash</span> = proof.split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;)&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;==&#x27;</span>)[-<span class="number">1</span>].split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>].strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未知数:&quot;</span>,Xnum)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;tail:&quot;</span>,tail)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hash:&quot;</span>,<span class="built_in">hash</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始爆破&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(table,repeat=<span class="number">4</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = hashlib.md5((head + tail).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> t == <span class="built_in">hash</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;爆破成功！结果是：&#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(head)</span><br><span class="line">            sh.send(head.encode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;以下是提交完XXXX之后的流程\n&quot;</span>)</span><br><span class="line">    output = []</span><br><span class="line">    d = sh.recvline()</span><br><span class="line">    <span class="built_in">print</span>(d.decode())</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        sh.send(<span class="string">&quot;1&quot;</span>.encode())</span><br><span class="line">        data = sh.recvline()</span><br><span class="line">        <span class="built_in">print</span>(data.decode())</span><br><span class="line">        output.append(<span class="built_in">int</span>(data.decode().split(<span class="string">&#x27; &#x27;</span>)[-<span class="number">1</span>]))</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    t = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(output)):</span><br><span class="line">        t.append(output[i]-output[i-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    T = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(t)-<span class="number">1</span>):</span><br><span class="line">        T.append(t[i+<span class="number">1</span>]*t[i-<span class="number">1</span>] - t[i]**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    m = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(T)-<span class="number">1</span>):</span><br><span class="line">        mm = gmpy2.gcd(T[i],T[i+<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> isPrime(mm):</span><br><span class="line">            m.append(<span class="built_in">int</span>(mm))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">                <span class="keyword">if</span> isPrime(mm // i):</span><br><span class="line">                    mm = mm // i</span><br><span class="line">                    m.append(<span class="built_in">int</span>(mm))</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;m的可能取值&quot;</span>,m)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">        <span class="keyword">global</span> flag</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="number">10000</span> &lt; i &lt; <span class="number">20000</span> <span class="keyword">and</span> isPrime(i):   </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;m=&quot;</span>,i)</span><br><span class="line">            a = gmpy2.invert(t[<span class="number">0</span>],i) * t[<span class="number">1</span>] % i</span><br><span class="line">            <span class="keyword">if</span> <span class="number">10000</span> &lt; a &lt; <span class="number">20000</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;a=&quot;</span>,a)</span><br><span class="line">                b = output[<span class="number">1</span>] - a*output[<span class="number">0</span>] % i</span><br><span class="line">                a_ = gmpy2.invert(a,i)</span><br><span class="line"></span><br><span class="line">                seed = (a * output[-<span class="number">1</span>] + b) % i</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;下一个值是:&quot;</span>,seed)</span><br><span class="line">                sh.send(<span class="built_in">str</span>(seed).encode())</span><br><span class="line">                data = sh.recvline()</span><br><span class="line">                <span class="built_in">print</span>(data.decode())</span><br><span class="line">                flag = data.decode().split(<span class="string">&quot;:&quot;</span>)[-<span class="number">1</span>].strip()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> flag != <span class="literal">False</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>值得注意的是，$a$和$m$都是有范围的，而且在做题过程中，发现成功率并不是100%，需要多次尝试。</p>
<h3 id="giant-e"><a href="#giant-e" class="headerlink" title="giant_e"></a>giant_e</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x609778981bfbb26bb93398cb6d96984616a6ab08ade090c1c0d4fedb00f44f0552a1555efec5cc66e7960b61e94e80e7483b9f906a6c8155a91cdc3e4917fa5347c58a2bc85bb160fcf7fe98e3645cfea8458ea209e565e4eb72ee7cbb232331a862d8a84d91a0ff6d74aa3c779b2b129c3d8148b090c4193234764f2e5d9b2170a9b4859501d07c0601cdd18616a0ab2cf713a7c785fd06f27d68dff24446d884644e08f31bd37ecf48750e4324f959a8d37c5bef25e1580851646d57b3d4f525bc04c7ddafdf146539a84703df2161a0da7a368675f473065d2cb661907d990ba4a8451b15e054bfc4dd73e134f3bf7d8fa4716125d8e21f946d16b7b0fc43</span></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag,<span class="string">&quot;big&quot;</span>)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(n) </span><br><span class="line"><span class="comment">#0xbaa70ba4c29eb1e6bb3458827540fce84d40e1c966db73c0a39e4f9f40e975c42e02971dab385be27bd2b0687e2476894845cc46e55d9747a5be5ca9d925931ca82b0489e39724ea814800eb3c0ea40d89ebe7fe377f8d3f431a68d209e7a149851c06a4e67db7c99fcfd9ec19496f29d59bb186feb44a36fe344f11d047b9435a1c47fa2f8ed72f59403ebb0e439738fd550a7684247ab7da64311690f461e6dce03bf2fcd55345948a3b537087f07cd680d7461d326690bf21e39dff30268cb33f86eeceff412cd63a38f7110805d337dcad25e6f7e3728b53ca722b695b0d9db37361b5b63213af50dd69ee8b3cf2085f845d7932c08b27bf638e98497239</span></span><br><span class="line"><span class="built_in">print</span>(c) </span><br><span class="line"><span class="comment">#0x45a9ce4297c8afee693d3cce2525d3399c5251061ddd2462513a57f0fd69bdc74b71b519d3a2c23209d74fcfbcb6b196b5943838c2441cb34496c96e0f9fc9f0f80a2f6d5b49f220cb3e78e36a4a66595aa2dbe3ff6e814d84f07cb5442e2d5d08d08aa9ccde0294b39bfde79a6c6dcd2329e9820744c4deb34a039da7933ddf00b0a0469afb89cba87490a39783a9b2f8f0274f646ca242e78a326dda886c213bc8d03ac1a9150de4ba08c5936c3fe924c8646652ef85aa7ac0103485f472413427a0e9d9a4d416b99e24861ca8499500c693d7a07360158ffffa543480758cafff2a09a9f6628f92767764fa026d48a9dd899838505ae16e38910697f9de14</span></span><br></pre></td></tr></table></figure>

<p>e很大，维纳攻击</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continuedFra</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;计算连分数</span></span><br><span class="line"><span class="string">    :param x: 分子</span></span><br><span class="line"><span class="string">    :param y: 分母</span></span><br><span class="line"><span class="string">    :return: 连分数列表</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cf = []</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        cf.append(x // y)</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    <span class="keyword">return</span> cf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gradualFra</span>(<span class="params">cf</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;计算传入列表最后的渐进分数</span></span><br><span class="line"><span class="string">    :param cf: 连分数列表</span></span><br><span class="line"><span class="string">    :return: 该列表最后的渐近分数</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    numerator = <span class="number">0</span></span><br><span class="line">    denominator = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cf[::-<span class="number">1</span>]:</span><br><span class="line">        <span class="comment"># 这里的渐进分数分子分母要分开</span></span><br><span class="line">        numerator, denominator = denominator, x * denominator + numerator</span><br><span class="line">    <span class="keyword">return</span> numerator, denominator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_pq</span>(<span class="params">a, b, c</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用韦达定理解出pq，x^2−(p+q)∗x+pq=0</span></span><br><span class="line"><span class="string">    :param a:x^2的系数</span></span><br><span class="line"><span class="string">    :param b:x的系数</span></span><br><span class="line"><span class="string">    :param c:pq</span></span><br><span class="line"><span class="string">    :return:p，q</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    par = gmpy2.isqrt(b * b - <span class="number">4</span> * a * c)</span><br><span class="line">    <span class="keyword">return</span> (-b + par) // (<span class="number">2</span> * a), (-b - par) // (<span class="number">2</span> * a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getGradualFra</span>(<span class="params">cf</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;计算列表所有的渐近分数</span></span><br><span class="line"><span class="string">    :param cf: 连分数列表</span></span><br><span class="line"><span class="string">    :return: 该列表所有的渐近分数</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    gf = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(cf) + <span class="number">1</span>):</span><br><span class="line">        gf.append(gradualFra(cf[:i]))</span><br><span class="line">    <span class="keyword">return</span> gf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wienerAttack</span>(<span class="params">e, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param e:</span></span><br><span class="line"><span class="string">    :param n:</span></span><br><span class="line"><span class="string">    :return: 私钥d</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cf = continuedFra(e, n)</span><br><span class="line">    gf = getGradualFra(cf)</span><br><span class="line">    <span class="keyword">for</span> d, k <span class="keyword">in</span> gf:</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> (e * d - <span class="number">1</span>) % k != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">        p, q = solve_pq(<span class="number">1</span>, n - phi + <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> p * q == n:</span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n=</span><br><span class="line">e=</span><br><span class="line">c=</span><br><span class="line"></span><br><span class="line">d = wienerAttack(e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;d =&quot;</span>,d)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(m).decode())</span><br></pre></td></tr></table></figure>

<h3 id="factorize-me"><a href="#factorize-me" class="headerlink" title="factorize_me"></a>factorize_me</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> prod</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choices</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"></span><br><span class="line">primes = [getPrime(<span class="number">512</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;prod(primes) = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;prod(p - <span class="number">1</span> <span class="keyword">for</span> p <span class="keyword">in</span> primes) = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">primes2 = [nextprime(p) <span class="keyword">for</span> p <span class="keyword">in</span> choices(primes, k=<span class="number">3</span>)]</span><br><span class="line">n = prod(primes2)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(<span class="built_in">int</span>.from_bytes(flag, <span class="string">&#x27;big&#x27;</span>), e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 363364907814244019888662301376841344262476227242899756862391470731421569394957444030214887114615748277199649349781524749919652160244484352285668794188836866602305788131186220057989320357344904731322223310531945208433910803617954798258382169132907508787682006064930747033681966462568715421005454243255297306718356766130469885581576362173340673516476386201173298433892314145854649884922769732583885904512624543994675379894718657682146178638074984373206937523380103438050549181568015985546172618830480078894445808092527561363650503540062128543705172678754195578429520889784813733491180748361345720247750720179608752244490362713103319685024237941527268458213442611663415417005556439749055222361212059968254748751273361732365487788593341859760309778894350385339764442343374673786357175846291309425081492959910254127778240522152676060766139057453197528944251599979227271074508795482632471242983094008619339488744362509349734218480932255216087706001484182136783834973304870508270118505737767002256270427907341952256516206663258530300791364944105025764611810001781971638030661367630116818647252727909489405550104641122269772492252464714694507693447974171377200402508765841829763548525530878309985480248379655169722567051495205792089930014228403456098065971372039443284193603395249634283366194562380309469628114581468645669390610963076340643757972439104287127375438663839421605531570285615180251</span></span><br><span class="line"><span class="comment"># 363364907814244019888662301376841344262476227242899756862391470731421569394957444030214887114615748277199649349781524749919652160244484352285668794188836492373364350673588273863828369502073826782362255108313852264064760467561392054178047091483873483255491431451728274259516789065331176728192953741805933100379191778599394515981288225535175013258094287912195847642598436035132783919453991516358280321085873745330313812205910011387125778714795906023110368957596998222544234082487264006696812862179916726781327290284827659294751262185328816323311831349296593013038823107653943652771448719760448938995150646738377177532550757319539185878535087009904848382493668686831331474113789651777885239747000076063679062106375348803749466079052774597412239427050432901553466002731972993029311850718200685157193170716432600165476733200831046297530470544781309612128231925681374239849452623513538498417735984094919756374577623486416462101457492789215144166273775249387638107644634704270216130852885082174564648445147377239033930079759024399532146184753110240154062693457622208373371290126810856885343328090305620627668495081760346853701632815149478447405718664667978825807101325764916405446176183238866136433205933785973568759281210319422288153910340542098573782006262190181726245838857185687242960093445000287347616796984610291664809895901301187179157382169999966124177588884152267266994164841066291200</span></span><br><span class="line"><span class="comment"># n = 899081756851564072995842371038848265712822308942406479625157544735473115850983700580364485532298999127834142923262920189902691972009898741820291331257478170998867183390650298055916005944577877856728843264502218692432679062445730259562784479410120575777748292393321588239071577384218317338474855507210816917917699500763270490789679076190405915250953860114858086078092945282693720016414837231157788381144668395364877545151382171251673050910143023561541226464220441</span></span><br><span class="line"><span class="comment"># e = 65537</span></span><br><span class="line"><span class="comment"># c = 841335863342518623856757469220437045493934999201203757845757404101093751603513457430254875658199946020695655428637035628085973393246970440054477600379027466651143466332405520374224855994531411584946074861018245519106776529260649700756908093025092104292223745612991818151040610497258923925952531383407297026038305824754456660932812929344928080812670596607694776017112795053283695891798940700646874515366341575417161087304105309794441077774052357656529143940010140</span></span><br></pre></td></tr></table></figure>

<p>已知大N和大N对应的$\phi(N)$，</p>
<p>通过$\phi(N)$和$N$可以分解N。</p>
<p>然后稍微爆破一下即可出flag</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> is_prime</span><br><span class="line"><span class="comment"># from sage.all import is_prime</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factorize</span>(<span class="params">N, phi</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Recovers the prime factors from a modulus if Euler&#x27;s totient is known.</span></span><br><span class="line"><span class="string">    This method only works for a modulus consisting of 2 primes!</span></span><br><span class="line"><span class="string">    :param N: the modulus</span></span><br><span class="line"><span class="string">    :param phi: Euler&#x27;s totient, the order of the multiplicative group modulo N</span></span><br><span class="line"><span class="string">    :return: a tuple containing the prime factors, or None if the factors were not found</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    s = N + <span class="number">1</span> - phi</span><br><span class="line">    d = s ** <span class="number">2</span> - <span class="number">4</span> * N</span><br><span class="line">    p = <span class="built_in">int</span>(s - isqrt(d)) // <span class="number">2</span></span><br><span class="line">    q = <span class="built_in">int</span>(s + isqrt(d)) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factorize_multi_prime</span>(<span class="params">N, phi</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Recovers the prime factors from a modulus if Euler&#x27;s totient is known.</span></span><br><span class="line"><span class="string">    This method works for a modulus consisting of any number of primes, but is considerably be slower than factorize.</span></span><br><span class="line"><span class="string">    More information: Hinek M. J., Low M. K., Teske E., &quot;On Some Attacks on Multi-prime RSA&quot; (Section 3)</span></span><br><span class="line"><span class="string">    :param N: the modulus</span></span><br><span class="line"><span class="string">    :param phi: Euler&#x27;s totient, the order of the multiplicative group modulo N</span></span><br><span class="line"><span class="string">    :return: a tuple containing the prime factors</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    prime_factors = <span class="built_in">set</span>()</span><br><span class="line">    factors = [N]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(factors) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># Element to factorize.</span></span><br><span class="line">        N = factors[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        w = randrange(<span class="number">2</span>, N - <span class="number">1</span>)</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> phi % (<span class="number">2</span> ** i) == <span class="number">0</span>:</span><br><span class="line">            sqrt_1 = <span class="built_in">pow</span>(w, phi // (<span class="number">2</span> ** i), N)</span><br><span class="line">            <span class="keyword">if</span> sqrt_1 &gt; <span class="number">1</span> <span class="keyword">and</span> sqrt_1 != N - <span class="number">1</span>:</span><br><span class="line">                <span class="comment"># We can remove the element to factorize now, because we have a factorization.</span></span><br><span class="line">                factors = factors[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">                p = gcd(N, sqrt_1 + <span class="number">1</span>)</span><br><span class="line">                q = N // p</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> is_prime(p):</span><br><span class="line">                    prime_factors.add(p)</span><br><span class="line">                <span class="keyword">elif</span> p &gt; <span class="number">1</span>:</span><br><span class="line">                    factors.append(p)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> is_prime(q):</span><br><span class="line">                    prime_factors.add(q)</span><br><span class="line">                <span class="keyword">elif</span> q &gt; <span class="number">1</span>:</span><br><span class="line">                    factors.append(q)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Continue in the outer loop</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tuple</span>(prime_factors)</span><br><span class="line">    </span><br><span class="line">N = </span><br><span class="line">phi = </span><br><span class="line">prime = factorize_multi_prime(N,phi)</span><br><span class="line"><span class="comment">#print(prime)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choices</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">	primes2 = [gmpy2.next_prime(p) <span class="keyword">for</span> p <span class="keyword">in</span> choices(prime, k=<span class="number">3</span>)]</span><br><span class="line">	n = </span><br><span class="line">	c = </span><br><span class="line">	<span class="keyword">if</span> prod(primes2) == n:</span><br><span class="line">		phi = <span class="number">1</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> primes2:</span><br><span class="line">			phi *= (i-<span class="number">1</span>)</span><br><span class="line">			d = gmpy2.invert(<span class="number">65537</span>,phi)</span><br><span class="line">			m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">			flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">			<span class="keyword">if</span> <span class="string">b&#x27;moectf&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">				<span class="built_in">print</span>(flag)</span><br><span class="line">				<span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="难"><a href="#难" class="headerlink" title="难"></a>难</h2><h3 id="xorrrrrrrrr"><a href="#xorrrrrrrrr" class="headerlink" title="xorrrrrrrrr"></a>xorrrrrrrrr</h3><p>这道题算是长见识了，在lingfeng师傅指导下学了新东西</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;moectf&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">article = <span class="built_in">open</span>(<span class="string">&#x27;article.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">strxor = <span class="keyword">lambda</span> x,y: <span class="built_in">bytes</span>([a^b <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(x,y)])</span><br><span class="line"></span><br><span class="line">result = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    range_start = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(article) - <span class="built_in">len</span>(flag))</span><br><span class="line">    mask = article[range_start:range_start + <span class="built_in">len</span>(flag)]</span><br><span class="line">    result.append(strxor(flag,mask))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;result.log&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    fs.writelines([<span class="built_in">str</span>(i)+<span class="string">&quot;\n&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> result])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据题目，可以意识到，我们可以通过已知的部分明文恢复100个7位的article(甚至更多，最后一位也可以恢复)。</p>
<p>然后把每一个7位的article，遍历密文中每7位值进行异或，如果结果是可打印字符，那么就有可能是$flag$的值</p>
<p>然后再从中判断$flag$后6位和有可能的值的前6位是否相等，如果相等，那么第七位就有可能是$flag$的后一位。</p>
<p>再进行词频分析，选择可能性更大的那个字符</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">strxor = <span class="keyword">lambda</span> x,y: <span class="built_in">bytes</span>([a^b <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(x,y)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;result.log&quot;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  f = f.readlines()</span><br><span class="line"></span><br><span class="line">cipher = [<span class="built_in">eval</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> f]</span><br><span class="line"></span><br><span class="line">head = <span class="string">b&#x27;moectf&#123;&#x27;</span></span><br><span class="line"></span><br><span class="line">article = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">  article.append(<span class="built_in">bytes</span>(strxor(head,i[:<span class="number">7</span>])))</span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(article)</span><br><span class="line">re=[]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> tqdm(article):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(i)-<span class="number">7</span>):</span><br><span class="line">            tmp=strxor(i[j:j+<span class="number">7</span>],x)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">str</span>(tmp))==<span class="number">10</span>:</span><br><span class="line">                re.append(tmp.decode())			</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;moectf&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">72</span>-<span class="number">8</span>):</span><br><span class="line">    col=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> re:</span><br><span class="line">        <span class="keyword">if</span> flag[-<span class="number">6</span>:] ==i[:<span class="number">6</span>]:</span><br><span class="line">            col.append(i[-<span class="number">1</span>])</span><br><span class="line">    K=Counter(col)</span><br><span class="line">    flag=flag+K.most_common()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(flag+<span class="string">&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>值得注意的是</p>
<p>这里的<code>eavl(i)</code>是把$i$从<code>str</code>变成<code>byte</code>，区别于<code>.encode()</code></p>
<p>&#96;&#96;K&#x3D;Counter(col)<code>统计</code>col&#96;中每个字符每个字符出现的次数，并且以元组的形式返回</p>
<p><code>K.most_common()</code>作用同上，但是返回的是列表，这个列表由有序对组成</p>
<p>使用示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">col = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">64</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">12</span>,<span class="number">14</span>]</span><br><span class="line">K = Counter(col)</span><br><span class="line"><span class="built_in">print</span>(K)</span><br><span class="line"><span class="comment">#Counter(&#123;1: 1, 2: 1, 64: 1, 4: 1, 8: 1, 7: 1, 5: 1, 12: 1, 14: 1&#125;)</span></span><br><span class="line"><span class="built_in">print</span>(K.most_common())</span><br><span class="line"><span class="comment">#[(1, 1), (2, 1), (64, 1), (4, 1), (8, 1), (7, 1), (5, 1), (12, 1), (14, 1)]</span></span><br></pre></td></tr></table></figure>

<h3 id="ez-chian"><a href="#ez-chian" class="headerlink" title="ez_chian"></a>ez_chian</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;key.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    key = <span class="built_in">int</span>(fs.read().strip())</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">72</span></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">base = bytes_to_long(<span class="string">b&quot;koito&quot;</span>)</span><br><span class="line">iv = <span class="number">3735927943</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockize</span>(<span class="params">long</span>):</span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">while</span> long &gt; <span class="number">0</span>:</span><br><span class="line">        out.append(long % base)</span><br><span class="line">        long //= base</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">reversed</span>(out))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">blocks = blockize(m)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_block_cbc</span>(<span class="params">blocks, iv, key</span>):</span><br><span class="line">    encrypted = [iv]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(blocks)):</span><br><span class="line">        encrypted.append(blocks[i] ^ encrypted[i] ^ key)</span><br><span class="line">    <span class="keyword">return</span> encrypted[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(encrypt_block_cbc(blocks, iv, key))</span><br><span class="line"><span class="comment"># [8490961288, 122685644196, 349851982069, 319462619019, 74697733110, 43107579733, 465430019828, 178715374673, 425695308534, 164022852989, 435966065649, 222907886694, 420391941825, 173833246025, 329708930734]</span></span><br></pre></td></tr></table></figure>

<p><code>blockize</code>函数相当于是把传入的<code>long</code>用<code>base</code>进制表示，最后把<code>out</code>逆序返回，所以返回的列表中存放的是<code>long</code>的高位到低位(对于base进制而言的高位低位)。</p>
<p>然后是个CBC加密模式，给了iv，重点是求出key。我们是能知道部分的明文，所以是可以求key的。</p>
<p>已知flag格式为<code>moectf&#123;&#125;</code></p>
<p>自己把flag填充为72位，再把它表示成base进制。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base = bytes_to_long(<span class="string">b&quot;koito&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockize</span>(<span class="params">long</span>):</span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">while</span> long &gt; <span class="number">0</span>:</span><br><span class="line">        out.append(long % base)</span><br><span class="line">        long //= base</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">reversed</span>(out))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    flag = <span class="string">&#x27;moectf&#123;&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join(random.choices(string.ascii_letters,k=<span class="number">64</span>)) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">    m = bytes_to_long(flag.encode())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(blockize(m))</span><br></pre></td></tr></table></figure>

<p>经过多组数据测试，可以判断第一块加密的明文的值是<code>	5329712293</code></p>
<p>由此，便可以求得key，然后就是CBC解密了</p>
<p>需要注意的是，CBC解出来的是m每一位的值(对于base进制)，而且是从高到低。</p>
<p>最后用进制恢复m即可求解</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">base = bytes_to_long(<span class="string">b&quot;koito&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(base)</span><br><span class="line"></span><br><span class="line">iv = <span class="number">3735927943</span></span><br><span class="line">m0 = <span class="number">5329712293</span></span><br><span class="line">c = [<span class="number">8490961288</span>, <span class="number">122685644196</span>, <span class="number">349851982069</span>, <span class="number">319462619019</span>, <span class="number">74697733110</span>, <span class="number">43107579733</span>, <span class="number">465430019828</span>, <span class="number">178715374673</span>, <span class="number">425695308534</span>, <span class="number">164022852989</span>, <span class="number">435966065649</span>, <span class="number">222907886694</span>, <span class="number">420391941825</span>, <span class="number">173833246025</span>, <span class="number">329708930734</span>]</span><br><span class="line"></span><br><span class="line">key = c[<span class="number">0</span>] ^ m0 ^ iv</span><br><span class="line"></span><br><span class="line">out = [m0]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(c)):</span><br><span class="line">    msg = c[i] ^ c[i-<span class="number">1</span>] ^ key</span><br><span class="line">    out.append(msg)</span><br><span class="line"><span class="built_in">print</span>(out)                          </span><br><span class="line"></span><br><span class="line">out = out[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">m = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(out)):</span><br><span class="line">    m += out[i] * base **i</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<h3 id="broken-hash"><a href="#broken-hash" class="headerlink" title="broken_hash"></a>broken_hash</h3><p>题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">F</span>(<span class="params">x, y, z</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x &amp; ~y) ^ (y &amp; ~z) ^ (z &amp; ~x)) ^ (</span><br><span class="line">        ((x + y) * (y + z) + (x + z)) &amp; <span class="number">0xFFFF_FFFF_FFFF_FFFF_FFFF_FFFF_FFFF_FFFF</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_block_hash</span>(<span class="params">a, b, c, d</span>):</span><br><span class="line">    x, y, z, w = F(a, b, c), F(b, c, d), F(c, d, a), F(d, a, b)</span><br><span class="line">    <span class="keyword">return</span> (a ^ b ^ c ^ d ^ x ^ y ^ z ^ w) ^ <span class="number">0xFFFF_FFFF_FFFF_FFFF_FFFF_FFFF_FFFF_FFFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_hash</span>(<span class="params">blocks: <span class="built_in">list</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    length = <span class="built_in">len</span>(blocks)</span><br><span class="line">    <span class="keyword">if</span> length % <span class="number">4</span> != <span class="number">0</span>:</span><br><span class="line">        padding = <span class="number">4</span> - length % <span class="number">4</span></span><br><span class="line">        blocks += [<span class="number">0</span>] * padding</span><br><span class="line">        length += padding</span><br><span class="line">    <span class="keyword">if</span> length == <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span> _block_hash(*blocks)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        block_size = length // <span class="number">4</span></span><br><span class="line">        h1 = _<span class="built_in">hash</span>(blocks[:block_size])</span><br><span class="line">        h2 = _<span class="built_in">hash</span>(blocks[block_size : block_size * <span class="number">2</span>])</span><br><span class="line">        h3 = _<span class="built_in">hash</span>(blocks[block_size * <span class="number">2</span> : block_size * <span class="number">3</span>])</span><br><span class="line">        h4 = _<span class="built_in">hash</span>(blocks[block_size * <span class="number">3</span> :])</span><br><span class="line">        <span class="keyword">return</span> _block_hash(h1, h2, h3, h4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes2blocks</span>(<span class="params">data: <span class="built_in">bytes</span>, block_size=<span class="number">16</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data) % block_size != <span class="number">0</span>:</span><br><span class="line">        data += <span class="string">b&quot;\x00&quot;</span> * (block_size - <span class="built_in">len</span>(data) % block_size)</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="built_in">int</span>.from_bytes(data[i : i + block_size], <span class="string">&quot;little&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), block_size)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">*data: <span class="built_in">list</span>[<span class="built_in">bytes</span>]</span>):</span><br><span class="line">    <span class="keyword">return</span> _<span class="built_in">hash</span>(bytes2blocks(<span class="string">b&quot;&quot;</span>.join(data)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randbytes</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode,b64encode</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choices</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chall</span>(<span class="params"><span class="built_in">input</span>: <span class="type">Callable</span>[[<span class="built_in">str</span>], <span class="literal">None</span>], <span class="built_in">print</span>: <span class="type">Callable</span>[[<span class="built_in">str</span>], <span class="literal">None</span>]</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line"></span><br><span class="line">        s = <span class="string">&quot;&quot;</span>.join(choices(ascii_letters, k=<span class="number">16</span>))</span><br><span class="line">        h = md5(s.encode()).hexdigest()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;&lt;!&gt; md5(XXXXXXXX+<span class="subst">&#123;s[<span class="number">8</span>:]&#125;</span>) == <span class="subst">&#123;h&#125;</span>&quot;</span>)</span><br><span class="line">        i = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXXXXXX: &quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> md5((i + s[<span class="number">8</span>:]).encode()).hexdigest() == h</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&lt;!&gt; ACCESS DENIED &lt;!&gt;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    b = randbytes(<span class="number">256</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;this is a random bytes: <span class="subst">&#123;b64encode(b).decode()&#125;</span>&quot;</span>)</span><br><span class="line">    i = <span class="built_in">input</span>(<span class="string">&quot;give me another bytes with the same hash: &quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d = b64decode(i)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;invaild input&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hash</span>(b) == <span class="built_in">hash</span>(d) <span class="keyword">and</span> d!=b:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;congurations! and your flag is <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<p>先分析函数</p>
<h4 id="F"><a href="#F" class="headerlink" title="F"></a>F</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">F</span>(<span class="params">x, y, z</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x &amp; ~y) ^ (y &amp; ~z) ^ (z &amp; ~x)) ^ (</span><br><span class="line">        ((x + y) * (y + z) + (x + z)) &amp; <span class="number">0xFFFF_FFFF_FFFF_FFFF_FFFF_FFFF_FFFF_FFFF</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>接收3个参数。观察到<code>(x &amp; ~y) ^ (y &amp; ~z) ^ (z &amp; ~x)</code>这个表达式有个特征：把$x,y,z$三者进行交换，或者两者进行交换是不影响整个表达式最后的值。</p>
<p>$(x + y) × (y + z) + (x + z) &#x3D; y^2 + (y+1)(x+z) + xz$这个表达式交换$x,z$不影响整个表达式的值</p>
<p>所以$F(x,y,z) &#x3D; F(z,y,x)$</p>
<h4 id="block-hash"><a href="#block-hash" class="headerlink" title="_block_hash"></a>_block_hash</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_block_hash</span>(<span class="params">a, b, c, d</span>):</span><br><span class="line">    x, y, z, w = F(a, b, c), F(b, c, d), F(c, d, a), F(d, a, b)</span><br><span class="line">    <span class="keyword">return</span> (a ^ b ^ c ^ d ^ x ^ y ^ z ^ w) ^ <span class="number">0xFFFF_FFFF_FFFF_FFFF_FFFF_FFFF_FFFF_FFFF</span></span><br></pre></td></tr></table></figure>

<p>$\because x,y,z,w &#x3D; F(a,b,c),F(b,c,d),F(c,d,a),F(d,a,b)$</p>
<p>等同于$x,y,z,w &#x3D; F(c,b,a),F(d,c,b),F(a,d,c),F(b,a,d)$</p>
<p>而且不影响最后<code>(a ^ b ^ c ^ d ^ x ^ y ^ z ^ w)</code>的值</p>
<p>$\therefore$ <code>_block_hash(a, b, c, d) = _block_hash(c, d, a, b)</code></p>
<h4 id="hash"><a href="#hash" class="headerlink" title="_hash"></a>_hash</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_hash</span>(<span class="params">blocks: <span class="built_in">list</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    length = <span class="built_in">len</span>(blocks)</span><br><span class="line">    <span class="keyword">if</span> length % <span class="number">4</span> != <span class="number">0</span>:</span><br><span class="line">        padding = <span class="number">4</span> - length % <span class="number">4</span></span><br><span class="line">        blocks += [<span class="number">0</span>] * padding</span><br><span class="line">        length += padding</span><br><span class="line">    <span class="keyword">if</span> length == <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span> _block_hash(*blocks)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        block_size = length // <span class="number">4</span></span><br><span class="line">        h1 = _<span class="built_in">hash</span>(blocks[:block_size])</span><br><span class="line">        h2 = _<span class="built_in">hash</span>(blocks[block_size : block_size * <span class="number">2</span>])</span><br><span class="line">        h3 = _<span class="built_in">hash</span>(blocks[block_size * <span class="number">2</span> : block_size * <span class="number">3</span>])</span><br><span class="line">        h4 = _<span class="built_in">hash</span>(blocks[block_size * <span class="number">3</span> :])</span><br><span class="line">        <span class="keyword">return</span> _block_hash(h1, h2, h3, h4)</span><br></pre></td></tr></table></figure>

<p>接收一个装有整形数据的列表。如果列表刚好是4个数据，那就返回<code>_broken_hash()</code>的值，如果不是，就先分为4组，再返回<code>_broken_hash()</code>的值</p>
<h4 id="bytes2blocks"><a href="#bytes2blocks" class="headerlink" title="bytes2blocks"></a>bytes2blocks</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bytes2blocks</span>(<span class="params">data: <span class="built_in">bytes</span>, block_size=<span class="number">16</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data) % block_size != <span class="number">0</span>:</span><br><span class="line">        data += <span class="string">b&quot;\x00&quot;</span> * (block_size - <span class="built_in">len</span>(data) % block_size)</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="built_in">int</span>.from_bytes(data[i : i + block_size], <span class="string">&quot;little&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), block_size)</span><br></pre></td></tr></table></figure>

<p>接受byte数据，把一串byte数据分为16字节的块，并以列表的形式返回。</p>
<h4 id="hash-1"><a href="#hash-1" class="headerlink" title="hash"></a>hash</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">*data: <span class="built_in">list</span>[<span class="built_in">bytes</span>]</span>):</span><br><span class="line">    <span class="keyword">return</span> _<span class="built_in">hash</span>(bytes2blocks(<span class="string">b&quot;&quot;</span>.join(data)))</span><br></pre></td></tr></table></figure>

<p>接收一个装有byte数据的列表。</p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>靶机给出256长的字节，按照<code>bytes2blocks</code>，我们可以将其分为16块，也就是4×4</p>
<p>在<code>bytes2block</code>函数作用后</p>
<p>变成$[C_{1,1},C_{1,2},C_{1,3},C_{1,4},C_{2,1},C_{2,2},C_{2,3},C_{2,4},C_{3,1},C_{3,2}, C_{3,3},C_{3,4},C_{4,1},C_{4,2},C_{4,3},C_{4,4}]$</p>
<p>根据<code>_hash(a,b,c,d)</code>，先分别计算</p>
<p>$h_1 &#x3D; _hash(C_{1,1},C_{1,2},C_{1,3},C_{1,4})$；</p>
<p>$h_2 &#x3D; _hash(C_{2,1},C_{2,2},C_{2,3},C_{2,4})$；</p>
<p>$h_3 &#x3D; _hash(C_{3,1},C_{3,2},C_{3,3},C_{3,4})$；</p>
<p>$h_4 &#x3D; _hash(C_{4,1},C_{4,2},C_{4,3},C_{4,4})$。</p>
<p>再计算$h &#x3D; _hash(h_1,h_2,h_3,h_4)$</p>
<p>根据算法的性质</p>
<p>$h &#x3D; _hash(h_3,h_4,h_1,h_2)$</p>
<p>$h_1 &#x3D; _hash(C_{1,3},C_{1,4},C_{1,1},C_{1,2})$；</p>
<p>$h_2 &#x3D; _hash(C_{2,3},C_{2,4},C_{2,1},C_{2,2})$；</p>
<p>$h_3 &#x3D; _hash(C_{3,3},C_{3,4},C_{3,1},C_{3,2})$；</p>
<p>$h_4 &#x3D; _hash(C_{4,3},C_{4,4},C_{4,1},C_{4,2})$。</p>
<p>所以只需要把靶机给的值进行一些交换即可</p>
<p>即把$[C_{1,1},C_{1,2},C_{1,3},C_{1,4},C_{2,1},C_{2,2},C_{2,3},C_{2,4},C_{3,1},C_{3,2}, C_{3,3},C_{3,4},C_{4,1},C_{4,2},C_{4,3},C_{4,4}]$</p>
<p>改为$[C_{3,3},C_{3,4},C_{3,1},C_{3,2},C_{4,3},C_{4,4},C_{4,1},C_{4,2},C_{1,3},C_{1,4}, C_{1,1},C_{1,2},C_{2,3},C_{2,4},C_{2,1},C_{2,2}]$</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">table = string.ascii_letters + string.digits</span><br><span class="line">host = <span class="string">&#x27;cl.akarin.tk&#x27;</span></span><br><span class="line">post = <span class="number">10002</span></span><br><span class="line">GeShi = <span class="string">b&#x27;Give me XXXX: &#x27;</span>  <span class="comment"># 改格式！</span></span><br><span class="line"></span><br><span class="line">sh = remote(host,post)</span><br><span class="line">data = sh.recvuntil(GeShi).decode()</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">proof = data.split(<span class="string">&#x27;md5&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">Xnum = proof.split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">0</span>].upper().count(<span class="string">&quot;X&quot;</span>)           <span class="comment">#要爆破的数量</span></span><br><span class="line">tail = proof.split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;)&#x27;</span>)[<span class="number">0</span>].strip()</span><br><span class="line"><span class="built_in">hash</span> = proof.split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;)&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;==&#x27;</span>)[-<span class="number">1</span>].split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>].strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;未知数:&quot;</span>,Xnum)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;tail:&quot;</span>,tail)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hash:&quot;</span>,<span class="built_in">hash</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始爆破&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> product(table,repeat=Xnum):</span><br><span class="line">    head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">    t = hashlib.md5((head + tail).encode()).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> t == <span class="built_in">hash</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;爆破成功！结果是：&#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(head)</span><br><span class="line">        sh.send(head.encode())</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;以下是提交完XXXX之后的流程\n&quot;</span>)</span><br><span class="line">data1 = sh.recvline().decode().strip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(data1)</span><br><span class="line">cipher_enc = data1.split(<span class="string">&#x27;:&#x27;</span>)[-<span class="number">1</span>].strip().encode()      <span class="comment">#本来是str加个encode变成byte</span></span><br><span class="line">cipher = base64.b64decode(cipher_enc)					</span><br><span class="line"></span><br><span class="line">data2 = sh.recvuntil(<span class="string">b&#x27;:&#x27;</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(data2)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trans</span>(<span class="params">c</span>):</span><br><span class="line">    length = <span class="built_in">len</span>(c)</span><br><span class="line">    C = [c[i:i+length//<span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,length,length//<span class="number">4</span>)]</span><br><span class="line">    C[<span class="number">0</span>],C[<span class="number">1</span>],C[<span class="number">2</span>],C[<span class="number">3</span>] = C[<span class="number">2</span>],C[<span class="number">3</span>],C[<span class="number">0</span>],C[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;&quot;</span>.join(C)</span><br><span class="line"></span><br><span class="line">tmp = trans(cipher)</span><br><span class="line">length = <span class="built_in">len</span>(tmp)</span><br><span class="line">tmpp = [tmp[i:i+length//<span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,length,length//<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">anser = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tmpp:</span><br><span class="line">    anser += trans(i)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(anser)</span><br><span class="line">sh.send(base64.b64encode(anser))							<span class="comment">#要进行base64加密后再传给靶机</span></span><br><span class="line">sh.interactive()											<span class="comment">#base64后就是byte数据，不需要encode</span></span><br></pre></td></tr></table></figure>

<p>做题过程中注意下数据类型</p>
<h3 id="feistel"><a href="#feistel" class="headerlink" title="feistel"></a>feistel</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="built_in">round</span> = <span class="number">2</span></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;./secret&quot;</span>, <span class="string">&quot;rb&quot;</span>).read().strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">m, key</span>):</span><br><span class="line">    m = m ^ (m &gt;&gt; <span class="number">4</span>)</span><br><span class="line">    m = m ^ (m &lt;&lt; <span class="number">5</span>)</span><br><span class="line">    m = m ^ (m &gt;&gt; <span class="number">8</span>)</span><br><span class="line">    m ^= key</span><br><span class="line">    m = (m * <span class="number">1145</span> + <span class="number">14</span>) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    m = (m * <span class="number">1919</span> + <span class="number">810</span>) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    m = (m * key) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">m, key, <span class="built_in">round</span></span>):</span><br><span class="line">    key = bytes_to_long(key)</span><br><span class="line">    left = bytes_to_long(m[:<span class="number">8</span>])</span><br><span class="line">    right = bytes_to_long(m[<span class="number">8</span>:])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">round</span>):</span><br><span class="line">        left, right = right, f(right, key) ^ left</span><br><span class="line">    left, right = right, left</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(left).rjust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>) + long_to_bytes(right).rjust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding</span>(<span class="params">m</span>):</span><br><span class="line">    mlen = <span class="built_in">len</span>(m)</span><br><span class="line">    pad = <span class="number">16</span> - mlen % <span class="number">16</span></span><br><span class="line">    <span class="keyword">return</span> m + pad * <span class="built_in">bytes</span>([pad])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ecb_enc</span>(<span class="params">m, key</span>):</span><br><span class="line">    m = padding(m)</span><br><span class="line">    mlen = <span class="built_in">len</span>(m)</span><br><span class="line">    c = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(mlen // <span class="number">16</span>):</span><br><span class="line">        c += enc(m[i * <span class="number">16</span> : i * <span class="number">16</span> + <span class="number">16</span>], key, <span class="built_in">round</span>)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ecb_enc(flag, <span class="string">b&quot;wulidego&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;\x0b\xa7\xc6J\xf6\x80T\xc6\xfbq\xaa\xd8\xcc\x95\xad[\x1e\&#x27;W5\xce\x92Y\xd3\xa0\x1fL\xe8\xe1&quot;^\xad&#x27;</span></span><br></pre></td></tr></table></figure>

<p>手推一下过程</p>
<p><img src="/../../images/2023MoeCTF/10.png"></p>
<p>题目给出key</p>
<p><strong>把</strong>①<strong>和key丢入f函数，再和密文的左一半异或，即可得到明文的后一半。</strong></p>
<p><strong>得到明文后一半后，丢入f函数，再和密文的右一半异或，即可得到明文的前一半</strong></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">m, key</span>):</span><br><span class="line">    m = m ^ (m &gt;&gt; <span class="number">4</span>)</span><br><span class="line">    m = m ^ (m &lt;&lt; <span class="number">5</span>)</span><br><span class="line">    m = m ^ (m &gt;&gt; <span class="number">8</span>)</span><br><span class="line">    m ^= key</span><br><span class="line">    m = (m * <span class="number">1145</span> + <span class="number">14</span>) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    m = (m * <span class="number">1919</span> + <span class="number">810</span>) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    m = (m * key) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">c,key</span>):</span><br><span class="line">    key = bytes_to_long(key)</span><br><span class="line">    left = bytes_to_long(c[:<span class="number">8</span>])</span><br><span class="line">    right = bytes_to_long(c[<span class="number">8</span>:])</span><br><span class="line">    m_right = f(right,key) ^ left</span><br><span class="line">    m_left = f(m_right,key) ^ right</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(m_left) + long_to_bytes(m_right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ecb_dec</span>(<span class="params">c, key</span>):</span><br><span class="line">    clen = <span class="built_in">len</span>(c)</span><br><span class="line">    m = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(clen // <span class="number">16</span>):</span><br><span class="line">        m += dec(c[i * <span class="number">16</span> : i * <span class="number">16</span> + <span class="number">16</span>], key)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">c = <span class="string">b&#x27;\x0b\xa7\xc6J\xf6\x80T\xc6\xfbq\xaa\xd8\xcc\x95\xad[\x1e\&#x27;W5\xce\x92Y\xd3\xa0\x1fL\xe8\xe1&quot;^\xad&#x27;</span></span><br><span class="line">key = <span class="string">b&quot;wulidego&quot;</span></span><br><span class="line">flag = ecb_dec(c,key)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="feistel-promax"><a href="#feistel-promax" class="headerlink" title="feistel_promax"></a>feistel_promax</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"></span><br><span class="line"><span class="built_in">round</span> = <span class="number">2</span></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;./secret&quot;</span>, <span class="string">&quot;rb&quot;</span>).read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">m, key</span>):</span><br><span class="line">    m = m ^ (m &gt;&gt; <span class="number">4</span>)</span><br><span class="line">    m = m ^ (m &lt;&lt; <span class="number">5</span>)</span><br><span class="line">    m = m ^ (m &gt;&gt; <span class="number">8</span>)</span><br><span class="line">    m ^= key</span><br><span class="line">    m = (m * <span class="number">1145</span> + <span class="number">14</span>) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    m = (m * <span class="number">1919</span> + <span class="number">810</span>) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    m = (m * key) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">m, key, <span class="built_in">round</span></span>):</span><br><span class="line">    key = bytes_to_long(key)</span><br><span class="line">    left = bytes_to_long(m[:<span class="number">8</span>])</span><br><span class="line">    right = bytes_to_long(m[<span class="number">8</span>:])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">round</span>):</span><br><span class="line">        left, right = right, f(right, key) ^ left</span><br><span class="line">    left, right = right, left</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(left).rjust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>) + long_to_bytes(right).rjust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding</span>(<span class="params">m</span>):</span><br><span class="line">    mlen = <span class="built_in">len</span>(m)</span><br><span class="line">    pad = <span class="number">16</span> - mlen % <span class="number">16</span></span><br><span class="line">    <span class="keyword">return</span> m + pad * <span class="built_in">bytes</span>([pad])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ecb_enc</span>(<span class="params">m, key</span>):</span><br><span class="line">    m = padding(m)</span><br><span class="line">    mlen = <span class="built_in">len</span>(m)</span><br><span class="line">    c = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(mlen // <span class="number">16</span>):</span><br><span class="line">        c += enc(m[i * <span class="number">16</span> : i * <span class="number">16</span> + <span class="number">16</span>], key, <span class="built_in">round</span>)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = urandom(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ecb_enc(padding(flag), key))</span><br><span class="line"><span class="comment"># b&#x27;B\xf5\xd8gy\x0f\xaf\xc7\xdf\xabn9\xbb\xd0\xe3\x1e0\x9eR\xa9\x1c\xb7\xad\xe5H\x8cC\x07\xd5w9Ms\x03\x06\xec\xb4\x8d\x80\xcb&#125;\xa9\x8a\xcc\xd1W\x82[\xd3\xdc\xb4\x83P\xda5\xac\x9e\xb0)\x98R\x1c\xb3h&#x27;</span></span><br></pre></td></tr></table></figure>

<p>和前一题不同之处在于<code>ecb_enc(padding(flag), key)</code>，而且没给出key。</p>
<p>题目把2填充后的flag进行加密，说明实际加密的明文是进行了两次填充。</p>
<p>而且第二次填充的内容是<code>b&#39;\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10&#39;</code></p>
<p>还得根据这个<code>f</code>的特性，发现如果用部分的<code>key</code>加密，会使得加密后的结果与用完整<code>key</code>加密的结果在低位上有相同的地方，于是可以用爆破求出key。</p>
<p>自己试了从低位，爆破key。一位一位爆的太慢了，然后请教了一下其他师傅，每两位进行爆破，很快就出结果了。</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">m, key</span>):</span><br><span class="line">    m = m ^ (m &gt;&gt; <span class="number">4</span>)</span><br><span class="line">    m = m ^ (m &lt;&lt; <span class="number">5</span>)</span><br><span class="line">    m = m ^ (m &gt;&gt; <span class="number">8</span>)</span><br><span class="line">    m ^= key</span><br><span class="line">    m = (m * <span class="number">1145</span> + <span class="number">14</span>) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    m = (m * <span class="number">1919</span> + <span class="number">810</span>) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    m = (m * key) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">c,key</span>):</span><br><span class="line">    key = bytes_to_long(key)</span><br><span class="line">    left = bytes_to_long(c[:<span class="number">8</span>])</span><br><span class="line">    right = bytes_to_long(c[<span class="number">8</span>:])</span><br><span class="line">    m_right = f(right,key) ^ left</span><br><span class="line">    m_left = f(m_right,key) ^ right</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(m_left) + long_to_bytes(m_right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ecb_dec</span>(<span class="params">c, key</span>):</span><br><span class="line">    clen = <span class="built_in">len</span>(c)</span><br><span class="line">    m = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(clen // <span class="number">16</span>):</span><br><span class="line">        m += dec(c[i * <span class="number">16</span> : i * <span class="number">16</span> + <span class="number">16</span>], key)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">m = <span class="string">b&#x27;\x10\x10\x10\x10\x10\x10\x10\x10&#x27;</span></span><br><span class="line">ct = <span class="string">b&#x27;B\xf5\xd8gy\x0f\xaf\xc7\xdf\xabn9\xbb\xd0\xe3\x1e0\x9eR\xa9\x1c\xb7\xad\xe5H\x8cC\x07\xd5w9Ms\x03\x06\xec\xb4\x8d\x80\xcb&#125;\xa9\x8a\xcc\xd1W\x82[\xd3\xdc\xb4\x83P\xda5\xac\x9e\xb0)\x98R\x1c\xb3h&#x27;</span></span><br><span class="line">c = bytes_to_long(ct[-<span class="number">8</span>:]) ^ bytes_to_long(m)</span><br><span class="line">bin_c = <span class="built_in">bin</span>(c)[<span class="number">2</span>:].rjust(<span class="number">64</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k1 = [<span class="string">b&#x27;&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">    k2 = []</span><br><span class="line">    <span class="keyword">for</span> KEY <span class="keyword">in</span> k1:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">16</span>):</span><br><span class="line">            key1 = long_to_bytes(j) + KEY</span><br><span class="line">            cc = f(bytes_to_long(m),bytes_to_long(key1))</span><br><span class="line">            bin_cc = <span class="built_in">bin</span>(cc)[<span class="number">2</span>:].rjust(<span class="number">64</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> bin_cc[-<span class="number">16</span>*i:] == bin_c[-<span class="number">16</span>*i:]:</span><br><span class="line">                k2.append(key1)</span><br><span class="line">                k1 = k2</span><br><span class="line">    <span class="comment"># print(k2)</span></span><br><span class="line"></span><br><span class="line">key = [<span class="string">b&#x27;4t*zFD\xac\xb4&#x27;</span>, <span class="string">b&#x27;\xb4t*zFD\xac\xb4&#x27;</span>, <span class="string">b&#x27;\\q\x0f\x00w\xeb\xc1&quot;&#x27;</span>, <span class="string">b&#x27;\xdcq\x0f\x00w\xeb\xc1&quot;&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> KEY <span class="keyword">in</span> key:</span><br><span class="line">    flag = ecb_dec(ct,KEY)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h1 id="古典密码"><a href="#古典密码" class="headerlink" title="古典密码"></a>古典密码</h1><h2 id="ezrot"><a href="#ezrot" class="headerlink" title="ezrot"></a>ezrot</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@64E7LC@Ecf0:D0;FDE020D:&gt;!=60=6EE6C0DF3DE:EFE:@?04:!96C0tsAJdEA6d;F&#125;%0N</span><br></pre></td></tr></table></figure>

<p>rot47</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oectf&#123;rot47_is_just_a_simPle_letter_substitution_ciPher_EDpy5tpe5juNT_&#125;</span><br></pre></td></tr></table></figure>

<h2 id="皇帝的新密码"><a href="#皇帝的新密码" class="headerlink" title="皇帝的新密码"></a>皇帝的新密码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tvljam&#123;JhLzhL_JPwoLy_Pz_h_cLyF_zPtwPL_JPwoLy!_ZmUVUA40q5KbEQZAK5Ehag4Av&#125;</span><br></pre></td></tr></table></figure>

<p>移位7</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;CaEsaE_CIphEr_Is_a_vErY_sImpIE_CIphEr!_SfNONT40j5DuXJSTD5Xatz4To&#125;</span><br></pre></td></tr></table></figure>

<h2 id="不是皇帝的新密码"><a href="#不是皇帝的新密码" class="headerlink" title="不是皇帝的新密码"></a>不是皇帝的新密码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scsfct&#123;wOuSQNfF_IWdkNf_Jy_o_zLchmK_voumSs_zvoQ_loFyof_FRdiKf_4i4x4NLgDn&#125;</span><br><span class="line">md5 of flag (utf-8) `ea23f80270bdd96b5fcd213cae68eea5`</span><br></pre></td></tr></table></figure>

<p>维吉尼亚</p>
<p>先对表$moectf \longrightarrow scsfct$，得到$key &#x3D; goodjo$</p>
<p>解完发现不对，把$key$换成$goodjob$</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;vIgENErE_CIphEr_Is_a_lIttlE_hardEr_thaN_caEsar_CIphEr_4u4u4EXfXz&#125;</span><br></pre></td></tr></table></figure>

<h2 id="可可的新围墙"><a href="#可可的新围墙" class="headerlink" title="可可的新围墙"></a>可可的新围墙</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mt3_hsTal3yGnM_p3jocfFn3cp3_hFs3c_3TrB__i3_uBro_lcsOp&#125;e&#123;ciri_hT_avn3Fa_j</span><br></pre></td></tr></table></figure>

<p>W型栅栏</p>
<p>栅栏数3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;F3nc3_ciph3r_shiFTs_3ach_l3TT3r_By_a_Giv3n_nuMB3r_oF_plac3s_Ojpj&#125;</span><br></pre></td></tr></table></figure>

<h2 id="猫言喵语"><a href="#猫言喵语" class="headerlink" title="猫言喵语"></a>猫言喵语</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">喵喵？ 喵喵喵喵喵喵喵喵喵喵喵喵 喵喵喵 喵喵喵喵喵喵喵喵？喵喵？喵喵喵喵喵？ 喵喵？喵喵喵喵喵？ 喵喵喵喵喵？ 喵喵喵喵喵？喵喵？ 喵喵喵喵喵？ 喵喵喵喵喵喵 喵喵喵喵喵喵 喵喵喵喵喵喵喵喵？喵喵？喵喵喵喵喵？ 喵喵？喵喵喵喵喵？喵喵喵 喵喵喵喵喵？ 喵喵？ 喵喵喵喵喵喵喵喵？喵喵？喵喵喵喵喵？ 喵喵？喵喵喵喵喵喵喵喵喵 喵喵喵喵喵喵喵喵？ 喵喵？ 喵喵喵喵喵喵喵喵？喵喵？喵喵喵喵喵？ 喵喵？喵喵喵喵喵喵喵喵喵 喵喵喵 喵喵喵喵喵喵喵喵？喵喵？喵喵喵喵喵？ 喵喵？喵喵喵喵喵？喵喵喵 喵喵喵喵喵？ 喵喵喵喵喵？喵喵喵喵喵喵 喵喵喵喵喵？喵喵喵喵喵喵 喵喵喵 喵喵？喵喵喵喵喵喵 喵喵喵喵喵喵喵喵？喵喵？喵喵喵喵喵？ 喵喵？喵喵？喵喵喵 喵喵？喵喵？喵喵？ 喵喵喵喵喵喵喵喵？ 喵喵？喵喵？喵喵喵喵喵喵 喵喵喵喵喵喵 喵喵喵喵喵喵喵喵？喵喵？喵喵喵喵喵？ 喵喵？喵喵喵喵喵喵喵喵喵 喵喵？喵喵喵喵喵？喵喵？ 喵喵喵喵喵喵喵喵？喵喵？喵喵喵喵喵？ 喵喵喵喵喵？喵喵喵 喵喵？喵喵喵喵喵喵喵喵？</span><br></pre></td></tr></table></figure>

<p>Morse</p>
<p><code>喵喵？</code>换<code>-</code>，<code>喵喵喵</code>换<code>.</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">THE_KAWAII_CAT_BUT_BE_CALLED_GOUZI_BY_RX</span><br></pre></td></tr></table></figure>

<p>加上格式<code>moectf&#123;THE_KAWAII_CAT_BUT_BE_CALLED_GOUZI_BY_RX&#125;</code></p>
<h1 id="Jail"><a href="#Jail" class="headerlink" title="Jail"></a>Jail</h1><h2 id="Jail-level-0"><a href="#Jail-level-0" class="headerlink" title="Jail level 0"></a>Jail level 0</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the MoeCTF2023 Jail challenge.It&#x27;s time to work on this calc challenge.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">user_input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;calc Answer: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(user_input_data)))</span><br></pre></td></tr></table></figure>

<p>利用<code>eval()</code>函数的特性。输入<code>print(open(&#39;flag&#39;,&#39;r&#39;).read())</code></p>
<p>这个文件名是猜的，尝试各种可能，总能弄出来。</p>
<h2 id="Jail-level-1"><a href="#Jail-level-1" class="headerlink" title="Jail level 1"></a>Jail level 1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the MoeCTF2023 Jail challenge level1.It&#x27;s time to work on this calc challenge.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">user_input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(user_input_data)&gt;<span class="number">12</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! Bye~&quot;</span>)</span><br><span class="line">  exit(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;calc Answer: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(user_input_data)))</span><br></pre></td></tr></table></figure>

<p>题目限制了命令的长度不超过12</p>
<p>如果不超过13的话，可以用<code>eval(input())</code></p>
<p><strong>尝试通过<code>help()</code>函数，然后随机进入一个模块比如<code>os</code>，再输入<code>!sh</code>即可获得shell，然后就可以为所欲为了</strong></p>
<p><strong>但是我输入<code>os</code>之后还是停留在<code>help()</code>不懂是为啥。</strong></p>
<p>思路来源：<a target="_blank" rel="noopener" href="https://dummykitty.github.io/posts/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%8E%9F%E7%90%86/#help-%E5%87%BD%E6%95%B0">https://dummykitty.github.io/posts/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%8E%9F%E7%90%86/#help-%E5%87%BD%E6%95%B0</a></p>
<p><strong>然后尝试用<code>breakpoint()</code>，使用<code>breakpoint()</code>之后就会进到Pdb里面。</strong></p>
<p>这里摘抄一下Pdb为何物：</p>
<p><strong>pdb 模块定义了一个交互式源代码调试器，用于 Python 程序。它支持在源码行间设置（有条件的）断点和单步执行，检视堆栈帧，列出源码列表，以及在任何堆栈帧的上下文中运行任意 Python 代码。它还支持事后调试，可以在程序控制下调用。</strong></p>
<p>思路来源：[<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/578986988">PyJail] python沙箱逃逸探究·上（HNCTF题解 - WEEK1） - 知乎 (zhihu.com)</a></p>
<h2 id="Jail-level-2"><a href="#Jail-level-2" class="headerlink" title="Jail level 2"></a>Jail level 2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the MoeCTF2023 Jail challenge level1.It&#x27;s time to work on this calc challenge.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">user_input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(user_input_data)&gt;<span class="number">6</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! Bye~&quot;</span>)</span><br><span class="line">  exit(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;calc Answer: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(user_input_data)))</span><br></pre></td></tr></table></figure>

<p>长度限制在6，只能用<code>help()</code>了</p>
<p><img src="/../../images/2023MoeCTF/0.png"></p>
<p>这题倒是成功了。不知道为啥</p>
<h2 id="Jail-level-3"><a href="#Jail-level-3" class="headerlink" title="Jail level 3"></a>Jail level 3</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">    BANLIST = [<span class="string">&#x27;breakpoint&#x27;</span>]</span><br><span class="line">    BANLIST_WORDS = <span class="string">&#x27;|&#x27;</span>.join(<span class="string">f&#x27;(<span class="subst">&#123;WORD&#125;</span>)&#x27;</span> <span class="keyword">for</span> WORD <span class="keyword">in</span> BANLIST)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Welcome to the MoeCTF2023 Jail challenge.It&#x27;s time to work on this calc challenge.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">    user_input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(user_input_data)&gt;<span class="number">12</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! Bye~&quot;</span>)</span><br><span class="line">      exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> re.findall(BANLIST_WORDS, user_input_data, re.I):</span><br><span class="line">      <span class="keyword">raise</span> Exception(<span class="string">&#x27;Blacklisted word detected! you are hacker!&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Answer result: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(user_input_data)))</span><br></pre></td></tr></table></figure>

<p>把<code>breakpoint</code>办了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">re.findall(BANLIST_WORDS, user_input_data, re.I) 执行了一个正则表达式的查找操作。其中：</span><br><span class="line">	BANLIST_WORDS 是一个正则表达式模式，表示黑名单中的词汇。</span><br><span class="line">	user_input_data 是用户输入的数据，需要在其中查找匹配的词汇。</span><br><span class="line">	re.I 是一个标志参数，表示忽略大小写进行匹配。</span><br></pre></td></tr></table></figure>

<p>如果输入<code>breakpoint</code>，<code>re.findall()</code>会返回一个空列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> re.findall(BANLIST_WORDS, user_input_data, re.I):</span><br><span class="line">      <span class="keyword">raise</span> Exception(<span class="string">&#x27;Blacklisted word detected! you are hacker!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>如果<code>re.findall()</code>返回空的列表，则会抛出异常</p>
<p>总的来说，这道题不能用<code>breakpoint</code>，除此之外还限制了payload的长度，用chr进行拼接也不行</p>
<p>试了<code>help()</code>也不行</p>
<p>在大佬指导下，通过把<code>breakpoint</code>半角转全角得<code>ｂｒｅａｋｐｏｉｎｔ</code>，可以绕过限制</p>
<p><a target="_blank" rel="noopener" href="https://www.sojson.com/convert/fullhalf.html">在线全角半角转换—在线工具 (sojson.com)</a></p>
<h2 id="Jail-level-4"><a href="#Jail-level-4" class="headerlink" title="Jail level 4"></a>Jail level 4</h2><p>没给源码</p>
<p><img src="/../../images/2023MoeCTF/7.png"></p>
<p>题目要求用的python2.7</p>
<p>没明白这个报错，不知道这样算不算预期解</p>
<h2 id="Leak-level-0"><a href="#Leak-level-0" class="headerlink" title="Leak level 0"></a>Leak level 0</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">fake_key_into_local_but_valid_key_into_remote = <span class="string">&quot;moectfisbestctfhopeyoulikethat&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hey Guys,Welcome to the moeleak challenge.Have fun!.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;| Options: </span></span><br><span class="line"><span class="string">|       [V]uln </span></span><br><span class="line"><span class="string">|       [B]ackdoor&quot;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func_filter</span>(<span class="params">s</span>):</span><br><span class="line">      not_allowed = <span class="built_in">set</span>(<span class="string">&#x27;vvvveeee&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">any</span>(c <span class="keyword">in</span> not_allowed <span class="keyword">for</span> c <span class="keyword">in</span> s)</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">      challenge_choice = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>).lower().strip()</span><br><span class="line">      <span class="keyword">if</span> challenge_choice == <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">        code = <span class="built_in">input</span>(<span class="string">&quot;code &gt;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(code)&gt;<span class="number">9</span>):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;you&#x27;re hacker!&quot;</span>)</span><br><span class="line">          exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> func_filter(code):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! byte~&quot;</span>)</span><br><span class="line">          exit(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">eval</span>(code))</span><br><span class="line">      <span class="keyword">elif</span> challenge_choice == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please enter the admin key&quot;</span>)</span><br><span class="line">        key = <span class="built_in">input</span>(<span class="string">&quot;key &gt;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(key == fake_key_into_local_but_valid_key_into_remote):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;Hey Admin,please input your code:&quot;</span>)</span><br><span class="line">          code = <span class="built_in">input</span>(<span class="string">&quot;backdoor &gt;&gt; &quot;</span>)</span><br><span class="line">          <span class="built_in">print</span>(<span class="built_in">eval</span>(code))</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You should select valid choice!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><code>v</code>功能下的限制命令长度不超过9，而且不能出现<code>v</code>,<code>e</code>，因此不能通过<code>help()</code>，再经过<code>__main__</code>查看变量。</p>
<p><code>b</code>功能，需要key进入</p>
<p>我们可以用<code>globals()</code>查看全局变量获得key，然后转到<code>b</code>功能下输入不受限的命令。</p>
<p><img src="/../../images/2023MoeCTF/1.png"></p>
<h2 id="Leak-level-1"><a href="#Leak-level-1" class="headerlink" title="Leak level 1"></a>Leak level 1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">fake_key_into_local_but_valid_key_into_remote = <span class="string">&quot;moectfisbestctfhopeyoulikethat&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hey Guys,Welcome to the moeleak challenge.Have fun!.&quot;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func_filter</span>(<span class="params">s</span>):</span><br><span class="line">      not_allowed = <span class="built_in">set</span>(<span class="string">&#x27;moe_dbt&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">any</span>(c <span class="keyword">in</span> not_allowed <span class="keyword">for</span> c <span class="keyword">in</span> s)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;| Options: </span></span><br><span class="line"><span class="string">|       [V]uln </span></span><br><span class="line"><span class="string">|       [B]ackdoor&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">      challenge_choice = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>).lower().strip()</span><br><span class="line">      <span class="keyword">if</span> challenge_choice == <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">        code = <span class="built_in">input</span>(<span class="string">&quot;code &gt;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(code)&gt;<span class="number">6</span>):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;you&#x27;re hacker!&quot;</span>)</span><br><span class="line">          exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> func_filter(code):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! byte~&quot;</span>)</span><br><span class="line">          exit(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">eval</span>(code))</span><br><span class="line">      <span class="keyword">elif</span> challenge_choice == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please enter the admin key&quot;</span>)</span><br><span class="line">        key = <span class="built_in">input</span>(<span class="string">&quot;key &gt;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(key == fake_key_into_local_but_vailed_key_into_remote):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;Hey Admin,please input your code:&quot;</span>)</span><br><span class="line">          code = <span class="built_in">input</span>(<span class="string">&quot;backdoor &gt;&gt; &quot;</span>)</span><br><span class="line">          <span class="built_in">print</span>(<span class="built_in">eval</span>(code))</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You should select valid choice!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>换了限制的字符，不能输入<code>m,o,e,_,d,b,t</code>，限制命令长度不超过6</p>
<p>半角转全角的思路，进入<code>help()</code>，通过<code>__main__</code>获得key</p>
<p><img src="/../../images/2023MoeCTF/2.png"></p>
<h2 id="Leak-level-2"><a href="#Leak-level-2" class="headerlink" title="Leak level 2"></a>Leak level 2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">fake_key_into_local_but_valid_key_into_remote = <span class="string">&quot;moectfisbestctfhopeyoulikethat&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hey Guys,Welcome to the moeleak challenge.Have fun!.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;| Options: </span></span><br><span class="line"><span class="string">|       [V]uln </span></span><br><span class="line"><span class="string">|       [B]ackdoor&quot;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func_filter</span>(<span class="params">s</span>):</span><br><span class="line">      not_allowed = <span class="built_in">set</span>(<span class="string">&#x27;dbtaaaaaaaaa!&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">any</span>(c <span class="keyword">in</span> not_allowed <span class="keyword">for</span> c <span class="keyword">in</span> s)</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">      challenge_choice = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>).lower().strip()</span><br><span class="line">      <span class="keyword">if</span> challenge_choice == <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;you need to &quot;</span>)</span><br><span class="line">        code = <span class="built_in">input</span>(<span class="string">&quot;code &gt;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(code)&gt;<span class="number">6</span>):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;you&#x27;re hacker!&quot;</span>)</span><br><span class="line">          exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> func_filter(code):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! byte~&quot;</span>)</span><br><span class="line">          exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> code.isascii():</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;please use ascii only thanks!&quot;</span>)</span><br><span class="line">          exit(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">eval</span>(code))</span><br><span class="line">      <span class="keyword">elif</span> challenge_choice == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please enter the admin key&quot;</span>)</span><br><span class="line">        key = <span class="built_in">input</span>(<span class="string">&quot;key &gt;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(key == fake_key_into_local_but_vailed_key_into_remote):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;Hey Admin,please input your code:&quot;</span>)</span><br><span class="line">          code = <span class="built_in">input</span>(<span class="string">&quot;backdoor&gt; &quot;</span>)</span><br><span class="line">          <span class="built_in">print</span>(<span class="built_in">eval</span>(code))</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You should select valid choice!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这道题不能出现<code>d,b,t,a</code>而且多了一个限制，必须是ascii字符，半角转全角的思路不可用了。</p>
<p>不过我们直接用<code>help()</code>即可</p>
<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="test-nc"><a href="#test-nc" class="headerlink" title="test_nc"></a>test_nc</h2><p>先ls，发现没有flag文件，但是有个gift</p>
<p>查看提示，看来考点是查看隐藏文件</p>
<p>了解一下用<code>ls -al</code>查看隐藏文件</p>
<p>发现flag</p>
<p><img src="/../../images/2023MoeCTF/8.png"></p>
<h2 id="fd"><a href="#fd" class="headerlink" title="fd"></a>fd</h2><p>附件丢ida分析一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> input; <span class="comment">// [rsp+4h] [rbp-6Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+8h] [rbp-68h]</span></span><br><span class="line">  <span class="type">int</span> new_fd; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  <span class="type">char</span> flag[<span class="number">80</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  input = <span class="number">0</span>;</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know fd?&quot;</span>);</span><br><span class="line">  fd = open(<span class="string">&quot;./flag&quot;</span>, <span class="number">0</span>, <span class="number">0LL</span>);</span><br><span class="line">  new_fd = (<span class="number">4</span> * fd) | <span class="number">0x29A</span>;</span><br><span class="line">  dup2(fd, new_fd);</span><br><span class="line">  close(fd);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Which file do you want to read?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input its fd: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;input);</span><br><span class="line">  read(input, flag, <span class="number">0x50</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(flag);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让GPT分析了一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  fd = open(<span class="string">&quot;./flag&quot;</span>, <span class="number">0</span>, <span class="number">0LL</span>);</span><br><span class="line">  new_fd = (<span class="number">4</span> * fd) | <span class="number">0x29A</span>;</span><br><span class="line">dup2(fd, new_fd);</span><br></pre></td></tr></table></figure>

<p>以只读的形式打开名为<code>./flag</code>，并且将其文件描述符存储在<code>fd</code>变量中，则这个<code>fd=1</code></p>
<p>然后计算<code>new_fd = (fd × 4) | 0x29A</code> ，然后将文件描述符<code>fd</code>复制到<code>new_fd</code>，使得<code>new_fd</code>也指向同一文件。</p>
<p>所以我们根据<code>fd=1</code>，计算出<code>new_fd= 670</code>，即可拿到flag</p>
<p><img src="/../../images/2023MoeCTF/3.png"></p>
<h2 id="baby-calculator"><a href="#baby-calculator" class="headerlink" title="baby_calculator"></a>baby_calculator</h2><p><img src="/../../images/2023MoeCTF/4.png"></p>
<p>判断100道加法是否正确即可获得flag</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;&#x27;</span></span><br><span class="line">post = </span><br><span class="line">GeShi = <span class="string">b&#x27;Now..start!&#x27;</span>  <span class="comment"># 改格式！</span></span><br><span class="line"></span><br><span class="line">sh = remote(host,post)</span><br><span class="line"></span><br><span class="line">data = sh.recvuntil(GeShi).decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    data1 = sh.recvuntil(<span class="string">b&#x27;=&#x27;</span>).decode()</span><br><span class="line">    <span class="built_in">print</span>(data1)</span><br><span class="line"></span><br><span class="line">    a = data1.split(<span class="string">&#x27;:&#x27;</span>)[-<span class="number">1</span>].split(<span class="string">&#x27;\n&#x27;</span>)[-<span class="number">1</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    b = sh.recvuntil(<span class="string">b&#x27;\n&#x27;</span>).decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a:&quot;</span>,a)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;b:&quot;</span>,b.strip(<span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">eval</span>(a) == <span class="built_in">int</span>(b):</span><br><span class="line">        sh.sendline(<span class="string">&quot;BlackBird&quot;</span>.encode())</span><br><span class="line">        sh.recvline()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sh.sendline(<span class="string">&quot;WingS&quot;</span>.encode())</span><br><span class="line">        sh.recvline()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sh.recvall())</span><br></pre></td></tr></table></figure>

<h2 id="int-overflow"><a href="#int-overflow" class="headerlink" title="int_overflow"></a>int_overflow</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Welcome to Moectf2023.</span><br><span class="line">Do you know <span class="built_in">int</span> overflow?</span><br><span class="line">Can you make n == -<span class="number">114514</span> but no <span class="string">&#x27;-&#x27;</span> when you <span class="built_in">input</span> n.</span><br><span class="line">Please <span class="built_in">input</span> n:</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/2023MoeCTF/5.png"></p>
<p>整形数据范围在$-2147483648—2147483647$，根据溢出规则，超出最大值的数将从最小值开始往前</p>
<p>比如<code>2147483648 = -2147483648，2147483649 = -2147483647</code></p>
<p>根据这个规则<code>-114514 = 4294852782</code>。</p>
<p>我的计算方式是先计算$-114514$和$-2147483648$的差值x，再加上$2147483648$。</p>
<p>因为<code>2147483649 = -2147483647</code>，$-2147483647$和$-2147483648$差值为1，所以是加上$2147483648$</p>
<p><img src="/../../images/2023MoeCTF/6.png"></p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="base-64"><a href="#base-64" class="headerlink" title="base_64"></a>base_64</h2><p>找个网站把<code>pyc</code>文件反编译为<code>py</code>文件</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> *</span><br><span class="line">str1 = <span class="string">&#x27;yD9oB3Inv3YAB19YynIuJnUaAGB0um0=&#x27;</span></span><br><span class="line">string1 = <span class="string">&#x27;ZYXWVUTSRQPONMLKJIHGFEDCBAzyxwvutsrqponmlkjihgfedcba0123456789+/&#x27;</span></span><br><span class="line">string2 = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">flag = <span class="built_in">input</span>(<span class="string">&#x27;welcome to moectf\ninput your flag and I wiil check it:&#x27;</span>)</span><br><span class="line">enc_flag = base64.b64encode(flag.encode()).decode()</span><br><span class="line">enc_flag = enc_flag.translate(<span class="built_in">str</span>.maketrans(string2, string1))</span><br><span class="line"><span class="keyword">if</span> enc_flag == str1:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;good job!!!!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;something wrong???&#x27;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>给出了base64的原表和替换后的表</p>
<p>换标即可</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">&quot;yD9oB3Inv3YAB19YynIuJnUaAGB0um0=&quot;</span></span><br><span class="line"></span><br><span class="line">table1 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span> <span class="comment">#这是ba64的表</span></span><br><span class="line">table2 = <span class="string">&quot;ZYXWVUTSRQPONMLKJIHGFEDCBAzyxwvutsrqponmlkjihgfedcba0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line">flag = base64.b64decode(cipher.translate(<span class="built_in">str</span>.maketrans(table2,table1)))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#moectf&#123;pYc_And_Base64~&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="XOR"><a href="#XOR" class="headerlink" title="XOR"></a>XOR</h2><p><img src="/../../images/2023MoeCTF/14.png"></p>
<p>把<code>enc[i]</code>和<code>0x39</code>异或回去即可</p>
<p><img src="/../../images/2023MoeCTF/15.png"></p>
<p>以上是<code>enc</code>的值</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x54</span>, <span class="number">0x56</span>, <span class="number">0x5C</span>, <span class="number">0x5A</span>, <span class="number">0x4D</span>, <span class="number">0x5F</span>, <span class="number">0x42</span>, <span class="number">0x60</span>, <span class="number">0x56</span>, <span class="number">0x4C</span>, <span class="number">0x66</span>, <span class="number">0x52</span>, <span class="number">0x57</span>, <span class="number">0x9</span>, <span class="number">0x4E</span>, <span class="number">0x66</span>, <span class="number">0x51</span>, <span class="number">0x9</span>, <span class="number">0x4E</span>, <span class="number">0x66</span>, <span class="number">0x4D</span>,<span class="number">0x9</span>,<span class="number">0x66</span>,<span class="number">0x61</span>,<span class="number">0x9</span>,<span class="number">0x6b</span>,<span class="number">0x18</span>,<span class="number">0x44</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    m = i ^ <span class="number">0x39</span></span><br><span class="line">    flag += <span class="built_in">chr</span>(m)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#moectf&#123;You_kn0w_h0w_t0_X0R!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="ANDROID"><a href="#ANDROID" class="headerlink" title="ANDROID"></a>ANDROID</h2><p>JEB打开， 找到主函数，然后反编译</p>
<p><img src="/../../images/2023MoeCTF/16.png"></p>
<p>找到<code>enc</code>和<code>key</code>，以及加密过程，异或回去即是明文</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="string">&#x27;\u0019&#x27;</span>, <span class="string">&#x27;\u0007&#x27;</span>, <span class="string">&#x27;\u0000&#x27;</span>, <span class="string">&#x27;\u000E&#x27;</span>, <span class="string">&#x27;\u001B&#x27;</span>, <span class="string">&#x27;\u0003&#x27;</span>, <span class="string">&#x27;\u0010&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;\u0018&#x27;</span>, <span class="string">&#x27;\u0002&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;\u0004&#x27;</span>, <span class="string">&#x27;\u0001&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;\u000B&#x27;</span>, <span class="string">&#x27;\u001D&#x27;</span>, <span class="string">&#x27;\u0006&#x27;</span>, <span class="string">&#x27;\u0007&#x27;</span>, <span class="string">&#x27;\f&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;\u0018&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;\u001C&#x27;</span>, <span class="string">&#x27;\u0015&#x27;</span>, <span class="string">&#x27;\u001B&#x27;</span>, <span class="string">&#x27;\u001C&#x27;</span>, <span class="string">&#x27;\u0010&#x27;</span>]</span><br><span class="line">key = [<span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;y&#x27;</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    m = <span class="built_in">ord</span>(enc[i]) ^ <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])</span><br><span class="line">    flag += <span class="built_in">chr</span>(m)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#moectf&#123;Java_in_Android_1s_easy&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="UPX"><a href="#UPX" class="headerlink" title="UPX!"></a>UPX!</h2><p>先脱壳，丢入IDA发现没有主函数。然后打开<code>Shift + F12</code>，找到字符串</p>
<p><img src="/../../images/2023MoeCTF/0.jpg"></p>
<p>双击进去，找到关键函数</p>
<p><img src="/../../images/2023MoeCTF/17.png"></p>
<p>反编译</p>
<p><img src="/../../images/2023MoeCTF/18.png"></p>
<p>得到密文</p>
<p><img src="/../../images/2023MoeCTF/19.png"></p>
<p><code>Shift + e</code>提取密文</p>
<p><code>0A08020413011C570F381E5712382C095710382F571038130838350211541514023832373F4646461A0000000000000000000000000000000000000000000000</code></p>
<p>加密是<code>c[i] = m[i] ^ 0x67</code>，异或回来即可</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="string">&quot;0A08020413011C570F381E5712382C095710382F571038130838350211541514023832373F4646461A0000000000000000000000000000000000000000000000&quot;</span></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(c)</span><br><span class="line"></span><br><span class="line">m = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    mm = <span class="built_in">chr</span>(i ^ <span class="number">0x67</span>)</span><br><span class="line">    m += mm</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment">#moectf&#123;0h_y0u_Kn0w_H0w_to_Rev3rse_UPX!!!&#125;</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------已经到底啦！<i class="fa fa-paw"></i>-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>DexterJie
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dexterjie.github.io/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023MoeCTF/" title="2023MoeCTF">https://dexterjie.github.io/2023/09/25/赛题复现/2023MoeCTF/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Wp/" rel="tag"># Wp</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/09/23/HNP/" rel="prev" title="HNP">
                  <i class="fa fa-chevron-left"></i> HNP
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/09/27/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/%E5%8D%8E%E4%B8%BA%E6%9D%AF/" rel="next" title="华为杯">
                  华为杯 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DexterJie</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">242k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">14:40</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->


    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
<div class="busuanzi-count">
  <script async src="/js/busuanzi.pure.mini.js"></script>
  
  <span class="site-uv" title="总访客量">
    访客量<span id="busuanzi_value_site_uv"></span>
  </span>

  <span class="site-pv" title="总访问量">
    经过<span id="busuanzi_value_site_pv"></span>次回眸与你相遇
  </span>
</div>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"waline-five-mocha.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"locale":null,"placeholder":"请文明评论呀","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2023/09/25/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023MoeCTF/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right"},"mobile":{"show":true}});</script></body>

</html>
