<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/0.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/0.jpg">
  <link rel="mask-icon" href="/images/0.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dexterjie.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="记录近期做的一些题，包括强网青少赛线下赛，NCTF，强网杯，楚慧杯，强网拟态决赛的部分赛题。">
<meta property="og:type" content="article">
<meta property="og:title" content="杂记(1)">
<meta property="og:url" content="https://dexterjie.github.io/2023/12/17/%E6%9D%82%E8%AE%B0/index.html">
<meta property="og:site_name" content="DexterJie&#39;Blog">
<meta property="og:description" content="记录近期做的一些题，包括强网青少赛线下赛，NCTF，强网杯，楚慧杯，强网拟态决赛的部分赛题。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dexterjie.github.io/images/%E6%9D%82/3.png">
<meta property="og:image" content="https://dexterjie.github.io/images/%E6%9D%82/1.png">
<meta property="og:image" content="https://dexterjie.github.io/images/%E6%9D%82/0.png">
<meta property="og:image" content="https://dexterjie.github.io/images/%E6%9D%82/2.png">
<meta property="article:published_time" content="2023-12-17T09:53:52.000Z">
<meta property="article:modified_time" content="2024-02-06T04:39:40.934Z">
<meta property="article:author" content="DexterJie">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dexterjie.github.io/images/%E6%9D%82/3.png">


<link rel="canonical" href="https://dexterjie.github.io/2023/12/17/%E6%9D%82%E8%AE%B0/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dexterjie.github.io/2023/12/17/%E6%9D%82%E8%AE%B0/","path":"2023/12/17/杂记/","title":"杂记(1)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>杂记(1) | DexterJie'Blog</title>
  







<link rel="dns-prefetch" href="waline-five-mocha.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DexterJie'Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">诗酒趁年华</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1456890009&auto=1&height=66"></iframe>
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%BA%E7%BD%91%E9%9D%92%E5%B0%91%E8%B5%9B%E2%80%94%E2%80%94%E6%9C%AA%E8%A7%A3%E4%B9%8B%E8%B0%9C"><span class="nav-number">1.</span> <span class="nav-text">强网青少赛——未解之谜</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NCTF"><span class="nav-number">2.</span> <span class="nav-text">NCTF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Signin"><span class="nav-number">2.1.</span> <span class="nav-text">Signin</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Code-Infinite"><span class="nav-number">2.2.</span> <span class="nav-text">Code Infinite</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B5%A3CTF"><span class="nav-number">3.</span> <span class="nav-text">赣CTF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Paillier"><span class="nav-number">3.1.</span> <span class="nav-text">Paillier</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF"><span class="nav-number">4.</span> <span class="nav-text">强网杯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#speed-up"><span class="nav-number">4.1.</span> <span class="nav-text">speed up</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%951"><span class="nav-number">4.1.1.</span> <span class="nav-text">解法1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%952"><span class="nav-number">4.1.2.</span> <span class="nav-text">解法2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#not-only-rsa"><span class="nav-number">4.2.</span> <span class="nav-text">not only rsa</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A5%9A%E6%85%A7%E6%9D%AF"><span class="nav-number">5.</span> <span class="nav-text">楚慧杯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#so-large-e"><span class="nav-number">5.1.</span> <span class="nav-text">so large e</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81%E5%86%B3%E8%B5%9B"><span class="nav-number">6.</span> <span class="nav-text">强网拟态决赛</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#BadRSA"><span class="nav-number">6.1.</span> <span class="nav-text">BadRSA</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="DexterJie"
      src="/images/0.jpg">
  <p class="site-author-name" itemprop="name">DexterJie</p>
  <div class="site-description" itemprop="description">一枚Crypto新手</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dexterjie.github.io/2023/12/17/%E6%9D%82%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/0.jpg">
      <meta itemprop="name" content="DexterJie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DexterJie'Blog">
      <meta itemprop="description" content="一枚Crypto新手">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="杂记(1) | DexterJie'Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          杂记(1)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-12-17 17:53:52" itemprop="dateCreated datePublished" datetime="2023-12-17T17:53:52+08:00">2023-12-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-06 12:39:40" itemprop="dateModified" datetime="2024-02-06T12:39:40+08:00">2024-02-06</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/12/17/%E6%9D%82%E8%AE%B0/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/12/17/%E6%9D%82%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>30 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>记录近期做的一些题，包括强网青少赛线下赛，NCTF，强网杯，楚慧杯，强网拟态决赛的部分赛题。</p>
<span id="more"></span>

<p>由于备战期末考，时间比较紧迫，以下分析中若有不足，请师傅们指点指点◝(⑅•ᴗ•⑅)◜</p>
<h1 id="强网青少赛——未解之谜"><a href="#强网青少赛——未解之谜" class="headerlink" title="强网青少赛——未解之谜"></a>强网青少赛——未解之谜</h1><blockquote>
<p>task</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, getRandomRange, inverse, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> root</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = phi - getRandomRange(<span class="number">2</span>, <span class="built_in">int</span>(root(n, <span class="number">4</span>))) // <span class="number">8</span></span><br><span class="line">e = inverse(d, phi)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;e =&#x27;</span>, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, <span class="built_in">pow</span>(bytes_to_long(flag), e, n))</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n = 25104277676119161522476112705793911276186101133479173238944044444464009124657009694225705909271077799809201079535406029771187080821769825464939077364642964415589149682726638069269303311285936728041400854664257359847513887226478935580304175033826156547132233021300058658354982546861556682763142936482347346981937850032206377127314298996750210542463016619202624387167346335084458869807050799087359137798417551118968333882132707224657634668232656084437165318707402672030846390316318799964502570888352016316259499484840687212162216956553959109504315812401670136366987689573854797204256680114377923495968022852465088943989</span></span><br><span class="line"><span class="string">e = 20178654515985191683778773315986117381438788487541162528625194682232622732804488937715690749685871993409744005510930308420585745479669138349385107492298100706904329996211024990254138155122883012416834611836914150399764071426903891183064811037874610688800753516815651605274198703402396721086099787022825008576711822311154359274255900798872482666009298170322494751141546145941540881032818218463468104215745893024753697280199179802990999289320485792935099342229022401065822066935230288340988833699778866513151729621894378561772202838242163207916815287677576914310414398842800437151570085615904905893908276037442921399227</span></span><br><span class="line"><span class="string">c = 17919859480795687548085357946533906742006563498678009884880024066719328584604178565823672582612851264338072607103147445102727569389591915368827826312868652213968050837327044813877938386742395231183072530875013974151364420171911413436696049091197432327690528295737499380220977246385029611858967823050774781344312401574401181366787200767075321779650346958885769663961952777015710540836731205786542415656103087841645510635687411784335649106356843368609597447408986641261723987501544380365356737604262721383825893578507628688434330167951610192310425417890688432557997801981742408687534970307199203734028604303069367331398</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>关键在</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d = phi - getRandomRange(<span class="number">2</span>, <span class="built_in">int</span>(root(n, <span class="number">4</span>))) // <span class="number">8</span></span><br><span class="line">e = inverse(d, phi)</span><br></pre></td></tr></table></figure>

<p>设$x &#x3D; $<code>getRandomRange(2, int(root(n, 4))) // 8</code></p>
<p>$\because ed \equiv 1 \mod \phi(n)$，而且$d &#x3D; \phi(n) - x$</p>
<p>即$e\phi(n) + e(-x) \equiv e(-x) \equiv 1 \mod \phi(n)$</p>
<p>$\therefore ex \equiv -1 \mod \phi(n)$</p>
<p>$ex &#x3D; k\phi(n) - 1$</p>
<p>$\frac{e}{\phi(n)} &#x3D; \frac{k}{x} - \frac{1}{x\phi(n)}$</p>
<p>$\frac{e}{n}\approx \frac{k}{x}$</p>
<p>$\because |\frac{e}{n}-\frac{k}{x}| \approx\frac{1}{n} &lt; \frac{1}{2x^2}$</p>
<p>其中$n$是2048bit量级，而$x$是509bit量级，因此上式成立，即符合勒让德理论，因此可以连分数展开求d</p>
<p>需要注意的是，我们求的是$x$，但实际解密需要用$-x$解</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">25104277676119161522476112705793911276186101133479173238944044444464009124657009694225705909271077799809201079535406029771187080821769825464939077364642964415589149682726638069269303311285936728041400854664257359847513887226478935580304175033826156547132233021300058658354982546861556682763142936482347346981937850032206377127314298996750210542463016619202624387167346335084458869807050799087359137798417551118968333882132707224657634668232656084437165318707402672030846390316318799964502570888352016316259499484840687212162216956553959109504315812401670136366987689573854797204256680114377923495968022852465088943989</span></span><br><span class="line">e = <span class="number">20178654515985191683778773315986117381438788487541162528625194682232622732804488937715690749685871993409744005510930308420585745479669138349385107492298100706904329996211024990254138155122883012416834611836914150399764071426903891183064811037874610688800753516815651605274198703402396721086099787022825008576711822311154359274255900798872482666009298170322494751141546145941540881032818218463468104215745893024753697280199179802990999289320485792935099342229022401065822066935230288340988833699778866513151729621894378561772202838242163207916815287677576914310414398842800437151570085615904905893908276037442921399227</span></span><br><span class="line">c = <span class="number">17919859480795687548085357946533906742006563498678009884880024066719328584604178565823672582612851264338072607103147445102727569389591915368827826312868652213968050837327044813877938386742395231183072530875013974151364420171911413436696049091197432327690528295737499380220977246385029611858967823050774781344312401574401181366787200767075321779650346958885769663961952777015710540836731205786542415656103087841645510635687411784335649106356843368609597447408986641261723987501544380365356737604262721383825893578507628688434330167951610192310425417890688432557997801981742408687534970307199203734028604303069367331398</span></span><br><span class="line"></span><br><span class="line">cf = continued_fraction(Integer(e) / Integer(n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10000</span>):</span><br><span class="line">    k = <span class="built_in">int</span>(cf.numerator(i))</span><br><span class="line">    d = <span class="built_in">int</span>(cf.denominator(i))</span><br><span class="line">    m = <span class="built_in">pow</span>(c,-d,n)</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;d = <span class="subst">&#123;d&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="comment"># flag&#123;c30d7177-1bb7-4caf-b602-39f8d2e9792b&#125;</span></span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h1 id="NCTF"><a href="#NCTF" class="headerlink" title="NCTF"></a>NCTF</h1><h2 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NTRU</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, N, p, q, d</span>):</span><br><span class="line">        self.debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> q &gt; (<span class="number">6</span>*d+<span class="number">1</span>)*p</span><br><span class="line">        <span class="keyword">assert</span> is_prime(N)</span><br><span class="line">        <span class="keyword">assert</span> gcd(N, q) == <span class="number">1</span> <span class="keyword">and</span> gcd(p, q) == <span class="number">1</span></span><br><span class="line">        self.N = N</span><br><span class="line">        self.p = p</span><br><span class="line">        self.q = q</span><br><span class="line">        self.d = d</span><br><span class="line">      </span><br><span class="line">        self.R_  = PolynomialRing(ZZ,<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">        self.Rp_ = PolynomialRing(Zmod(p),<span class="string">&#x27;xp&#x27;</span>)</span><br><span class="line">        self.Rq_ = PolynomialRing(Zmod(q),<span class="string">&#x27;xq&#x27;</span>)</span><br><span class="line">        x = self.R_.gen()</span><br><span class="line">        xp = self.Rp_.gen()</span><br><span class="line">        xq = self.Rq_.gen()</span><br><span class="line">        self.R  = self.R_.quotient(x^N - <span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">        self.Rp = self.Rp_.quotient(xp^N - <span class="number">1</span>, <span class="string">&#x27;yp&#x27;</span>)</span><br><span class="line">        self.Rq = self.Rq_.quotient(xq^N - <span class="number">1</span>, <span class="string">&#x27;yq&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self.RpOrder = self.p^self.N - self.p</span><br><span class="line">        self.RqOrder = self.q^self.N - self.q</span><br><span class="line">        self.sk, self.pk = self.keyGen()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">T</span>(<span class="params">self, d1, d2</span>):</span><br><span class="line">        <span class="keyword">assert</span> self.N &gt;= d1+d2</span><br><span class="line">        t = [<span class="number">1</span>]*d1 + [-<span class="number">1</span>]*d2 + [<span class="number">0</span>]*(self.N-d1-d2)</span><br><span class="line">        shuffle(t)</span><br><span class="line">        <span class="keyword">return</span> self.R(t)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lift</span>(<span class="params">self, fx</span>):</span><br><span class="line">        mod = Integer(fx.base_ring()(-<span class="number">1</span>)) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.R([Integer(x)-mod <span class="keyword">if</span> x &gt; mod//<span class="number">2</span> <span class="keyword">else</span> x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">list</span>(fx)])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">keyGen</span>(<span class="params">self</span>):</span><br><span class="line">        fx = self.T(self.d+<span class="number">1</span>, self.d)</span><br><span class="line">        gx = self.T(self.d, self.d)</span><br><span class="line"></span><br><span class="line">        Fp = self.Rp(<span class="built_in">list</span>(fx)) ^ (-<span class="number">1</span>)                         </span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">pow</span>(self.Rp(<span class="built_in">list</span>(fx)), self.RpOrder-<span class="number">1</span>) == Fp </span><br><span class="line">        <span class="keyword">assert</span> self.Rp(<span class="built_in">list</span>(fx)) * Fp == <span class="number">1</span>                </span><br><span class="line">        </span><br><span class="line">        Fq = <span class="built_in">pow</span>(self.Rq(<span class="built_in">list</span>(fx)), self.RqOrder - <span class="number">1</span>)   </span><br><span class="line">        <span class="keyword">assert</span> self.Rq(<span class="built_in">list</span>(fx)) * Fq == <span class="number">1</span>              </span><br><span class="line">        </span><br><span class="line">        hx = Fq * self.Rq(<span class="built_in">list</span>(gx))</span><br><span class="line"></span><br><span class="line">        sk = (fx, gx, Fp, Fq, hx)</span><br><span class="line">        pk = hx</span><br><span class="line">        <span class="keyword">return</span> sk, pk</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getKey</span>(<span class="params">self</span>):</span><br><span class="line">        ssk = (</span><br><span class="line">              self.R_(<span class="built_in">list</span>(self.sk[<span class="number">0</span>])),   </span><br><span class="line">              self.R_(<span class="built_in">list</span>(self.sk[<span class="number">1</span>]))   </span><br><span class="line">            )</span><br><span class="line">        spk = self.Rq_(<span class="built_in">list</span>(self.pk)) </span><br><span class="line">        <span class="keyword">return</span> ssk, spk</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">self,msg</span>):</span><br><span class="line">        pad_length = self.N - <span class="built_in">len</span>(msg)</span><br><span class="line">        msg += [-<span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(pad_length)]</span><br><span class="line">        <span class="keyword">return</span> msg</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">self,msg</span>):</span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> msg:</span><br><span class="line">            result += [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(result) &lt; self.N:result = self.pad(result)</span><br><span class="line">        result = self.R(result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, m</span>):</span><br><span class="line">        m = self.encode(m)</span><br><span class="line">        <span class="keyword">assert</span> self.pk != <span class="literal">None</span></span><br><span class="line">        hx = self.pk</span><br><span class="line">        mx = self.R(m)</span><br><span class="line">        mx = self.Rp(<span class="built_in">list</span>(mx))            </span><br><span class="line">        mx = self.Rq(<span class="built_in">list</span>(mx))   </span><br><span class="line"></span><br><span class="line">        rx = self.T(self.d, self.d)</span><br><span class="line">        rx = self.Rq(<span class="built_in">list</span>(rx))</span><br><span class="line">        </span><br><span class="line">        e = self.p * rx * hx + mx</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ntru = NTRU(N=<span class="number">509</span>, p=<span class="number">3</span>, q=<span class="number">512</span>, d=<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">42</span></span><br><span class="line">    sk, pk = ntru.getKey()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;fx = &quot;</span> , sk[<span class="number">0</span>].<span class="built_in">list</span>())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;gx = &quot;</span> , sk[<span class="number">1</span>].<span class="built_in">list</span>())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hx = &quot;</span> , pk.<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line">    e = ntru.encrypt(flag)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;e=<span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>output</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fx =  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]</span><br><span class="line">gx =  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]</span><br><span class="line">hx =  [292, 374, 91, 384, 263, 330, 77, 497, 294, 141, 485, 464, 46, 478, 315, 100, 287, 1, 337, 477, 451, 387, 340, 370, 384, 19, 158, 440, 377, 177, 235, 340, 166, 359, 488, 332, 252, 443, 256, 453, 33, 282, 175, 18, 218, 208, 414, 147, 12, 468, 155, 34, 109, 390, 312, 472, 345, 176, 9, 184, 100, 414, 293, 366, 132, 128, 223, 242, 137, 223, 268, 259, 446, 57, 463, 344, 459, 115, 509, 510, 82, 42, 408, 139, 341, 351, 511, 339, 317, 139, 317, 297, 288, 58, 33, 120, 244, 194, 44, 128, 278, 130, 449, 282, 274, 376, 209, 240, 148, 426, 244, 319, 251, 438, 317, 166, 161, 37, 361, 468, 172, 116, 211, 64, 446, 162, 301, 447, 92, 325, 285, 4, 8, 160, 382, 365, 413, 150, 141, 323, 107, 225, 466, 93, 86, 219, 174, 198, 155, 88, 194, 259, 140, 36, 82, 462, 182, 496, 250, 337, 39, 435, 448, 365, 262, 146, 89, 283, 195, 395, 216, 159, 312, 53, 70, 485, 368, 130, 491, 474, 325, 4, 205, 1, 292, 330, 186, 66, 137, 291, 452, 236, 25, 114, 407, 125, 343, 2, 304, 267, 459, 432, 129, 21, 197, 51, 26, 342, 457, 163, 51, 52, 82, 229, 332, 72, 408, 242, 218, 286, 368, 503, 498, 434, 135, 311, 321, 205, 269, 318, 19, 119, 422, 425, 463, 368, 317, 99, 178, 390, 8, 127, 156, 27, 332, 437, 87, 187, 92, 115, 380, 54, 236, 287, 259, 386, 391, 94, 312, 454, 459, 340, 382, 424, 25, 318, 47, 249, 115, 20, 89, 82, 377, 328, 231, 298, 402, 336, 452, 264, 265, 83, 254, 156, 449, 34, 99, 412, 101, 183, 38, 142, 231, 181, 495, 6, 327, 278, 92, 452, 372, 12, 91, 102, 277, 98, 418, 22, 32, 493, 50, 374, 230, 479, 496, 6, 382, 300, 496, 157, 1, 221, 418, 381, 275, 391, 199, 472, 5, 222, 448, 377, 102, 468, 94, 35, 6, 6, 464, 452, 453, 354, 277, 425, 120, 501, 172, 222, 314, 362, 6, 105, 387, 77, 14, 112, 289, 358, 495, 350, 411, 378, 30, 89, 115, 171, 42, 32, 427, 125, 420, 486, 435, 151, 234, 416, 428, 425, 250, 142, 301, 245, 154, 338, 223, 292, 27, 194, 220, 34, 283, 255, 53, 5, 420, 134, 351, 216, 92, 242, 39, 454, 96, 239, 390, 182, 368, 463, 176, 187, 25, 122, 441, 54, 171, 426, 435, 318, 345, 166, 224, 258, 246, 349, 50, 400, 381, 236, 315, 439, 249, 201, 262, 95, 210, 327, 199, 205, 402, 175, 280, 337, 388, 205, 336, 52, 68, 364, 293, 462, 388, 354, 169, 163, 72, 374, 220, 355, 275, 36, 208, 198, 363, 369, 344, 61, 13, 230, 196, 190, 463, 351, 37, 276, 336, 110, 352, 56, 117, 376, 500, 373, 438, 309, 496, 400, 76, 169, 447, 434, 255, 456, 511, 414, 83, 369, 174, 291, 213, 227, 254, 186, 145, 402, 265, 13, 20, 212, 442]</span><br><span class="line">e=[219, 149, 491, 115, 68, 464, 91, 223, 480, 506, 103, 373, 19, 52, 368, 467, 304, 380, 495, 372, 506, 318, 320, 263, 120, 126, 165, 271, 435, 378, 443, 261, 336, 381, 57, 360, 36, 155, 424, 458, 84, 80, 187, 261, 501, 279, 167, 13, 241, 85, 214, 133, 483, 374, 430, 401, 265, 127, 497, 405, 60, 34, 81, 422, 423, 200, 276, 424, 245, 437, 31, 193, 282, 154, 93, 13, 499, 190, 1, 304, 415, 189, 82, 472, 13, 488, 366, 364, 319, 121, 322, 120, 468, 134, 305, 228, 288, 284, 33, 430, 125, 366, 212, 207, 227, 201, 286, 377, 376, 57, 336, 379, 101, 461, 375, 101, 475, 126, 306, 73, 88, 1, 149, 378, 381, 129, 402, 341, 390, 57, 305, 139, 436, 101, 386, 460, 43, 468, 9, 449, 255, 184, 374, 466, 429, 167, 101, 247, 183, 159, 346, 45, 79, 192, 259, 32, 140, 151, 16, 214, 42, 450, 111, 7, 303, 286, 435, 491, 339, 248, 114, 185, 103, 81, 414, 100, 485, 428, 137, 13, 243, 202, 62, 208, 136, 376, 88, 158, 377, 404, 355, 194, 452, 373, 107, 290, 89, 489, 259, 462, 169, 235, 86, 214, 333, 472, 343, 487, 19, 371, 203, 234, 315, 339, 430, 133, 96, 161, 278, 13, 20, 87, 303, 466, 353, 139, 395, 131, 298, 85, 144, 244, 150, 488, 254, 284, 89, 300, 297, 288, 245, 439, 307, 222, 110, 343, 318, 202, 429, 81, 203, 468, 144, 140, 480, 370, 501, 14, 490, 278, 493, 390, 214, 108, 174, 150, 287, 197, 497, 374, 420, 298, 222, 188, 146, 298, 466, 459, 456, 16, 131, 253, 153, 481, 342, 498, 173, 12, 452, 197, 233, 18, 439, 332, 185, 48, 330, 4, 99, 105, 75, 306, 174, 492, 131, 39, 126, 491, 79, 145, 186, 493, 23, 230, 195, 118, 310, 173, 244, 80, 25, 502, 373, 457, 275, 282, 26, 206, 14, 181, 61, 391, 454, 417, 370, 70, 413, 389, 434, 400, 88, 417, 364, 458, 496, 425, 12, 280, 102, 265, 471, 43, 257, 327, 10, 334, 239, 344, 77, 298, 140, 287, 260, 194, 431, 65, 304, 302, 210, 393, 473, 463, 312, 255, 368, 476, 462, 390, 412, 266, 138, 410, 246, 101, 460, 307, 123, 4, 240, 502, 115, 147, 370, 241, 222, 495, 109, 51, 138, 354, 447, 282, 434, 280, 275, 404, 214, 68, 77, 167, 302, 95, 462, 16, 184, 213, 227, 130, 50, 405, 30, 353, 24, 143, 100, 163, 212, 388, 283, 252, 187, 247, 190, 163, 252, 169, 267, 363, 72, 399, 195, 215, 103, 60, 466, 318, 71, 193, 449, 65, 358, 443, 260, 253, 46, 5, 416, 115, 390, 15, 120, 384, 50, 122, 87, 428, 282, 464, 83, 80, 401, 8, 175, 457, 301, 63, 205, 402, 468, 368, 510, 488, 345, 103, 306, 387, 34, 119, 459, 43, 319, 264, 184, 406, 407, 358, 242, 42, 241, 34, 118, 477, 117, 325, 511, 499, 365, 192, 507]</span><br></pre></td></tr></table></figure>

<p>题目实现了标准的NTRU密码系统，参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/664635742">NTRU密码系统 - 知乎 (zhihu.com)</a></p>
<p>该给的参数都给了</p>
<p>对照这文章的解密流程即可恢复</p>
<p><img src="/../images/%E6%9D%82/3.png"></p>
<p>需要注意的是**计算$b\equiv a$的时候，要保证系数在$(\frac{-q}{2},\frac{q}{2})$**中</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line">N=<span class="number">509</span></span><br><span class="line">p=<span class="number">3</span></span><br><span class="line">q=<span class="number">512</span></span><br><span class="line">d=<span class="number">3</span></span><br><span class="line">fx =  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">gx =  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">hx =  [<span class="number">292</span>, <span class="number">374</span>, <span class="number">91</span>, <span class="number">384</span>, <span class="number">263</span>, <span class="number">330</span>, <span class="number">77</span>, <span class="number">497</span>, <span class="number">294</span>, <span class="number">141</span>, <span class="number">485</span>, <span class="number">464</span>, <span class="number">46</span>, <span class="number">478</span>, <span class="number">315</span>, <span class="number">100</span>, <span class="number">287</span>, <span class="number">1</span>, <span class="number">337</span>, <span class="number">477</span>, <span class="number">451</span>, <span class="number">387</span>, <span class="number">340</span>, <span class="number">370</span>, <span class="number">384</span>, <span class="number">19</span>, <span class="number">158</span>, <span class="number">440</span>, <span class="number">377</span>, <span class="number">177</span>, <span class="number">235</span>, <span class="number">340</span>, <span class="number">166</span>, <span class="number">359</span>, <span class="number">488</span>, <span class="number">332</span>, <span class="number">252</span>, <span class="number">443</span>, <span class="number">256</span>, <span class="number">453</span>, <span class="number">33</span>, <span class="number">282</span>, <span class="number">175</span>, <span class="number">18</span>, <span class="number">218</span>, <span class="number">208</span>, <span class="number">414</span>, <span class="number">147</span>, <span class="number">12</span>, <span class="number">468</span>, <span class="number">155</span>, <span class="number">34</span>, <span class="number">109</span>, <span class="number">390</span>, <span class="number">312</span>, <span class="number">472</span>, <span class="number">345</span>, <span class="number">176</span>, <span class="number">9</span>, <span class="number">184</span>, <span class="number">100</span>, <span class="number">414</span>, <span class="number">293</span>, <span class="number">366</span>, <span class="number">132</span>, <span class="number">128</span>, <span class="number">223</span>, <span class="number">242</span>, <span class="number">137</span>, <span class="number">223</span>, <span class="number">268</span>, <span class="number">259</span>, <span class="number">446</span>, <span class="number">57</span>, <span class="number">463</span>, <span class="number">344</span>, <span class="number">459</span>, <span class="number">115</span>, <span class="number">509</span>, <span class="number">510</span>, <span class="number">82</span>, <span class="number">42</span>, <span class="number">408</span>, <span class="number">139</span>, <span class="number">341</span>, <span class="number">351</span>, <span class="number">511</span>, <span class="number">339</span>, <span class="number">317</span>, <span class="number">139</span>, <span class="number">317</span>, <span class="number">297</span>, <span class="number">288</span>, <span class="number">58</span>, <span class="number">33</span>, <span class="number">120</span>, <span class="number">244</span>, <span class="number">194</span>, <span class="number">44</span>, <span class="number">128</span>, <span class="number">278</span>, <span class="number">130</span>, <span class="number">449</span>, <span class="number">282</span>, <span class="number">274</span>, <span class="number">376</span>, <span class="number">209</span>, <span class="number">240</span>, <span class="number">148</span>, <span class="number">426</span>, <span class="number">244</span>, <span class="number">319</span>, <span class="number">251</span>, <span class="number">438</span>, <span class="number">317</span>, <span class="number">166</span>, <span class="number">161</span>, <span class="number">37</span>, <span class="number">361</span>, <span class="number">468</span>, <span class="number">172</span>, <span class="number">116</span>, <span class="number">211</span>, <span class="number">64</span>, <span class="number">446</span>, <span class="number">162</span>, <span class="number">301</span>, <span class="number">447</span>, <span class="number">92</span>, <span class="number">325</span>, <span class="number">285</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">160</span>, <span class="number">382</span>, <span class="number">365</span>, <span class="number">413</span>, <span class="number">150</span>, <span class="number">141</span>, <span class="number">323</span>, <span class="number">107</span>, <span class="number">225</span>, <span class="number">466</span>, <span class="number">93</span>, <span class="number">86</span>, <span class="number">219</span>, <span class="number">174</span>, <span class="number">198</span>, <span class="number">155</span>, <span class="number">88</span>, <span class="number">194</span>, <span class="number">259</span>, <span class="number">140</span>, <span class="number">36</span>, <span class="number">82</span>, <span class="number">462</span>, <span class="number">182</span>, <span class="number">496</span>, <span class="number">250</span>, <span class="number">337</span>, <span class="number">39</span>, <span class="number">435</span>, <span class="number">448</span>, <span class="number">365</span>, <span class="number">262</span>, <span class="number">146</span>, <span class="number">89</span>, <span class="number">283</span>, <span class="number">195</span>, <span class="number">395</span>, <span class="number">216</span>, <span class="number">159</span>, <span class="number">312</span>, <span class="number">53</span>, <span class="number">70</span>, <span class="number">485</span>, <span class="number">368</span>, <span class="number">130</span>, <span class="number">491</span>, <span class="number">474</span>, <span class="number">325</span>, <span class="number">4</span>, <span class="number">205</span>, <span class="number">1</span>, <span class="number">292</span>, <span class="number">330</span>, <span class="number">186</span>, <span class="number">66</span>, <span class="number">137</span>, <span class="number">291</span>, <span class="number">452</span>, <span class="number">236</span>, <span class="number">25</span>, <span class="number">114</span>, <span class="number">407</span>, <span class="number">125</span>, <span class="number">343</span>, <span class="number">2</span>, <span class="number">304</span>, <span class="number">267</span>, <span class="number">459</span>, <span class="number">432</span>, <span class="number">129</span>, <span class="number">21</span>, <span class="number">197</span>, <span class="number">51</span>, <span class="number">26</span>, <span class="number">342</span>, <span class="number">457</span>, <span class="number">163</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">82</span>, <span class="number">229</span>, <span class="number">332</span>, <span class="number">72</span>, <span class="number">408</span>, <span class="number">242</span>, <span class="number">218</span>, <span class="number">286</span>, <span class="number">368</span>, <span class="number">503</span>, <span class="number">498</span>, <span class="number">434</span>, <span class="number">135</span>, <span class="number">311</span>, <span class="number">321</span>, <span class="number">205</span>, <span class="number">269</span>, <span class="number">318</span>, <span class="number">19</span>, <span class="number">119</span>, <span class="number">422</span>, <span class="number">425</span>, <span class="number">463</span>, <span class="number">368</span>, <span class="number">317</span>, <span class="number">99</span>, <span class="number">178</span>, <span class="number">390</span>, <span class="number">8</span>, <span class="number">127</span>, <span class="number">156</span>, <span class="number">27</span>, <span class="number">332</span>, <span class="number">437</span>, <span class="number">87</span>, <span class="number">187</span>, <span class="number">92</span>, <span class="number">115</span>, <span class="number">380</span>, <span class="number">54</span>, <span class="number">236</span>, <span class="number">287</span>, <span class="number">259</span>, <span class="number">386</span>, <span class="number">391</span>, <span class="number">94</span>, <span class="number">312</span>, <span class="number">454</span>, <span class="number">459</span>, <span class="number">340</span>, <span class="number">382</span>, <span class="number">424</span>, <span class="number">25</span>, <span class="number">318</span>, <span class="number">47</span>, <span class="number">249</span>, <span class="number">115</span>, <span class="number">20</span>, <span class="number">89</span>, <span class="number">82</span>, <span class="number">377</span>, <span class="number">328</span>, <span class="number">231</span>, <span class="number">298</span>, <span class="number">402</span>, <span class="number">336</span>, <span class="number">452</span>, <span class="number">264</span>, <span class="number">265</span>, <span class="number">83</span>, <span class="number">254</span>, <span class="number">156</span>, <span class="number">449</span>, <span class="number">34</span>, <span class="number">99</span>, <span class="number">412</span>, <span class="number">101</span>, <span class="number">183</span>, <span class="number">38</span>, <span class="number">142</span>, <span class="number">231</span>, <span class="number">181</span>, <span class="number">495</span>, <span class="number">6</span>, <span class="number">327</span>, <span class="number">278</span>, <span class="number">92</span>, <span class="number">452</span>, <span class="number">372</span>, <span class="number">12</span>, <span class="number">91</span>, <span class="number">102</span>, <span class="number">277</span>, <span class="number">98</span>, <span class="number">418</span>, <span class="number">22</span>, <span class="number">32</span>, <span class="number">493</span>, <span class="number">50</span>, <span class="number">374</span>, <span class="number">230</span>, <span class="number">479</span>, <span class="number">496</span>, <span class="number">6</span>, <span class="number">382</span>, <span class="number">300</span>, <span class="number">496</span>, <span class="number">157</span>, <span class="number">1</span>, <span class="number">221</span>, <span class="number">418</span>, <span class="number">381</span>, <span class="number">275</span>, <span class="number">391</span>, <span class="number">199</span>, <span class="number">472</span>, <span class="number">5</span>, <span class="number">222</span>, <span class="number">448</span>, <span class="number">377</span>, <span class="number">102</span>, <span class="number">468</span>, <span class="number">94</span>, <span class="number">35</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">464</span>, <span class="number">452</span>, <span class="number">453</span>, <span class="number">354</span>, <span class="number">277</span>, <span class="number">425</span>, <span class="number">120</span>, <span class="number">501</span>, <span class="number">172</span>, <span class="number">222</span>, <span class="number">314</span>, <span class="number">362</span>, <span class="number">6</span>, <span class="number">105</span>, <span class="number">387</span>, <span class="number">77</span>, <span class="number">14</span>, <span class="number">112</span>, <span class="number">289</span>, <span class="number">358</span>, <span class="number">495</span>, <span class="number">350</span>, <span class="number">411</span>, <span class="number">378</span>, <span class="number">30</span>, <span class="number">89</span>, <span class="number">115</span>, <span class="number">171</span>, <span class="number">42</span>, <span class="number">32</span>, <span class="number">427</span>, <span class="number">125</span>, <span class="number">420</span>, <span class="number">486</span>, <span class="number">435</span>, <span class="number">151</span>, <span class="number">234</span>, <span class="number">416</span>, <span class="number">428</span>, <span class="number">425</span>, <span class="number">250</span>, <span class="number">142</span>, <span class="number">301</span>, <span class="number">245</span>, <span class="number">154</span>, <span class="number">338</span>, <span class="number">223</span>, <span class="number">292</span>, <span class="number">27</span>, <span class="number">194</span>, <span class="number">220</span>, <span class="number">34</span>, <span class="number">283</span>, <span class="number">255</span>, <span class="number">53</span>, <span class="number">5</span>, <span class="number">420</span>, <span class="number">134</span>, <span class="number">351</span>, <span class="number">216</span>, <span class="number">92</span>, <span class="number">242</span>, <span class="number">39</span>, <span class="number">454</span>, <span class="number">96</span>, <span class="number">239</span>, <span class="number">390</span>, <span class="number">182</span>, <span class="number">368</span>, <span class="number">463</span>, <span class="number">176</span>, <span class="number">187</span>, <span class="number">25</span>, <span class="number">122</span>, <span class="number">441</span>, <span class="number">54</span>, <span class="number">171</span>, <span class="number">426</span>, <span class="number">435</span>, <span class="number">318</span>, <span class="number">345</span>, <span class="number">166</span>, <span class="number">224</span>, <span class="number">258</span>, <span class="number">246</span>, <span class="number">349</span>, <span class="number">50</span>, <span class="number">400</span>, <span class="number">381</span>, <span class="number">236</span>, <span class="number">315</span>, <span class="number">439</span>, <span class="number">249</span>, <span class="number">201</span>, <span class="number">262</span>, <span class="number">95</span>, <span class="number">210</span>, <span class="number">327</span>, <span class="number">199</span>, <span class="number">205</span>, <span class="number">402</span>, <span class="number">175</span>, <span class="number">280</span>, <span class="number">337</span>, <span class="number">388</span>, <span class="number">205</span>, <span class="number">336</span>, <span class="number">52</span>, <span class="number">68</span>, <span class="number">364</span>, <span class="number">293</span>, <span class="number">462</span>, <span class="number">388</span>, <span class="number">354</span>, <span class="number">169</span>, <span class="number">163</span>, <span class="number">72</span>, <span class="number">374</span>, <span class="number">220</span>, <span class="number">355</span>, <span class="number">275</span>, <span class="number">36</span>, <span class="number">208</span>, <span class="number">198</span>, <span class="number">363</span>, <span class="number">369</span>, <span class="number">344</span>, <span class="number">61</span>, <span class="number">13</span>, <span class="number">230</span>, <span class="number">196</span>, <span class="number">190</span>, <span class="number">463</span>, <span class="number">351</span>, <span class="number">37</span>, <span class="number">276</span>, <span class="number">336</span>, <span class="number">110</span>, <span class="number">352</span>, <span class="number">56</span>, <span class="number">117</span>, <span class="number">376</span>, <span class="number">500</span>, <span class="number">373</span>, <span class="number">438</span>, <span class="number">309</span>, <span class="number">496</span>, <span class="number">400</span>, <span class="number">76</span>, <span class="number">169</span>, <span class="number">447</span>, <span class="number">434</span>, <span class="number">255</span>, <span class="number">456</span>, <span class="number">511</span>, <span class="number">414</span>, <span class="number">83</span>, <span class="number">369</span>, <span class="number">174</span>, <span class="number">291</span>, <span class="number">213</span>, <span class="number">227</span>, <span class="number">254</span>, <span class="number">186</span>, <span class="number">145</span>, <span class="number">402</span>, <span class="number">265</span>, <span class="number">13</span>, <span class="number">20</span>, <span class="number">212</span>, <span class="number">442</span>]</span><br><span class="line">e = [<span class="number">219</span>, <span class="number">149</span>, <span class="number">491</span>, <span class="number">115</span>, <span class="number">68</span>, <span class="number">464</span>, <span class="number">91</span>, <span class="number">223</span>, <span class="number">480</span>, <span class="number">506</span>, <span class="number">103</span>, <span class="number">373</span>, <span class="number">19</span>, <span class="number">52</span>, <span class="number">368</span>, <span class="number">467</span>, <span class="number">304</span>, <span class="number">380</span>, <span class="number">495</span>, <span class="number">372</span>, <span class="number">506</span>, <span class="number">318</span>, <span class="number">320</span>, <span class="number">263</span>, <span class="number">120</span>, <span class="number">126</span>, <span class="number">165</span>, <span class="number">271</span>, <span class="number">435</span>, <span class="number">378</span>, <span class="number">443</span>, <span class="number">261</span>, <span class="number">336</span>, <span class="number">381</span>, <span class="number">57</span>, <span class="number">360</span>, <span class="number">36</span>, <span class="number">155</span>, <span class="number">424</span>, <span class="number">458</span>, <span class="number">84</span>, <span class="number">80</span>, <span class="number">187</span>, <span class="number">261</span>, <span class="number">501</span>, <span class="number">279</span>, <span class="number">167</span>, <span class="number">13</span>, <span class="number">241</span>, <span class="number">85</span>, <span class="number">214</span>, <span class="number">133</span>, <span class="number">483</span>, <span class="number">374</span>, <span class="number">430</span>, <span class="number">401</span>, <span class="number">265</span>, <span class="number">127</span>, <span class="number">497</span>, <span class="number">405</span>, <span class="number">60</span>, <span class="number">34</span>, <span class="number">81</span>, <span class="number">422</span>, <span class="number">423</span>, <span class="number">200</span>, <span class="number">276</span>, <span class="number">424</span>, <span class="number">245</span>, <span class="number">437</span>, <span class="number">31</span>, <span class="number">193</span>, <span class="number">282</span>, <span class="number">154</span>, <span class="number">93</span>, <span class="number">13</span>, <span class="number">499</span>, <span class="number">190</span>, <span class="number">1</span>, <span class="number">304</span>, <span class="number">415</span>, <span class="number">189</span>, <span class="number">82</span>, <span class="number">472</span>, <span class="number">13</span>, <span class="number">488</span>, <span class="number">366</span>, <span class="number">364</span>, <span class="number">319</span>, <span class="number">121</span>, <span class="number">322</span>, <span class="number">120</span>, <span class="number">468</span>, <span class="number">134</span>, <span class="number">305</span>, <span class="number">228</span>, <span class="number">288</span>, <span class="number">284</span>, <span class="number">33</span>, <span class="number">430</span>, <span class="number">125</span>, <span class="number">366</span>, <span class="number">212</span>, <span class="number">207</span>, <span class="number">227</span>, <span class="number">201</span>, <span class="number">286</span>, <span class="number">377</span>, <span class="number">376</span>, <span class="number">57</span>, <span class="number">336</span>, <span class="number">379</span>, <span class="number">101</span>, <span class="number">461</span>, <span class="number">375</span>, <span class="number">101</span>, <span class="number">475</span>, <span class="number">126</span>, <span class="number">306</span>, <span class="number">73</span>, <span class="number">88</span>, <span class="number">1</span>, <span class="number">149</span>, <span class="number">378</span>, <span class="number">381</span>, <span class="number">129</span>, <span class="number">402</span>, <span class="number">341</span>, <span class="number">390</span>, <span class="number">57</span>, <span class="number">305</span>, <span class="number">139</span>, <span class="number">436</span>, <span class="number">101</span>, <span class="number">386</span>, <span class="number">460</span>, <span class="number">43</span>, <span class="number">468</span>, <span class="number">9</span>, <span class="number">449</span>, <span class="number">255</span>, <span class="number">184</span>, <span class="number">374</span>, <span class="number">466</span>, <span class="number">429</span>, <span class="number">167</span>, <span class="number">101</span>, <span class="number">247</span>, <span class="number">183</span>, <span class="number">159</span>, <span class="number">346</span>, <span class="number">45</span>, <span class="number">79</span>, <span class="number">192</span>, <span class="number">259</span>, <span class="number">32</span>, <span class="number">140</span>, <span class="number">151</span>, <span class="number">16</span>, <span class="number">214</span>, <span class="number">42</span>, <span class="number">450</span>, <span class="number">111</span>, <span class="number">7</span>, <span class="number">303</span>, <span class="number">286</span>, <span class="number">435</span>, <span class="number">491</span>, <span class="number">339</span>, <span class="number">248</span>, <span class="number">114</span>, <span class="number">185</span>, <span class="number">103</span>, <span class="number">81</span>, <span class="number">414</span>, <span class="number">100</span>, <span class="number">485</span>, <span class="number">428</span>, <span class="number">137</span>, <span class="number">13</span>, <span class="number">243</span>, <span class="number">202</span>, <span class="number">62</span>, <span class="number">208</span>, <span class="number">136</span>, <span class="number">376</span>, <span class="number">88</span>, <span class="number">158</span>, <span class="number">377</span>, <span class="number">404</span>, <span class="number">355</span>, <span class="number">194</span>, <span class="number">452</span>, <span class="number">373</span>, <span class="number">107</span>, <span class="number">290</span>, <span class="number">89</span>, <span class="number">489</span>, <span class="number">259</span>, <span class="number">462</span>, <span class="number">169</span>, <span class="number">235</span>, <span class="number">86</span>, <span class="number">214</span>, <span class="number">333</span>, <span class="number">472</span>, <span class="number">343</span>, <span class="number">487</span>, <span class="number">19</span>, <span class="number">371</span>, <span class="number">203</span>, <span class="number">234</span>, <span class="number">315</span>, <span class="number">339</span>, <span class="number">430</span>, <span class="number">133</span>, <span class="number">96</span>, <span class="number">161</span>, <span class="number">278</span>, <span class="number">13</span>, <span class="number">20</span>, <span class="number">87</span>, <span class="number">303</span>, <span class="number">466</span>, <span class="number">353</span>, <span class="number">139</span>, <span class="number">395</span>, <span class="number">131</span>, <span class="number">298</span>, <span class="number">85</span>, <span class="number">144</span>, <span class="number">244</span>, <span class="number">150</span>, <span class="number">488</span>, <span class="number">254</span>, <span class="number">284</span>, <span class="number">89</span>, <span class="number">300</span>, <span class="number">297</span>, <span class="number">288</span>, <span class="number">245</span>, <span class="number">439</span>, <span class="number">307</span>, <span class="number">222</span>, <span class="number">110</span>, <span class="number">343</span>, <span class="number">318</span>, <span class="number">202</span>, <span class="number">429</span>, <span class="number">81</span>, <span class="number">203</span>, <span class="number">468</span>, <span class="number">144</span>, <span class="number">140</span>, <span class="number">480</span>, <span class="number">370</span>, <span class="number">501</span>, <span class="number">14</span>, <span class="number">490</span>, <span class="number">278</span>, <span class="number">493</span>, <span class="number">390</span>, <span class="number">214</span>, <span class="number">108</span>, <span class="number">174</span>, <span class="number">150</span>, <span class="number">287</span>, <span class="number">197</span>, <span class="number">497</span>, <span class="number">374</span>, <span class="number">420</span>, <span class="number">298</span>, <span class="number">222</span>, <span class="number">188</span>, <span class="number">146</span>, <span class="number">298</span>, <span class="number">466</span>, <span class="number">459</span>, <span class="number">456</span>, <span class="number">16</span>, <span class="number">131</span>, <span class="number">253</span>, <span class="number">153</span>, <span class="number">481</span>, <span class="number">342</span>, <span class="number">498</span>, <span class="number">173</span>, <span class="number">12</span>, <span class="number">452</span>, <span class="number">197</span>, <span class="number">233</span>, <span class="number">18</span>, <span class="number">439</span>, <span class="number">332</span>, <span class="number">185</span>, <span class="number">48</span>, <span class="number">330</span>, <span class="number">4</span>, <span class="number">99</span>, <span class="number">105</span>, <span class="number">75</span>, <span class="number">306</span>, <span class="number">174</span>, <span class="number">492</span>, <span class="number">131</span>, <span class="number">39</span>, <span class="number">126</span>, <span class="number">491</span>, <span class="number">79</span>, <span class="number">145</span>, <span class="number">186</span>, <span class="number">493</span>, <span class="number">23</span>, <span class="number">230</span>, <span class="number">195</span>, <span class="number">118</span>, <span class="number">310</span>, <span class="number">173</span>, <span class="number">244</span>, <span class="number">80</span>, <span class="number">25</span>, <span class="number">502</span>, <span class="number">373</span>, <span class="number">457</span>, <span class="number">275</span>, <span class="number">282</span>, <span class="number">26</span>, <span class="number">206</span>, <span class="number">14</span>, <span class="number">181</span>, <span class="number">61</span>, <span class="number">391</span>, <span class="number">454</span>, <span class="number">417</span>, <span class="number">370</span>, <span class="number">70</span>, <span class="number">413</span>, <span class="number">389</span>, <span class="number">434</span>, <span class="number">400</span>, <span class="number">88</span>, <span class="number">417</span>, <span class="number">364</span>, <span class="number">458</span>, <span class="number">496</span>, <span class="number">425</span>, <span class="number">12</span>, <span class="number">280</span>, <span class="number">102</span>, <span class="number">265</span>, <span class="number">471</span>, <span class="number">43</span>, <span class="number">257</span>, <span class="number">327</span>, <span class="number">10</span>, <span class="number">334</span>, <span class="number">239</span>, <span class="number">344</span>, <span class="number">77</span>, <span class="number">298</span>, <span class="number">140</span>, <span class="number">287</span>, <span class="number">260</span>, <span class="number">194</span>, <span class="number">431</span>, <span class="number">65</span>, <span class="number">304</span>, <span class="number">302</span>, <span class="number">210</span>, <span class="number">393</span>, <span class="number">473</span>, <span class="number">463</span>, <span class="number">312</span>, <span class="number">255</span>, <span class="number">368</span>, <span class="number">476</span>, <span class="number">462</span>, <span class="number">390</span>, <span class="number">412</span>, <span class="number">266</span>, <span class="number">138</span>, <span class="number">410</span>, <span class="number">246</span>, <span class="number">101</span>, <span class="number">460</span>, <span class="number">307</span>, <span class="number">123</span>, <span class="number">4</span>, <span class="number">240</span>, <span class="number">502</span>, <span class="number">115</span>, <span class="number">147</span>, <span class="number">370</span>, <span class="number">241</span>, <span class="number">222</span>, <span class="number">495</span>, <span class="number">109</span>, <span class="number">51</span>, <span class="number">138</span>, <span class="number">354</span>, <span class="number">447</span>, <span class="number">282</span>, <span class="number">434</span>, <span class="number">280</span>, <span class="number">275</span>, <span class="number">404</span>, <span class="number">214</span>, <span class="number">68</span>, <span class="number">77</span>, <span class="number">167</span>, <span class="number">302</span>, <span class="number">95</span>, <span class="number">462</span>, <span class="number">16</span>, <span class="number">184</span>, <span class="number">213</span>, <span class="number">227</span>, <span class="number">130</span>, <span class="number">50</span>, <span class="number">405</span>, <span class="number">30</span>, <span class="number">353</span>, <span class="number">24</span>, <span class="number">143</span>, <span class="number">100</span>, <span class="number">163</span>, <span class="number">212</span>, <span class="number">388</span>, <span class="number">283</span>, <span class="number">252</span>, <span class="number">187</span>, <span class="number">247</span>, <span class="number">190</span>, <span class="number">163</span>, <span class="number">252</span>, <span class="number">169</span>, <span class="number">267</span>, <span class="number">363</span>, <span class="number">72</span>, <span class="number">399</span>, <span class="number">195</span>, <span class="number">215</span>, <span class="number">103</span>, <span class="number">60</span>, <span class="number">466</span>, <span class="number">318</span>, <span class="number">71</span>, <span class="number">193</span>, <span class="number">449</span>, <span class="number">65</span>, <span class="number">358</span>, <span class="number">443</span>, <span class="number">260</span>, <span class="number">253</span>, <span class="number">46</span>, <span class="number">5</span>, <span class="number">416</span>, <span class="number">115</span>, <span class="number">390</span>, <span class="number">15</span>, <span class="number">120</span>, <span class="number">384</span>, <span class="number">50</span>, <span class="number">122</span>, <span class="number">87</span>, <span class="number">428</span>, <span class="number">282</span>, <span class="number">464</span>, <span class="number">83</span>, <span class="number">80</span>, <span class="number">401</span>, <span class="number">8</span>, <span class="number">175</span>, <span class="number">457</span>, <span class="number">301</span>, <span class="number">63</span>, <span class="number">205</span>, <span class="number">402</span>, <span class="number">468</span>, <span class="number">368</span>, <span class="number">510</span>, <span class="number">488</span>, <span class="number">345</span>, <span class="number">103</span>, <span class="number">306</span>, <span class="number">387</span>, <span class="number">34</span>, <span class="number">119</span>, <span class="number">459</span>, <span class="number">43</span>, <span class="number">319</span>, <span class="number">264</span>, <span class="number">184</span>, <span class="number">406</span>, <span class="number">407</span>, <span class="number">358</span>, <span class="number">242</span>, <span class="number">42</span>, <span class="number">241</span>, <span class="number">34</span>, <span class="number">118</span>, <span class="number">477</span>, <span class="number">117</span>, <span class="number">325</span>, <span class="number">511</span>, <span class="number">499</span>, <span class="number">365</span>, <span class="number">192</span>, <span class="number">507</span>]</span><br><span class="line"></span><br><span class="line">Rq.&lt;x&gt; = PolynomialRing(Zmod(q))</span><br><span class="line">f = Rq(fx)</span><br><span class="line">c = Rq(e)</span><br><span class="line">Modq = x ^ N - <span class="number">1</span></span><br><span class="line">a = (f * c) % Modq</span><br><span class="line"><span class="comment"># print(f&quot;a = &#123;a&#125;&quot;)</span></span><br><span class="line">A = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    A.append(<span class="built_in">int</span>(i))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A)):</span><br><span class="line">    <span class="keyword">if</span> A[i] &gt; <span class="number">256</span>:</span><br><span class="line">        A[i] -= <span class="number">512</span></span><br><span class="line"><span class="comment"># print(A)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Rp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = Rp(fx)</span><br><span class="line">Mod = x ^ N - <span class="number">1</span></span><br><span class="line">Fp = (inverse_mod(f,Mod))</span><br><span class="line"><span class="comment"># print(Fp)</span></span><br><span class="line">b = Rp(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A)):</span><br><span class="line">    b += A[i]*x^i</span><br><span class="line"><span class="comment"># print(b)</span></span><br><span class="line"></span><br><span class="line">m = (Fp * b) % Mod</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;m = <span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">    flag.append(i)</span><br><span class="line"><span class="comment"># print(flag)</span></span><br><span class="line">Flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>):</span><br><span class="line">    mm = flag[j*<span class="number">8</span>:(j+<span class="number">1</span>)*<span class="number">8</span>]</span><br><span class="line">    msg = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> mm:</span><br><span class="line">        msg += <span class="built_in">str</span>(i)</span><br><span class="line">    Flag += <span class="built_in">chr</span>(<span class="built_in">int</span>(msg,<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(Flag)</span><br><span class="line"><span class="comment"># NCTF&#123;0e301384-a06c-11ee-959d-b39f60b9e252&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Code-Infinite"><a href="#Code-Infinite" class="headerlink" title="Code Infinite"></a>Code Infinite</h2><p>首先声明这道题，由于前置知识不够扎实，导致我的理解其实很不充分，后面有时间会重新梳理思路。</p>
<blockquote>
<p>util</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,x,y,curve, isInfinity = <span class="literal">False</span></span>):</span><br><span class="line">		self.x = x % curve.p</span><br><span class="line">		self.y = y % curve.p</span><br><span class="line">		self.curve = curve</span><br><span class="line">		self.isInfinity = isInfinity</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self,other</span>):</span><br><span class="line">		<span class="keyword">return</span> self.curve.add(self,other)</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self,other</span>):</span><br><span class="line">		<span class="keyword">return</span> self.curve.multiply(self,other)</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__rmul__</span>(<span class="params">self,other</span>):</span><br><span class="line">		<span class="keyword">return</span> self.curve.multiply(self,other)</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> <span class="string">f&quot;(<span class="subst">&#123;self.x&#125;</span>,<span class="subst">&#123;self.y&#125;</span>)&quot;</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">		<span class="keyword">return</span> self.x == other.x <span class="keyword">and</span> self.y == other.y <span class="keyword">and</span> self.curve == other.curve</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Curve</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,a,b,p</span>):</span><br><span class="line">		self.a = a%p</span><br><span class="line">		self.b = b%p</span><br><span class="line">		self.p = p</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">self, P:Point, k:<span class="built_in">int</span></span>) -&gt; Point:</span><br><span class="line">		Q = P</span><br><span class="line">		R = Point(<span class="number">0</span>,<span class="number">0</span>,self,isInfinity=<span class="literal">True</span>)</span><br><span class="line">		<span class="keyword">while</span> k &gt; <span class="number">0</span> :</span><br><span class="line">			<span class="keyword">if</span> (k &amp; <span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">				R = self.add(R,Q)</span><br><span class="line">			Q = self.add(Q,Q)</span><br><span class="line">			k &gt;&gt;= <span class="number">1</span></span><br><span class="line">		<span class="keyword">return</span> R</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">find_y</span>(<span class="params">self,x</span>):</span><br><span class="line">		x = x % self.p</span><br><span class="line">		y_squared = (<span class="built_in">pow</span>(x, <span class="number">3</span>, self.p) + self.a * x + self.b) % self.p</span><br><span class="line">		<span class="keyword">assert</span> <span class="built_in">pow</span>(y_squared, (self.p - <span class="number">1</span>) // <span class="number">2</span>, self.p) == <span class="number">1</span>, <span class="string">&quot;The x coordinate is not on the curve&quot;</span></span><br><span class="line">		y = <span class="built_in">pow</span>(y_squared, (self.p + <span class="number">1</span>) // <span class="number">4</span>, self.p)</span><br><span class="line">		<span class="keyword">assert</span> <span class="built_in">pow</span>(y,<span class="number">2</span>,self.p) == (<span class="built_in">pow</span>(x, <span class="number">3</span>, self.p) + self.a * x + self.b) % self.p</span><br><span class="line">		<span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self,P: Point, Q : Point</span>) -&gt; Point:</span><br><span class="line">		<span class="keyword">if</span> P.isInfinity:</span><br><span class="line">			<span class="keyword">return</span> Q</span><br><span class="line">		<span class="keyword">elif</span> Q.isInfinity:</span><br><span class="line">			<span class="keyword">return</span> P</span><br><span class="line">		<span class="keyword">elif</span> P.x == Q.x <span class="keyword">and</span> P.y == (-Q.y) % self.p:</span><br><span class="line">			<span class="keyword">return</span> Point(<span class="number">0</span>,<span class="number">0</span>,self,isInfinity=<span class="literal">True</span>)</span><br><span class="line">		<span class="keyword">if</span> P.x == Q.x <span class="keyword">and</span> P.y == Q.y:</span><br><span class="line">			param = ((<span class="number">3</span>*<span class="built_in">pow</span>(P.x,<span class="number">2</span>,self.p)+self.a) * <span class="built_in">pow</span>(<span class="number">2</span>*P.y,-<span class="number">1</span>,self.p))</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			param = ((Q.y - P.y) * <span class="built_in">pow</span>(Q.x-P.x,-<span class="number">1</span>,self.p))</span><br><span class="line">		Sx =  (<span class="built_in">pow</span>(param,<span class="number">2</span>,self.p)-P.x-Q.x)%self.p</span><br><span class="line">		Sy = (param * ((P.x-Sx)%self.p) - P.y) % self.p</span><br><span class="line">		<span class="keyword">return</span> Point(Sx,Sy,self)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">    random.seed(urandom(<span class="number">8</span>))</span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    _hexdigest = sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] sha256(XXXX+<span class="subst">&#123;proof[<span class="number">4</span>:]&#125;</span>) == <span class="subst">&#123;_hexdigest&#125;</span>&quot;</span>)</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&#x27;[+] Plz tell me XXXX: &#x27;</span>).encode()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x+proof[<span class="number">4</span>:].encode()).hexdigest() != _hexdigest:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>task</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,a,b,p</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long,long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;[!] Wrong!&quot;</span>)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		curve = Curve(a,b,p)</span><br><span class="line">		g = randrange(<span class="number">1</span>,p)</span><br><span class="line">		G = Point(g,curve.find_y(g),curve)</span><br><span class="line">		PK = randrange(<span class="number">1</span>,p)</span><br><span class="line">		pub = PK * G</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">key = long_to_bytes(PK)[:<span class="number">16</span>]</span><br><span class="line">Cipher = AES.new(key,AES.MODE_ECB)</span><br><span class="line">enc = Cipher.encrypt(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">=============================================</span></span><br><span class="line"><span class="string">The secret is <span class="subst">&#123;enc.<span class="built_in">hex</span>()&#125;</span> </span></span><br><span class="line"><span class="string">Alice&#x27;s public key is <span class="subst">&#123;pub&#125;</span></span></span><br><span class="line"><span class="string">Now send over yours !</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">	your_pub_key_x = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">f&quot;Give me your pub key&#x27;s x : \n&quot;</span>))</span><br><span class="line">	your_pub_key_y = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">f&quot;Give me your pub key&#x27;s y : \n&quot;</span>))</span><br><span class="line">	your_pub_key = Point(your_pub_key_x,your_pub_key_y,curve)</span><br><span class="line">	shared_key = your_pub_key * PK</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;The shared key is\n <span class="subst">&#123;shared_key&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>简单来说，util中实现了椭圆曲线上的加法和乘法，还有一个验证</p>
<p>task中，我们通过验证后，可以输入4次点(x,y)，主要任务是恢复<code>PK</code></p>
<p>本题思路参考：<a target="_blank" rel="noopener" href="https://tangcuxiaojikuai.xyz/post/187210a7.html">Crypto趣题-曲线 | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a>————————ECDH</p>
<p>大概是因为服务器没有对输入的点进行验证是否在曲线上，因此，我们可以改变参数b，构造一个曲线$y^2 \equiv x^3 +ax +b’$</p>
<p>下面具体的思路没有理清</p>
<p>大概就是利用CRT，用四次机会，输入四次我们曲线上的点$G_i$，服务器返回$G_i$的倍点$Q_i &#x3D; PK\times G_i$</p>
<p>然后我们分别解4次$k_iG_i &#x3D; Q_i$，最后对4个$k_i$求解CRT，即可恢复PK</p>
<p>因为服务器的曲线参数不变，于是我先连了4次靶机，来获得4个点，恢复出参数</p>
<p>如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> GCD,isPrime</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_para</span>(<span class="params">Q</span>):</span><br><span class="line"> x1,y1 = Q[<span class="number">0</span>]</span><br><span class="line"> x2,y2 = Q[<span class="number">1</span>]</span><br><span class="line"> x3,y3 = Q[<span class="number">2</span>]</span><br><span class="line"> x4,y4 = Q[<span class="number">3</span>]</span><br><span class="line"> t12_13 = ((y1**<span class="number">2</span> - x1**<span class="number">3</span>)-(y2**<span class="number">2</span> - x2**<span class="number">3</span>)) * (x1-x3)</span><br><span class="line"> t13_12 = ((y1**<span class="number">2</span> - x1**<span class="number">3</span>)-(y3**<span class="number">2</span> - x3**<span class="number">3</span>)) * (x1-x2)</span><br><span class="line"> k1p = t12_13-t13_12</span><br><span class="line"></span><br><span class="line"> t12_14 = ((y1**<span class="number">2</span> - x1**<span class="number">3</span>)-(y2**<span class="number">2</span> - x2**<span class="number">3</span>)) * (x1-x4)</span><br><span class="line"> t14_12 = ((y1**<span class="number">2</span> - x1**<span class="number">3</span>)-(y4**<span class="number">2</span> - x4**<span class="number">3</span>)) * (x1-x2)</span><br><span class="line"> k2p = t12_14-t14_12</span><br><span class="line"></span><br><span class="line"> p = factor(GCD(k1p,k2p))[-<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line"> <span class="keyword">assert</span> isPrime(<span class="built_in">int</span>(p))</span><br><span class="line"></span><br><span class="line"> a = ((y1^<span class="number">2</span>-x1^<span class="number">3</span>)-(y2^<span class="number">2</span>-x2^<span class="number">3</span>))/(x1-x2) % p</span><br><span class="line"> b = (y1^<span class="number">2</span>-x1^<span class="number">3</span>-a*x1) % p</span><br><span class="line"></span><br><span class="line"> E = EllipticCurve(GF(p),[a,b])</span><br><span class="line"></span><br><span class="line"> <span class="keyword">assert</span> E(Q[<span class="number">0</span>])</span><br><span class="line"> <span class="keyword">return</span> E,a,b,p</span><br><span class="line"></span><br><span class="line">Q = [</span><br><span class="line">    (<span class="number">2845822532553776599692133610996291958841570735744741843546</span>,<span class="number">5546744973172175494966318399405777490191735700856307542348</span>),</span><br><span class="line">    (<span class="number">164124603250334845418798190314521081977657146616868389802</span>,<span class="number">5827607416298226172585153066613095195693202224870785680211</span>),</span><br><span class="line">    (<span class="number">3085322768139282829195896461453680669085310051891241339683</span>,<span class="number">4839824814181827567238586919502670280804402058059671061077</span>),</span><br><span class="line">    (<span class="number">2475102402978907255506522850446484114868887359220654243314</span>,<span class="number">3976026982315595141029554602740489639103543841358417228869</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">E,a,b,p = recover_para(Q)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a=&quot;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;b=&quot;</span>,b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p=&quot;</span>,p)</span><br></pre></td></tr></table></figure>

<p>获得参数，发现$p \approx 192bit$，所以$PK \approx 192bit$</p>
<p>然后改变b，使得椭圆曲线的阶存在一些小因子</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">a= <span class="number">6277101735386680763835789423207666416083908700390324961276</span></span><br><span class="line">b= <span class="number">2455155546008943817740293915197451784769108058161191238065</span></span><br><span class="line">p= <span class="number">6277101735386680763835789423207666416083908700390324961279</span></span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line"><span class="comment"># print(E.order())</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100000</span>):</span><br><span class="line">    b = i</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        temp = factor(EllipticCurve(GF(p), [a, b]).order())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;b = <span class="subst">&#123;b&#125;</span>&quot;</span>,<span class="string">f&quot;temp = <span class="subst">&#123;temp&#125;</span>&quot;</span>)</span><br><span class="line">        maxp = [<span class="built_in">int</span>(p) <span class="keyword">for</span> p, e <span class="keyword">in</span> temp][-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span>(maxp &lt; <span class="number">2</span> ^ <span class="number">40</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;b = <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><strong>需要注意的是，因为只有4次交互机会，所以我们每次解的</strong>$k_i$<strong>应该在50bit左右，这就要求小因子的乘积应该在50bit左右</strong></p>
<p>如下，我选择的b使得曲线能有这样的小因子，这样既保证了求解$k_iG_i &#x3D; Q_i$比较快(因为这样的阶很光滑)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="number">11</span>,a = <span class="number">2</span>**<span class="number">4</span>*<span class="number">5</span>*<span class="number">7706591</span>*<span class="number">10310351</span>				<span class="comment"># 53bit</span></span><br><span class="line">b = <span class="number">18</span>,a = <span class="number">2</span>**<span class="number">3</span>*<span class="number">3</span>*<span class="number">5</span>*<span class="number">23</span>*<span class="number">1583</span>*<span class="number">17209</span>*<span class="number">31120709</span>		 <span class="comment"># 62bit</span></span><br><span class="line">b = <span class="number">21</span>,a = <span class="number">53</span>*<span class="number">83</span>*<span class="number">941</span>*<span class="number">23581</span>*<span class="number">34812431</span>				<span class="comment"># 62bit</span></span><br><span class="line">b = <span class="number">24</span>,a = <span class="number">7</span> * <span class="number">109</span>*<span class="number">30949</span>*<span class="number">454563497</span>				<span class="comment"># 54bit</span></span><br></pre></td></tr></table></figure>

<p>最后exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage </span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Pwn4Sage.pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof</span>():</span><br><span class="line">    table = string.ascii_letters + string.digits</span><br><span class="line"></span><br><span class="line">    GeShi = <span class="string">b&#x27;[+] Plz tell me XXXX: &#x27;</span>  <span class="comment"># 改格式！</span></span><br><span class="line">    </span><br><span class="line">    data = sh.recvuntil(GeShi).decode()</span><br><span class="line"></span><br><span class="line">    proof = data.split(<span class="string">&#x27;sha256&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    Xnum = proof.split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">0</span>].upper().count(<span class="string">&quot;X&quot;</span>)           <span class="comment">#要爆破的数量</span></span><br><span class="line">    tail = proof.split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;)&#x27;</span>)[<span class="number">0</span>].strip()</span><br><span class="line">    <span class="built_in">hash</span> = proof.split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;)&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;==&#x27;</span>)[-<span class="number">1</span>].split(<span class="string">&#x27;[&#x27;</span>)[<span class="number">0</span>].strip()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未知数:&quot;</span>,Xnum)</span><br><span class="line">    <span class="built_in">print</span>(tail)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hash</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始爆破&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(table,repeat=Xnum):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = hashlib.sha256((head + tail).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> t == <span class="built_in">hash</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;爆破成功！结果是：&#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(head)</span><br><span class="line">            sh.sendline(head.encode())</span><br><span class="line">            <span class="keyword">return</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = <span class="number">6277101735386680763835789423207666416083908700390324961276</span></span><br><span class="line">p = <span class="number">6277101735386680763835789423207666416083908700390324961279</span></span><br><span class="line">B = [(<span class="number">11</span>,<span class="number">6356612657875280</span>),(<span class="number">18</span>,<span class="number">2339888236982283480</span>),(<span class="number">21</span>,<span class="number">3398131299244482649</span>),(<span class="number">24</span>,<span class="number">10734101965182239</span>)]</span><br><span class="line">modnum = []</span><br><span class="line">secret = []</span><br><span class="line">PUB = []</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;115.159.221.202&#x27;</span>                  <span class="comment">#ip地址</span></span><br><span class="line">port =  <span class="number">11112</span>                              <span class="comment">#端口</span></span><br><span class="line">sh = remote(host,port)                  <span class="comment">#建立连接  </span></span><br><span class="line">proof()</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;The secret is&quot;</span>)</span><br><span class="line">cipher = <span class="built_in">bytes</span>.fromhex(<span class="built_in">str</span>(sh.recvline().decode().strip()))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;cipher = <span class="subst">&#123;cipher&#125;</span>&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&quot;Now send over yours !\n&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">4</span>):</span><br><span class="line">    b = B[i][<span class="number">0</span>]</span><br><span class="line">    E = EllipticCurve(Zmod(p),[a,b])</span><br><span class="line">    order = E.order()</span><br><span class="line">    G = E.gens()[<span class="number">0</span>]</span><br><span class="line">    factors = B[i][<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    sendG = (order//factors)*G</span><br><span class="line">    modnum.append(factors)</span><br><span class="line">    sendGx = <span class="built_in">int</span>(sendG[<span class="number">0</span>])</span><br><span class="line">    sendGy = <span class="built_in">int</span>(sendG[<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;Give me your pub key&#x27;s x :&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(sendGx).encode())</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;Give me your pub key&#x27;s y :&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(sendGy).encode())</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;The shared key is\n&quot;</span>)</span><br><span class="line">    temp = <span class="built_in">eval</span>(sh.recvline().strip().decode())</span><br><span class="line">    <span class="built_in">print</span>(temp)</span><br><span class="line">    Qx = <span class="built_in">int</span>(temp[<span class="number">0</span>])</span><br><span class="line">    Qy = <span class="built_in">int</span>(temp[<span class="number">1</span>])</span><br><span class="line">    Q = E(Qx,Qy)</span><br><span class="line">    PUB.append(Q)</span><br><span class="line">    k = discrete_log(Q,sendG,operation = <span class="string">&quot;+&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;k = <span class="subst">&#123;k&#125;</span>&quot;</span>)</span><br><span class="line">    secret.append(k)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">PK = crt(modnum,secret)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;PK = <span class="subst">&#123;PK&#125;</span>&quot;</span>)</span><br><span class="line">key = long_to_bytes(PK)[:<span class="number">16</span>]</span><br><span class="line">aes = AES.new(key,AES.MODE_ECB)</span><br><span class="line">flag = aes.decrypt(cipher)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># NCTF&#123;ca93509d-9ecf-11ee-9b92-b025aa41becb&#125;</span></span><br></pre></td></tr></table></figure>



<h1 id="赣CTF"><a href="#赣CTF" class="headerlink" title="赣CTF"></a>赣CTF</h1><h2 id="Paillier"><a href="#Paillier" class="headerlink" title="Paillier"></a>Paillier</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getStrongPrime,GCD,bytes_to_long</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">flag = <span class="string">b&quot;flag&#123;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            p = getStrongPrime(bits//<span class="number">2</span>)</span><br><span class="line">            q = getStrongPrime(bits//<span class="number">2</span>)</span><br><span class="line">            phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">assert</span> GCD(p*q, phi) == <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> p,q,phi</span><br><span class="line"></span><br><span class="line">p,q,phi = gen(<span class="number">4096</span>)</span><br><span class="line">relation = <span class="built_in">pow</span>(<span class="number">1949</span>*p+<span class="number">2023</span>,q,p*q)</span><br><span class="line">e = bytes_to_long(flag)</span><br><span class="line">n = p*p*q*q</span><br><span class="line">m1 = p*q+<span class="number">1</span></span><br><span class="line">m2 = randint(<span class="number">1</span>,p*q)</span><br><span class="line">c = <span class="built_in">pow</span>(m1,e,n)* <span class="built_in">pow</span>(m2,p*q,n) % n</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pq = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(p*q))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(c))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;r = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(relation))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pq = 887166447166908657875261838189880924598502010532802594357792586479405303600293352901354250661651440173678984721449155150569658414460907308207395217714073465789336037528820384504682261383134149950924711017705469385976843630755333653594133550138203226251679035220402593639286098419533450127641841763263532739412752119921519469031603370689902166613111442258053360353675972164543765953155296693017036110089750056317512700539251460392822501685118151651053736001643529228257725093507504777106651318771022545536494424257325948545285947224480124270824469387763520021373564659726071920334664660638427287881128656621366437992161335475097156562366370189800926486827773369343875911013941727458484733579779987518689440390273061310030122477970154371634800517544286207542226893322249504677426768230905352021685624446085667741447943553776127246344767559462950127895715194772578266968627117192022319478447762288841148942606807267300592648345050432191106211660661975538486044324700532413628992123771986347580132637422985487775324215641630120399614206165620577557862498513625751023336154441276494811321027022075968666161204083601567420981354579585765518249333579931543871485722588207836569306920651159678633890501000411112337862727032796320667777700319</span></span><br><span class="line"><span class="string">c = 323104572733056013022232486209795669816554834535601387232962336629170655850534314377617934197680759290559846935490656186083677314089429656804856335524692075372743032084131018452000127872246514430829438658543559900140854007878840361748526203998984411050117562232641090277061058838906587509258636800528603847445547938034130054858336906785685848654335600709939262479353368034082193509323294933603918116246340737911157061443282270207463561100105917304203916088760871308885091672255249534049979791578470331222906455224561104349847184035127559402743918823029257506812576223379821894308066258672451450683594036743320085094677256410814502550655295926629672064365774405226858361305878063559587655891732644666454675632155044600750031081929026668466076685284598678742892932867210546631035960182133659630156881113022786923840772277637984504620005258267988782585233487278808988499952500666966183475724382298888144869080055552509548958121952081310193858529205985575007298889289790765815033496387498756584008120132476400313134104152939600449003563325993472159269768874300428981316261923218359164567470793117504689390632939710978810213641551906532978338823420643316330940655937653381016347565948025800066537335606068590806366669159147613711722595108296517617501238810649394361783540984360800550967481778102693631148620612637261218694331865911082095074229724430736357231772418893822475389129656619563049190656052129978019794093431436182978689680711258096125364181724391940048059864568248424963697192515512824691745481055455041139683413323952422427478777508144913712466493631443481419743104115445055749214481472907347853218242035572752088863088586911967851839927488620703519887745185151057205452839656630428557432359081706642582626204620845683585079921271665513783694464226345490553425440395759713327751129225092651115897387818479920067054499945516535962600590291917909490839859244827186125356914569157371884400578544778284972543551747588182070545253302203256753412353635427924783586240203437409666455087583421435122682650900629397086322568717200715965469262221264526732434570241278318691467047049198011699661747618071924145079600200541539074616415662717381866674259250430391417176197430011943435148240516180992711773089637192808600745460407977081932525387006733024417765527436291902428861034477361566763013627884956795260111032669808711172167596733104788142220562239131262895357318086602746992514123306314802937058268304296208812601925747707823346394747245244912555520062443004568349</span></span><br><span class="line"><span class="string">r = 865637930492121361886040660958095287735652100059804297239549862305074524342882218036407756195501660137614332514449671726516318012272921644431634990397955755452418355435210702607050281478215501241593800950428265623124851502962706192747580206650440857460514057532387723966581671187821458771271495725813359545478050364573058316741586000836455350643646322854627450464873523811391446102913520775230108952542654623489324912508319173605941525541092868775740020238758970696523358855304171551467374093410916441923038159303426071896161802348155237253703136258350379905869362756354512195103530352494848068900430088690695486537882796843627424321556255359200236642772594700472060253927288260231875214517350548531219877990850510060538710218821389338975073365997691494936004212511479970247940758562853029615691559463499722174608861686562660451587690321371941877852557365507747135748755958542470652752809719469470047161978745121481217418159340152676451489205085786136051301309021641406617183846328887808447131843851965391259692686700087792622136451415147478524493146973717710487616252332933063236185679743903001346951192734414668183345639614973815042497781198548651467636425872167027265577291998910747253383240028130114553850989967444499041336167318</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>网上找了个脚本，留个坑，将来有时间复现</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p =        </span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line">q = n // p</span><br><span class="line">g = n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># c = g^m * r^n (mod n^2) =&gt;</span></span><br><span class="line"><span class="comment"># c mod n = g^m * r^n (mod n)</span></span><br><span class="line"><span class="comment"># And g (mod n) = 1, so g^m = 1 (mod n)  </span></span><br><span class="line"><span class="comment"># We got r^n = c (mod n) , and find that (φ(n),n) = 1 </span></span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)     </span><br><span class="line"><span class="comment"># Just solve r like RSA decryption</span></span><br><span class="line">r = <span class="built_in">pow</span>(c%n, gmpy2.invert(n, phi), n)</span><br><span class="line"><span class="comment"># convert equation to g^m = c*r^(-n) (mod n^2)</span></span><br><span class="line"><span class="comment"># g^m = (n+1)^m = mn + 1 (mod n^2)</span></span><br><span class="line"><span class="comment"># set a = c*r^(-n) - 1, </span></span><br><span class="line">a = c * <span class="built_in">pow</span>(gmpy2.invert(r,n*n), n, n*n) % (n*n) - <span class="number">1</span></span><br><span class="line"><span class="comment"># We have mn = a (mod n^2)</span></span><br><span class="line"><span class="comment"># n|a , n|mn , n|n^2 , So m = a/n (mod n) =&gt; m = a/n</span></span><br><span class="line">m = a//n </span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># print((a-1) % n)</span></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">	<span class="comment"># flag&#123;i_10ve_crypto!&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="强网杯"><a href="#强网杯" class="headerlink" title="强网杯"></a>强网杯</h1><p>被学长带飞了，排名58！！！</p>
<p>Vanish的wp👉<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/wKtMzkaCAdN2UE7aixxrpA">2023 强网杯 初赛 (qq.com)</a></p>
<h2 id="speed-up"><a href="#speed-up" class="headerlink" title="speed up"></a>speed up</h2><p>计算$2^{27}!$</p>
<blockquote>
<p>task</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> x:</span><br><span class="line">        res += x % <span class="number">10</span></span><br><span class="line">        x //= <span class="number">10</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">flag = flag&#123;sha256(f(x))&#125;</span><br></pre></td></tr></table></figure>

<p>f函数是把每个十进制位的值进行求和</p>
<h3 id="解法1"><a href="#解法1" class="headerlink" title="解法1"></a>解法1</h3><p><a target="_blank" rel="noopener" href="https://oeis.org/A244060/b244060.txt">网站</a>上找特殊的值</p>
<p><img src="/../images/%E6%9D%82/1.png" alt="1"></p>
<p><img src="/../images/%E6%9D%82/0.png"></p>
<h3 id="解法2"><a href="#解法2" class="headerlink" title="解法2"></a>解法2</h3><p>用Mathematica工具</p>
<p><img src="/../images/%E6%9D%82/2.png"></p>
<p>大概7分钟出结果</p>
<p>工具安装教程：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/632361071">Mathematica安装激活极简教程 - 知乎 (zhihu.com)</a></p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">t = <span class="number">4495662081</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;flag&#123;&quot;</span> + hashlib.sha256(<span class="built_in">str</span>(t).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h2 id="not-only-rsa"><a href="#not-only-rsa" class="headerlink" title="not only rsa"></a>not only rsa</h2><blockquote>
<p>task</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">n = <span class="number">6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849</span></span><br><span class="line">e = <span class="number">641747</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">flag = flag + os.urandom(n.bit_length() // <span class="number">8</span> - <span class="built_in">len</span>(flag) - <span class="number">1</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>, file=f)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>, file=f)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>, file=f)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>out</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n = 6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849</span><br><span class="line">e = 641747</span><br><span class="line">c = 730024611795626517480532940587152891926416120514706825368440230330259913837764632826884065065554839415540061752397144140563698277864414584568812699048873820551131185796851863064509294123861487954267708318027370912496252338232193619491860340395824180108335802813022066531232025997349683725357024257420090981323217296019482516072036780365510855555146547481407283231721904830868033930943</span><br></pre></td></tr></table></figure>

<p>n网站分解，拿到p</p>
<p>发现<code>gcd(e,phi)=e</code></p>
<p>用sagemath自带的<code>nth_root()</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">91027438112295439314606669837102361953591324472804851543344131406676387779969</span></span><br><span class="line">n = <span class="number">6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849</span></span><br><span class="line">e = <span class="number">641747</span></span><br><span class="line">c = <span class="number">730024611795626517480532940587152891926416120514706825368440230330259913837764632826884065065554839415540061752397144140563698277864414584568812699048873820551131185796851863064509294123861487954267708318027370912496252338232193619491860340395824180108335802813022066531232025997349683725357024257420090981323217296019482516072036780365510855555146547481407283231721904830868033930943</span></span><br><span class="line"></span><br><span class="line">res = Zmod(n)(c).nth_root(e, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> res:</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment">#flag&#123;c19c3ec0-d489-4bbb-83fc-bc0419a6822a&#125;</span></span><br></pre></td></tr></table></figure>

<p>根据<a target="_blank" rel="noopener" href="https://www.cnblogs.com/vconlln/p/17066506.html">sagemath密码学 - vconlln - 博客园 (cnblogs.com)</a>提到的</p>
<p><code>Zmod(n)(c).nth_root(t,all=&#39;True&#39;)</code>作用是：在模$n$下求$c$的t次根</p>
<p>还可以求解离散对数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x=mod(<span class="number">5</span>,<span class="number">41</span>)</span><br><span class="line">r=x.nth_root(<span class="number">22</span>)</span><br></pre></td></tr></table></figure>



<h1 id="楚慧杯"><a href="#楚慧杯" class="headerlink" title="楚慧杯"></a>楚慧杯</h1><h2 id="so-large-e"><a href="#so-large-e" class="headerlink" title="so large e"></a>so large e</h2><blockquote>
<p>task</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = random.getrandbits(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">assert</span> size(e)==<span class="number">1024</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">assert</span> GCD(e,phi)==<span class="number">1</span></span><br><span class="line">d = inverse(e,phi)</span><br><span class="line"><span class="keyword">assert</span> size(d)==<span class="number">269</span></span><br><span class="line"></span><br><span class="line">pub = (n, e)</span><br><span class="line">PublicKey = RSA.construct(pub)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;pub.pem&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f :</span><br><span class="line">    f.write(PublicKey.exportKey())</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#c = 6838759631922176040297411386959306230064807618456930982742841698524622016849807235726065272136043603027166249075560058232683230155346614429566511309977857815138004298815137913729662337535371277019856193898546849896085411001528569293727010020290576888205244471943227253000727727343731590226737192613447347860</span></span><br></pre></td></tr></table></figure>

<p>提取公钥得到n,e</p>
<p>发现$\frac{d}{n} &#x3D; 0.26269$</p>
<p>多半就是<strong>boneh_durfee</strong>攻击手段</p>
<p>改改example()函数的<code>delta</code>和<code>m</code>即可</p>
<p><code>delta</code>就是$\frac{d}{n}$的大小</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Config</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct</span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this</span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions</span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;* removing unhelpful vector&quot;</span>, ii)</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line">    <span class="comment"># How To Use This Script</span></span><br><span class="line">    <span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># The problem to solve (edit the following values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the modulus</span></span><br><span class="line">    N = <span class="number">116518679305515263290840706715579691213922169271634579327519562902613543582623449606741546472920401997930041388553141909069487589461948798111698856100819163407893673249162209631978914843896272256274862501461321020961958367098759183487116417487922645782638510876609728886007680825340200888068103951956139343723</span></span><br><span class="line">    e = <span class="number">113449247876071397911206070019495939088171696712182747502133063172021565345788627261740950665891922659340020397229619329204520999096535909867327960323598168596664323692312516466648588320607291284630435682282630745947689431909998401389566081966753438869725583665294310689820290368901166811028660086977458571233</span></span><br><span class="line">    <span class="comment"># the public exponent</span></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line">    delta = <span class="number">.27</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line">    m = <span class="number">5</span> <span class="comment"># size of the lattice (bigger the better/slower)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">    t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">    X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">    Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Don&#x27;t touch anything below</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Problem put in equation</span></span><br><span class="line">    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    A = <span class="built_in">int</span>((N+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">    pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Find the solutions!</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Checking bounds</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== checking values ===&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* delta:&quot;</span>, delta)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* delta &lt; 0.292&quot;</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* size of e:&quot;</span>, <span class="built_in">int</span>(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* size of N:&quot;</span>, <span class="built_in">int</span>(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* m:&quot;</span>, m, <span class="string">&quot;, t:&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># boneh_durfee</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== running algorithm ===&quot;</span>)</span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">    solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># found a solution?</span></span><br><span class="line">    <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"></span><br><span class="line">        d = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;private key found:&quot;</span>, d)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== no solution was found ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>((<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example()</span><br></pre></td></tr></table></figure>

<p>解的<code>d = 663822343397699728953336968317794118491145998032244266550694156830036498673227937</code></p>
<p>最后解RSA</p>
<p><code>flag:DASCTF&#123;6f4fadce-5378-d17f-3c2d-2e064db4af19&#125;</code></p>
<h1 id="强网拟态决赛"><a href="#强网拟态决赛" class="headerlink" title="强网拟态决赛"></a>强网拟态决赛</h1><h2 id="BadRSA"><a href="#BadRSA" class="headerlink" title="BadRSA"></a>BadRSA</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">m = bytes_to_long(f.readline().strip())</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">e = getPrime(<span class="number">8</span>)</span><br><span class="line">n = p*q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line">leak = d &amp; ((<span class="number">1</span>&lt;&lt;<span class="number">265</span>) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;leak = <span class="subst">&#123;leak&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">e = 149</span></span><br><span class="line"><span class="string">leak = 6001958312144157007304943931113872134090201010357773442954181100786589106572169</span></span><br><span class="line"><span class="string">n = 88436063749749362190546240596734626745594171540325086418270903156390958817492063940459108934841028734921718351342152598224670602551497995639921650979296052943953491639892805985538785565357751736799561653032725751622522198746331856539251721033316195306373318196300612386897339425222615697620795751869751705629</span></span><br><span class="line"><span class="string">c = 1206332017436789083799133504302957634035030644841294494992108068042941783794804420630684301945366528832108224264145563741764232409333108261614056154508904583078897178425071831580459193200987943565099780857889864631160747321901113496943710282498262354984634755751858251005566753245882185271726628553508627299</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>由$ed \equiv 1 \mod \phi(n)$</p>
<p>即$ed &#x3D; k(p-1)(q-1) + 1$</p>
<p>两边同时模$2^{265}$，得$ed_0 \equiv k(p-1)(q-1) + 1 \mod 2^{265}$，这里$d_0 &#x3D; leak$</p>
<p>$\therefore ed_0 \equiv k(pq - p - q + 1) + 1 \mod 2^{265}$</p>
<p>再同乘$p$，得到$ed_0p \equiv knp - kp^2 - kn + kp + p \mod 2^{265}$</p>
<p>因为$d \approx 1023bit$</p>
<p>所以$k &lt; e$</p>
<p>爆破$k$，解方程得到$p$的低位，然后用copper恢复$p$</p>
<p>exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e = <span class="number">149</span></span><br><span class="line">d0 = <span class="number">6001958312144157007304943931113872134090201010357773442954181100786589106572169</span></span><br><span class="line">n = <span class="number">88436063749749362190546240596734626745594171540325086418270903156390958817492063940459108934841028734921718351342152598224670602551497995639921650979296052943953491639892805985538785565357751736799561653032725751622522198746331856539251721033316195306373318196300612386897339425222615697620795751869751705629</span></span><br><span class="line">c = <span class="number">1206332017436789083799133504302957634035030644841294494992108068042941783794804420630684301945366528832108224264145563741764232409333108261614056154508904583078897178425071831580459193200987943565099780857889864631160747321901113496943710282498262354984634755751858251005566753245882185271726628553508627299</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,e):</span><br><span class="line">    var(<span class="string">&quot;p&quot;</span>)</span><br><span class="line">    temp = e*d0*p</span><br><span class="line">    f = (k*n*p - k*p^<span class="number">2</span> - k*n + k*p + p) - temp  == <span class="number">0</span></span><br><span class="line">    roots = solve_mod([f],<span class="number">2</span>^<span class="number">265</span>)</span><br><span class="line">    <span class="keyword">if</span> roots != []:</span><br><span class="line">        <span class="keyword">for</span> root <span class="keyword">in</span> roots:</span><br><span class="line">            plow = <span class="built_in">int</span>(root[<span class="number">0</span>])</span><br><span class="line">			<span class="comment">#print(plow)</span></span><br><span class="line">			<span class="comment"># 55136429770900518182274612434328885021714880080534773062619965935822096183916139</span></span><br><span class="line">            R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">            </span><br><span class="line">            f1 = x*<span class="number">2</span>^<span class="number">265</span> + plow</span><br><span class="line">            f1 = f1.monic()</span><br><span class="line">            res = f1.small_roots(X=<span class="number">2</span>^<span class="number">247</span>,beta=<span class="number">0.5</span>,epsilon = <span class="number">0.01</span>)</span><br><span class="line">            <span class="keyword">if</span> res != []:</span><br><span class="line">                <span class="built_in">print</span>(res)</span><br><span class="line">                <span class="comment"># [188210689227294472160085325314952069542671020803828390144430392548173787275]</span></span><br><span class="line">                p = <span class="built_in">int</span>(res[<span class="number">0</span>])*<span class="number">2</span>^<span class="number">265</span> + plow</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>,p)</span><br><span class="line">                <span class="comment"># p = 11158174168280917736979570452068827611755694573672250873587467083259280584739528118050085070475912733864211083865201596017044398008278425498714490994488939</span></span><br><span class="line">                q = n // p</span><br><span class="line">                d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">                m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line">                <span class="comment"># flag&#123;827ccb0eea8a706c4c34a16891f84e7b&#125;</span></span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>这里<code>beta = 0.5</code>是因为，对于度（即最大次方）为$d$的多项式，要求根小于$n^{\frac{\beta^2}{d} - \epsilon}$，而且要求因子$p &gt; n^{\beta}$</p>
<p>此题$d &#x3D; 1$，经过计算我们要求的根的上界为$2^{247}$，$\frac{247}{1024} &#x3D; 0.2412$，所以取<code>beta = 0.5</code>可以恢复p</p>

    </div>

    
    
    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------已经到底啦！<i class="fa fa-paw"></i>-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>DexterJie
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dexterjie.github.io/2023/12/17/%E6%9D%82%E8%AE%B0/" title="杂记(1)">https://dexterjie.github.io/2023/12/17/杂记/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/11/29/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023ISCTF/" rel="prev" title="2023ISCTF">
                  <i class="fa fa-chevron-left"></i> 2023ISCTF
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/12/23/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023%E5%AE%89%E6%B4%B5%E6%9D%AF/" rel="next" title="2023安洵杯">
                  2023安洵杯 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DexterJie</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">233k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">14:06</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->


    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
<div class="busuanzi-count">
  <script async src="/js/busuanzi.pure.mini.js"></script>
  
  <span class="site-uv" title="总访客量">
    访客量<span id="busuanzi_value_site_uv"></span>
  </span>

  <span class="site-pv" title="总访问量">
    经过<span id="busuanzi_value_site_pv"></span>次回眸与你相遇
  </span>
</div>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"waline-five-mocha.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"locale":null,"placeholder":"请文明评论呀","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":false,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2023/12/17/%E6%9D%82%E8%AE%B0/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right"},"mobile":{"show":true}});</script></body>

</html>
